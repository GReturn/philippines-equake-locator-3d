(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=t(s);fetch(s.href,a)}})();var fd={exports:{}},uo={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s0;function jS(){if(s0)return uo;s0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,a){var l=null;if(a!==void 0&&(l=""+a),s.key!==void 0&&(l=""+s.key),"key"in s){a={};for(var u in s)u!=="key"&&(a[u]=s[u])}else a=s;return s=a.ref,{$$typeof:n,type:i,key:l,ref:s!==void 0?s:null,props:a}}return uo.Fragment=e,uo.jsx=t,uo.jsxs=t,uo}var r0;function $S(){return r0||(r0=1,fd.exports=jS()),fd.exports}var ve=$S(),hd={exports:{}},Te={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a0;function WS(){if(a0)return Te;a0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.for("react.activity"),y=Symbol.iterator;function v(I){return I===null||typeof I!="object"?null:(I=y&&I[y]||I["@@iterator"],typeof I=="function"?I:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,E={};function C(I,G,oe){this.props=I,this.context=G,this.refs=E,this.updater=oe||x}C.prototype.isReactComponent={},C.prototype.setState=function(I,G){if(typeof I!="object"&&typeof I!="function"&&I!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,I,G,"setState")},C.prototype.forceUpdate=function(I){this.updater.enqueueForceUpdate(this,I,"forceUpdate")};function D(){}D.prototype=C.prototype;function M(I,G,oe){this.props=I,this.context=G,this.refs=E,this.updater=oe||x}var B=M.prototype=new D;B.constructor=M,A(B,C.prototype),B.isPureReactComponent=!0;var z=Array.isArray;function X(){}var ne={H:null,A:null,T:null,S:null},ae=Object.prototype.hasOwnProperty;function ie(I,G,oe){var ce=oe.ref;return{$$typeof:n,type:I,key:G,ref:ce!==void 0?ce:null,props:oe}}function ge(I,G){return ie(I.type,G,I.props)}function ee(I){return typeof I=="object"&&I!==null&&I.$$typeof===n}function fe(I){var G={"=":"=0",":":"=2"};return"$"+I.replace(/[=:]/g,function(oe){return G[oe]})}var we=/\/+/g;function me(I,G){return typeof I=="object"&&I!==null&&I.key!=null?fe(""+I.key):G.toString(36)}function He(I){switch(I.status){case"fulfilled":return I.value;case"rejected":throw I.reason;default:switch(typeof I.status=="string"?I.then(X,X):(I.status="pending",I.then(function(G){I.status==="pending"&&(I.status="fulfilled",I.value=G)},function(G){I.status==="pending"&&(I.status="rejected",I.reason=G)})),I.status){case"fulfilled":return I.value;case"rejected":throw I.reason}}throw I}function W(I,G,oe,ce,Z){var ue=typeof I;(ue==="undefined"||ue==="boolean")&&(I=null);var be=!1;if(I===null)be=!0;else switch(ue){case"bigint":case"string":case"number":be=!0;break;case"object":switch(I.$$typeof){case n:case e:be=!0;break;case p:return be=I._init,W(be(I._payload),G,oe,ce,Z)}}if(be)return Z=Z(I),be=ce===""?"."+me(I,0):ce,z(Z)?(oe="",be!=null&&(oe=be.replace(we,"$&/")+"/"),W(Z,G,oe,"",function(Zn){return Zn})):Z!=null&&(ee(Z)&&(Z=ge(Z,oe+(Z.key==null||I&&I.key===Z.key?"":(""+Z.key).replace(we,"$&/")+"/")+be)),G.push(Z)),1;be=0;var Ne=ce===""?".":ce+":";if(z(I))for(var Ke=0;Ke<I.length;Ke++)ce=I[Ke],ue=Ne+me(ce,Ke),be+=W(ce,G,oe,ue,Z);else if(Ke=v(I),typeof Ke=="function")for(I=Ke.call(I),Ke=0;!(ce=I.next()).done;)ce=ce.value,ue=Ne+me(ce,Ke++),be+=W(ce,G,oe,ue,Z);else if(ue==="object"){if(typeof I.then=="function")return W(He(I),G,oe,ce,Z);throw G=String(I),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.")}return be}function se(I,G,oe){if(I==null)return I;var ce=[],Z=0;return W(I,ce,"","",function(ue){return G.call(oe,ue,Z++)}),ce}function de(I){if(I._status===-1){var G=I._result;G=G(),G.then(function(oe){(I._status===0||I._status===-1)&&(I._status=1,I._result=oe)},function(oe){(I._status===0||I._status===-1)&&(I._status=2,I._result=oe)}),I._status===-1&&(I._status=0,I._result=G)}if(I._status===1)return I._result.default;throw I._result}var Ee=typeof reportError=="function"?reportError:function(I){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var G=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof I=="object"&&I!==null&&typeof I.message=="string"?String(I.message):String(I),error:I});if(!window.dispatchEvent(G))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",I);return}console.error(I)},Le={map:se,forEach:function(I,G,oe){se(I,function(){G.apply(this,arguments)},oe)},count:function(I){var G=0;return se(I,function(){G++}),G},toArray:function(I){return se(I,function(G){return G})||[]},only:function(I){if(!ee(I))throw Error("React.Children.only expected to receive a single React element child.");return I}};return Te.Activity=m,Te.Children=Le,Te.Component=C,Te.Fragment=t,Te.Profiler=s,Te.PureComponent=M,Te.StrictMode=i,Te.Suspense=h,Te.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ne,Te.__COMPILER_RUNTIME={__proto__:null,c:function(I){return ne.H.useMemoCache(I)}},Te.cache=function(I){return function(){return I.apply(null,arguments)}},Te.cacheSignal=function(){return null},Te.cloneElement=function(I,G,oe){if(I==null)throw Error("The argument must be a React element, but you passed "+I+".");var ce=A({},I.props),Z=I.key;if(G!=null)for(ue in G.key!==void 0&&(Z=""+G.key),G)!ae.call(G,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&G.ref===void 0||(ce[ue]=G[ue]);var ue=arguments.length-2;if(ue===1)ce.children=oe;else if(1<ue){for(var be=Array(ue),Ne=0;Ne<ue;Ne++)be[Ne]=arguments[Ne+2];ce.children=be}return ie(I.type,Z,ce)},Te.createContext=function(I){return I={$$typeof:l,_currentValue:I,_currentValue2:I,_threadCount:0,Provider:null,Consumer:null},I.Provider=I,I.Consumer={$$typeof:a,_context:I},I},Te.createElement=function(I,G,oe){var ce,Z={},ue=null;if(G!=null)for(ce in G.key!==void 0&&(ue=""+G.key),G)ae.call(G,ce)&&ce!=="key"&&ce!=="__self"&&ce!=="__source"&&(Z[ce]=G[ce]);var be=arguments.length-2;if(be===1)Z.children=oe;else if(1<be){for(var Ne=Array(be),Ke=0;Ke<be;Ke++)Ne[Ke]=arguments[Ke+2];Z.children=Ne}if(I&&I.defaultProps)for(ce in be=I.defaultProps,be)Z[ce]===void 0&&(Z[ce]=be[ce]);return ie(I,ue,Z)},Te.createRef=function(){return{current:null}},Te.forwardRef=function(I){return{$$typeof:u,render:I}},Te.isValidElement=ee,Te.lazy=function(I){return{$$typeof:p,_payload:{_status:-1,_result:I},_init:de}},Te.memo=function(I,G){return{$$typeof:d,type:I,compare:G===void 0?null:G}},Te.startTransition=function(I){var G=ne.T,oe={};ne.T=oe;try{var ce=I(),Z=ne.S;Z!==null&&Z(oe,ce),typeof ce=="object"&&ce!==null&&typeof ce.then=="function"&&ce.then(X,Ee)}catch(ue){Ee(ue)}finally{G!==null&&oe.types!==null&&(G.types=oe.types),ne.T=G}},Te.unstable_useCacheRefresh=function(){return ne.H.useCacheRefresh()},Te.use=function(I){return ne.H.use(I)},Te.useActionState=function(I,G,oe){return ne.H.useActionState(I,G,oe)},Te.useCallback=function(I,G){return ne.H.useCallback(I,G)},Te.useContext=function(I){return ne.H.useContext(I)},Te.useDebugValue=function(){},Te.useDeferredValue=function(I,G){return ne.H.useDeferredValue(I,G)},Te.useEffect=function(I,G){return ne.H.useEffect(I,G)},Te.useEffectEvent=function(I){return ne.H.useEffectEvent(I)},Te.useId=function(){return ne.H.useId()},Te.useImperativeHandle=function(I,G,oe){return ne.H.useImperativeHandle(I,G,oe)},Te.useInsertionEffect=function(I,G){return ne.H.useInsertionEffect(I,G)},Te.useLayoutEffect=function(I,G){return ne.H.useLayoutEffect(I,G)},Te.useMemo=function(I,G){return ne.H.useMemo(I,G)},Te.useOptimistic=function(I,G){return ne.H.useOptimistic(I,G)},Te.useReducer=function(I,G,oe){return ne.H.useReducer(I,G,oe)},Te.useRef=function(I){return ne.H.useRef(I)},Te.useState=function(I){return ne.H.useState(I)},Te.useSyncExternalStore=function(I,G,oe){return ne.H.useSyncExternalStore(I,G,oe)},Te.useTransition=function(){return ne.H.useTransition()},Te.version="19.2.0",Te}var o0;function Mu(){return o0||(o0=1,hd.exports=WS()),hd.exports}var te=Mu(),dd={exports:{}},fo={},pd={exports:{}},gd={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l0;function XS(){return l0||(l0=1,(function(n){function e(W,se){var de=W.length;W.push(se);e:for(;0<de;){var Ee=de-1>>>1,Le=W[Ee];if(0<s(Le,se))W[Ee]=se,W[de]=Le,de=Ee;else break e}}function t(W){return W.length===0?null:W[0]}function i(W){if(W.length===0)return null;var se=W[0],de=W.pop();if(de!==se){W[0]=de;e:for(var Ee=0,Le=W.length,I=Le>>>1;Ee<I;){var G=2*(Ee+1)-1,oe=W[G],ce=G+1,Z=W[ce];if(0>s(oe,de))ce<Le&&0>s(Z,oe)?(W[Ee]=Z,W[ce]=de,Ee=ce):(W[Ee]=oe,W[G]=de,Ee=G);else if(ce<Le&&0>s(Z,de))W[Ee]=Z,W[ce]=de,Ee=ce;else break e}}return se}function s(W,se){var de=W.sortIndex-se.sortIndex;return de!==0?de:W.id-se.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();n.unstable_now=function(){return l.now()-u}}var h=[],d=[],p=1,m=null,y=3,v=!1,x=!1,A=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function B(W){for(var se=t(d);se!==null;){if(se.callback===null)i(d);else if(se.startTime<=W)i(d),se.sortIndex=se.expirationTime,e(h,se);else break;se=t(d)}}function z(W){if(A=!1,B(W),!x)if(t(h)!==null)x=!0,X||(X=!0,fe());else{var se=t(d);se!==null&&He(z,se.startTime-W)}}var X=!1,ne=-1,ae=5,ie=-1;function ge(){return E?!0:!(n.unstable_now()-ie<ae)}function ee(){if(E=!1,X){var W=n.unstable_now();ie=W;var se=!0;try{e:{x=!1,A&&(A=!1,D(ne),ne=-1),v=!0;var de=y;try{t:{for(B(W),m=t(h);m!==null&&!(m.expirationTime>W&&ge());){var Ee=m.callback;if(typeof Ee=="function"){m.callback=null,y=m.priorityLevel;var Le=Ee(m.expirationTime<=W);if(W=n.unstable_now(),typeof Le=="function"){m.callback=Le,B(W),se=!0;break t}m===t(h)&&i(h),B(W)}else i(h);m=t(h)}if(m!==null)se=!0;else{var I=t(d);I!==null&&He(z,I.startTime-W),se=!1}}break e}finally{m=null,y=de,v=!1}se=void 0}}finally{se?fe():X=!1}}}var fe;if(typeof M=="function")fe=function(){M(ee)};else if(typeof MessageChannel<"u"){var we=new MessageChannel,me=we.port2;we.port1.onmessage=ee,fe=function(){me.postMessage(null)}}else fe=function(){C(ee,0)};function He(W,se){ne=C(function(){W(n.unstable_now())},se)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(W){W.callback=null},n.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<W?Math.floor(1e3/W):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(W){switch(y){case 1:case 2:case 3:var se=3;break;default:se=y}var de=y;y=se;try{return W()}finally{y=de}},n.unstable_requestPaint=function(){E=!0},n.unstable_runWithPriority=function(W,se){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var de=y;y=W;try{return se()}finally{y=de}},n.unstable_scheduleCallback=function(W,se,de){var Ee=n.unstable_now();switch(typeof de=="object"&&de!==null?(de=de.delay,de=typeof de=="number"&&0<de?Ee+de:Ee):de=Ee,W){case 1:var Le=-1;break;case 2:Le=250;break;case 5:Le=1073741823;break;case 4:Le=1e4;break;default:Le=5e3}return Le=de+Le,W={id:p++,callback:se,priorityLevel:W,startTime:de,expirationTime:Le,sortIndex:-1},de>Ee?(W.sortIndex=de,e(d,W),t(h)===null&&W===t(d)&&(A?(D(ne),ne=-1):A=!0,He(z,de-Ee))):(W.sortIndex=Le,e(h,W),x||v||(x=!0,X||(X=!0,fe()))),W},n.unstable_shouldYield=ge,n.unstable_wrapCallback=function(W){var se=y;return function(){var de=y;y=se;try{return W.apply(this,arguments)}finally{y=de}}}})(gd)),gd}var c0;function YS(){return c0||(c0=1,pd.exports=XS()),pd.exports}var _d={exports:{}},Ct={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u0;function qS(){if(u0)return Ct;u0=1;var n=Mu();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)d+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function a(h,d,p){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:h,containerInfo:d,implementation:p}}var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Ct.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Ct.createPortal=function(h,d){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return a(h,d,null,p)},Ct.flushSync=function(h){var d=l.T,p=i.p;try{if(l.T=null,i.p=2,h)return h()}finally{l.T=d,i.p=p,i.d.f()}},Ct.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(h,d))},Ct.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},Ct.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var p=d.as,m=u(p,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,v=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;p==="style"?i.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:v}):p==="script"&&i.d.X(h,{crossOrigin:m,integrity:y,fetchPriority:v,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Ct.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var p=u(d.as,d.crossOrigin);i.d.M(h,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(h)},Ct.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var p=d.as,m=u(p,d.crossOrigin);i.d.L(h,p,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Ct.preloadModule=function(h,d){if(typeof h=="string")if(d){var p=u(d.as,d.crossOrigin);i.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(h)},Ct.requestFormReset=function(h){i.d.r(h)},Ct.unstable_batchedUpdates=function(h,d){return h(d)},Ct.useFormState=function(h,d,p){return l.H.useFormState(h,d,p)},Ct.useFormStatus=function(){return l.H.useHostTransitionStatus()},Ct.version="19.2.0",Ct}var f0;function r1(){if(f0)return _d.exports;f0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),_d.exports=qS(),_d.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h0;function ZS(){if(h0)return fo;h0=1;var n=YS(),e=Mu(),t=r1();function i(r){var o="https://react.dev/errors/"+r;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)o+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+r+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function a(r){var o=r,c=r;if(r.alternate)for(;o.return;)o=o.return;else{r=o;do o=r,(o.flags&4098)!==0&&(c=o.return),r=o.return;while(r)}return o.tag===3?c:null}function l(r){if(r.tag===13){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function u(r){if(r.tag===31){var o=r.memoizedState;if(o===null&&(r=r.alternate,r!==null&&(o=r.memoizedState)),o!==null)return o.dehydrated}return null}function h(r){if(a(r)!==r)throw Error(i(188))}function d(r){var o=r.alternate;if(!o){if(o=a(r),o===null)throw Error(i(188));return o!==r?null:r}for(var c=r,f=o;;){var g=c.return;if(g===null)break;var _=g.alternate;if(_===null){if(f=g.return,f!==null){c=f;continue}break}if(g.child===_.child){for(_=g.child;_;){if(_===c)return h(g),r;if(_===f)return h(g),o;_=_.sibling}throw Error(i(188))}if(c.return!==f.return)c=g,f=_;else{for(var b=!1,T=g.child;T;){if(T===c){b=!0,c=g,f=_;break}if(T===f){b=!0,f=g,c=_;break}T=T.sibling}if(!b){for(T=_.child;T;){if(T===c){b=!0,c=_,f=g;break}if(T===f){b=!0,f=_,c=g;break}T=T.sibling}if(!b)throw Error(i(189))}}if(c.alternate!==f)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?r:o}function p(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r;for(r=r.child;r!==null;){if(o=p(r),o!==null)return o;r=r.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),D=Symbol.for("react.consumer"),M=Symbol.for("react.context"),B=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),X=Symbol.for("react.suspense_list"),ne=Symbol.for("react.memo"),ae=Symbol.for("react.lazy"),ie=Symbol.for("react.activity"),ge=Symbol.for("react.memo_cache_sentinel"),ee=Symbol.iterator;function fe(r){return r===null||typeof r!="object"?null:(r=ee&&r[ee]||r["@@iterator"],typeof r=="function"?r:null)}var we=Symbol.for("react.client.reference");function me(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===we?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case A:return"Fragment";case C:return"Profiler";case E:return"StrictMode";case z:return"Suspense";case X:return"SuspenseList";case ie:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case x:return"Portal";case M:return r.displayName||"Context";case D:return(r._context.displayName||"Context")+".Consumer";case B:var o=r.render;return r=r.displayName,r||(r=o.displayName||o.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case ne:return o=r.displayName||null,o!==null?o:me(r.type)||"Memo";case ae:o=r._payload,r=r._init;try{return me(r(o))}catch{}}return null}var He=Array.isArray,W=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,de={pending:!1,data:null,method:null,action:null},Ee=[],Le=-1;function I(r){return{current:r}}function G(r){0>Le||(r.current=Ee[Le],Ee[Le]=null,Le--)}function oe(r,o){Le++,Ee[Le]=r.current,r.current=o}var ce=I(null),Z=I(null),ue=I(null),be=I(null);function Ne(r,o){switch(oe(ue,o),oe(Z,r),oe(ce,null),o.nodeType){case 9:case 11:r=(r=o.documentElement)&&(r=r.namespaceURI)?Rb(r):0;break;default:if(r=o.tagName,o=o.namespaceURI)o=Rb(o),r=Cb(o,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}G(ce),oe(ce,r)}function Ke(){G(ce),G(Z),G(ue)}function Zn(r){r.memoizedState!==null&&oe(be,r);var o=ce.current,c=Cb(o,r.type);o!==c&&(oe(Z,r),oe(ce,c))}function Wt(r){Z.current===r&&(G(ce),G(Z)),be.current===r&&(G(be),ao._currentValue=de)}var rs,tl;function as(r){if(rs===void 0)try{throw Error()}catch(c){var o=c.stack.trim().match(/\n( *(at )?)/);rs=o&&o[1]||"",tl=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+rs+r+tl}var Yu=!1;function qu(r,o){if(!r||Yu)return"";Yu=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var Q=function(){throw Error()};if(Object.defineProperty(Q.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Q,[])}catch($){var j=$}Reflect.construct(r,[],Q)}else{try{Q.call()}catch($){j=$}r.call(Q.prototype)}}else{try{throw Error()}catch($){j=$}(Q=r())&&typeof Q.catch=="function"&&Q.catch(function(){})}}catch($){if($&&j&&typeof $.stack=="string")return[$.stack,j.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=f.DetermineComponentFrameRoot(),b=_[0],T=_[1];if(b&&T){var R=b.split(`
`),H=T.split(`
`);for(g=f=0;f<R.length&&!R[f].includes("DetermineComponentFrameRoot");)f++;for(;g<H.length&&!H[g].includes("DetermineComponentFrameRoot");)g++;if(f===R.length||g===H.length)for(f=R.length-1,g=H.length-1;1<=f&&0<=g&&R[f]!==H[g];)g--;for(;1<=f&&0<=g;f--,g--)if(R[f]!==H[g]){if(f!==1||g!==1)do if(f--,g--,0>g||R[f]!==H[g]){var Y=`
`+R[f].replace(" at new "," at ");return r.displayName&&Y.includes("<anonymous>")&&(Y=Y.replace("<anonymous>",r.displayName)),Y}while(1<=f&&0<=g);break}}}finally{Yu=!1,Error.prepareStackTrace=c}return(c=r?r.displayName||r.name:"")?as(c):""}function vx(r,o){switch(r.tag){case 26:case 27:case 5:return as(r.type);case 16:return as("Lazy");case 13:return r.child!==o&&o!==null?as("Suspense Fallback"):as("Suspense");case 19:return as("SuspenseList");case 0:case 15:return qu(r.type,!1);case 11:return qu(r.type.render,!1);case 1:return qu(r.type,!0);case 31:return as("Activity");default:return""}}function s_(r){try{var o="",c=null;do o+=vx(r,c),c=r,r=r.return;while(r);return o}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var Zu=Object.prototype.hasOwnProperty,Ku=n.unstable_scheduleCallback,Qu=n.unstable_cancelCallback,Tx=n.unstable_shouldYield,xx=n.unstable_requestPaint,Xt=n.unstable_now,wx=n.unstable_getCurrentPriorityLevel,r_=n.unstable_ImmediatePriority,a_=n.unstable_UserBlockingPriority,nl=n.unstable_NormalPriority,Sx=n.unstable_LowPriority,o_=n.unstable_IdlePriority,Ax=n.log,Ex=n.unstable_setDisableYieldValue,ya=null,Yt=null;function xi(r){if(typeof Ax=="function"&&Ex(r),Yt&&typeof Yt.setStrictMode=="function")try{Yt.setStrictMode(ya,r)}catch{}}var qt=Math.clz32?Math.clz32:Mx,Rx=Math.log,Cx=Math.LN2;function Mx(r){return r>>>=0,r===0?32:31-(Rx(r)/Cx|0)|0}var il=256,sl=262144,rl=4194304;function os(r){var o=r&42;if(o!==0)return o;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function al(r,o,c){var f=r.pendingLanes;if(f===0)return 0;var g=0,_=r.suspendedLanes,b=r.pingedLanes;r=r.warmLanes;var T=f&134217727;return T!==0?(f=T&~_,f!==0?g=os(f):(b&=T,b!==0?g=os(b):c||(c=T&~r,c!==0&&(g=os(c))))):(T=f&~_,T!==0?g=os(T):b!==0?g=os(b):c||(c=f&~r,c!==0&&(g=os(c)))),g===0?0:o!==0&&o!==g&&(o&_)===0&&(_=g&-g,c=o&-o,_>=c||_===32&&(c&4194048)!==0)?o:g}function ba(r,o){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&o)===0}function Ox(r,o){switch(r){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function l_(){var r=rl;return rl<<=1,(rl&62914560)===0&&(rl=4194304),r}function Gu(r){for(var o=[],c=0;31>c;c++)o.push(r);return o}function va(r,o){r.pendingLanes|=o,o!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Ix(r,o,c,f,g,_){var b=r.pendingLanes;r.pendingLanes=c,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=c,r.entangledLanes&=c,r.errorRecoveryDisabledLanes&=c,r.shellSuspendCounter=0;var T=r.entanglements,R=r.expirationTimes,H=r.hiddenUpdates;for(c=b&~c;0<c;){var Y=31-qt(c),Q=1<<Y;T[Y]=0,R[Y]=-1;var j=H[Y];if(j!==null)for(H[Y]=null,Y=0;Y<j.length;Y++){var $=j[Y];$!==null&&($.lane&=-536870913)}c&=~Q}f!==0&&c_(r,f,0),_!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=_&~(b&~o))}function c_(r,o,c){r.pendingLanes|=o,r.suspendedLanes&=~o;var f=31-qt(o);r.entangledLanes|=o,r.entanglements[f]=r.entanglements[f]|1073741824|c&261930}function u_(r,o){var c=r.entangledLanes|=o;for(r=r.entanglements;c;){var f=31-qt(c),g=1<<f;g&o|r[f]&o&&(r[f]|=o),c&=~g}}function f_(r,o){var c=o&-o;return c=(c&42)!==0?1:Ju(c),(c&(r.suspendedLanes|o))!==0?0:c}function Ju(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function ef(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function h_(){var r=se.p;return r!==0?r:(r=window.event,r===void 0?32:Qb(r.type))}function d_(r,o){var c=se.p;try{return se.p=r,o()}finally{se.p=c}}var wi=Math.random().toString(36).slice(2),wt="__reactFiber$"+wi,Ut="__reactProps$"+wi,Js="__reactContainer$"+wi,tf="__reactEvents$"+wi,Nx="__reactListeners$"+wi,kx="__reactHandles$"+wi,p_="__reactResources$"+wi,Ta="__reactMarker$"+wi;function nf(r){delete r[wt],delete r[Ut],delete r[tf],delete r[Nx],delete r[kx]}function er(r){var o=r[wt];if(o)return o;for(var c=r.parentNode;c;){if(o=c[Js]||c[wt]){if(c=o.alternate,o.child!==null||c!==null&&c.child!==null)for(r=Db(r);r!==null;){if(c=r[wt])return c;r=Db(r)}return o}r=c,c=r.parentNode}return null}function tr(r){if(r=r[wt]||r[Js]){var o=r.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return r}return null}function xa(r){var o=r.tag;if(o===5||o===26||o===27||o===6)return r.stateNode;throw Error(i(33))}function nr(r){var o=r[p_];return o||(o=r[p_]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function vt(r){r[Ta]=!0}var g_=new Set,__={};function ls(r,o){ir(r,o),ir(r+"Capture",o)}function ir(r,o){for(__[r]=o,r=0;r<o.length;r++)g_.add(o[r])}var Px=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),m_={},y_={};function Dx(r){return Zu.call(y_,r)?!0:Zu.call(m_,r)?!1:Px.test(r)?y_[r]=!0:(m_[r]=!0,!1)}function ol(r,o,c){if(Dx(o))if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":r.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){r.removeAttribute(o);return}}r.setAttribute(o,""+c)}}function ll(r,o,c){if(c===null)r.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttribute(o,""+c)}}function Kn(r,o,c,f){if(f===null)r.removeAttribute(c);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(c);return}r.setAttributeNS(o,c,""+f)}}function cn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function b_(r){var o=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function Bx(r,o,c){var f=Object.getOwnPropertyDescriptor(r.constructor.prototype,o);if(!r.hasOwnProperty(o)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var g=f.get,_=f.set;return Object.defineProperty(r,o,{configurable:!0,get:function(){return g.call(this)},set:function(b){c=""+b,_.call(this,b)}}),Object.defineProperty(r,o,{enumerable:f.enumerable}),{getValue:function(){return c},setValue:function(b){c=""+b},stopTracking:function(){r._valueTracker=null,delete r[o]}}}}function sf(r){if(!r._valueTracker){var o=b_(r)?"checked":"value";r._valueTracker=Bx(r,o,""+r[o])}}function v_(r){if(!r)return!1;var o=r._valueTracker;if(!o)return!0;var c=o.getValue(),f="";return r&&(f=b_(r)?r.checked?"true":"false":r.value),r=f,r!==c?(o.setValue(r),!0):!1}function cl(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Ux=/[\n"\\]/g;function un(r){return r.replace(Ux,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function rf(r,o,c,f,g,_,b,T){r.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?r.type=b:r.removeAttribute("type"),o!=null?b==="number"?(o===0&&r.value===""||r.value!=o)&&(r.value=""+cn(o)):r.value!==""+cn(o)&&(r.value=""+cn(o)):b!=="submit"&&b!=="reset"||r.removeAttribute("value"),o!=null?af(r,b,cn(o)):c!=null?af(r,b,cn(c)):f!=null&&r.removeAttribute("value"),g==null&&_!=null&&(r.defaultChecked=!!_),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?r.name=""+cn(T):r.removeAttribute("name")}function T_(r,o,c,f,g,_,b,T){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(r.type=_),o!=null||c!=null){if(!(_!=="submit"&&_!=="reset"||o!=null)){sf(r);return}c=c!=null?""+cn(c):"",o=o!=null?""+cn(o):c,T||o===r.value||(r.value=o),r.defaultValue=o}f=f??g,f=typeof f!="function"&&typeof f!="symbol"&&!!f,r.checked=T?r.checked:!!f,r.defaultChecked=!!f,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(r.name=b),sf(r)}function af(r,o,c){o==="number"&&cl(r.ownerDocument)===r||r.defaultValue===""+c||(r.defaultValue=""+c)}function sr(r,o,c,f){if(r=r.options,o){o={};for(var g=0;g<c.length;g++)o["$"+c[g]]=!0;for(c=0;c<r.length;c++)g=o.hasOwnProperty("$"+r[c].value),r[c].selected!==g&&(r[c].selected=g),g&&f&&(r[c].defaultSelected=!0)}else{for(c=""+cn(c),o=null,g=0;g<r.length;g++){if(r[g].value===c){r[g].selected=!0,f&&(r[g].defaultSelected=!0);return}o!==null||r[g].disabled||(o=r[g])}o!==null&&(o.selected=!0)}}function x_(r,o,c){if(o!=null&&(o=""+cn(o),o!==r.value&&(r.value=o),c==null)){r.defaultValue!==o&&(r.defaultValue=o);return}r.defaultValue=c!=null?""+cn(c):""}function w_(r,o,c,f){if(o==null){if(f!=null){if(c!=null)throw Error(i(92));if(He(f)){if(1<f.length)throw Error(i(93));f=f[0]}c=f}c==null&&(c=""),o=c}c=cn(o),r.defaultValue=c,f=r.textContent,f===c&&f!==""&&f!==null&&(r.value=f),sf(r)}function rr(r,o){if(o){var c=r.firstChild;if(c&&c===r.lastChild&&c.nodeType===3){c.nodeValue=o;return}}r.textContent=o}var Fx=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function S_(r,o,c){var f=o.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?f?r.setProperty(o,""):o==="float"?r.cssFloat="":r[o]="":f?r.setProperty(o,c):typeof c!="number"||c===0||Fx.has(o)?o==="float"?r.cssFloat=c:r[o]=(""+c).trim():r[o]=c+"px"}function A_(r,o,c){if(o!=null&&typeof o!="object")throw Error(i(62));if(r=r.style,c!=null){for(var f in c)!c.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?r.setProperty(f,""):f==="float"?r.cssFloat="":r[f]="");for(var g in o)f=o[g],o.hasOwnProperty(g)&&c[g]!==f&&S_(r,g,f)}else for(var _ in o)o.hasOwnProperty(_)&&S_(r,_,o[_])}function of(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lx=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),zx=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ul(r){return zx.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Qn(){}var lf=null;function cf(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ar=null,or=null;function E_(r){var o=tr(r);if(o&&(r=o.stateNode)){var c=r[Ut]||null;e:switch(r=o.stateNode,o.type){case"input":if(rf(r,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),o=c.name,c.type==="radio"&&o!=null){for(c=r;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+un(""+o)+'"][type="radio"]'),o=0;o<c.length;o++){var f=c[o];if(f!==r&&f.form===r.form){var g=f[Ut]||null;if(!g)throw Error(i(90));rf(f,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(o=0;o<c.length;o++)f=c[o],f.form===r.form&&v_(f)}break e;case"textarea":x_(r,c.value,c.defaultValue);break e;case"select":o=c.value,o!=null&&sr(r,!!c.multiple,o,!1)}}}var uf=!1;function R_(r,o,c){if(uf)return r(o,c);uf=!0;try{var f=r(o);return f}finally{if(uf=!1,(ar!==null||or!==null)&&(Ql(),ar&&(o=ar,r=or,or=ar=null,E_(o),r)))for(o=0;o<r.length;o++)E_(r[o])}}function wa(r,o){var c=r.stateNode;if(c===null)return null;var f=c[Ut]||null;if(f===null)return null;c=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(r=r.type,f=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!f;break e;default:r=!1}if(r)return null;if(c&&typeof c!="function")throw Error(i(231,o,typeof c));return c}var Gn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ff=!1;if(Gn)try{var Sa={};Object.defineProperty(Sa,"passive",{get:function(){ff=!0}}),window.addEventListener("test",Sa,Sa),window.removeEventListener("test",Sa,Sa)}catch{ff=!1}var Si=null,hf=null,fl=null;function C_(){if(fl)return fl;var r,o=hf,c=o.length,f,g="value"in Si?Si.value:Si.textContent,_=g.length;for(r=0;r<c&&o[r]===g[r];r++);var b=c-r;for(f=1;f<=b&&o[c-f]===g[_-f];f++);return fl=g.slice(r,1<f?1-f:void 0)}function hl(r){var o=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&o===13&&(r=13)):r=o,r===10&&(r=13),32<=r||r===13?r:0}function dl(){return!0}function M_(){return!1}function Ft(r){function o(c,f,g,_,b){this._reactName=c,this._targetInst=g,this.type=f,this.nativeEvent=_,this.target=b,this.currentTarget=null;for(var T in r)r.hasOwnProperty(T)&&(c=r[T],this[T]=c?c(_):_[T]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?dl:M_,this.isPropagationStopped=M_,this}return m(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=dl)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=dl)},persist:function(){},isPersistent:dl}),o}var cs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pl=Ft(cs),Aa=m({},cs,{view:0,detail:0}),Vx=Ft(Aa),df,pf,Ea,gl=m({},Aa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_f,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Ea&&(Ea&&r.type==="mousemove"?(df=r.screenX-Ea.screenX,pf=r.screenY-Ea.screenY):pf=df=0,Ea=r),df)},movementY:function(r){return"movementY"in r?r.movementY:pf}}),O_=Ft(gl),Hx=m({},gl,{dataTransfer:0}),jx=Ft(Hx),$x=m({},Aa,{relatedTarget:0}),gf=Ft($x),Wx=m({},cs,{animationName:0,elapsedTime:0,pseudoElement:0}),Xx=Ft(Wx),Yx=m({},cs,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),qx=Ft(Yx),Zx=m({},cs,{data:0}),I_=Ft(Zx),Kx={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Qx={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Gx={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Jx(r){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(r):(r=Gx[r])?!!o[r]:!1}function _f(){return Jx}var ew=m({},Aa,{key:function(r){if(r.key){var o=Kx[r.key]||r.key;if(o!=="Unidentified")return o}return r.type==="keypress"?(r=hl(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Qx[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_f,charCode:function(r){return r.type==="keypress"?hl(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?hl(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),tw=Ft(ew),nw=m({},gl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),N_=Ft(nw),iw=m({},Aa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_f}),sw=Ft(iw),rw=m({},cs,{propertyName:0,elapsedTime:0,pseudoElement:0}),aw=Ft(rw),ow=m({},gl,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),lw=Ft(ow),cw=m({},cs,{newState:0,oldState:0}),uw=Ft(cw),fw=[9,13,27,32],mf=Gn&&"CompositionEvent"in window,Ra=null;Gn&&"documentMode"in document&&(Ra=document.documentMode);var hw=Gn&&"TextEvent"in window&&!Ra,k_=Gn&&(!mf||Ra&&8<Ra&&11>=Ra),P_=" ",D_=!1;function B_(r,o){switch(r){case"keyup":return fw.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function U_(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var lr=!1;function dw(r,o){switch(r){case"compositionend":return U_(o);case"keypress":return o.which!==32?null:(D_=!0,P_);case"textInput":return r=o.data,r===P_&&D_?null:r;default:return null}}function pw(r,o){if(lr)return r==="compositionend"||!mf&&B_(r,o)?(r=C_(),fl=hf=Si=null,lr=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return k_&&o.locale!=="ko"?null:o.data;default:return null}}var gw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function F_(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o==="input"?!!gw[r.type]:o==="textarea"}function L_(r,o,c,f){ar?or?or.push(f):or=[f]:ar=f,o=sc(o,"onChange"),0<o.length&&(c=new pl("onChange","change",null,c,f),r.push({event:c,listeners:o}))}var Ca=null,Ma=null;function _w(r){Tb(r,0)}function _l(r){var o=xa(r);if(v_(o))return r}function z_(r,o){if(r==="change")return o}var V_=!1;if(Gn){var yf;if(Gn){var bf="oninput"in document;if(!bf){var H_=document.createElement("div");H_.setAttribute("oninput","return;"),bf=typeof H_.oninput=="function"}yf=bf}else yf=!1;V_=yf&&(!document.documentMode||9<document.documentMode)}function j_(){Ca&&(Ca.detachEvent("onpropertychange",$_),Ma=Ca=null)}function $_(r){if(r.propertyName==="value"&&_l(Ma)){var o=[];L_(o,Ma,r,cf(r)),R_(_w,o)}}function mw(r,o,c){r==="focusin"?(j_(),Ca=o,Ma=c,Ca.attachEvent("onpropertychange",$_)):r==="focusout"&&j_()}function yw(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return _l(Ma)}function bw(r,o){if(r==="click")return _l(o)}function vw(r,o){if(r==="input"||r==="change")return _l(o)}function Tw(r,o){return r===o&&(r!==0||1/r===1/o)||r!==r&&o!==o}var Zt=typeof Object.is=="function"?Object.is:Tw;function Oa(r,o){if(Zt(r,o))return!0;if(typeof r!="object"||r===null||typeof o!="object"||o===null)return!1;var c=Object.keys(r),f=Object.keys(o);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var g=c[f];if(!Zu.call(o,g)||!Zt(r[g],o[g]))return!1}return!0}function W_(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function X_(r,o){var c=W_(r);r=0;for(var f;c;){if(c.nodeType===3){if(f=r+c.textContent.length,r<=o&&f>=o)return{node:c,offset:o-r};r=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=W_(c)}}function Y_(r,o){return r&&o?r===o?!0:r&&r.nodeType===3?!1:o&&o.nodeType===3?Y_(r,o.parentNode):"contains"in r?r.contains(o):r.compareDocumentPosition?!!(r.compareDocumentPosition(o)&16):!1:!1}function q_(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var o=cl(r.document);o instanceof r.HTMLIFrameElement;){try{var c=typeof o.contentWindow.location.href=="string"}catch{c=!1}if(c)r=o.contentWindow;else break;o=cl(r.document)}return o}function vf(r){var o=r&&r.nodeName&&r.nodeName.toLowerCase();return o&&(o==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||o==="textarea"||r.contentEditable==="true")}var xw=Gn&&"documentMode"in document&&11>=document.documentMode,cr=null,Tf=null,Ia=null,xf=!1;function Z_(r,o,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;xf||cr==null||cr!==cl(f)||(f=cr,"selectionStart"in f&&vf(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Ia&&Oa(Ia,f)||(Ia=f,f=sc(Tf,"onSelect"),0<f.length&&(o=new pl("onSelect","select",null,o,c),r.push({event:o,listeners:f}),o.target=cr)))}function us(r,o){var c={};return c[r.toLowerCase()]=o.toLowerCase(),c["Webkit"+r]="webkit"+o,c["Moz"+r]="moz"+o,c}var ur={animationend:us("Animation","AnimationEnd"),animationiteration:us("Animation","AnimationIteration"),animationstart:us("Animation","AnimationStart"),transitionrun:us("Transition","TransitionRun"),transitionstart:us("Transition","TransitionStart"),transitioncancel:us("Transition","TransitionCancel"),transitionend:us("Transition","TransitionEnd")},wf={},K_={};Gn&&(K_=document.createElement("div").style,"AnimationEvent"in window||(delete ur.animationend.animation,delete ur.animationiteration.animation,delete ur.animationstart.animation),"TransitionEvent"in window||delete ur.transitionend.transition);function fs(r){if(wf[r])return wf[r];if(!ur[r])return r;var o=ur[r],c;for(c in o)if(o.hasOwnProperty(c)&&c in K_)return wf[r]=o[c];return r}var Q_=fs("animationend"),G_=fs("animationiteration"),J_=fs("animationstart"),ww=fs("transitionrun"),Sw=fs("transitionstart"),Aw=fs("transitioncancel"),em=fs("transitionend"),tm=new Map,Sf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Sf.push("scrollEnd");function Sn(r,o){tm.set(r,o),ls(o,[r])}var ml=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},fn=[],fr=0,Af=0;function yl(){for(var r=fr,o=Af=fr=0;o<r;){var c=fn[o];fn[o++]=null;var f=fn[o];fn[o++]=null;var g=fn[o];fn[o++]=null;var _=fn[o];if(fn[o++]=null,f!==null&&g!==null){var b=f.pending;b===null?g.next=g:(g.next=b.next,b.next=g),f.pending=g}_!==0&&nm(c,g,_)}}function bl(r,o,c,f){fn[fr++]=r,fn[fr++]=o,fn[fr++]=c,fn[fr++]=f,Af|=f,r.lanes|=f,r=r.alternate,r!==null&&(r.lanes|=f)}function Ef(r,o,c,f){return bl(r,o,c,f),vl(r)}function hs(r,o){return bl(r,null,null,o),vl(r)}function nm(r,o,c){r.lanes|=c;var f=r.alternate;f!==null&&(f.lanes|=c);for(var g=!1,_=r.return;_!==null;)_.childLanes|=c,f=_.alternate,f!==null&&(f.childLanes|=c),_.tag===22&&(r=_.stateNode,r===null||r._visibility&1||(g=!0)),r=_,_=_.return;return r.tag===3?(_=r.stateNode,g&&o!==null&&(g=31-qt(c),r=_.hiddenUpdates,f=r[g],f===null?r[g]=[o]:f.push(o),o.lane=c|536870912),_):null}function vl(r){if(50<Ja)throw Ja=0,Dh=null,Error(i(185));for(var o=r.return;o!==null;)r=o,o=r.return;return r.tag===3?r.stateNode:null}var hr={};function Ew(r,o,c,f){this.tag=r,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kt(r,o,c,f){return new Ew(r,o,c,f)}function Rf(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Jn(r,o){var c=r.alternate;return c===null?(c=Kt(r.tag,o,r.key,r.mode),c.elementType=r.elementType,c.type=r.type,c.stateNode=r.stateNode,c.alternate=r,r.alternate=c):(c.pendingProps=o,c.type=r.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=r.flags&65011712,c.childLanes=r.childLanes,c.lanes=r.lanes,c.child=r.child,c.memoizedProps=r.memoizedProps,c.memoizedState=r.memoizedState,c.updateQueue=r.updateQueue,o=r.dependencies,c.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},c.sibling=r.sibling,c.index=r.index,c.ref=r.ref,c.refCleanup=r.refCleanup,c}function im(r,o){r.flags&=65011714;var c=r.alternate;return c===null?(r.childLanes=0,r.lanes=o,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=c.childLanes,r.lanes=c.lanes,r.child=c.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=c.memoizedProps,r.memoizedState=c.memoizedState,r.updateQueue=c.updateQueue,r.type=c.type,o=c.dependencies,r.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),r}function Tl(r,o,c,f,g,_){var b=0;if(f=r,typeof r=="function")Rf(r)&&(b=1);else if(typeof r=="string")b=IS(r,c,ce.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case ie:return r=Kt(31,c,o,g),r.elementType=ie,r.lanes=_,r;case A:return ds(c.children,g,_,o);case E:b=8,g|=24;break;case C:return r=Kt(12,c,o,g|2),r.elementType=C,r.lanes=_,r;case z:return r=Kt(13,c,o,g),r.elementType=z,r.lanes=_,r;case X:return r=Kt(19,c,o,g),r.elementType=X,r.lanes=_,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case M:b=10;break e;case D:b=9;break e;case B:b=11;break e;case ne:b=14;break e;case ae:b=16,f=null;break e}b=29,c=Error(i(130,r===null?"null":typeof r,"")),f=null}return o=Kt(b,c,o,g),o.elementType=r,o.type=f,o.lanes=_,o}function ds(r,o,c,f){return r=Kt(7,r,f,o),r.lanes=c,r}function Cf(r,o,c){return r=Kt(6,r,null,o),r.lanes=c,r}function sm(r){var o=Kt(18,null,null,0);return o.stateNode=r,o}function Mf(r,o,c){return o=Kt(4,r.children!==null?r.children:[],r.key,o),o.lanes=c,o.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},o}var rm=new WeakMap;function hn(r,o){if(typeof r=="object"&&r!==null){var c=rm.get(r);return c!==void 0?c:(o={value:r,source:o,stack:s_(o)},rm.set(r,o),o)}return{value:r,source:o,stack:s_(o)}}var dr=[],pr=0,xl=null,Na=0,dn=[],pn=0,Ai=null,Dn=1,Bn="";function ei(r,o){dr[pr++]=Na,dr[pr++]=xl,xl=r,Na=o}function am(r,o,c){dn[pn++]=Dn,dn[pn++]=Bn,dn[pn++]=Ai,Ai=r;var f=Dn;r=Bn;var g=32-qt(f)-1;f&=~(1<<g),c+=1;var _=32-qt(o)+g;if(30<_){var b=g-g%5;_=(f&(1<<b)-1).toString(32),f>>=b,g-=b,Dn=1<<32-qt(o)+g|c<<g|f,Bn=_+r}else Dn=1<<_|c<<g|f,Bn=r}function Of(r){r.return!==null&&(ei(r,1),am(r,1,0))}function If(r){for(;r===xl;)xl=dr[--pr],dr[pr]=null,Na=dr[--pr],dr[pr]=null;for(;r===Ai;)Ai=dn[--pn],dn[pn]=null,Bn=dn[--pn],dn[pn]=null,Dn=dn[--pn],dn[pn]=null}function om(r,o){dn[pn++]=Dn,dn[pn++]=Bn,dn[pn++]=Ai,Dn=o.id,Bn=o.overflow,Ai=r}var St=null,Je=null,Ie=!1,Ei=null,gn=!1,Nf=Error(i(519));function Ri(r){var o=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw ka(hn(o,r)),Nf}function lm(r){var o=r.stateNode,c=r.type,f=r.memoizedProps;switch(o[wt]=r,o[Ut]=f,c){case"dialog":Ce("cancel",o),Ce("close",o);break;case"iframe":case"object":case"embed":Ce("load",o);break;case"video":case"audio":for(c=0;c<to.length;c++)Ce(to[c],o);break;case"source":Ce("error",o);break;case"img":case"image":case"link":Ce("error",o),Ce("load",o);break;case"details":Ce("toggle",o);break;case"input":Ce("invalid",o),T_(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":Ce("invalid",o);break;case"textarea":Ce("invalid",o),w_(o,f.value,f.defaultValue,f.children)}c=f.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||o.textContent===""+c||f.suppressHydrationWarning===!0||Ab(o.textContent,c)?(f.popover!=null&&(Ce("beforetoggle",o),Ce("toggle",o)),f.onScroll!=null&&Ce("scroll",o),f.onScrollEnd!=null&&Ce("scrollend",o),f.onClick!=null&&(o.onclick=Qn),o=!0):o=!1,o||Ri(r,!0)}function cm(r){for(St=r.return;St;)switch(St.tag){case 5:case 31:case 13:gn=!1;return;case 27:case 3:gn=!0;return;default:St=St.return}}function gr(r){if(r!==St)return!1;if(!Ie)return cm(r),Ie=!0,!1;var o=r.tag,c;if((c=o!==3&&o!==27)&&((c=o===5)&&(c=r.type,c=!(c!=="form"&&c!=="button")||Kh(r.type,r.memoizedProps)),c=!c),c&&Je&&Ri(r),cm(r),o===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));Je=Pb(r)}else if(o===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));Je=Pb(r)}else o===27?(o=Je,Vi(r.type)?(r=td,td=null,Je=r):Je=o):Je=St?mn(r.stateNode.nextSibling):null;return!0}function ps(){Je=St=null,Ie=!1}function kf(){var r=Ei;return r!==null&&(Ht===null?Ht=r:Ht.push.apply(Ht,r),Ei=null),r}function ka(r){Ei===null?Ei=[r]:Ei.push(r)}var Pf=I(null),gs=null,ti=null;function Ci(r,o,c){oe(Pf,o._currentValue),o._currentValue=c}function ni(r){r._currentValue=Pf.current,G(Pf)}function Df(r,o,c){for(;r!==null;){var f=r.alternate;if((r.childLanes&o)!==o?(r.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),r===c)break;r=r.return}}function Bf(r,o,c,f){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var _=g.dependencies;if(_!==null){var b=g.child;_=_.firstContext;e:for(;_!==null;){var T=_;_=g;for(var R=0;R<o.length;R++)if(T.context===o[R]){_.lanes|=c,T=_.alternate,T!==null&&(T.lanes|=c),Df(_.return,c,r),f||(b=null);break e}_=T.next}}else if(g.tag===18){if(b=g.return,b===null)throw Error(i(341));b.lanes|=c,_=b.alternate,_!==null&&(_.lanes|=c),Df(b,c,r),b=null}else b=g.child;if(b!==null)b.return=g;else for(b=g;b!==null;){if(b===r){b=null;break}if(g=b.sibling,g!==null){g.return=b.return,b=g;break}b=b.return}g=b}}function _r(r,o,c,f){r=null;for(var g=o,_=!1;g!==null;){if(!_){if((g.flags&524288)!==0)_=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var b=g.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var T=g.type;Zt(g.pendingProps.value,b.value)||(r!==null?r.push(T):r=[T])}}else if(g===be.current){if(b=g.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(ao):r=[ao])}g=g.return}r!==null&&Bf(o,r,c,f),o.flags|=262144}function wl(r){for(r=r.firstContext;r!==null;){if(!Zt(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function _s(r){gs=r,ti=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function At(r){return um(gs,r)}function Sl(r,o){return gs===null&&_s(r),um(r,o)}function um(r,o){var c=o._currentValue;if(o={context:o,memoizedValue:c,next:null},ti===null){if(r===null)throw Error(i(308));ti=o,r.dependencies={lanes:0,firstContext:o},r.flags|=524288}else ti=ti.next=o;return c}var Rw=typeof AbortController<"u"?AbortController:function(){var r=[],o=this.signal={aborted:!1,addEventListener:function(c,f){r.push(f)}};this.abort=function(){o.aborted=!0,r.forEach(function(c){return c()})}},Cw=n.unstable_scheduleCallback,Mw=n.unstable_NormalPriority,ct={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Uf(){return{controller:new Rw,data:new Map,refCount:0}}function Pa(r){r.refCount--,r.refCount===0&&Cw(Mw,function(){r.controller.abort()})}var Da=null,Ff=0,mr=0,yr=null;function Ow(r,o){if(Da===null){var c=Da=[];Ff=0,mr=Vh(),yr={status:"pending",value:void 0,then:function(f){c.push(f)}}}return Ff++,o.then(fm,fm),o}function fm(){if(--Ff===0&&Da!==null){yr!==null&&(yr.status="fulfilled");var r=Da;Da=null,mr=0,yr=null;for(var o=0;o<r.length;o++)(0,r[o])()}}function Iw(r,o){var c=[],f={status:"pending",value:null,reason:null,then:function(g){c.push(g)}};return r.then(function(){f.status="fulfilled",f.value=o;for(var g=0;g<c.length;g++)(0,c[g])(o)},function(g){for(f.status="rejected",f.reason=g,g=0;g<c.length;g++)(0,c[g])(void 0)}),f}var hm=W.S;W.S=function(r,o){Zy=Xt(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&Ow(r,o),hm!==null&&hm(r,o)};var ms=I(null);function Lf(){var r=ms.current;return r!==null?r:Ze.pooledCache}function Al(r,o){o===null?oe(ms,ms.current):oe(ms,o.pool)}function dm(){var r=Lf();return r===null?null:{parent:ct._currentValue,pool:r}}var br=Error(i(460)),zf=Error(i(474)),El=Error(i(542)),Rl={then:function(){}};function pm(r){return r=r.status,r==="fulfilled"||r==="rejected"}function gm(r,o,c){switch(c=r[c],c===void 0?r.push(o):c!==o&&(o.then(Qn,Qn),o=c),o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,mm(r),r;default:if(typeof o.status=="string")o.then(Qn,Qn);else{if(r=Ze,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=o,r.status="pending",r.then(function(f){if(o.status==="pending"){var g=o;g.status="fulfilled",g.value=f}},function(f){if(o.status==="pending"){var g=o;g.status="rejected",g.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw r=o.reason,mm(r),r}throw bs=o,br}}function ys(r){try{var o=r._init;return o(r._payload)}catch(c){throw c!==null&&typeof c=="object"&&typeof c.then=="function"?(bs=c,br):c}}var bs=null;function _m(){if(bs===null)throw Error(i(459));var r=bs;return bs=null,r}function mm(r){if(r===br||r===El)throw Error(i(483))}var vr=null,Ba=0;function Cl(r){var o=Ba;return Ba+=1,vr===null&&(vr=[]),gm(vr,r,o)}function Ua(r,o){o=o.props.ref,r.ref=o!==void 0?o:null}function Ml(r,o){throw o.$$typeof===y?Error(i(525)):(r=Object.prototype.toString.call(o),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":r)))}function ym(r){function o(U,O){if(r){var V=U.deletions;V===null?(U.deletions=[O],U.flags|=16):V.push(O)}}function c(U,O){if(!r)return null;for(;O!==null;)o(U,O),O=O.sibling;return null}function f(U){for(var O=new Map;U!==null;)U.key!==null?O.set(U.key,U):O.set(U.index,U),U=U.sibling;return O}function g(U,O){return U=Jn(U,O),U.index=0,U.sibling=null,U}function _(U,O,V){return U.index=V,r?(V=U.alternate,V!==null?(V=V.index,V<O?(U.flags|=67108866,O):V):(U.flags|=67108866,O)):(U.flags|=1048576,O)}function b(U){return r&&U.alternate===null&&(U.flags|=67108866),U}function T(U,O,V,q){return O===null||O.tag!==6?(O=Cf(V,U.mode,q),O.return=U,O):(O=g(O,V),O.return=U,O)}function R(U,O,V,q){var pe=V.type;return pe===A?Y(U,O,V.props.children,q,V.key):O!==null&&(O.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===ae&&ys(pe)===O.type)?(O=g(O,V.props),Ua(O,V),O.return=U,O):(O=Tl(V.type,V.key,V.props,null,U.mode,q),Ua(O,V),O.return=U,O)}function H(U,O,V,q){return O===null||O.tag!==4||O.stateNode.containerInfo!==V.containerInfo||O.stateNode.implementation!==V.implementation?(O=Mf(V,U.mode,q),O.return=U,O):(O=g(O,V.children||[]),O.return=U,O)}function Y(U,O,V,q,pe){return O===null||O.tag!==7?(O=ds(V,U.mode,q,pe),O.return=U,O):(O=g(O,V),O.return=U,O)}function Q(U,O,V){if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return O=Cf(""+O,U.mode,V),O.return=U,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case v:return V=Tl(O.type,O.key,O.props,null,U.mode,V),Ua(V,O),V.return=U,V;case x:return O=Mf(O,U.mode,V),O.return=U,O;case ae:return O=ys(O),Q(U,O,V)}if(He(O)||fe(O))return O=ds(O,U.mode,V,null),O.return=U,O;if(typeof O.then=="function")return Q(U,Cl(O),V);if(O.$$typeof===M)return Q(U,Sl(U,O),V);Ml(U,O)}return null}function j(U,O,V,q){var pe=O!==null?O.key:null;if(typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint")return pe!==null?null:T(U,O,""+V,q);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case v:return V.key===pe?R(U,O,V,q):null;case x:return V.key===pe?H(U,O,V,q):null;case ae:return V=ys(V),j(U,O,V,q)}if(He(V)||fe(V))return pe!==null?null:Y(U,O,V,q,null);if(typeof V.then=="function")return j(U,O,Cl(V),q);if(V.$$typeof===M)return j(U,O,Sl(U,V),q);Ml(U,V)}return null}function $(U,O,V,q,pe){if(typeof q=="string"&&q!==""||typeof q=="number"||typeof q=="bigint")return U=U.get(V)||null,T(O,U,""+q,pe);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case v:return U=U.get(q.key===null?V:q.key)||null,R(O,U,q,pe);case x:return U=U.get(q.key===null?V:q.key)||null,H(O,U,q,pe);case ae:return q=ys(q),$(U,O,V,q,pe)}if(He(q)||fe(q))return U=U.get(V)||null,Y(O,U,q,pe,null);if(typeof q.then=="function")return $(U,O,V,Cl(q),pe);if(q.$$typeof===M)return $(U,O,V,Sl(O,q),pe);Ml(O,q)}return null}function le(U,O,V,q){for(var pe=null,ke=null,he=O,Ae=O=0,Oe=null;he!==null&&Ae<V.length;Ae++){he.index>Ae?(Oe=he,he=null):Oe=he.sibling;var Pe=j(U,he,V[Ae],q);if(Pe===null){he===null&&(he=Oe);break}r&&he&&Pe.alternate===null&&o(U,he),O=_(Pe,O,Ae),ke===null?pe=Pe:ke.sibling=Pe,ke=Pe,he=Oe}if(Ae===V.length)return c(U,he),Ie&&ei(U,Ae),pe;if(he===null){for(;Ae<V.length;Ae++)he=Q(U,V[Ae],q),he!==null&&(O=_(he,O,Ae),ke===null?pe=he:ke.sibling=he,ke=he);return Ie&&ei(U,Ae),pe}for(he=f(he);Ae<V.length;Ae++)Oe=$(he,U,Ae,V[Ae],q),Oe!==null&&(r&&Oe.alternate!==null&&he.delete(Oe.key===null?Ae:Oe.key),O=_(Oe,O,Ae),ke===null?pe=Oe:ke.sibling=Oe,ke=Oe);return r&&he.forEach(function(Xi){return o(U,Xi)}),Ie&&ei(U,Ae),pe}function _e(U,O,V,q){if(V==null)throw Error(i(151));for(var pe=null,ke=null,he=O,Ae=O=0,Oe=null,Pe=V.next();he!==null&&!Pe.done;Ae++,Pe=V.next()){he.index>Ae?(Oe=he,he=null):Oe=he.sibling;var Xi=j(U,he,Pe.value,q);if(Xi===null){he===null&&(he=Oe);break}r&&he&&Xi.alternate===null&&o(U,he),O=_(Xi,O,Ae),ke===null?pe=Xi:ke.sibling=Xi,ke=Xi,he=Oe}if(Pe.done)return c(U,he),Ie&&ei(U,Ae),pe;if(he===null){for(;!Pe.done;Ae++,Pe=V.next())Pe=Q(U,Pe.value,q),Pe!==null&&(O=_(Pe,O,Ae),ke===null?pe=Pe:ke.sibling=Pe,ke=Pe);return Ie&&ei(U,Ae),pe}for(he=f(he);!Pe.done;Ae++,Pe=V.next())Pe=$(he,U,Ae,Pe.value,q),Pe!==null&&(r&&Pe.alternate!==null&&he.delete(Pe.key===null?Ae:Pe.key),O=_(Pe,O,Ae),ke===null?pe=Pe:ke.sibling=Pe,ke=Pe);return r&&he.forEach(function(HS){return o(U,HS)}),Ie&&ei(U,Ae),pe}function We(U,O,V,q){if(typeof V=="object"&&V!==null&&V.type===A&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case v:e:{for(var pe=V.key;O!==null;){if(O.key===pe){if(pe=V.type,pe===A){if(O.tag===7){c(U,O.sibling),q=g(O,V.props.children),q.return=U,U=q;break e}}else if(O.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===ae&&ys(pe)===O.type){c(U,O.sibling),q=g(O,V.props),Ua(q,V),q.return=U,U=q;break e}c(U,O);break}else o(U,O);O=O.sibling}V.type===A?(q=ds(V.props.children,U.mode,q,V.key),q.return=U,U=q):(q=Tl(V.type,V.key,V.props,null,U.mode,q),Ua(q,V),q.return=U,U=q)}return b(U);case x:e:{for(pe=V.key;O!==null;){if(O.key===pe)if(O.tag===4&&O.stateNode.containerInfo===V.containerInfo&&O.stateNode.implementation===V.implementation){c(U,O.sibling),q=g(O,V.children||[]),q.return=U,U=q;break e}else{c(U,O);break}else o(U,O);O=O.sibling}q=Mf(V,U.mode,q),q.return=U,U=q}return b(U);case ae:return V=ys(V),We(U,O,V,q)}if(He(V))return le(U,O,V,q);if(fe(V)){if(pe=fe(V),typeof pe!="function")throw Error(i(150));return V=pe.call(V),_e(U,O,V,q)}if(typeof V.then=="function")return We(U,O,Cl(V),q);if(V.$$typeof===M)return We(U,O,Sl(U,V),q);Ml(U,V)}return typeof V=="string"&&V!==""||typeof V=="number"||typeof V=="bigint"?(V=""+V,O!==null&&O.tag===6?(c(U,O.sibling),q=g(O,V),q.return=U,U=q):(c(U,O),q=Cf(V,U.mode,q),q.return=U,U=q),b(U)):c(U,O)}return function(U,O,V,q){try{Ba=0;var pe=We(U,O,V,q);return vr=null,pe}catch(he){if(he===br||he===El)throw he;var ke=Kt(29,he,null,U.mode);return ke.lanes=q,ke.return=U,ke}finally{}}}var vs=ym(!0),bm=ym(!1),Mi=!1;function Vf(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Hf(r,o){r=r.updateQueue,o.updateQueue===r&&(o.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Oi(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ii(r,o,c){var f=r.updateQueue;if(f===null)return null;if(f=f.shared,(De&2)!==0){var g=f.pending;return g===null?o.next=o:(o.next=g.next,g.next=o),f.pending=o,o=vl(r),nm(r,null,c),o}return bl(r,f,o,c),vl(r)}function Fa(r,o,c){if(o=o.updateQueue,o!==null&&(o=o.shared,(c&4194048)!==0)){var f=o.lanes;f&=r.pendingLanes,c|=f,o.lanes=c,u_(r,c)}}function jf(r,o){var c=r.updateQueue,f=r.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var g=null,_=null;if(c=c.firstBaseUpdate,c!==null){do{var b={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};_===null?g=_=b:_=_.next=b,c=c.next}while(c!==null);_===null?g=_=o:_=_.next=o}else g=_=o;c={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:_,shared:f.shared,callbacks:f.callbacks},r.updateQueue=c;return}r=c.lastBaseUpdate,r===null?c.firstBaseUpdate=o:r.next=o,c.lastBaseUpdate=o}var $f=!1;function La(){if($f){var r=yr;if(r!==null)throw r}}function za(r,o,c,f){$f=!1;var g=r.updateQueue;Mi=!1;var _=g.firstBaseUpdate,b=g.lastBaseUpdate,T=g.shared.pending;if(T!==null){g.shared.pending=null;var R=T,H=R.next;R.next=null,b===null?_=H:b.next=H,b=R;var Y=r.alternate;Y!==null&&(Y=Y.updateQueue,T=Y.lastBaseUpdate,T!==b&&(T===null?Y.firstBaseUpdate=H:T.next=H,Y.lastBaseUpdate=R))}if(_!==null){var Q=g.baseState;b=0,Y=H=R=null,T=_;do{var j=T.lane&-536870913,$=j!==T.lane;if($?(Me&j)===j:(f&j)===j){j!==0&&j===mr&&($f=!0),Y!==null&&(Y=Y.next={lane:0,tag:T.tag,payload:T.payload,callback:null,next:null});e:{var le=r,_e=T;j=o;var We=c;switch(_e.tag){case 1:if(le=_e.payload,typeof le=="function"){Q=le.call(We,Q,j);break e}Q=le;break e;case 3:le.flags=le.flags&-65537|128;case 0:if(le=_e.payload,j=typeof le=="function"?le.call(We,Q,j):le,j==null)break e;Q=m({},Q,j);break e;case 2:Mi=!0}}j=T.callback,j!==null&&(r.flags|=64,$&&(r.flags|=8192),$=g.callbacks,$===null?g.callbacks=[j]:$.push(j))}else $={lane:j,tag:T.tag,payload:T.payload,callback:T.callback,next:null},Y===null?(H=Y=$,R=Q):Y=Y.next=$,b|=j;if(T=T.next,T===null){if(T=g.shared.pending,T===null)break;$=T,T=$.next,$.next=null,g.lastBaseUpdate=$,g.shared.pending=null}}while(!0);Y===null&&(R=Q),g.baseState=R,g.firstBaseUpdate=H,g.lastBaseUpdate=Y,_===null&&(g.shared.lanes=0),Bi|=b,r.lanes=b,r.memoizedState=Q}}function vm(r,o){if(typeof r!="function")throw Error(i(191,r));r.call(o)}function Tm(r,o){var c=r.callbacks;if(c!==null)for(r.callbacks=null,r=0;r<c.length;r++)vm(c[r],o)}var Tr=I(null),Ol=I(0);function xm(r,o){r=fi,oe(Ol,r),oe(Tr,o),fi=r|o.baseLanes}function Wf(){oe(Ol,fi),oe(Tr,Tr.current)}function Xf(){fi=Ol.current,G(Tr),G(Ol)}var Qt=I(null),_n=null;function Ni(r){var o=r.alternate;oe(ot,ot.current&1),oe(Qt,r),_n===null&&(o===null||Tr.current!==null||o.memoizedState!==null)&&(_n=r)}function Yf(r){oe(ot,ot.current),oe(Qt,r),_n===null&&(_n=r)}function wm(r){r.tag===22?(oe(ot,ot.current),oe(Qt,r),_n===null&&(_n=r)):ki()}function ki(){oe(ot,ot.current),oe(Qt,Qt.current)}function Gt(r){G(Qt),_n===r&&(_n=null),G(ot)}var ot=I(0);function Il(r){for(var o=r;o!==null;){if(o.tag===13){var c=o.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||Jh(c)||ed(c)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var ii=0,Se=null,je=null,ut=null,Nl=!1,xr=!1,Ts=!1,kl=0,Va=0,wr=null,Nw=0;function it(){throw Error(i(321))}function qf(r,o){if(o===null)return!1;for(var c=0;c<o.length&&c<r.length;c++)if(!Zt(r[c],o[c]))return!1;return!0}function Zf(r,o,c,f,g,_){return ii=_,Se=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,W.H=r===null||r.memoizedState===null?ay:uh,Ts=!1,_=c(f,g),Ts=!1,xr&&(_=Am(o,c,f,g)),Sm(r),_}function Sm(r){W.H=$a;var o=je!==null&&je.next!==null;if(ii=0,ut=je=Se=null,Nl=!1,Va=0,wr=null,o)throw Error(i(300));r===null||ft||(r=r.dependencies,r!==null&&wl(r)&&(ft=!0))}function Am(r,o,c,f){Se=r;var g=0;do{if(xr&&(wr=null),Va=0,xr=!1,25<=g)throw Error(i(301));if(g+=1,ut=je=null,r.updateQueue!=null){var _=r.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}W.H=oy,_=o(c,f)}while(xr);return _}function kw(){var r=W.H,o=r.useState()[0];return o=typeof o.then=="function"?Ha(o):o,r=r.useState()[0],(je!==null?je.memoizedState:null)!==r&&(Se.flags|=1024),o}function Kf(){var r=kl!==0;return kl=0,r}function Qf(r,o,c){o.updateQueue=r.updateQueue,o.flags&=-2053,r.lanes&=~c}function Gf(r){if(Nl){for(r=r.memoizedState;r!==null;){var o=r.queue;o!==null&&(o.pending=null),r=r.next}Nl=!1}ii=0,ut=je=Se=null,xr=!1,Va=kl=0,wr=null}function Pt(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?Se.memoizedState=ut=r:ut=ut.next=r,ut}function lt(){if(je===null){var r=Se.alternate;r=r!==null?r.memoizedState:null}else r=je.next;var o=ut===null?Se.memoizedState:ut.next;if(o!==null)ut=o,je=r;else{if(r===null)throw Se.alternate===null?Error(i(467)):Error(i(310));je=r,r={memoizedState:je.memoizedState,baseState:je.baseState,baseQueue:je.baseQueue,queue:je.queue,next:null},ut===null?Se.memoizedState=ut=r:ut=ut.next=r}return ut}function Pl(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ha(r){var o=Va;return Va+=1,wr===null&&(wr=[]),r=gm(wr,r,o),o=Se,(ut===null?o.memoizedState:ut.next)===null&&(o=o.alternate,W.H=o===null||o.memoizedState===null?ay:uh),r}function Dl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Ha(r);if(r.$$typeof===M)return At(r)}throw Error(i(438,String(r)))}function Jf(r){var o=null,c=Se.updateQueue;if(c!==null&&(o=c.memoCache),o==null){var f=Se.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(g){return g.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),c===null&&(c=Pl(),Se.updateQueue=c),c.memoCache=o,c=o.data[o.index],c===void 0)for(c=o.data[o.index]=Array(r),f=0;f<r;f++)c[f]=ge;return o.index++,c}function si(r,o){return typeof o=="function"?o(r):o}function Bl(r){var o=lt();return eh(o,je,r)}function eh(r,o,c){var f=r.queue;if(f===null)throw Error(i(311));f.lastRenderedReducer=c;var g=r.baseQueue,_=f.pending;if(_!==null){if(g!==null){var b=g.next;g.next=_.next,_.next=b}o.baseQueue=g=_,f.pending=null}if(_=r.baseState,g===null)r.memoizedState=_;else{o=g.next;var T=b=null,R=null,H=o,Y=!1;do{var Q=H.lane&-536870913;if(Q!==H.lane?(Me&Q)===Q:(ii&Q)===Q){var j=H.revertLane;if(j===0)R!==null&&(R=R.next={lane:0,revertLane:0,gesture:null,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null}),Q===mr&&(Y=!0);else if((ii&j)===j){H=H.next,j===mr&&(Y=!0);continue}else Q={lane:0,revertLane:H.revertLane,gesture:null,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},R===null?(T=R=Q,b=_):R=R.next=Q,Se.lanes|=j,Bi|=j;Q=H.action,Ts&&c(_,Q),_=H.hasEagerState?H.eagerState:c(_,Q)}else j={lane:Q,revertLane:H.revertLane,gesture:H.gesture,action:H.action,hasEagerState:H.hasEagerState,eagerState:H.eagerState,next:null},R===null?(T=R=j,b=_):R=R.next=j,Se.lanes|=Q,Bi|=Q;H=H.next}while(H!==null&&H!==o);if(R===null?b=_:R.next=T,!Zt(_,r.memoizedState)&&(ft=!0,Y&&(c=yr,c!==null)))throw c;r.memoizedState=_,r.baseState=b,r.baseQueue=R,f.lastRenderedState=_}return g===null&&(f.lanes=0),[r.memoizedState,f.dispatch]}function th(r){var o=lt(),c=o.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=r;var f=c.dispatch,g=c.pending,_=o.memoizedState;if(g!==null){c.pending=null;var b=g=g.next;do _=r(_,b.action),b=b.next;while(b!==g);Zt(_,o.memoizedState)||(ft=!0),o.memoizedState=_,o.baseQueue===null&&(o.baseState=_),c.lastRenderedState=_}return[_,f]}function Em(r,o,c){var f=Se,g=lt(),_=Ie;if(_){if(c===void 0)throw Error(i(407));c=c()}else c=o();var b=!Zt((je||g).memoizedState,c);if(b&&(g.memoizedState=c,ft=!0),g=g.queue,sh(Mm.bind(null,f,g,r),[r]),g.getSnapshot!==o||b||ut!==null&&ut.memoizedState.tag&1){if(f.flags|=2048,Sr(9,{destroy:void 0},Cm.bind(null,f,g,c,o),null),Ze===null)throw Error(i(349));_||(ii&127)!==0||Rm(f,o,c)}return c}function Rm(r,o,c){r.flags|=16384,r={getSnapshot:o,value:c},o=Se.updateQueue,o===null?(o=Pl(),Se.updateQueue=o,o.stores=[r]):(c=o.stores,c===null?o.stores=[r]:c.push(r))}function Cm(r,o,c,f){o.value=c,o.getSnapshot=f,Om(o)&&Im(r)}function Mm(r,o,c){return c(function(){Om(o)&&Im(r)})}function Om(r){var o=r.getSnapshot;r=r.value;try{var c=o();return!Zt(r,c)}catch{return!0}}function Im(r){var o=hs(r,2);o!==null&&jt(o,r,2)}function nh(r){var o=Pt();if(typeof r=="function"){var c=r;if(r=c(),Ts){xi(!0);try{c()}finally{xi(!1)}}}return o.memoizedState=o.baseState=r,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:r},o}function Nm(r,o,c,f){return r.baseState=c,eh(r,je,typeof f=="function"?f:si)}function Pw(r,o,c,f,g){if(Ll(r))throw Error(i(485));if(r=o.action,r!==null){var _={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){_.listeners.push(b)}};W.T!==null?c(!0):_.isTransition=!1,f(_),c=o.pending,c===null?(_.next=o.pending=_,km(o,_)):(_.next=c.next,o.pending=c.next=_)}}function km(r,o){var c=o.action,f=o.payload,g=r.state;if(o.isTransition){var _=W.T,b={};W.T=b;try{var T=c(g,f),R=W.S;R!==null&&R(b,T),Pm(r,o,T)}catch(H){ih(r,o,H)}finally{_!==null&&b.types!==null&&(_.types=b.types),W.T=_}}else try{_=c(g,f),Pm(r,o,_)}catch(H){ih(r,o,H)}}function Pm(r,o,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(f){Dm(r,o,f)},function(f){return ih(r,o,f)}):Dm(r,o,c)}function Dm(r,o,c){o.status="fulfilled",o.value=c,Bm(o),r.state=c,o=r.pending,o!==null&&(c=o.next,c===o?r.pending=null:(c=c.next,o.next=c,km(r,c)))}function ih(r,o,c){var f=r.pending;if(r.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=c,Bm(o),o=o.next;while(o!==f)}r.action=null}function Bm(r){r=r.listeners;for(var o=0;o<r.length;o++)(0,r[o])()}function Um(r,o){return o}function Fm(r,o){if(Ie){var c=Ze.formState;if(c!==null){e:{var f=Se;if(Ie){if(Je){t:{for(var g=Je,_=gn;g.nodeType!==8;){if(!_){g=null;break t}if(g=mn(g.nextSibling),g===null){g=null;break t}}_=g.data,g=_==="F!"||_==="F"?g:null}if(g){Je=mn(g.nextSibling),f=g.data==="F!";break e}}Ri(f)}f=!1}f&&(o=c[0])}}return c=Pt(),c.memoizedState=c.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Um,lastRenderedState:o},c.queue=f,c=iy.bind(null,Se,f),f.dispatch=c,f=nh(!1),_=ch.bind(null,Se,!1,f.queue),f=Pt(),g={state:o,dispatch:null,action:r,pending:null},f.queue=g,c=Pw.bind(null,Se,g,_,c),g.dispatch=c,f.memoizedState=r,[o,c,!1]}function Lm(r){var o=lt();return zm(o,je,r)}function zm(r,o,c){if(o=eh(r,o,Um)[0],r=Bl(si)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=Ha(o)}catch(b){throw b===br?El:b}else f=o;o=lt();var g=o.queue,_=g.dispatch;return c!==o.memoizedState&&(Se.flags|=2048,Sr(9,{destroy:void 0},Dw.bind(null,g,c),null)),[f,_,r]}function Dw(r,o){r.action=o}function Vm(r){var o=lt(),c=je;if(c!==null)return zm(o,c,r);lt(),o=o.memoizedState,c=lt();var f=c.queue.dispatch;return c.memoizedState=r,[o,f,!1]}function Sr(r,o,c,f){return r={tag:r,create:c,deps:f,inst:o,next:null},o=Se.updateQueue,o===null&&(o=Pl(),Se.updateQueue=o),c=o.lastEffect,c===null?o.lastEffect=r.next=r:(f=c.next,c.next=r,r.next=f,o.lastEffect=r),r}function Hm(){return lt().memoizedState}function Ul(r,o,c,f){var g=Pt();Se.flags|=r,g.memoizedState=Sr(1|o,{destroy:void 0},c,f===void 0?null:f)}function Fl(r,o,c,f){var g=lt();f=f===void 0?null:f;var _=g.memoizedState.inst;je!==null&&f!==null&&qf(f,je.memoizedState.deps)?g.memoizedState=Sr(o,_,c,f):(Se.flags|=r,g.memoizedState=Sr(1|o,_,c,f))}function jm(r,o){Ul(8390656,8,r,o)}function sh(r,o){Fl(2048,8,r,o)}function Bw(r){Se.flags|=4;var o=Se.updateQueue;if(o===null)o=Pl(),Se.updateQueue=o,o.events=[r];else{var c=o.events;c===null?o.events=[r]:c.push(r)}}function $m(r){var o=lt().memoizedState;return Bw({ref:o,nextImpl:r}),function(){if((De&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}function Wm(r,o){return Fl(4,2,r,o)}function Xm(r,o){return Fl(4,4,r,o)}function Ym(r,o){if(typeof o=="function"){r=r();var c=o(r);return function(){typeof c=="function"?c():o(null)}}if(o!=null)return r=r(),o.current=r,function(){o.current=null}}function qm(r,o,c){c=c!=null?c.concat([r]):null,Fl(4,4,Ym.bind(null,o,r),c)}function rh(){}function Zm(r,o){var c=lt();o=o===void 0?null:o;var f=c.memoizedState;return o!==null&&qf(o,f[1])?f[0]:(c.memoizedState=[r,o],r)}function Km(r,o){var c=lt();o=o===void 0?null:o;var f=c.memoizedState;if(o!==null&&qf(o,f[1]))return f[0];if(f=r(),Ts){xi(!0);try{r()}finally{xi(!1)}}return c.memoizedState=[f,o],f}function ah(r,o,c){return c===void 0||(ii&1073741824)!==0&&(Me&261930)===0?r.memoizedState=o:(r.memoizedState=c,r=Qy(),Se.lanes|=r,Bi|=r,c)}function Qm(r,o,c,f){return Zt(c,o)?c:Tr.current!==null?(r=ah(r,c,f),Zt(r,o)||(ft=!0),r):(ii&42)===0||(ii&1073741824)!==0&&(Me&261930)===0?(ft=!0,r.memoizedState=c):(r=Qy(),Se.lanes|=r,Bi|=r,o)}function Gm(r,o,c,f,g){var _=se.p;se.p=_!==0&&8>_?_:8;var b=W.T,T={};W.T=T,ch(r,!1,o,c);try{var R=g(),H=W.S;if(H!==null&&H(T,R),R!==null&&typeof R=="object"&&typeof R.then=="function"){var Y=Iw(R,f);ja(r,o,Y,tn(r))}else ja(r,o,f,tn(r))}catch(Q){ja(r,o,{then:function(){},status:"rejected",reason:Q},tn())}finally{se.p=_,b!==null&&T.types!==null&&(b.types=T.types),W.T=b}}function Uw(){}function oh(r,o,c,f){if(r.tag!==5)throw Error(i(476));var g=Jm(r).queue;Gm(r,g,o,de,c===null?Uw:function(){return ey(r),c(f)})}function Jm(r){var o=r.memoizedState;if(o!==null)return o;o={memoizedState:de,baseState:de,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:de},next:null};var c={};return o.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:si,lastRenderedState:c},next:null},r.memoizedState=o,r=r.alternate,r!==null&&(r.memoizedState=o),o}function ey(r){var o=Jm(r);o.next===null&&(o=r.alternate.memoizedState),ja(r,o.next.queue,{},tn())}function lh(){return At(ao)}function ty(){return lt().memoizedState}function ny(){return lt().memoizedState}function Fw(r){for(var o=r.return;o!==null;){switch(o.tag){case 24:case 3:var c=tn();r=Oi(c);var f=Ii(o,r,c);f!==null&&(jt(f,o,c),Fa(f,o,c)),o={cache:Uf()},r.payload=o;return}o=o.return}}function Lw(r,o,c){var f=tn();c={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null},Ll(r)?sy(o,c):(c=Ef(r,o,c,f),c!==null&&(jt(c,r,f),ry(c,o,f)))}function iy(r,o,c){var f=tn();ja(r,o,c,f)}function ja(r,o,c,f){var g={lane:f,revertLane:0,gesture:null,action:c,hasEagerState:!1,eagerState:null,next:null};if(Ll(r))sy(o,g);else{var _=r.alternate;if(r.lanes===0&&(_===null||_.lanes===0)&&(_=o.lastRenderedReducer,_!==null))try{var b=o.lastRenderedState,T=_(b,c);if(g.hasEagerState=!0,g.eagerState=T,Zt(T,b))return bl(r,o,g,0),Ze===null&&yl(),!1}catch{}finally{}if(c=Ef(r,o,g,f),c!==null)return jt(c,r,f),ry(c,o,f),!0}return!1}function ch(r,o,c,f){if(f={lane:2,revertLane:Vh(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},Ll(r)){if(o)throw Error(i(479))}else o=Ef(r,c,f,2),o!==null&&jt(o,r,2)}function Ll(r){var o=r.alternate;return r===Se||o!==null&&o===Se}function sy(r,o){xr=Nl=!0;var c=r.pending;c===null?o.next=o:(o.next=c.next,c.next=o),r.pending=o}function ry(r,o,c){if((c&4194048)!==0){var f=o.lanes;f&=r.pendingLanes,c|=f,o.lanes=c,u_(r,c)}}var $a={readContext:At,use:Dl,useCallback:it,useContext:it,useEffect:it,useImperativeHandle:it,useLayoutEffect:it,useInsertionEffect:it,useMemo:it,useReducer:it,useRef:it,useState:it,useDebugValue:it,useDeferredValue:it,useTransition:it,useSyncExternalStore:it,useId:it,useHostTransitionStatus:it,useFormState:it,useActionState:it,useOptimistic:it,useMemoCache:it,useCacheRefresh:it};$a.useEffectEvent=it;var ay={readContext:At,use:Dl,useCallback:function(r,o){return Pt().memoizedState=[r,o===void 0?null:o],r},useContext:At,useEffect:jm,useImperativeHandle:function(r,o,c){c=c!=null?c.concat([r]):null,Ul(4194308,4,Ym.bind(null,o,r),c)},useLayoutEffect:function(r,o){return Ul(4194308,4,r,o)},useInsertionEffect:function(r,o){Ul(4,2,r,o)},useMemo:function(r,o){var c=Pt();o=o===void 0?null:o;var f=r();if(Ts){xi(!0);try{r()}finally{xi(!1)}}return c.memoizedState=[f,o],f},useReducer:function(r,o,c){var f=Pt();if(c!==void 0){var g=c(o);if(Ts){xi(!0);try{c(o)}finally{xi(!1)}}}else g=o;return f.memoizedState=f.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},f.queue=r,r=r.dispatch=Lw.bind(null,Se,r),[f.memoizedState,r]},useRef:function(r){var o=Pt();return r={current:r},o.memoizedState=r},useState:function(r){r=nh(r);var o=r.queue,c=iy.bind(null,Se,o);return o.dispatch=c,[r.memoizedState,c]},useDebugValue:rh,useDeferredValue:function(r,o){var c=Pt();return ah(c,r,o)},useTransition:function(){var r=nh(!1);return r=Gm.bind(null,Se,r.queue,!0,!1),Pt().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,o,c){var f=Se,g=Pt();if(Ie){if(c===void 0)throw Error(i(407));c=c()}else{if(c=o(),Ze===null)throw Error(i(349));(Me&127)!==0||Rm(f,o,c)}g.memoizedState=c;var _={value:c,getSnapshot:o};return g.queue=_,jm(Mm.bind(null,f,_,r),[r]),f.flags|=2048,Sr(9,{destroy:void 0},Cm.bind(null,f,_,c,o),null),c},useId:function(){var r=Pt(),o=Ze.identifierPrefix;if(Ie){var c=Bn,f=Dn;c=(f&~(1<<32-qt(f)-1)).toString(32)+c,o="_"+o+"R_"+c,c=kl++,0<c&&(o+="H"+c.toString(32)),o+="_"}else c=Nw++,o="_"+o+"r_"+c.toString(32)+"_";return r.memoizedState=o},useHostTransitionStatus:lh,useFormState:Fm,useActionState:Fm,useOptimistic:function(r){var o=Pt();o.memoizedState=o.baseState=r;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=c,o=ch.bind(null,Se,!0,c),c.dispatch=o,[r,o]},useMemoCache:Jf,useCacheRefresh:function(){return Pt().memoizedState=Fw.bind(null,Se)},useEffectEvent:function(r){var o=Pt(),c={impl:r};return o.memoizedState=c,function(){if((De&2)!==0)throw Error(i(440));return c.impl.apply(void 0,arguments)}}},uh={readContext:At,use:Dl,useCallback:Zm,useContext:At,useEffect:sh,useImperativeHandle:qm,useInsertionEffect:Wm,useLayoutEffect:Xm,useMemo:Km,useReducer:Bl,useRef:Hm,useState:function(){return Bl(si)},useDebugValue:rh,useDeferredValue:function(r,o){var c=lt();return Qm(c,je.memoizedState,r,o)},useTransition:function(){var r=Bl(si)[0],o=lt().memoizedState;return[typeof r=="boolean"?r:Ha(r),o]},useSyncExternalStore:Em,useId:ty,useHostTransitionStatus:lh,useFormState:Lm,useActionState:Lm,useOptimistic:function(r,o){var c=lt();return Nm(c,je,r,o)},useMemoCache:Jf,useCacheRefresh:ny};uh.useEffectEvent=$m;var oy={readContext:At,use:Dl,useCallback:Zm,useContext:At,useEffect:sh,useImperativeHandle:qm,useInsertionEffect:Wm,useLayoutEffect:Xm,useMemo:Km,useReducer:th,useRef:Hm,useState:function(){return th(si)},useDebugValue:rh,useDeferredValue:function(r,o){var c=lt();return je===null?ah(c,r,o):Qm(c,je.memoizedState,r,o)},useTransition:function(){var r=th(si)[0],o=lt().memoizedState;return[typeof r=="boolean"?r:Ha(r),o]},useSyncExternalStore:Em,useId:ty,useHostTransitionStatus:lh,useFormState:Vm,useActionState:Vm,useOptimistic:function(r,o){var c=lt();return je!==null?Nm(c,je,r,o):(c.baseState=r,[r,c.queue.dispatch])},useMemoCache:Jf,useCacheRefresh:ny};oy.useEffectEvent=$m;function fh(r,o,c,f){o=r.memoizedState,c=c(f,o),c=c==null?o:m({},o,c),r.memoizedState=c,r.lanes===0&&(r.updateQueue.baseState=c)}var hh={enqueueSetState:function(r,o,c){r=r._reactInternals;var f=tn(),g=Oi(f);g.payload=o,c!=null&&(g.callback=c),o=Ii(r,g,f),o!==null&&(jt(o,r,f),Fa(o,r,f))},enqueueReplaceState:function(r,o,c){r=r._reactInternals;var f=tn(),g=Oi(f);g.tag=1,g.payload=o,c!=null&&(g.callback=c),o=Ii(r,g,f),o!==null&&(jt(o,r,f),Fa(o,r,f))},enqueueForceUpdate:function(r,o){r=r._reactInternals;var c=tn(),f=Oi(c);f.tag=2,o!=null&&(f.callback=o),o=Ii(r,f,c),o!==null&&(jt(o,r,c),Fa(o,r,c))}};function ly(r,o,c,f,g,_,b){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(f,_,b):o.prototype&&o.prototype.isPureReactComponent?!Oa(c,f)||!Oa(g,_):!0}function cy(r,o,c,f){r=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(c,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(c,f),o.state!==r&&hh.enqueueReplaceState(o,o.state,null)}function xs(r,o){var c=o;if("ref"in o){c={};for(var f in o)f!=="ref"&&(c[f]=o[f])}if(r=r.defaultProps){c===o&&(c=m({},c));for(var g in r)c[g]===void 0&&(c[g]=r[g])}return c}function uy(r){ml(r)}function fy(r){console.error(r)}function hy(r){ml(r)}function zl(r,o){try{var c=r.onUncaughtError;c(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function dy(r,o,c){try{var f=r.onCaughtError;f(c.value,{componentStack:c.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function dh(r,o,c){return c=Oi(c),c.tag=3,c.payload={element:null},c.callback=function(){zl(r,o)},c}function py(r){return r=Oi(r),r.tag=3,r}function gy(r,o,c,f){var g=c.type.getDerivedStateFromError;if(typeof g=="function"){var _=f.value;r.payload=function(){return g(_)},r.callback=function(){dy(o,c,f)}}var b=c.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(r.callback=function(){dy(o,c,f),typeof g!="function"&&(Ui===null?Ui=new Set([this]):Ui.add(this));var T=f.stack;this.componentDidCatch(f.value,{componentStack:T!==null?T:""})})}function zw(r,o,c,f,g){if(c.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=c.alternate,o!==null&&_r(o,c,g,!0),c=Qt.current,c!==null){switch(c.tag){case 31:case 13:return _n===null?Gl():c.alternate===null&&st===0&&(st=3),c.flags&=-257,c.flags|=65536,c.lanes=g,f===Rl?c.flags|=16384:(o=c.updateQueue,o===null?c.updateQueue=new Set([f]):o.add(f),Fh(r,f,g)),!1;case 22:return c.flags|=65536,f===Rl?c.flags|=16384:(o=c.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},c.updateQueue=o):(c=o.retryQueue,c===null?o.retryQueue=new Set([f]):c.add(f)),Fh(r,f,g)),!1}throw Error(i(435,c.tag))}return Fh(r,f,g),Gl(),!1}if(Ie)return o=Qt.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=g,f!==Nf&&(r=Error(i(422),{cause:f}),ka(hn(r,c)))):(f!==Nf&&(o=Error(i(423),{cause:f}),ka(hn(o,c))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,f=hn(f,c),g=dh(r.stateNode,f,g),jf(r,g),st!==4&&(st=2)),!1;var _=Error(i(520),{cause:f});if(_=hn(_,c),Ga===null?Ga=[_]:Ga.push(_),st!==4&&(st=2),o===null)return!0;f=hn(f,c),c=o;do{switch(c.tag){case 3:return c.flags|=65536,r=g&-g,c.lanes|=r,r=dh(c.stateNode,f,r),jf(c,r),!1;case 1:if(o=c.type,_=c.stateNode,(c.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Ui===null||!Ui.has(_))))return c.flags|=65536,g&=-g,c.lanes|=g,g=py(g),gy(g,r,c,f),jf(c,g),!1}c=c.return}while(c!==null);return!1}var ph=Error(i(461)),ft=!1;function Et(r,o,c,f){o.child=r===null?bm(o,null,c,f):vs(o,r.child,c,f)}function _y(r,o,c,f,g){c=c.render;var _=o.ref;if("ref"in f){var b={};for(var T in f)T!=="ref"&&(b[T]=f[T])}else b=f;return _s(o),f=Zf(r,o,c,b,_,g),T=Kf(),r!==null&&!ft?(Qf(r,o,g),ri(r,o,g)):(Ie&&T&&Of(o),o.flags|=1,Et(r,o,f,g),o.child)}function my(r,o,c,f,g){if(r===null){var _=c.type;return typeof _=="function"&&!Rf(_)&&_.defaultProps===void 0&&c.compare===null?(o.tag=15,o.type=_,yy(r,o,_,f,g)):(r=Tl(c.type,null,f,o,o.mode,g),r.ref=o.ref,r.return=o,o.child=r)}if(_=r.child,!xh(r,g)){var b=_.memoizedProps;if(c=c.compare,c=c!==null?c:Oa,c(b,f)&&r.ref===o.ref)return ri(r,o,g)}return o.flags|=1,r=Jn(_,f),r.ref=o.ref,r.return=o,o.child=r}function yy(r,o,c,f,g){if(r!==null){var _=r.memoizedProps;if(Oa(_,f)&&r.ref===o.ref)if(ft=!1,o.pendingProps=f=_,xh(r,g))(r.flags&131072)!==0&&(ft=!0);else return o.lanes=r.lanes,ri(r,o,g)}return gh(r,o,c,f,g)}function by(r,o,c,f){var g=f.children,_=r!==null?r.memoizedState:null;if(r===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((o.flags&128)!==0){if(_=_!==null?_.baseLanes|c:c,r!==null){for(f=o.child=r.child,g=0;f!==null;)g=g|f.lanes|f.childLanes,f=f.sibling;f=g&~_}else f=0,o.child=null;return vy(r,o,_,c,f)}if((c&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},r!==null&&Al(o,_!==null?_.cachePool:null),_!==null?xm(o,_):Wf(),wm(o);else return f=o.lanes=536870912,vy(r,o,_!==null?_.baseLanes|c:c,c,f)}else _!==null?(Al(o,_.cachePool),xm(o,_),ki(),o.memoizedState=null):(r!==null&&Al(o,null),Wf(),ki());return Et(r,o,g,c),o.child}function Wa(r,o){return r!==null&&r.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function vy(r,o,c,f,g){var _=Lf();return _=_===null?null:{parent:ct._currentValue,pool:_},o.memoizedState={baseLanes:c,cachePool:_},r!==null&&Al(o,null),Wf(),wm(o),r!==null&&_r(r,o,f,!0),o.childLanes=g,null}function Vl(r,o){return o=jl({mode:o.mode,children:o.children},r.mode),o.ref=r.ref,r.child=o,o.return=r,o}function Ty(r,o,c){return vs(o,r.child,null,c),r=Vl(o,o.pendingProps),r.flags|=2,Gt(o),o.memoizedState=null,r}function Vw(r,o,c){var f=o.pendingProps,g=(o.flags&128)!==0;if(o.flags&=-129,r===null){if(Ie){if(f.mode==="hidden")return r=Vl(o,f),o.lanes=536870912,Wa(null,r);if(Yf(o),(r=Je)?(r=kb(r,gn),r=r!==null&&r.data==="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:Ai!==null?{id:Dn,overflow:Bn}:null,retryLane:536870912,hydrationErrors:null},c=sm(r),c.return=o,o.child=c,St=o,Je=null)):r=null,r===null)throw Ri(o);return o.lanes=536870912,null}return Vl(o,f)}var _=r.memoizedState;if(_!==null){var b=_.dehydrated;if(Yf(o),g)if(o.flags&256)o.flags&=-257,o=Ty(r,o,c);else if(o.memoizedState!==null)o.child=r.child,o.flags|=128,o=null;else throw Error(i(558));else if(ft||_r(r,o,c,!1),g=(c&r.childLanes)!==0,ft||g){if(f=Ze,f!==null&&(b=f_(f,c),b!==0&&b!==_.retryLane))throw _.retryLane=b,hs(r,b),jt(f,r,b),ph;Gl(),o=Ty(r,o,c)}else r=_.treeContext,Je=mn(b.nextSibling),St=o,Ie=!0,Ei=null,gn=!1,r!==null&&om(o,r),o=Vl(o,f),o.flags|=4096;return o}return r=Jn(r.child,{mode:f.mode,children:f.children}),r.ref=o.ref,o.child=r,r.return=o,r}function Hl(r,o){var c=o.ref;if(c===null)r!==null&&r.ref!==null&&(o.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(r===null||r.ref!==c)&&(o.flags|=4194816)}}function gh(r,o,c,f,g){return _s(o),c=Zf(r,o,c,f,void 0,g),f=Kf(),r!==null&&!ft?(Qf(r,o,g),ri(r,o,g)):(Ie&&f&&Of(o),o.flags|=1,Et(r,o,c,g),o.child)}function xy(r,o,c,f,g,_){return _s(o),o.updateQueue=null,c=Am(o,f,c,g),Sm(r),f=Kf(),r!==null&&!ft?(Qf(r,o,_),ri(r,o,_)):(Ie&&f&&Of(o),o.flags|=1,Et(r,o,c,_),o.child)}function wy(r,o,c,f,g){if(_s(o),o.stateNode===null){var _=hr,b=c.contextType;typeof b=="object"&&b!==null&&(_=At(b)),_=new c(f,_),o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=hh,o.stateNode=_,_._reactInternals=o,_=o.stateNode,_.props=f,_.state=o.memoizedState,_.refs={},Vf(o),b=c.contextType,_.context=typeof b=="object"&&b!==null?At(b):hr,_.state=o.memoizedState,b=c.getDerivedStateFromProps,typeof b=="function"&&(fh(o,c,b,f),_.state=o.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(b=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),b!==_.state&&hh.enqueueReplaceState(_,_.state,null),za(o,f,_,g),La(),_.state=o.memoizedState),typeof _.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(r===null){_=o.stateNode;var T=o.memoizedProps,R=xs(c,T);_.props=R;var H=_.context,Y=c.contextType;b=hr,typeof Y=="object"&&Y!==null&&(b=At(Y));var Q=c.getDerivedStateFromProps;Y=typeof Q=="function"||typeof _.getSnapshotBeforeUpdate=="function",T=o.pendingProps!==T,Y||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(T||H!==b)&&cy(o,_,f,b),Mi=!1;var j=o.memoizedState;_.state=j,za(o,f,_,g),La(),H=o.memoizedState,T||j!==H||Mi?(typeof Q=="function"&&(fh(o,c,Q,f),H=o.memoizedState),(R=Mi||ly(o,c,R,f,j,H,b))?(Y||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(o.flags|=4194308)):(typeof _.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=H),_.props=f,_.state=H,_.context=b,f=R):(typeof _.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{_=o.stateNode,Hf(r,o),b=o.memoizedProps,Y=xs(c,b),_.props=Y,Q=o.pendingProps,j=_.context,H=c.contextType,R=hr,typeof H=="object"&&H!==null&&(R=At(H)),T=c.getDerivedStateFromProps,(H=typeof T=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(b!==Q||j!==R)&&cy(o,_,f,R),Mi=!1,j=o.memoizedState,_.state=j,za(o,f,_,g),La();var $=o.memoizedState;b!==Q||j!==$||Mi||r!==null&&r.dependencies!==null&&wl(r.dependencies)?(typeof T=="function"&&(fh(o,c,T,f),$=o.memoizedState),(Y=Mi||ly(o,c,Y,f,j,$,R)||r!==null&&r.dependencies!==null&&wl(r.dependencies))?(H||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(f,$,R),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(f,$,R)),typeof _.componentDidUpdate=="function"&&(o.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof _.componentDidUpdate!="function"||b===r.memoizedProps&&j===r.memoizedState||(o.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&j===r.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=$),_.props=f,_.state=$,_.context=R,f=Y):(typeof _.componentDidUpdate!="function"||b===r.memoizedProps&&j===r.memoizedState||(o.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&j===r.memoizedState||(o.flags|=1024),f=!1)}return _=f,Hl(r,o),f=(o.flags&128)!==0,_||f?(_=o.stateNode,c=f&&typeof c.getDerivedStateFromError!="function"?null:_.render(),o.flags|=1,r!==null&&f?(o.child=vs(o,r.child,null,g),o.child=vs(o,null,c,g)):Et(r,o,c,g),o.memoizedState=_.state,r=o.child):r=ri(r,o,g),r}function Sy(r,o,c,f){return ps(),o.flags|=256,Et(r,o,c,f),o.child}var _h={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function mh(r){return{baseLanes:r,cachePool:dm()}}function yh(r,o,c){return r=r!==null?r.childLanes&~c:0,o&&(r|=en),r}function Ay(r,o,c){var f=o.pendingProps,g=!1,_=(o.flags&128)!==0,b;if((b=_)||(b=r!==null&&r.memoizedState===null?!1:(ot.current&2)!==0),b&&(g=!0,o.flags&=-129),b=(o.flags&32)!==0,o.flags&=-33,r===null){if(Ie){if(g?Ni(o):ki(),(r=Je)?(r=kb(r,gn),r=r!==null&&r.data!=="&"?r:null,r!==null&&(o.memoizedState={dehydrated:r,treeContext:Ai!==null?{id:Dn,overflow:Bn}:null,retryLane:536870912,hydrationErrors:null},c=sm(r),c.return=o,o.child=c,St=o,Je=null)):r=null,r===null)throw Ri(o);return ed(r)?o.lanes=32:o.lanes=536870912,null}var T=f.children;return f=f.fallback,g?(ki(),g=o.mode,T=jl({mode:"hidden",children:T},g),f=ds(f,g,c,null),T.return=o,f.return=o,T.sibling=f,o.child=T,f=o.child,f.memoizedState=mh(c),f.childLanes=yh(r,b,c),o.memoizedState=_h,Wa(null,f)):(Ni(o),bh(o,T))}var R=r.memoizedState;if(R!==null&&(T=R.dehydrated,T!==null)){if(_)o.flags&256?(Ni(o),o.flags&=-257,o=vh(r,o,c)):o.memoizedState!==null?(ki(),o.child=r.child,o.flags|=128,o=null):(ki(),T=f.fallback,g=o.mode,f=jl({mode:"visible",children:f.children},g),T=ds(T,g,c,null),T.flags|=2,f.return=o,T.return=o,f.sibling=T,o.child=f,vs(o,r.child,null,c),f=o.child,f.memoizedState=mh(c),f.childLanes=yh(r,b,c),o.memoizedState=_h,o=Wa(null,f));else if(Ni(o),ed(T)){if(b=T.nextSibling&&T.nextSibling.dataset,b)var H=b.dgst;b=H,f=Error(i(419)),f.stack="",f.digest=b,ka({value:f,source:null,stack:null}),o=vh(r,o,c)}else if(ft||_r(r,o,c,!1),b=(c&r.childLanes)!==0,ft||b){if(b=Ze,b!==null&&(f=f_(b,c),f!==0&&f!==R.retryLane))throw R.retryLane=f,hs(r,f),jt(b,r,f),ph;Jh(T)||Gl(),o=vh(r,o,c)}else Jh(T)?(o.flags|=192,o.child=r.child,o=null):(r=R.treeContext,Je=mn(T.nextSibling),St=o,Ie=!0,Ei=null,gn=!1,r!==null&&om(o,r),o=bh(o,f.children),o.flags|=4096);return o}return g?(ki(),T=f.fallback,g=o.mode,R=r.child,H=R.sibling,f=Jn(R,{mode:"hidden",children:f.children}),f.subtreeFlags=R.subtreeFlags&65011712,H!==null?T=Jn(H,T):(T=ds(T,g,c,null),T.flags|=2),T.return=o,f.return=o,f.sibling=T,o.child=f,Wa(null,f),f=o.child,T=r.child.memoizedState,T===null?T=mh(c):(g=T.cachePool,g!==null?(R=ct._currentValue,g=g.parent!==R?{parent:R,pool:R}:g):g=dm(),T={baseLanes:T.baseLanes|c,cachePool:g}),f.memoizedState=T,f.childLanes=yh(r,b,c),o.memoizedState=_h,Wa(r.child,f)):(Ni(o),c=r.child,r=c.sibling,c=Jn(c,{mode:"visible",children:f.children}),c.return=o,c.sibling=null,r!==null&&(b=o.deletions,b===null?(o.deletions=[r],o.flags|=16):b.push(r)),o.child=c,o.memoizedState=null,c)}function bh(r,o){return o=jl({mode:"visible",children:o},r.mode),o.return=r,r.child=o}function jl(r,o){return r=Kt(22,r,null,o),r.lanes=0,r}function vh(r,o,c){return vs(o,r.child,null,c),r=bh(o,o.pendingProps.children),r.flags|=2,o.memoizedState=null,r}function Ey(r,o,c){r.lanes|=o;var f=r.alternate;f!==null&&(f.lanes|=o),Df(r.return,o,c)}function Th(r,o,c,f,g,_){var b=r.memoizedState;b===null?r.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:g,treeForkCount:_}:(b.isBackwards=o,b.rendering=null,b.renderingStartTime=0,b.last=f,b.tail=c,b.tailMode=g,b.treeForkCount=_)}function Ry(r,o,c){var f=o.pendingProps,g=f.revealOrder,_=f.tail;f=f.children;var b=ot.current,T=(b&2)!==0;if(T?(b=b&1|2,o.flags|=128):b&=1,oe(ot,b),Et(r,o,f,c),f=Ie?Na:0,!T&&r!==null&&(r.flags&128)!==0)e:for(r=o.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Ey(r,c,o);else if(r.tag===19)Ey(r,c,o);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break e;for(;r.sibling===null;){if(r.return===null||r.return===o)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(g){case"forwards":for(c=o.child,g=null;c!==null;)r=c.alternate,r!==null&&Il(r)===null&&(g=c),c=c.sibling;c=g,c===null?(g=o.child,o.child=null):(g=c.sibling,c.sibling=null),Th(o,!1,g,c,_,f);break;case"backwards":case"unstable_legacy-backwards":for(c=null,g=o.child,o.child=null;g!==null;){if(r=g.alternate,r!==null&&Il(r)===null){o.child=g;break}r=g.sibling,g.sibling=c,c=g,g=r}Th(o,!0,c,null,_,f);break;case"together":Th(o,!1,null,null,void 0,f);break;default:o.memoizedState=null}return o.child}function ri(r,o,c){if(r!==null&&(o.dependencies=r.dependencies),Bi|=o.lanes,(c&o.childLanes)===0)if(r!==null){if(_r(r,o,c,!1),(c&o.childLanes)===0)return null}else return null;if(r!==null&&o.child!==r.child)throw Error(i(153));if(o.child!==null){for(r=o.child,c=Jn(r,r.pendingProps),o.child=c,c.return=o;r.sibling!==null;)r=r.sibling,c=c.sibling=Jn(r,r.pendingProps),c.return=o;c.sibling=null}return o.child}function xh(r,o){return(r.lanes&o)!==0?!0:(r=r.dependencies,!!(r!==null&&wl(r)))}function Hw(r,o,c){switch(o.tag){case 3:Ne(o,o.stateNode.containerInfo),Ci(o,ct,r.memoizedState.cache),ps();break;case 27:case 5:Zn(o);break;case 4:Ne(o,o.stateNode.containerInfo);break;case 10:Ci(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Yf(o),null;break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(Ni(o),o.flags|=128,null):(c&o.child.childLanes)!==0?Ay(r,o,c):(Ni(o),r=ri(r,o,c),r!==null?r.sibling:null);Ni(o);break;case 19:var g=(r.flags&128)!==0;if(f=(c&o.childLanes)!==0,f||(_r(r,o,c,!1),f=(c&o.childLanes)!==0),g){if(f)return Ry(r,o,c);o.flags|=128}if(g=o.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),oe(ot,ot.current),f)break;return null;case 22:return o.lanes=0,by(r,o,c,o.pendingProps);case 24:Ci(o,ct,r.memoizedState.cache)}return ri(r,o,c)}function Cy(r,o,c){if(r!==null)if(r.memoizedProps!==o.pendingProps)ft=!0;else{if(!xh(r,c)&&(o.flags&128)===0)return ft=!1,Hw(r,o,c);ft=(r.flags&131072)!==0}else ft=!1,Ie&&(o.flags&1048576)!==0&&am(o,Na,o.index);switch(o.lanes=0,o.tag){case 16:e:{var f=o.pendingProps;if(r=ys(o.elementType),o.type=r,typeof r=="function")Rf(r)?(f=xs(r,f),o.tag=1,o=wy(null,o,r,f,c)):(o.tag=0,o=gh(null,o,r,f,c));else{if(r!=null){var g=r.$$typeof;if(g===B){o.tag=11,o=_y(null,o,r,f,c);break e}else if(g===ne){o.tag=14,o=my(null,o,r,f,c);break e}}throw o=me(r)||r,Error(i(306,o,""))}}return o;case 0:return gh(r,o,o.type,o.pendingProps,c);case 1:return f=o.type,g=xs(f,o.pendingProps),wy(r,o,f,g,c);case 3:e:{if(Ne(o,o.stateNode.containerInfo),r===null)throw Error(i(387));f=o.pendingProps;var _=o.memoizedState;g=_.element,Hf(r,o),za(o,f,null,c);var b=o.memoizedState;if(f=b.cache,Ci(o,ct,f),f!==_.cache&&Bf(o,[ct],c,!0),La(),f=b.element,_.isDehydrated)if(_={element:f,isDehydrated:!1,cache:b.cache},o.updateQueue.baseState=_,o.memoizedState=_,o.flags&256){o=Sy(r,o,f,c);break e}else if(f!==g){g=hn(Error(i(424)),o),ka(g),o=Sy(r,o,f,c);break e}else{switch(r=o.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(Je=mn(r.firstChild),St=o,Ie=!0,Ei=null,gn=!0,c=bm(o,null,f,c),o.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(ps(),f===g){o=ri(r,o,c);break e}Et(r,o,f,c)}o=o.child}return o;case 26:return Hl(r,o),r===null?(c=Lb(o.type,null,o.pendingProps,null))?o.memoizedState=c:Ie||(c=o.type,r=o.pendingProps,f=rc(ue.current).createElement(c),f[wt]=o,f[Ut]=r,Rt(f,c,r),vt(f),o.stateNode=f):o.memoizedState=Lb(o.type,r.memoizedProps,o.pendingProps,r.memoizedState),null;case 27:return Zn(o),r===null&&Ie&&(f=o.stateNode=Bb(o.type,o.pendingProps,ue.current),St=o,gn=!0,g=Je,Vi(o.type)?(td=g,Je=mn(f.firstChild)):Je=g),Et(r,o,o.pendingProps.children,c),Hl(r,o),r===null&&(o.flags|=4194304),o.child;case 5:return r===null&&Ie&&((g=f=Je)&&(f=yS(f,o.type,o.pendingProps,gn),f!==null?(o.stateNode=f,St=o,Je=mn(f.firstChild),gn=!1,g=!0):g=!1),g||Ri(o)),Zn(o),g=o.type,_=o.pendingProps,b=r!==null?r.memoizedProps:null,f=_.children,Kh(g,_)?f=null:b!==null&&Kh(g,b)&&(o.flags|=32),o.memoizedState!==null&&(g=Zf(r,o,kw,null,null,c),ao._currentValue=g),Hl(r,o),Et(r,o,f,c),o.child;case 6:return r===null&&Ie&&((r=c=Je)&&(c=bS(c,o.pendingProps,gn),c!==null?(o.stateNode=c,St=o,Je=null,r=!0):r=!1),r||Ri(o)),null;case 13:return Ay(r,o,c);case 4:return Ne(o,o.stateNode.containerInfo),f=o.pendingProps,r===null?o.child=vs(o,null,f,c):Et(r,o,f,c),o.child;case 11:return _y(r,o,o.type,o.pendingProps,c);case 7:return Et(r,o,o.pendingProps,c),o.child;case 8:return Et(r,o,o.pendingProps.children,c),o.child;case 12:return Et(r,o,o.pendingProps.children,c),o.child;case 10:return f=o.pendingProps,Ci(o,o.type,f.value),Et(r,o,f.children,c),o.child;case 9:return g=o.type._context,f=o.pendingProps.children,_s(o),g=At(g),f=f(g),o.flags|=1,Et(r,o,f,c),o.child;case 14:return my(r,o,o.type,o.pendingProps,c);case 15:return yy(r,o,o.type,o.pendingProps,c);case 19:return Ry(r,o,c);case 31:return Vw(r,o,c);case 22:return by(r,o,c,o.pendingProps);case 24:return _s(o),f=At(ct),r===null?(g=Lf(),g===null&&(g=Ze,_=Uf(),g.pooledCache=_,_.refCount++,_!==null&&(g.pooledCacheLanes|=c),g=_),o.memoizedState={parent:f,cache:g},Vf(o),Ci(o,ct,g)):((r.lanes&c)!==0&&(Hf(r,o),za(o,null,null,c),La()),g=r.memoizedState,_=o.memoizedState,g.parent!==f?(g={parent:f,cache:f},o.memoizedState=g,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=g),Ci(o,ct,f)):(f=_.cache,Ci(o,ct,f),f!==g.cache&&Bf(o,[ct],c,!0))),Et(r,o,o.pendingProps.children,c),o.child;case 29:throw o.pendingProps}throw Error(i(156,o.tag))}function ai(r){r.flags|=4}function wh(r,o,c,f,g){if((o=(r.mode&32)!==0)&&(o=!1),o){if(r.flags|=16777216,(g&335544128)===g)if(r.stateNode.complete)r.flags|=8192;else if(tb())r.flags|=8192;else throw bs=Rl,zf}else r.flags&=-16777217}function My(r,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!$b(o))if(tb())r.flags|=8192;else throw bs=Rl,zf}function $l(r,o){o!==null&&(r.flags|=4),r.flags&16384&&(o=r.tag!==22?l_():536870912,r.lanes|=o,Cr|=o)}function Xa(r,o){if(!Ie)switch(r.tailMode){case"hidden":o=r.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?r.tail=null:c.sibling=null;break;case"collapsed":c=r.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?o||r.tail===null?r.tail=null:r.tail.sibling=null:f.sibling=null}}function et(r){var o=r.alternate!==null&&r.alternate.child===r.child,c=0,f=0;if(o)for(var g=r.child;g!==null;)c|=g.lanes|g.childLanes,f|=g.subtreeFlags&65011712,f|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)c|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=f,r.childLanes=c,o}function jw(r,o,c){var f=o.pendingProps;switch(If(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return et(o),null;case 1:return et(o),null;case 3:return c=o.stateNode,f=null,r!==null&&(f=r.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),ni(ct),Ke(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(r===null||r.child===null)&&(gr(o)?ai(o):r===null||r.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,kf())),et(o),null;case 26:var g=o.type,_=o.memoizedState;return r===null?(ai(o),_!==null?(et(o),My(o,_)):(et(o),wh(o,g,null,f,c))):_?_!==r.memoizedState?(ai(o),et(o),My(o,_)):(et(o),o.flags&=-16777217):(r=r.memoizedProps,r!==f&&ai(o),et(o),wh(o,g,r,f,c)),null;case 27:if(Wt(o),c=ue.current,g=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==f&&ai(o);else{if(!f){if(o.stateNode===null)throw Error(i(166));return et(o),null}r=ce.current,gr(o)?lm(o):(r=Bb(g,f,c),o.stateNode=r,ai(o))}return et(o),null;case 5:if(Wt(o),g=o.type,r!==null&&o.stateNode!=null)r.memoizedProps!==f&&ai(o);else{if(!f){if(o.stateNode===null)throw Error(i(166));return et(o),null}if(_=ce.current,gr(o))lm(o);else{var b=rc(ue.current);switch(_){case 1:_=b.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:_=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":_=b.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":_=b.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":_=b.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild);break;case"select":_=typeof f.is=="string"?b.createElement("select",{is:f.is}):b.createElement("select"),f.multiple?_.multiple=!0:f.size&&(_.size=f.size);break;default:_=typeof f.is=="string"?b.createElement(g,{is:f.is}):b.createElement(g)}}_[wt]=o,_[Ut]=f;e:for(b=o.child;b!==null;){if(b.tag===5||b.tag===6)_.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===o)break e;for(;b.sibling===null;){if(b.return===null||b.return===o)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}o.stateNode=_;e:switch(Rt(_,g,f),g){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&ai(o)}}return et(o),wh(o,o.type,r===null?null:r.memoizedProps,o.pendingProps,c),null;case 6:if(r&&o.stateNode!=null)r.memoizedProps!==f&&ai(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(i(166));if(r=ue.current,gr(o)){if(r=o.stateNode,c=o.memoizedProps,f=null,g=St,g!==null)switch(g.tag){case 27:case 5:f=g.memoizedProps}r[wt]=o,r=!!(r.nodeValue===c||f!==null&&f.suppressHydrationWarning===!0||Ab(r.nodeValue,c)),r||Ri(o,!0)}else r=rc(r).createTextNode(f),r[wt]=o,o.stateNode=r}return et(o),null;case 31:if(c=o.memoizedState,r===null||r.memoizedState!==null){if(f=gr(o),c!==null){if(r===null){if(!f)throw Error(i(318));if(r=o.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(557));r[wt]=o}else ps(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;et(o),r=!1}else c=kf(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=c),r=!0;if(!r)return o.flags&256?(Gt(o),o):(Gt(o),null);if((o.flags&128)!==0)throw Error(i(558))}return et(o),null;case 13:if(f=o.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=gr(o),f!==null&&f.dehydrated!==null){if(r===null){if(!g)throw Error(i(318));if(g=o.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[wt]=o}else ps(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;et(o),g=!1}else g=kf(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return o.flags&256?(Gt(o),o):(Gt(o),null)}return Gt(o),(o.flags&128)!==0?(o.lanes=c,o):(c=f!==null,r=r!==null&&r.memoizedState!==null,c&&(f=o.child,g=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(g=f.alternate.memoizedState.cachePool.pool),_=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(_=f.memoizedState.cachePool.pool),_!==g&&(f.flags|=2048)),c!==r&&c&&(o.child.flags|=8192),$l(o,o.updateQueue),et(o),null);case 4:return Ke(),r===null&&Wh(o.stateNode.containerInfo),et(o),null;case 10:return ni(o.type),et(o),null;case 19:if(G(ot),f=o.memoizedState,f===null)return et(o),null;if(g=(o.flags&128)!==0,_=f.rendering,_===null)if(g)Xa(f,!1);else{if(st!==0||r!==null&&(r.flags&128)!==0)for(r=o.child;r!==null;){if(_=Il(r),_!==null){for(o.flags|=128,Xa(f,!1),r=_.updateQueue,o.updateQueue=r,$l(o,r),o.subtreeFlags=0,r=c,c=o.child;c!==null;)im(c,r),c=c.sibling;return oe(ot,ot.current&1|2),Ie&&ei(o,f.treeForkCount),o.child}r=r.sibling}f.tail!==null&&Xt()>Zl&&(o.flags|=128,g=!0,Xa(f,!1),o.lanes=4194304)}else{if(!g)if(r=Il(_),r!==null){if(o.flags|=128,g=!0,r=r.updateQueue,o.updateQueue=r,$l(o,r),Xa(f,!0),f.tail===null&&f.tailMode==="hidden"&&!_.alternate&&!Ie)return et(o),null}else 2*Xt()-f.renderingStartTime>Zl&&c!==536870912&&(o.flags|=128,g=!0,Xa(f,!1),o.lanes=4194304);f.isBackwards?(_.sibling=o.child,o.child=_):(r=f.last,r!==null?r.sibling=_:o.child=_,f.last=_)}return f.tail!==null?(r=f.tail,f.rendering=r,f.tail=r.sibling,f.renderingStartTime=Xt(),r.sibling=null,c=ot.current,oe(ot,g?c&1|2:c&1),Ie&&ei(o,f.treeForkCount),r):(et(o),null);case 22:case 23:return Gt(o),Xf(),f=o.memoizedState!==null,r!==null?r.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(c&536870912)!==0&&(o.flags&128)===0&&(et(o),o.subtreeFlags&6&&(o.flags|=8192)):et(o),c=o.updateQueue,c!==null&&$l(o,c.retryQueue),c=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==c&&(o.flags|=2048),r!==null&&G(ms),null;case 24:return c=null,r!==null&&(c=r.memoizedState.cache),o.memoizedState.cache!==c&&(o.flags|=2048),ni(ct),et(o),null;case 25:return null;case 30:return null}throw Error(i(156,o.tag))}function $w(r,o){switch(If(o),o.tag){case 1:return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 3:return ni(ct),Ke(),r=o.flags,(r&65536)!==0&&(r&128)===0?(o.flags=r&-65537|128,o):null;case 26:case 27:case 5:return Wt(o),null;case 31:if(o.memoizedState!==null){if(Gt(o),o.alternate===null)throw Error(i(340));ps()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 13:if(Gt(o),r=o.memoizedState,r!==null&&r.dehydrated!==null){if(o.alternate===null)throw Error(i(340));ps()}return r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 19:return G(ot),null;case 4:return Ke(),null;case 10:return ni(o.type),null;case 22:case 23:return Gt(o),Xf(),r!==null&&G(ms),r=o.flags,r&65536?(o.flags=r&-65537|128,o):null;case 24:return ni(ct),null;case 25:return null;default:return null}}function Oy(r,o){switch(If(o),o.tag){case 3:ni(ct),Ke();break;case 26:case 27:case 5:Wt(o);break;case 4:Ke();break;case 31:o.memoizedState!==null&&Gt(o);break;case 13:Gt(o);break;case 19:G(ot);break;case 10:ni(o.type);break;case 22:case 23:Gt(o),Xf(),r!==null&&G(ms);break;case 24:ni(ct)}}function Ya(r,o){try{var c=o.updateQueue,f=c!==null?c.lastEffect:null;if(f!==null){var g=f.next;c=g;do{if((c.tag&r)===r){f=void 0;var _=c.create,b=c.inst;f=_(),b.destroy=f}c=c.next}while(c!==g)}}catch(T){Ve(o,o.return,T)}}function Pi(r,o,c){try{var f=o.updateQueue,g=f!==null?f.lastEffect:null;if(g!==null){var _=g.next;f=_;do{if((f.tag&r)===r){var b=f.inst,T=b.destroy;if(T!==void 0){b.destroy=void 0,g=o;var R=c,H=T;try{H()}catch(Y){Ve(g,R,Y)}}}f=f.next}while(f!==_)}}catch(Y){Ve(o,o.return,Y)}}function Iy(r){var o=r.updateQueue;if(o!==null){var c=r.stateNode;try{Tm(o,c)}catch(f){Ve(r,r.return,f)}}}function Ny(r,o,c){c.props=xs(r.type,r.memoizedProps),c.state=r.memoizedState;try{c.componentWillUnmount()}catch(f){Ve(r,o,f)}}function qa(r,o){try{var c=r.ref;if(c!==null){switch(r.tag){case 26:case 27:case 5:var f=r.stateNode;break;case 30:f=r.stateNode;break;default:f=r.stateNode}typeof c=="function"?r.refCleanup=c(f):c.current=f}}catch(g){Ve(r,o,g)}}function Un(r,o){var c=r.ref,f=r.refCleanup;if(c!==null)if(typeof f=="function")try{f()}catch(g){Ve(r,o,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(g){Ve(r,o,g)}else c.current=null}function ky(r){var o=r.type,c=r.memoizedProps,f=r.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":c.autoFocus&&f.focus();break e;case"img":c.src?f.src=c.src:c.srcSet&&(f.srcset=c.srcSet)}}catch(g){Ve(r,r.return,g)}}function Sh(r,o,c){try{var f=r.stateNode;hS(f,r.type,c,o),f[Ut]=o}catch(g){Ve(r,r.return,g)}}function Py(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Vi(r.type)||r.tag===4}function Ah(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Py(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Vi(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Eh(r,o,c){var f=r.tag;if(f===5||f===6)r=r.stateNode,o?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(r,o):(o=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,o.appendChild(r),c=c._reactRootContainer,c!=null||o.onclick!==null||(o.onclick=Qn));else if(f!==4&&(f===27&&Vi(r.type)&&(c=r.stateNode,o=null),r=r.child,r!==null))for(Eh(r,o,c),r=r.sibling;r!==null;)Eh(r,o,c),r=r.sibling}function Wl(r,o,c){var f=r.tag;if(f===5||f===6)r=r.stateNode,o?c.insertBefore(r,o):c.appendChild(r);else if(f!==4&&(f===27&&Vi(r.type)&&(c=r.stateNode),r=r.child,r!==null))for(Wl(r,o,c),r=r.sibling;r!==null;)Wl(r,o,c),r=r.sibling}function Dy(r){var o=r.stateNode,c=r.memoizedProps;try{for(var f=r.type,g=o.attributes;g.length;)o.removeAttributeNode(g[0]);Rt(o,f,c),o[wt]=r,o[Ut]=c}catch(_){Ve(r,r.return,_)}}var oi=!1,ht=!1,Rh=!1,By=typeof WeakSet=="function"?WeakSet:Set,Tt=null;function Ww(r,o){if(r=r.containerInfo,qh=hc,r=q_(r),vf(r)){if("selectionStart"in r)var c={start:r.selectionStart,end:r.selectionEnd};else e:{c=(c=r.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var g=f.anchorOffset,_=f.focusNode;f=f.focusOffset;try{c.nodeType,_.nodeType}catch{c=null;break e}var b=0,T=-1,R=-1,H=0,Y=0,Q=r,j=null;t:for(;;){for(var $;Q!==c||g!==0&&Q.nodeType!==3||(T=b+g),Q!==_||f!==0&&Q.nodeType!==3||(R=b+f),Q.nodeType===3&&(b+=Q.nodeValue.length),($=Q.firstChild)!==null;)j=Q,Q=$;for(;;){if(Q===r)break t;if(j===c&&++H===g&&(T=b),j===_&&++Y===f&&(R=b),($=Q.nextSibling)!==null)break;Q=j,j=Q.parentNode}Q=$}c=T===-1||R===-1?null:{start:T,end:R}}else c=null}c=c||{start:0,end:0}}else c=null;for(Zh={focusedElem:r,selectionRange:c},hc=!1,Tt=o;Tt!==null;)if(o=Tt,r=o.child,(o.subtreeFlags&1028)!==0&&r!==null)r.return=o,Tt=r;else for(;Tt!==null;){switch(o=Tt,_=o.alternate,r=o.flags,o.tag){case 0:if((r&4)!==0&&(r=o.updateQueue,r=r!==null?r.events:null,r!==null))for(c=0;c<r.length;c++)g=r[c],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&_!==null){r=void 0,c=o,g=_.memoizedProps,_=_.memoizedState,f=c.stateNode;try{var le=xs(c.type,g);r=f.getSnapshotBeforeUpdate(le,_),f.__reactInternalSnapshotBeforeUpdate=r}catch(_e){Ve(c,c.return,_e)}}break;case 3:if((r&1024)!==0){if(r=o.stateNode.containerInfo,c=r.nodeType,c===9)Gh(r);else if(c===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Gh(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=o.sibling,r!==null){r.return=o.return,Tt=r;break}Tt=o.return}}function Uy(r,o,c){var f=c.flags;switch(c.tag){case 0:case 11:case 15:ci(r,c),f&4&&Ya(5,c);break;case 1:if(ci(r,c),f&4)if(r=c.stateNode,o===null)try{r.componentDidMount()}catch(b){Ve(c,c.return,b)}else{var g=xs(c.type,o.memoizedProps);o=o.memoizedState;try{r.componentDidUpdate(g,o,r.__reactInternalSnapshotBeforeUpdate)}catch(b){Ve(c,c.return,b)}}f&64&&Iy(c),f&512&&qa(c,c.return);break;case 3:if(ci(r,c),f&64&&(r=c.updateQueue,r!==null)){if(o=null,c.child!==null)switch(c.child.tag){case 27:case 5:o=c.child.stateNode;break;case 1:o=c.child.stateNode}try{Tm(r,o)}catch(b){Ve(c,c.return,b)}}break;case 27:o===null&&f&4&&Dy(c);case 26:case 5:ci(r,c),o===null&&f&4&&ky(c),f&512&&qa(c,c.return);break;case 12:ci(r,c);break;case 31:ci(r,c),f&4&&zy(r,c);break;case 13:ci(r,c),f&4&&Vy(r,c),f&64&&(r=c.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(c=eS.bind(null,c),vS(r,c))));break;case 22:if(f=c.memoizedState!==null||oi,!f){o=o!==null&&o.memoizedState!==null||ht,g=oi;var _=ht;oi=f,(ht=o)&&!_?ui(r,c,(c.subtreeFlags&8772)!==0):ci(r,c),oi=g,ht=_}break;case 30:break;default:ci(r,c)}}function Fy(r){var o=r.alternate;o!==null&&(r.alternate=null,Fy(o)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(o=r.stateNode,o!==null&&nf(o)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var tt=null,Lt=!1;function li(r,o,c){for(c=c.child;c!==null;)Ly(r,o,c),c=c.sibling}function Ly(r,o,c){if(Yt&&typeof Yt.onCommitFiberUnmount=="function")try{Yt.onCommitFiberUnmount(ya,c)}catch{}switch(c.tag){case 26:ht||Un(c,o),li(r,o,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:ht||Un(c,o);var f=tt,g=Lt;Vi(c.type)&&(tt=c.stateNode,Lt=!1),li(r,o,c),io(c.stateNode),tt=f,Lt=g;break;case 5:ht||Un(c,o);case 6:if(f=tt,g=Lt,tt=null,li(r,o,c),tt=f,Lt=g,tt!==null)if(Lt)try{(tt.nodeType===9?tt.body:tt.nodeName==="HTML"?tt.ownerDocument.body:tt).removeChild(c.stateNode)}catch(_){Ve(c,o,_)}else try{tt.removeChild(c.stateNode)}catch(_){Ve(c,o,_)}break;case 18:tt!==null&&(Lt?(r=tt,Ib(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,c.stateNode),Br(r)):Ib(tt,c.stateNode));break;case 4:f=tt,g=Lt,tt=c.stateNode.containerInfo,Lt=!0,li(r,o,c),tt=f,Lt=g;break;case 0:case 11:case 14:case 15:Pi(2,c,o),ht||Pi(4,c,o),li(r,o,c);break;case 1:ht||(Un(c,o),f=c.stateNode,typeof f.componentWillUnmount=="function"&&Ny(c,o,f)),li(r,o,c);break;case 21:li(r,o,c);break;case 22:ht=(f=ht)||c.memoizedState!==null,li(r,o,c),ht=f;break;default:li(r,o,c)}}function zy(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Br(r)}catch(c){Ve(o,o.return,c)}}}function Vy(r,o){if(o.memoizedState===null&&(r=o.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Br(r)}catch(c){Ve(o,o.return,c)}}function Xw(r){switch(r.tag){case 31:case 13:case 19:var o=r.stateNode;return o===null&&(o=r.stateNode=new By),o;case 22:return r=r.stateNode,o=r._retryCache,o===null&&(o=r._retryCache=new By),o;default:throw Error(i(435,r.tag))}}function Xl(r,o){var c=Xw(r);o.forEach(function(f){if(!c.has(f)){c.add(f);var g=tS.bind(null,r,f);f.then(g,g)}})}function zt(r,o){var c=o.deletions;if(c!==null)for(var f=0;f<c.length;f++){var g=c[f],_=r,b=o,T=b;e:for(;T!==null;){switch(T.tag){case 27:if(Vi(T.type)){tt=T.stateNode,Lt=!1;break e}break;case 5:tt=T.stateNode,Lt=!1;break e;case 3:case 4:tt=T.stateNode.containerInfo,Lt=!0;break e}T=T.return}if(tt===null)throw Error(i(160));Ly(_,b,g),tt=null,Lt=!1,_=g.alternate,_!==null&&(_.return=null),g.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)Hy(o,r),o=o.sibling}var An=null;function Hy(r,o){var c=r.alternate,f=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:zt(o,r),Vt(r),f&4&&(Pi(3,r,r.return),Ya(3,r),Pi(5,r,r.return));break;case 1:zt(o,r),Vt(r),f&512&&(ht||c===null||Un(c,c.return)),f&64&&oi&&(r=r.updateQueue,r!==null&&(f=r.callbacks,f!==null&&(c=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=c===null?f:c.concat(f))));break;case 26:var g=An;if(zt(o,r),Vt(r),f&512&&(ht||c===null||Un(c,c.return)),f&4){var _=c!==null?c.memoizedState:null;if(f=r.memoizedState,c===null)if(f===null)if(r.stateNode===null){e:{f=r.type,c=r.memoizedProps,g=g.ownerDocument||g;t:switch(f){case"title":_=g.getElementsByTagName("title")[0],(!_||_[Ta]||_[wt]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=g.createElement(f),g.head.insertBefore(_,g.querySelector("head > title"))),Rt(_,f,c),_[wt]=r,vt(_),f=_;break e;case"link":var b=Hb("link","href",g).get(f+(c.href||""));if(b){for(var T=0;T<b.length;T++)if(_=b[T],_.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&_.getAttribute("rel")===(c.rel==null?null:c.rel)&&_.getAttribute("title")===(c.title==null?null:c.title)&&_.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){b.splice(T,1);break t}}_=g.createElement(f),Rt(_,f,c),g.head.appendChild(_);break;case"meta":if(b=Hb("meta","content",g).get(f+(c.content||""))){for(T=0;T<b.length;T++)if(_=b[T],_.getAttribute("content")===(c.content==null?null:""+c.content)&&_.getAttribute("name")===(c.name==null?null:c.name)&&_.getAttribute("property")===(c.property==null?null:c.property)&&_.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&_.getAttribute("charset")===(c.charSet==null?null:c.charSet)){b.splice(T,1);break t}}_=g.createElement(f),Rt(_,f,c),g.head.appendChild(_);break;default:throw Error(i(468,f))}_[wt]=r,vt(_),f=_}r.stateNode=f}else jb(g,r.type,r.stateNode);else r.stateNode=Vb(g,f,r.memoizedProps);else _!==f?(_===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):_.count--,f===null?jb(g,r.type,r.stateNode):Vb(g,f,r.memoizedProps)):f===null&&r.stateNode!==null&&Sh(r,r.memoizedProps,c.memoizedProps)}break;case 27:zt(o,r),Vt(r),f&512&&(ht||c===null||Un(c,c.return)),c!==null&&f&4&&Sh(r,r.memoizedProps,c.memoizedProps);break;case 5:if(zt(o,r),Vt(r),f&512&&(ht||c===null||Un(c,c.return)),r.flags&32){g=r.stateNode;try{rr(g,"")}catch(le){Ve(r,r.return,le)}}f&4&&r.stateNode!=null&&(g=r.memoizedProps,Sh(r,g,c!==null?c.memoizedProps:g)),f&1024&&(Rh=!0);break;case 6:if(zt(o,r),Vt(r),f&4){if(r.stateNode===null)throw Error(i(162));f=r.memoizedProps,c=r.stateNode;try{c.nodeValue=f}catch(le){Ve(r,r.return,le)}}break;case 3:if(lc=null,g=An,An=ac(o.containerInfo),zt(o,r),An=g,Vt(r),f&4&&c!==null&&c.memoizedState.isDehydrated)try{Br(o.containerInfo)}catch(le){Ve(r,r.return,le)}Rh&&(Rh=!1,jy(r));break;case 4:f=An,An=ac(r.stateNode.containerInfo),zt(o,r),Vt(r),An=f;break;case 12:zt(o,r),Vt(r);break;case 31:zt(o,r),Vt(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,Xl(r,f)));break;case 13:zt(o,r),Vt(r),r.child.flags&8192&&r.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(ql=Xt()),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,Xl(r,f)));break;case 22:g=r.memoizedState!==null;var R=c!==null&&c.memoizedState!==null,H=oi,Y=ht;if(oi=H||g,ht=Y||R,zt(o,r),ht=Y,oi=H,Vt(r),f&8192)e:for(o=r.stateNode,o._visibility=g?o._visibility&-2:o._visibility|1,g&&(c===null||R||oi||ht||ws(r)),c=null,o=r;;){if(o.tag===5||o.tag===26){if(c===null){R=c=o;try{if(_=R.stateNode,g)b=_.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{T=R.stateNode;var Q=R.memoizedProps.style,j=Q!=null&&Q.hasOwnProperty("display")?Q.display:null;T.style.display=j==null||typeof j=="boolean"?"":(""+j).trim()}}catch(le){Ve(R,R.return,le)}}}else if(o.tag===6){if(c===null){R=o;try{R.stateNode.nodeValue=g?"":R.memoizedProps}catch(le){Ve(R,R.return,le)}}}else if(o.tag===18){if(c===null){R=o;try{var $=R.stateNode;g?Nb($,!0):Nb(R.stateNode,!1)}catch(le){Ve(R,R.return,le)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===r)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;c===o&&(c=null),o=o.return}c===o&&(c=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=r.updateQueue,f!==null&&(c=f.retryQueue,c!==null&&(f.retryQueue=null,Xl(r,c))));break;case 19:zt(o,r),Vt(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,Xl(r,f)));break;case 30:break;case 21:break;default:zt(o,r),Vt(r)}}function Vt(r){var o=r.flags;if(o&2){try{for(var c,f=r.return;f!==null;){if(Py(f)){c=f;break}f=f.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var g=c.stateNode,_=Ah(r);Wl(r,_,g);break;case 5:var b=c.stateNode;c.flags&32&&(rr(b,""),c.flags&=-33);var T=Ah(r);Wl(r,T,b);break;case 3:case 4:var R=c.stateNode.containerInfo,H=Ah(r);Eh(r,H,R);break;default:throw Error(i(161))}}catch(Y){Ve(r,r.return,Y)}r.flags&=-3}o&4096&&(r.flags&=-4097)}function jy(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var o=r;jy(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),r=r.sibling}}function ci(r,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)Uy(r,o.alternate,o),o=o.sibling}function ws(r){for(r=r.child;r!==null;){var o=r;switch(o.tag){case 0:case 11:case 14:case 15:Pi(4,o,o.return),ws(o);break;case 1:Un(o,o.return);var c=o.stateNode;typeof c.componentWillUnmount=="function"&&Ny(o,o.return,c),ws(o);break;case 27:io(o.stateNode);case 26:case 5:Un(o,o.return),ws(o);break;case 22:o.memoizedState===null&&ws(o);break;case 30:ws(o);break;default:ws(o)}r=r.sibling}}function ui(r,o,c){for(c=c&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,g=r,_=o,b=_.flags;switch(_.tag){case 0:case 11:case 15:ui(g,_,c),Ya(4,_);break;case 1:if(ui(g,_,c),f=_,g=f.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(H){Ve(f,f.return,H)}if(f=_,g=f.updateQueue,g!==null){var T=f.stateNode;try{var R=g.shared.hiddenCallbacks;if(R!==null)for(g.shared.hiddenCallbacks=null,g=0;g<R.length;g++)vm(R[g],T)}catch(H){Ve(f,f.return,H)}}c&&b&64&&Iy(_),qa(_,_.return);break;case 27:Dy(_);case 26:case 5:ui(g,_,c),c&&f===null&&b&4&&ky(_),qa(_,_.return);break;case 12:ui(g,_,c);break;case 31:ui(g,_,c),c&&b&4&&zy(g,_);break;case 13:ui(g,_,c),c&&b&4&&Vy(g,_);break;case 22:_.memoizedState===null&&ui(g,_,c),qa(_,_.return);break;case 30:break;default:ui(g,_,c)}o=o.sibling}}function Ch(r,o){var c=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(c=r.memoizedState.cachePool.pool),r=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(r=o.memoizedState.cachePool.pool),r!==c&&(r!=null&&r.refCount++,c!=null&&Pa(c))}function Mh(r,o){r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Pa(r))}function En(r,o,c,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)$y(r,o,c,f),o=o.sibling}function $y(r,o,c,f){var g=o.flags;switch(o.tag){case 0:case 11:case 15:En(r,o,c,f),g&2048&&Ya(9,o);break;case 1:En(r,o,c,f);break;case 3:En(r,o,c,f),g&2048&&(r=null,o.alternate!==null&&(r=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==r&&(o.refCount++,r!=null&&Pa(r)));break;case 12:if(g&2048){En(r,o,c,f),r=o.stateNode;try{var _=o.memoizedProps,b=_.id,T=_.onPostCommit;typeof T=="function"&&T(b,o.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(R){Ve(o,o.return,R)}}else En(r,o,c,f);break;case 31:En(r,o,c,f);break;case 13:En(r,o,c,f);break;case 23:break;case 22:_=o.stateNode,b=o.alternate,o.memoizedState!==null?_._visibility&2?En(r,o,c,f):Za(r,o):_._visibility&2?En(r,o,c,f):(_._visibility|=2,Ar(r,o,c,f,(o.subtreeFlags&10256)!==0||!1)),g&2048&&Ch(b,o);break;case 24:En(r,o,c,f),g&2048&&Mh(o.alternate,o);break;default:En(r,o,c,f)}}function Ar(r,o,c,f,g){for(g=g&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var _=r,b=o,T=c,R=f,H=b.flags;switch(b.tag){case 0:case 11:case 15:Ar(_,b,T,R,g),Ya(8,b);break;case 23:break;case 22:var Y=b.stateNode;b.memoizedState!==null?Y._visibility&2?Ar(_,b,T,R,g):Za(_,b):(Y._visibility|=2,Ar(_,b,T,R,g)),g&&H&2048&&Ch(b.alternate,b);break;case 24:Ar(_,b,T,R,g),g&&H&2048&&Mh(b.alternate,b);break;default:Ar(_,b,T,R,g)}o=o.sibling}}function Za(r,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var c=r,f=o,g=f.flags;switch(f.tag){case 22:Za(c,f),g&2048&&Ch(f.alternate,f);break;case 24:Za(c,f),g&2048&&Mh(f.alternate,f);break;default:Za(c,f)}o=o.sibling}}var Ka=8192;function Er(r,o,c){if(r.subtreeFlags&Ka)for(r=r.child;r!==null;)Wy(r,o,c),r=r.sibling}function Wy(r,o,c){switch(r.tag){case 26:Er(r,o,c),r.flags&Ka&&r.memoizedState!==null&&NS(c,An,r.memoizedState,r.memoizedProps);break;case 5:Er(r,o,c);break;case 3:case 4:var f=An;An=ac(r.stateNode.containerInfo),Er(r,o,c),An=f;break;case 22:r.memoizedState===null&&(f=r.alternate,f!==null&&f.memoizedState!==null?(f=Ka,Ka=16777216,Er(r,o,c),Ka=f):Er(r,o,c));break;default:Er(r,o,c)}}function Xy(r){var o=r.alternate;if(o!==null&&(r=o.child,r!==null)){o.child=null;do o=r.sibling,r.sibling=null,r=o;while(r!==null)}}function Qa(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var f=o[c];Tt=f,qy(f,r)}Xy(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Yy(r),r=r.sibling}function Yy(r){switch(r.tag){case 0:case 11:case 15:Qa(r),r.flags&2048&&Pi(9,r,r.return);break;case 3:Qa(r);break;case 12:Qa(r);break;case 22:var o=r.stateNode;r.memoizedState!==null&&o._visibility&2&&(r.return===null||r.return.tag!==13)?(o._visibility&=-3,Yl(r)):Qa(r);break;default:Qa(r)}}function Yl(r){var o=r.deletions;if((r.flags&16)!==0){if(o!==null)for(var c=0;c<o.length;c++){var f=o[c];Tt=f,qy(f,r)}Xy(r)}for(r=r.child;r!==null;){switch(o=r,o.tag){case 0:case 11:case 15:Pi(8,o,o.return),Yl(o);break;case 22:c=o.stateNode,c._visibility&2&&(c._visibility&=-3,Yl(o));break;default:Yl(o)}r=r.sibling}}function qy(r,o){for(;Tt!==null;){var c=Tt;switch(c.tag){case 0:case 11:case 15:Pi(8,c,o);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var f=c.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Pa(c.memoizedState.cache)}if(f=c.child,f!==null)f.return=c,Tt=f;else e:for(c=r;Tt!==null;){f=Tt;var g=f.sibling,_=f.return;if(Fy(f),f===c){Tt=null;break e}if(g!==null){g.return=_,Tt=g;break e}Tt=_}}}var Yw={getCacheForType:function(r){var o=At(ct),c=o.data.get(r);return c===void 0&&(c=r(),o.data.set(r,c)),c},cacheSignal:function(){return At(ct).controller.signal}},qw=typeof WeakMap=="function"?WeakMap:Map,De=0,Ze=null,Re=null,Me=0,ze=0,Jt=null,Di=!1,Rr=!1,Oh=!1,fi=0,st=0,Bi=0,Ss=0,Ih=0,en=0,Cr=0,Ga=null,Ht=null,Nh=!1,ql=0,Zy=0,Zl=1/0,Kl=null,Ui=null,_t=0,Fi=null,Mr=null,hi=0,kh=0,Ph=null,Ky=null,Ja=0,Dh=null;function tn(){return(De&2)!==0&&Me!==0?Me&-Me:W.T!==null?Vh():h_()}function Qy(){if(en===0)if((Me&536870912)===0||Ie){var r=sl;sl<<=1,(sl&3932160)===0&&(sl=262144),en=r}else en=536870912;return r=Qt.current,r!==null&&(r.flags|=32),en}function jt(r,o,c){(r===Ze&&(ze===2||ze===9)||r.cancelPendingCommit!==null)&&(Or(r,0),Li(r,Me,en,!1)),va(r,c),((De&2)===0||r!==Ze)&&(r===Ze&&((De&2)===0&&(Ss|=c),st===4&&Li(r,Me,en,!1)),Fn(r))}function Gy(r,o,c){if((De&6)!==0)throw Error(i(327));var f=!c&&(o&127)===0&&(o&r.expiredLanes)===0||ba(r,o),g=f?Qw(r,o):Uh(r,o,!0),_=f;do{if(g===0){Rr&&!f&&Li(r,o,0,!1);break}else{if(c=r.current.alternate,_&&!Zw(c)){g=Uh(r,o,!1),_=!1;continue}if(g===2){if(_=o,r.errorRecoveryDisabledLanes&_)var b=0;else b=r.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){o=b;e:{var T=r;g=Ga;var R=T.current.memoizedState.isDehydrated;if(R&&(Or(T,b).flags|=256),b=Uh(T,b,!1),b!==2){if(Oh&&!R){T.errorRecoveryDisabledLanes|=_,Ss|=_,g=4;break e}_=Ht,Ht=g,_!==null&&(Ht===null?Ht=_:Ht.push.apply(Ht,_))}g=b}if(_=!1,g!==2)continue}}if(g===1){Or(r,0),Li(r,o,0,!0);break}e:{switch(f=r,_=g,_){case 0:case 1:throw Error(i(345));case 4:if((o&4194048)!==o)break;case 6:Li(f,o,en,!Di);break e;case 2:Ht=null;break;case 3:case 5:break;default:throw Error(i(329))}if((o&62914560)===o&&(g=ql+300-Xt(),10<g)){if(Li(f,o,en,!Di),al(f,0,!0)!==0)break e;hi=o,f.timeoutHandle=Mb(Jy.bind(null,f,c,Ht,Kl,Nh,o,en,Ss,Cr,Di,_,"Throttled",-0,0),g);break e}Jy(f,c,Ht,Kl,Nh,o,en,Ss,Cr,Di,_,null,-0,0)}}break}while(!0);Fn(r)}function Jy(r,o,c,f,g,_,b,T,R,H,Y,Q,j,$){if(r.timeoutHandle=-1,Q=o.subtreeFlags,Q&8192||(Q&16785408)===16785408){Q={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Qn},Wy(o,_,Q);var le=(_&62914560)===_?ql-Xt():(_&4194048)===_?Zy-Xt():0;if(le=kS(Q,le),le!==null){hi=_,r.cancelPendingCommit=le(ob.bind(null,r,o,_,c,f,g,b,T,R,Y,Q,null,j,$)),Li(r,_,b,!H);return}}ob(r,o,_,c,f,g,b,T,R)}function Zw(r){for(var o=r;;){var c=o.tag;if((c===0||c===11||c===15)&&o.flags&16384&&(c=o.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var f=0;f<c.length;f++){var g=c[f],_=g.getSnapshot;g=g.value;try{if(!Zt(_(),g))return!1}catch{return!1}}if(c=o.child,o.subtreeFlags&16384&&c!==null)c.return=o,o=c;else{if(o===r)break;for(;o.sibling===null;){if(o.return===null||o.return===r)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function Li(r,o,c,f){o&=~Ih,o&=~Ss,r.suspendedLanes|=o,r.pingedLanes&=~o,f&&(r.warmLanes|=o),f=r.expirationTimes;for(var g=o;0<g;){var _=31-qt(g),b=1<<_;f[_]=-1,g&=~b}c!==0&&c_(r,c,o)}function Ql(){return(De&6)===0?(eo(0),!1):!0}function Bh(){if(Re!==null){if(ze===0)var r=Re.return;else r=Re,ti=gs=null,Gf(r),vr=null,Ba=0,r=Re;for(;r!==null;)Oy(r.alternate,r),r=r.return;Re=null}}function Or(r,o){var c=r.timeoutHandle;c!==-1&&(r.timeoutHandle=-1,gS(c)),c=r.cancelPendingCommit,c!==null&&(r.cancelPendingCommit=null,c()),hi=0,Bh(),Ze=r,Re=c=Jn(r.current,null),Me=o,ze=0,Jt=null,Di=!1,Rr=ba(r,o),Oh=!1,Cr=en=Ih=Ss=Bi=st=0,Ht=Ga=null,Nh=!1,(o&8)!==0&&(o|=o&32);var f=r.entangledLanes;if(f!==0)for(r=r.entanglements,f&=o;0<f;){var g=31-qt(f),_=1<<g;o|=r[g],f&=~_}return fi=o,yl(),c}function eb(r,o){Se=null,W.H=$a,o===br||o===El?(o=_m(),ze=3):o===zf?(o=_m(),ze=4):ze=o===ph?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,Jt=o,Re===null&&(st=1,zl(r,hn(o,r.current)))}function tb(){var r=Qt.current;return r===null?!0:(Me&4194048)===Me?_n===null:(Me&62914560)===Me||(Me&536870912)!==0?r===_n:!1}function nb(){var r=W.H;return W.H=$a,r===null?$a:r}function ib(){var r=W.A;return W.A=Yw,r}function Gl(){st=4,Di||(Me&4194048)!==Me&&Qt.current!==null||(Rr=!0),(Bi&134217727)===0&&(Ss&134217727)===0||Ze===null||Li(Ze,Me,en,!1)}function Uh(r,o,c){var f=De;De|=2;var g=nb(),_=ib();(Ze!==r||Me!==o)&&(Kl=null,Or(r,o)),o=!1;var b=st;e:do try{if(ze!==0&&Re!==null){var T=Re,R=Jt;switch(ze){case 8:Bh(),b=6;break e;case 3:case 2:case 9:case 6:Qt.current===null&&(o=!0);var H=ze;if(ze=0,Jt=null,Ir(r,T,R,H),c&&Rr){b=0;break e}break;default:H=ze,ze=0,Jt=null,Ir(r,T,R,H)}}Kw(),b=st;break}catch(Y){eb(r,Y)}while(!0);return o&&r.shellSuspendCounter++,ti=gs=null,De=f,W.H=g,W.A=_,Re===null&&(Ze=null,Me=0,yl()),b}function Kw(){for(;Re!==null;)sb(Re)}function Qw(r,o){var c=De;De|=2;var f=nb(),g=ib();Ze!==r||Me!==o?(Kl=null,Zl=Xt()+500,Or(r,o)):Rr=ba(r,o);e:do try{if(ze!==0&&Re!==null){o=Re;var _=Jt;t:switch(ze){case 1:ze=0,Jt=null,Ir(r,o,_,1);break;case 2:case 9:if(pm(_)){ze=0,Jt=null,rb(o);break}o=function(){ze!==2&&ze!==9||Ze!==r||(ze=7),Fn(r)},_.then(o,o);break e;case 3:ze=7;break e;case 4:ze=5;break e;case 7:pm(_)?(ze=0,Jt=null,rb(o)):(ze=0,Jt=null,Ir(r,o,_,7));break;case 5:var b=null;switch(Re.tag){case 26:b=Re.memoizedState;case 5:case 27:var T=Re;if(b?$b(b):T.stateNode.complete){ze=0,Jt=null;var R=T.sibling;if(R!==null)Re=R;else{var H=T.return;H!==null?(Re=H,Jl(H)):Re=null}break t}}ze=0,Jt=null,Ir(r,o,_,5);break;case 6:ze=0,Jt=null,Ir(r,o,_,6);break;case 8:Bh(),st=6;break e;default:throw Error(i(462))}}Gw();break}catch(Y){eb(r,Y)}while(!0);return ti=gs=null,W.H=f,W.A=g,De=c,Re!==null?0:(Ze=null,Me=0,yl(),st)}function Gw(){for(;Re!==null&&!Tx();)sb(Re)}function sb(r){var o=Cy(r.alternate,r,fi);r.memoizedProps=r.pendingProps,o===null?Jl(r):Re=o}function rb(r){var o=r,c=o.alternate;switch(o.tag){case 15:case 0:o=xy(c,o,o.pendingProps,o.type,void 0,Me);break;case 11:o=xy(c,o,o.pendingProps,o.type.render,o.ref,Me);break;case 5:Gf(o);default:Oy(c,o),o=Re=im(o,fi),o=Cy(c,o,fi)}r.memoizedProps=r.pendingProps,o===null?Jl(r):Re=o}function Ir(r,o,c,f){ti=gs=null,Gf(o),vr=null,Ba=0;var g=o.return;try{if(zw(r,g,o,c,Me)){st=1,zl(r,hn(c,r.current)),Re=null;return}}catch(_){if(g!==null)throw Re=g,_;st=1,zl(r,hn(c,r.current)),Re=null;return}o.flags&32768?(Ie||f===1?r=!0:Rr||(Me&536870912)!==0?r=!1:(Di=r=!0,(f===2||f===9||f===3||f===6)&&(f=Qt.current,f!==null&&f.tag===13&&(f.flags|=16384))),ab(o,r)):Jl(o)}function Jl(r){var o=r;do{if((o.flags&32768)!==0){ab(o,Di);return}r=o.return;var c=jw(o.alternate,o,fi);if(c!==null){Re=c;return}if(o=o.sibling,o!==null){Re=o;return}Re=o=r}while(o!==null);st===0&&(st=5)}function ab(r,o){do{var c=$w(r.alternate,r);if(c!==null){c.flags&=32767,Re=c;return}if(c=r.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!o&&(r=r.sibling,r!==null)){Re=r;return}Re=r=c}while(r!==null);st=6,Re=null}function ob(r,o,c,f,g,_,b,T,R){r.cancelPendingCommit=null;do ec();while(_t!==0);if((De&6)!==0)throw Error(i(327));if(o!==null){if(o===r.current)throw Error(i(177));if(_=o.lanes|o.childLanes,_|=Af,Ix(r,c,_,b,T,R),r===Ze&&(Re=Ze=null,Me=0),Mr=o,Fi=r,hi=c,kh=_,Ph=g,Ky=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,nS(nl,function(){return hb(),null})):(r.callbackNode=null,r.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=W.T,W.T=null,g=se.p,se.p=2,b=De,De|=4;try{Ww(r,o,c)}finally{De=b,se.p=g,W.T=f}}_t=1,lb(),cb(),ub()}}function lb(){if(_t===1){_t=0;var r=Fi,o=Mr,c=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||c){c=W.T,W.T=null;var f=se.p;se.p=2;var g=De;De|=4;try{Hy(o,r);var _=Zh,b=q_(r.containerInfo),T=_.focusedElem,R=_.selectionRange;if(b!==T&&T&&T.ownerDocument&&Y_(T.ownerDocument.documentElement,T)){if(R!==null&&vf(T)){var H=R.start,Y=R.end;if(Y===void 0&&(Y=H),"selectionStart"in T)T.selectionStart=H,T.selectionEnd=Math.min(Y,T.value.length);else{var Q=T.ownerDocument||document,j=Q&&Q.defaultView||window;if(j.getSelection){var $=j.getSelection(),le=T.textContent.length,_e=Math.min(R.start,le),We=R.end===void 0?_e:Math.min(R.end,le);!$.extend&&_e>We&&(b=We,We=_e,_e=b);var U=X_(T,_e),O=X_(T,We);if(U&&O&&($.rangeCount!==1||$.anchorNode!==U.node||$.anchorOffset!==U.offset||$.focusNode!==O.node||$.focusOffset!==O.offset)){var V=Q.createRange();V.setStart(U.node,U.offset),$.removeAllRanges(),_e>We?($.addRange(V),$.extend(O.node,O.offset)):(V.setEnd(O.node,O.offset),$.addRange(V))}}}}for(Q=[],$=T;$=$.parentNode;)$.nodeType===1&&Q.push({element:$,left:$.scrollLeft,top:$.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<Q.length;T++){var q=Q[T];q.element.scrollLeft=q.left,q.element.scrollTop=q.top}}hc=!!qh,Zh=qh=null}finally{De=g,se.p=f,W.T=c}}r.current=o,_t=2}}function cb(){if(_t===2){_t=0;var r=Fi,o=Mr,c=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||c){c=W.T,W.T=null;var f=se.p;se.p=2;var g=De;De|=4;try{Uy(r,o.alternate,o)}finally{De=g,se.p=f,W.T=c}}_t=3}}function ub(){if(_t===4||_t===3){_t=0,xx();var r=Fi,o=Mr,c=hi,f=Ky;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?_t=5:(_t=0,Mr=Fi=null,fb(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(Ui=null),ef(c),o=o.stateNode,Yt&&typeof Yt.onCommitFiberRoot=="function")try{Yt.onCommitFiberRoot(ya,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=W.T,g=se.p,se.p=2,W.T=null;try{for(var _=r.onRecoverableError,b=0;b<f.length;b++){var T=f[b];_(T.value,{componentStack:T.stack})}}finally{W.T=o,se.p=g}}(hi&3)!==0&&ec(),Fn(r),g=r.pendingLanes,(c&261930)!==0&&(g&42)!==0?r===Dh?Ja++:(Ja=0,Dh=r):Ja=0,eo(0)}}function fb(r,o){(r.pooledCacheLanes&=o)===0&&(o=r.pooledCache,o!=null&&(r.pooledCache=null,Pa(o)))}function ec(){return lb(),cb(),ub(),hb()}function hb(){if(_t!==5)return!1;var r=Fi,o=kh;kh=0;var c=ef(hi),f=W.T,g=se.p;try{se.p=32>c?32:c,W.T=null,c=Ph,Ph=null;var _=Fi,b=hi;if(_t=0,Mr=Fi=null,hi=0,(De&6)!==0)throw Error(i(331));var T=De;if(De|=4,Yy(_.current),$y(_,_.current,b,c),De=T,eo(0,!1),Yt&&typeof Yt.onPostCommitFiberRoot=="function")try{Yt.onPostCommitFiberRoot(ya,_)}catch{}return!0}finally{se.p=g,W.T=f,fb(r,o)}}function db(r,o,c){o=hn(c,o),o=dh(r.stateNode,o,2),r=Ii(r,o,2),r!==null&&(va(r,2),Fn(r))}function Ve(r,o,c){if(r.tag===3)db(r,r,c);else for(;o!==null;){if(o.tag===3){db(o,r,c);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ui===null||!Ui.has(f))){r=hn(c,r),c=py(2),f=Ii(o,c,2),f!==null&&(gy(c,f,o,r),va(f,2),Fn(f));break}}o=o.return}}function Fh(r,o,c){var f=r.pingCache;if(f===null){f=r.pingCache=new qw;var g=new Set;f.set(o,g)}else g=f.get(o),g===void 0&&(g=new Set,f.set(o,g));g.has(c)||(Oh=!0,g.add(c),r=Jw.bind(null,r,o,c),o.then(r,r))}function Jw(r,o,c){var f=r.pingCache;f!==null&&f.delete(o),r.pingedLanes|=r.suspendedLanes&c,r.warmLanes&=~c,Ze===r&&(Me&c)===c&&(st===4||st===3&&(Me&62914560)===Me&&300>Xt()-ql?(De&2)===0&&Or(r,0):Ih|=c,Cr===Me&&(Cr=0)),Fn(r)}function pb(r,o){o===0&&(o=l_()),r=hs(r,o),r!==null&&(va(r,o),Fn(r))}function eS(r){var o=r.memoizedState,c=0;o!==null&&(c=o.retryLane),pb(r,c)}function tS(r,o){var c=0;switch(r.tag){case 31:case 13:var f=r.stateNode,g=r.memoizedState;g!==null&&(c=g.retryLane);break;case 19:f=r.stateNode;break;case 22:f=r.stateNode._retryCache;break;default:throw Error(i(314))}f!==null&&f.delete(o),pb(r,c)}function nS(r,o){return Ku(r,o)}var tc=null,Nr=null,Lh=!1,nc=!1,zh=!1,zi=0;function Fn(r){r!==Nr&&r.next===null&&(Nr===null?tc=Nr=r:Nr=Nr.next=r),nc=!0,Lh||(Lh=!0,sS())}function eo(r,o){if(!zh&&nc){zh=!0;do for(var c=!1,f=tc;f!==null;){if(r!==0){var g=f.pendingLanes;if(g===0)var _=0;else{var b=f.suspendedLanes,T=f.pingedLanes;_=(1<<31-qt(42|r)+1)-1,_&=g&~(b&~T),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(c=!0,yb(f,_))}else _=Me,_=al(f,f===Ze?_:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(_&3)===0||ba(f,_)||(c=!0,yb(f,_));f=f.next}while(c);zh=!1}}function iS(){gb()}function gb(){nc=Lh=!1;var r=0;zi!==0&&pS()&&(r=zi);for(var o=Xt(),c=null,f=tc;f!==null;){var g=f.next,_=_b(f,o);_===0?(f.next=null,c===null?tc=g:c.next=g,g===null&&(Nr=c)):(c=f,(r!==0||(_&3)!==0)&&(nc=!0)),f=g}_t!==0&&_t!==5||eo(r),zi!==0&&(zi=0)}function _b(r,o){for(var c=r.suspendedLanes,f=r.pingedLanes,g=r.expirationTimes,_=r.pendingLanes&-62914561;0<_;){var b=31-qt(_),T=1<<b,R=g[b];R===-1?((T&c)===0||(T&f)!==0)&&(g[b]=Ox(T,o)):R<=o&&(r.expiredLanes|=T),_&=~T}if(o=Ze,c=Me,c=al(r,r===o?c:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f=r.callbackNode,c===0||r===o&&(ze===2||ze===9)||r.cancelPendingCommit!==null)return f!==null&&f!==null&&Qu(f),r.callbackNode=null,r.callbackPriority=0;if((c&3)===0||ba(r,c)){if(o=c&-c,o===r.callbackPriority)return o;switch(f!==null&&Qu(f),ef(c)){case 2:case 8:c=a_;break;case 32:c=nl;break;case 268435456:c=o_;break;default:c=nl}return f=mb.bind(null,r),c=Ku(c,f),r.callbackPriority=o,r.callbackNode=c,o}return f!==null&&f!==null&&Qu(f),r.callbackPriority=2,r.callbackNode=null,2}function mb(r,o){if(_t!==0&&_t!==5)return r.callbackNode=null,r.callbackPriority=0,null;var c=r.callbackNode;if(ec()&&r.callbackNode!==c)return null;var f=Me;return f=al(r,r===Ze?f:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f===0?null:(Gy(r,f,o),_b(r,Xt()),r.callbackNode!=null&&r.callbackNode===c?mb.bind(null,r):null)}function yb(r,o){if(ec())return null;Gy(r,o,!0)}function sS(){_S(function(){(De&6)!==0?Ku(r_,iS):gb()})}function Vh(){if(zi===0){var r=mr;r===0&&(r=il,il<<=1,(il&261888)===0&&(il=256)),zi=r}return zi}function bb(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:ul(""+r)}function vb(r,o){var c=o.ownerDocument.createElement("input");return c.name=o.name,c.value=o.value,r.id&&c.setAttribute("form",r.id),o.parentNode.insertBefore(c,o),r=new FormData(r),c.parentNode.removeChild(c),r}function rS(r,o,c,f,g){if(o==="submit"&&c&&c.stateNode===g){var _=bb((g[Ut]||null).action),b=f.submitter;b&&(o=(o=b[Ut]||null)?bb(o.formAction):b.getAttribute("formAction"),o!==null&&(_=o,b=null));var T=new pl("action","action",null,f,g);r.push({event:T,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(zi!==0){var R=b?vb(g,b):new FormData(g);oh(c,{pending:!0,data:R,method:g.method,action:_},null,R)}}else typeof _=="function"&&(T.preventDefault(),R=b?vb(g,b):new FormData(g),oh(c,{pending:!0,data:R,method:g.method,action:_},_,R))},currentTarget:g}]})}}for(var Hh=0;Hh<Sf.length;Hh++){var jh=Sf[Hh],aS=jh.toLowerCase(),oS=jh[0].toUpperCase()+jh.slice(1);Sn(aS,"on"+oS)}Sn(Q_,"onAnimationEnd"),Sn(G_,"onAnimationIteration"),Sn(J_,"onAnimationStart"),Sn("dblclick","onDoubleClick"),Sn("focusin","onFocus"),Sn("focusout","onBlur"),Sn(ww,"onTransitionRun"),Sn(Sw,"onTransitionStart"),Sn(Aw,"onTransitionCancel"),Sn(em,"onTransitionEnd"),ir("onMouseEnter",["mouseout","mouseover"]),ir("onMouseLeave",["mouseout","mouseover"]),ir("onPointerEnter",["pointerout","pointerover"]),ir("onPointerLeave",["pointerout","pointerover"]),ls("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ls("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ls("onBeforeInput",["compositionend","keypress","textInput","paste"]),ls("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ls("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ls("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var to="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(to));function Tb(r,o){o=(o&4)!==0;for(var c=0;c<r.length;c++){var f=r[c],g=f.event;f=f.listeners;e:{var _=void 0;if(o)for(var b=f.length-1;0<=b;b--){var T=f[b],R=T.instance,H=T.currentTarget;if(T=T.listener,R!==_&&g.isPropagationStopped())break e;_=T,g.currentTarget=H;try{_(g)}catch(Y){ml(Y)}g.currentTarget=null,_=R}else for(b=0;b<f.length;b++){if(T=f[b],R=T.instance,H=T.currentTarget,T=T.listener,R!==_&&g.isPropagationStopped())break e;_=T,g.currentTarget=H;try{_(g)}catch(Y){ml(Y)}g.currentTarget=null,_=R}}}}function Ce(r,o){var c=o[tf];c===void 0&&(c=o[tf]=new Set);var f=r+"__bubble";c.has(f)||(xb(o,r,2,!1),c.add(f))}function $h(r,o,c){var f=0;o&&(f|=4),xb(c,r,f,o)}var ic="_reactListening"+Math.random().toString(36).slice(2);function Wh(r){if(!r[ic]){r[ic]=!0,g_.forEach(function(c){c!=="selectionchange"&&(lS.has(c)||$h(c,!1,r),$h(c,!0,r))});var o=r.nodeType===9?r:r.ownerDocument;o===null||o[ic]||(o[ic]=!0,$h("selectionchange",!1,o))}}function xb(r,o,c,f){switch(Qb(o)){case 2:var g=BS;break;case 8:g=US;break;default:g=ad}c=g.bind(null,o,c,r),g=void 0,!ff||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(g=!0),f?g!==void 0?r.addEventListener(o,c,{capture:!0,passive:g}):r.addEventListener(o,c,!0):g!==void 0?r.addEventListener(o,c,{passive:g}):r.addEventListener(o,c,!1)}function Xh(r,o,c,f,g){var _=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var b=f.tag;if(b===3||b===4){var T=f.stateNode.containerInfo;if(T===g)break;if(b===4)for(b=f.return;b!==null;){var R=b.tag;if((R===3||R===4)&&b.stateNode.containerInfo===g)return;b=b.return}for(;T!==null;){if(b=er(T),b===null)return;if(R=b.tag,R===5||R===6||R===26||R===27){f=_=b;continue e}T=T.parentNode}}f=f.return}R_(function(){var H=_,Y=cf(c),Q=[];e:{var j=tm.get(r);if(j!==void 0){var $=pl,le=r;switch(r){case"keypress":if(hl(c)===0)break e;case"keydown":case"keyup":$=tw;break;case"focusin":le="focus",$=gf;break;case"focusout":le="blur",$=gf;break;case"beforeblur":case"afterblur":$=gf;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=O_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=jx;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=sw;break;case Q_:case G_:case J_:$=Xx;break;case em:$=aw;break;case"scroll":case"scrollend":$=Vx;break;case"wheel":$=lw;break;case"copy":case"cut":case"paste":$=qx;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=N_;break;case"toggle":case"beforetoggle":$=uw}var _e=(o&4)!==0,We=!_e&&(r==="scroll"||r==="scrollend"),U=_e?j!==null?j+"Capture":null:j;_e=[];for(var O=H,V;O!==null;){var q=O;if(V=q.stateNode,q=q.tag,q!==5&&q!==26&&q!==27||V===null||U===null||(q=wa(O,U),q!=null&&_e.push(no(O,q,V))),We)break;O=O.return}0<_e.length&&(j=new $(j,le,null,c,Y),Q.push({event:j,listeners:_e}))}}if((o&7)===0){e:{if(j=r==="mouseover"||r==="pointerover",$=r==="mouseout"||r==="pointerout",j&&c!==lf&&(le=c.relatedTarget||c.fromElement)&&(er(le)||le[Js]))break e;if(($||j)&&(j=Y.window===Y?Y:(j=Y.ownerDocument)?j.defaultView||j.parentWindow:window,$?(le=c.relatedTarget||c.toElement,$=H,le=le?er(le):null,le!==null&&(We=a(le),_e=le.tag,le!==We||_e!==5&&_e!==27&&_e!==6)&&(le=null)):($=null,le=H),$!==le)){if(_e=O_,q="onMouseLeave",U="onMouseEnter",O="mouse",(r==="pointerout"||r==="pointerover")&&(_e=N_,q="onPointerLeave",U="onPointerEnter",O="pointer"),We=$==null?j:xa($),V=le==null?j:xa(le),j=new _e(q,O+"leave",$,c,Y),j.target=We,j.relatedTarget=V,q=null,er(Y)===H&&(_e=new _e(U,O+"enter",le,c,Y),_e.target=V,_e.relatedTarget=We,q=_e),We=q,$&&le)t:{for(_e=cS,U=$,O=le,V=0,q=U;q;q=_e(q))V++;q=0;for(var pe=O;pe;pe=_e(pe))q++;for(;0<V-q;)U=_e(U),V--;for(;0<q-V;)O=_e(O),q--;for(;V--;){if(U===O||O!==null&&U===O.alternate){_e=U;break t}U=_e(U),O=_e(O)}_e=null}else _e=null;$!==null&&wb(Q,j,$,_e,!1),le!==null&&We!==null&&wb(Q,We,le,_e,!0)}}e:{if(j=H?xa(H):window,$=j.nodeName&&j.nodeName.toLowerCase(),$==="select"||$==="input"&&j.type==="file")var ke=z_;else if(F_(j))if(V_)ke=vw;else{ke=yw;var he=mw}else $=j.nodeName,!$||$.toLowerCase()!=="input"||j.type!=="checkbox"&&j.type!=="radio"?H&&of(H.elementType)&&(ke=z_):ke=bw;if(ke&&(ke=ke(r,H))){L_(Q,ke,c,Y);break e}he&&he(r,j,H),r==="focusout"&&H&&j.type==="number"&&H.memoizedProps.value!=null&&af(j,"number",j.value)}switch(he=H?xa(H):window,r){case"focusin":(F_(he)||he.contentEditable==="true")&&(cr=he,Tf=H,Ia=null);break;case"focusout":Ia=Tf=cr=null;break;case"mousedown":xf=!0;break;case"contextmenu":case"mouseup":case"dragend":xf=!1,Z_(Q,c,Y);break;case"selectionchange":if(xw)break;case"keydown":case"keyup":Z_(Q,c,Y)}var Ae;if(mf)e:{switch(r){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else lr?B_(r,c)&&(Oe="onCompositionEnd"):r==="keydown"&&c.keyCode===229&&(Oe="onCompositionStart");Oe&&(k_&&c.locale!=="ko"&&(lr||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&lr&&(Ae=C_()):(Si=Y,hf="value"in Si?Si.value:Si.textContent,lr=!0)),he=sc(H,Oe),0<he.length&&(Oe=new I_(Oe,r,null,c,Y),Q.push({event:Oe,listeners:he}),Ae?Oe.data=Ae:(Ae=U_(c),Ae!==null&&(Oe.data=Ae)))),(Ae=hw?dw(r,c):pw(r,c))&&(Oe=sc(H,"onBeforeInput"),0<Oe.length&&(he=new I_("onBeforeInput","beforeinput",null,c,Y),Q.push({event:he,listeners:Oe}),he.data=Ae)),rS(Q,r,H,c,Y)}Tb(Q,o)})}function no(r,o,c){return{instance:r,listener:o,currentTarget:c}}function sc(r,o){for(var c=o+"Capture",f=[];r!==null;){var g=r,_=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||_===null||(g=wa(r,c),g!=null&&f.unshift(no(r,g,_)),g=wa(r,o),g!=null&&f.push(no(r,g,_))),r.tag===3)return f;r=r.return}return[]}function cS(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function wb(r,o,c,f,g){for(var _=o._reactName,b=[];c!==null&&c!==f;){var T=c,R=T.alternate,H=T.stateNode;if(T=T.tag,R!==null&&R===f)break;T!==5&&T!==26&&T!==27||H===null||(R=H,g?(H=wa(c,_),H!=null&&b.unshift(no(c,H,R))):g||(H=wa(c,_),H!=null&&b.push(no(c,H,R)))),c=c.return}b.length!==0&&r.push({event:o,listeners:b})}var uS=/\r\n?/g,fS=/\u0000|\uFFFD/g;function Sb(r){return(typeof r=="string"?r:""+r).replace(uS,`
`).replace(fS,"")}function Ab(r,o){return o=Sb(o),Sb(r)===o}function $e(r,o,c,f,g,_){switch(c){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||rr(r,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&rr(r,""+f);break;case"className":ll(r,"class",f);break;case"tabIndex":ll(r,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":ll(r,c,f);break;case"style":A_(r,f,_);break;case"data":if(o!=="object"){ll(r,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||c!=="href")){r.removeAttribute(c);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(c);break}f=ul(""+f),r.setAttribute(c,f);break;case"action":case"formAction":if(typeof f=="function"){r.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(c==="formAction"?(o!=="input"&&$e(r,o,"name",g.name,g,null),$e(r,o,"formEncType",g.formEncType,g,null),$e(r,o,"formMethod",g.formMethod,g,null),$e(r,o,"formTarget",g.formTarget,g,null)):($e(r,o,"encType",g.encType,g,null),$e(r,o,"method",g.method,g,null),$e(r,o,"target",g.target,g,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(c);break}f=ul(""+f),r.setAttribute(c,f);break;case"onClick":f!=null&&(r.onclick=Qn);break;case"onScroll":f!=null&&Ce("scroll",r);break;case"onScrollEnd":f!=null&&Ce("scrollend",r);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"multiple":r.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":r.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){r.removeAttribute("xlink:href");break}c=ul(""+f),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,""+f):r.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,""):r.removeAttribute(c);break;case"capture":case"download":f===!0?r.setAttribute(c,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(c,f):r.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?r.setAttribute(c,f):r.removeAttribute(c);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?r.removeAttribute(c):r.setAttribute(c,f);break;case"popover":Ce("beforetoggle",r),Ce("toggle",r),ol(r,"popover",f);break;case"xlinkActuate":Kn(r,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Kn(r,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Kn(r,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Kn(r,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Kn(r,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Kn(r,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Kn(r,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Kn(r,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Kn(r,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":ol(r,"is",f);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=Lx.get(c)||c,ol(r,c,f))}}function Yh(r,o,c,f,g,_){switch(c){case"style":A_(r,f,_);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(c=f.__html,c!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=c}}break;case"children":typeof f=="string"?rr(r,f):(typeof f=="number"||typeof f=="bigint")&&rr(r,""+f);break;case"onScroll":f!=null&&Ce("scroll",r);break;case"onScrollEnd":f!=null&&Ce("scrollend",r);break;case"onClick":f!=null&&(r.onclick=Qn);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!__.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(g=c.endsWith("Capture"),o=c.slice(2,g?c.length-7:void 0),_=r[Ut]||null,_=_!=null?_[c]:null,typeof _=="function"&&r.removeEventListener(o,_,g),typeof f=="function")){typeof _!="function"&&_!==null&&(c in r?r[c]=null:r.hasAttribute(c)&&r.removeAttribute(c)),r.addEventListener(o,f,g);break e}c in r?r[c]=f:f===!0?r.setAttribute(c,""):ol(r,c,f)}}}function Rt(r,o,c){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ce("error",r),Ce("load",r);var f=!1,g=!1,_;for(_ in c)if(c.hasOwnProperty(_)){var b=c[_];if(b!=null)switch(_){case"src":f=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:$e(r,o,_,b,c,null)}}g&&$e(r,o,"srcSet",c.srcSet,c,null),f&&$e(r,o,"src",c.src,c,null);return;case"input":Ce("invalid",r);var T=_=b=g=null,R=null,H=null;for(f in c)if(c.hasOwnProperty(f)){var Y=c[f];if(Y!=null)switch(f){case"name":g=Y;break;case"type":b=Y;break;case"checked":R=Y;break;case"defaultChecked":H=Y;break;case"value":_=Y;break;case"defaultValue":T=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(i(137,o));break;default:$e(r,o,f,Y,c,null)}}T_(r,_,T,R,H,b,g,!1);return;case"select":Ce("invalid",r),f=b=_=null;for(g in c)if(c.hasOwnProperty(g)&&(T=c[g],T!=null))switch(g){case"value":_=T;break;case"defaultValue":b=T;break;case"multiple":f=T;default:$e(r,o,g,T,c,null)}o=_,c=b,r.multiple=!!f,o!=null?sr(r,!!f,o,!1):c!=null&&sr(r,!!f,c,!0);return;case"textarea":Ce("invalid",r),_=g=f=null;for(b in c)if(c.hasOwnProperty(b)&&(T=c[b],T!=null))switch(b){case"value":f=T;break;case"defaultValue":g=T;break;case"children":_=T;break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(i(91));break;default:$e(r,o,b,T,c,null)}w_(r,f,g,_);return;case"option":for(R in c)if(c.hasOwnProperty(R)&&(f=c[R],f!=null))switch(R){case"selected":r.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:$e(r,o,R,f,c,null)}return;case"dialog":Ce("beforetoggle",r),Ce("toggle",r),Ce("cancel",r),Ce("close",r);break;case"iframe":case"object":Ce("load",r);break;case"video":case"audio":for(f=0;f<to.length;f++)Ce(to[f],r);break;case"image":Ce("error",r),Ce("load",r);break;case"details":Ce("toggle",r);break;case"embed":case"source":case"link":Ce("error",r),Ce("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(H in c)if(c.hasOwnProperty(H)&&(f=c[H],f!=null))switch(H){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,o));default:$e(r,o,H,f,c,null)}return;default:if(of(o)){for(Y in c)c.hasOwnProperty(Y)&&(f=c[Y],f!==void 0&&Yh(r,o,Y,f,c,void 0));return}}for(T in c)c.hasOwnProperty(T)&&(f=c[T],f!=null&&$e(r,o,T,f,c,null))}function hS(r,o,c,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,_=null,b=null,T=null,R=null,H=null,Y=null;for($ in c){var Q=c[$];if(c.hasOwnProperty($)&&Q!=null)switch($){case"checked":break;case"value":break;case"defaultValue":R=Q;default:f.hasOwnProperty($)||$e(r,o,$,null,f,Q)}}for(var j in f){var $=f[j];if(Q=c[j],f.hasOwnProperty(j)&&($!=null||Q!=null))switch(j){case"type":_=$;break;case"name":g=$;break;case"checked":H=$;break;case"defaultChecked":Y=$;break;case"value":b=$;break;case"defaultValue":T=$;break;case"children":case"dangerouslySetInnerHTML":if($!=null)throw Error(i(137,o));break;default:$!==Q&&$e(r,o,j,$,f,Q)}}rf(r,b,T,R,H,Y,_,g);return;case"select":$=b=T=j=null;for(_ in c)if(R=c[_],c.hasOwnProperty(_)&&R!=null)switch(_){case"value":break;case"multiple":$=R;default:f.hasOwnProperty(_)||$e(r,o,_,null,f,R)}for(g in f)if(_=f[g],R=c[g],f.hasOwnProperty(g)&&(_!=null||R!=null))switch(g){case"value":j=_;break;case"defaultValue":T=_;break;case"multiple":b=_;default:_!==R&&$e(r,o,g,_,f,R)}o=T,c=b,f=$,j!=null?sr(r,!!c,j,!1):!!f!=!!c&&(o!=null?sr(r,!!c,o,!0):sr(r,!!c,c?[]:"",!1));return;case"textarea":$=j=null;for(T in c)if(g=c[T],c.hasOwnProperty(T)&&g!=null&&!f.hasOwnProperty(T))switch(T){case"value":break;case"children":break;default:$e(r,o,T,null,f,g)}for(b in f)if(g=f[b],_=c[b],f.hasOwnProperty(b)&&(g!=null||_!=null))switch(b){case"value":j=g;break;case"defaultValue":$=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==_&&$e(r,o,b,g,f,_)}x_(r,j,$);return;case"option":for(var le in c)if(j=c[le],c.hasOwnProperty(le)&&j!=null&&!f.hasOwnProperty(le))switch(le){case"selected":r.selected=!1;break;default:$e(r,o,le,null,f,j)}for(R in f)if(j=f[R],$=c[R],f.hasOwnProperty(R)&&j!==$&&(j!=null||$!=null))switch(R){case"selected":r.selected=j&&typeof j!="function"&&typeof j!="symbol";break;default:$e(r,o,R,j,f,$)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var _e in c)j=c[_e],c.hasOwnProperty(_e)&&j!=null&&!f.hasOwnProperty(_e)&&$e(r,o,_e,null,f,j);for(H in f)if(j=f[H],$=c[H],f.hasOwnProperty(H)&&j!==$&&(j!=null||$!=null))switch(H){case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(i(137,o));break;default:$e(r,o,H,j,f,$)}return;default:if(of(o)){for(var We in c)j=c[We],c.hasOwnProperty(We)&&j!==void 0&&!f.hasOwnProperty(We)&&Yh(r,o,We,void 0,f,j);for(Y in f)j=f[Y],$=c[Y],!f.hasOwnProperty(Y)||j===$||j===void 0&&$===void 0||Yh(r,o,Y,j,f,$);return}}for(var U in c)j=c[U],c.hasOwnProperty(U)&&j!=null&&!f.hasOwnProperty(U)&&$e(r,o,U,null,f,j);for(Q in f)j=f[Q],$=c[Q],!f.hasOwnProperty(Q)||j===$||j==null&&$==null||$e(r,o,Q,j,f,$)}function Eb(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function dS(){if(typeof performance.getEntriesByType=="function"){for(var r=0,o=0,c=performance.getEntriesByType("resource"),f=0;f<c.length;f++){var g=c[f],_=g.transferSize,b=g.initiatorType,T=g.duration;if(_&&T&&Eb(b)){for(b=0,T=g.responseEnd,f+=1;f<c.length;f++){var R=c[f],H=R.startTime;if(H>T)break;var Y=R.transferSize,Q=R.initiatorType;Y&&Eb(Q)&&(R=R.responseEnd,b+=Y*(R<T?1:(T-H)/(R-H)))}if(--f,o+=8*(_+b)/(g.duration/1e3),r++,10<r)break}}if(0<r)return o/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var qh=null,Zh=null;function rc(r){return r.nodeType===9?r:r.ownerDocument}function Rb(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Cb(r,o){if(r===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&o==="foreignObject"?0:r}function Kh(r,o){return r==="textarea"||r==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Qh=null;function pS(){var r=window.event;return r&&r.type==="popstate"?r===Qh?!1:(Qh=r,!0):(Qh=null,!1)}var Mb=typeof setTimeout=="function"?setTimeout:void 0,gS=typeof clearTimeout=="function"?clearTimeout:void 0,Ob=typeof Promise=="function"?Promise:void 0,_S=typeof queueMicrotask=="function"?queueMicrotask:typeof Ob<"u"?function(r){return Ob.resolve(null).then(r).catch(mS)}:Mb;function mS(r){setTimeout(function(){throw r})}function Vi(r){return r==="head"}function Ib(r,o){var c=o,f=0;do{var g=c.nextSibling;if(r.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"||c==="/&"){if(f===0){r.removeChild(g),Br(o);return}f--}else if(c==="$"||c==="$?"||c==="$~"||c==="$!"||c==="&")f++;else if(c==="html")io(r.ownerDocument.documentElement);else if(c==="head"){c=r.ownerDocument.head,io(c);for(var _=c.firstChild;_;){var b=_.nextSibling,T=_.nodeName;_[Ta]||T==="SCRIPT"||T==="STYLE"||T==="LINK"&&_.rel.toLowerCase()==="stylesheet"||c.removeChild(_),_=b}}else c==="body"&&io(r.ownerDocument.body);c=g}while(c);Br(o)}function Nb(r,o){var c=r;r=0;do{var f=c.nextSibling;if(c.nodeType===1?o?(c._stashedDisplay=c.style.display,c.style.display="none"):(c.style.display=c._stashedDisplay||"",c.getAttribute("style")===""&&c.removeAttribute("style")):c.nodeType===3&&(o?(c._stashedText=c.nodeValue,c.nodeValue=""):c.nodeValue=c._stashedText||""),f&&f.nodeType===8)if(c=f.data,c==="/$"){if(r===0)break;r--}else c!=="$"&&c!=="$?"&&c!=="$~"&&c!=="$!"||r++;c=f}while(c)}function Gh(r){var o=r.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var c=o;switch(o=o.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":Gh(c),nf(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}r.removeChild(c)}}function yS(r,o,c,f){for(;r.nodeType===1;){var g=c;if(r.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(f){if(!r[Ta])switch(o){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(_=r.getAttribute("rel"),_==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(_!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(_=r.getAttribute("src"),(_!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&_&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(o==="input"&&r.type==="hidden"){var _=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===_)return r}else return r;if(r=mn(r.nextSibling),r===null)break}return null}function bS(r,o,c){if(o==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!c||(r=mn(r.nextSibling),r===null))return null;return r}function kb(r,o){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!o||(r=mn(r.nextSibling),r===null))return null;return r}function Jh(r){return r.data==="$?"||r.data==="$~"}function ed(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function vS(r,o){var c=r.ownerDocument;if(r.data==="$~")r._reactRetry=o;else if(r.data!=="$?"||c.readyState!=="loading")o();else{var f=function(){o(),c.removeEventListener("DOMContentLoaded",f)};c.addEventListener("DOMContentLoaded",f),r._reactRetry=f}}function mn(r){for(;r!=null;r=r.nextSibling){var o=r.nodeType;if(o===1||o===3)break;if(o===8){if(o=r.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return r}var td=null;function Pb(r){r=r.nextSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="/$"||c==="/&"){if(o===0)return mn(r.nextSibling);o--}else c!=="$"&&c!=="$!"&&c!=="$?"&&c!=="$~"&&c!=="&"||o++}r=r.nextSibling}return null}function Db(r){r=r.previousSibling;for(var o=0;r;){if(r.nodeType===8){var c=r.data;if(c==="$"||c==="$!"||c==="$?"||c==="$~"||c==="&"){if(o===0)return r;o--}else c!=="/$"&&c!=="/&"||o++}r=r.previousSibling}return null}function Bb(r,o,c){switch(o=rc(c),r){case"html":if(r=o.documentElement,!r)throw Error(i(452));return r;case"head":if(r=o.head,!r)throw Error(i(453));return r;case"body":if(r=o.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function io(r){for(var o=r.attributes;o.length;)r.removeAttributeNode(o[0]);nf(r)}var yn=new Map,Ub=new Set;function ac(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var di=se.d;se.d={f:TS,r:xS,D:wS,C:SS,L:AS,m:ES,X:CS,S:RS,M:MS};function TS(){var r=di.f(),o=Ql();return r||o}function xS(r){var o=tr(r);o!==null&&o.tag===5&&o.type==="form"?ey(o):di.r(r)}var kr=typeof document>"u"?null:document;function Fb(r,o,c){var f=kr;if(f&&typeof o=="string"&&o){var g=un(o);g='link[rel="'+r+'"][href="'+g+'"]',typeof c=="string"&&(g+='[crossorigin="'+c+'"]'),Ub.has(g)||(Ub.add(g),r={rel:r,crossOrigin:c,href:o},f.querySelector(g)===null&&(o=f.createElement("link"),Rt(o,"link",r),vt(o),f.head.appendChild(o)))}}function wS(r){di.D(r),Fb("dns-prefetch",r,null)}function SS(r,o){di.C(r,o),Fb("preconnect",r,o)}function AS(r,o,c){di.L(r,o,c);var f=kr;if(f&&r&&o){var g='link[rel="preload"][as="'+un(o)+'"]';o==="image"&&c&&c.imageSrcSet?(g+='[imagesrcset="'+un(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(g+='[imagesizes="'+un(c.imageSizes)+'"]')):g+='[href="'+un(r)+'"]';var _=g;switch(o){case"style":_=Pr(r);break;case"script":_=Dr(r)}yn.has(_)||(r=m({rel:"preload",href:o==="image"&&c&&c.imageSrcSet?void 0:r,as:o},c),yn.set(_,r),f.querySelector(g)!==null||o==="style"&&f.querySelector(so(_))||o==="script"&&f.querySelector(ro(_))||(o=f.createElement("link"),Rt(o,"link",r),vt(o),f.head.appendChild(o)))}}function ES(r,o){di.m(r,o);var c=kr;if(c&&r){var f=o&&typeof o.as=="string"?o.as:"script",g='link[rel="modulepreload"][as="'+un(f)+'"][href="'+un(r)+'"]',_=g;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=Dr(r)}if(!yn.has(_)&&(r=m({rel:"modulepreload",href:r},o),yn.set(_,r),c.querySelector(g)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(ro(_)))return}f=c.createElement("link"),Rt(f,"link",r),vt(f),c.head.appendChild(f)}}}function RS(r,o,c){di.S(r,o,c);var f=kr;if(f&&r){var g=nr(f).hoistableStyles,_=Pr(r);o=o||"default";var b=g.get(_);if(!b){var T={loading:0,preload:null};if(b=f.querySelector(so(_)))T.loading=5;else{r=m({rel:"stylesheet",href:r,"data-precedence":o},c),(c=yn.get(_))&&nd(r,c);var R=b=f.createElement("link");vt(R),Rt(R,"link",r),R._p=new Promise(function(H,Y){R.onload=H,R.onerror=Y}),R.addEventListener("load",function(){T.loading|=1}),R.addEventListener("error",function(){T.loading|=2}),T.loading|=4,oc(b,o,f)}b={type:"stylesheet",instance:b,count:1,state:T},g.set(_,b)}}}function CS(r,o){di.X(r,o);var c=kr;if(c&&r){var f=nr(c).hoistableScripts,g=Dr(r),_=f.get(g);_||(_=c.querySelector(ro(g)),_||(r=m({src:r,async:!0},o),(o=yn.get(g))&&id(r,o),_=c.createElement("script"),vt(_),Rt(_,"link",r),c.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},f.set(g,_))}}function MS(r,o){di.M(r,o);var c=kr;if(c&&r){var f=nr(c).hoistableScripts,g=Dr(r),_=f.get(g);_||(_=c.querySelector(ro(g)),_||(r=m({src:r,async:!0,type:"module"},o),(o=yn.get(g))&&id(r,o),_=c.createElement("script"),vt(_),Rt(_,"link",r),c.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},f.set(g,_))}}function Lb(r,o,c,f){var g=(g=ue.current)?ac(g):null;if(!g)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(o=Pr(c.href),c=nr(g).hoistableStyles,f=c.get(o),f||(f={type:"style",instance:null,count:0,state:null},c.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){r=Pr(c.href);var _=nr(g).hoistableStyles,b=_.get(r);if(b||(g=g.ownerDocument||g,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(r,b),(_=g.querySelector(so(r)))&&!_._p&&(b.instance=_,b.state.loading=5),yn.has(r)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},yn.set(r,c),_||OS(g,r,c,b.state))),o&&f===null)throw Error(i(528,""));return b}if(o&&f!==null)throw Error(i(529,""));return null;case"script":return o=c.async,c=c.src,typeof c=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Dr(c),c=nr(g).hoistableScripts,f=c.get(o),f||(f={type:"script",instance:null,count:0,state:null},c.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function Pr(r){return'href="'+un(r)+'"'}function so(r){return'link[rel="stylesheet"]['+r+"]"}function zb(r){return m({},r,{"data-precedence":r.precedence,precedence:null})}function OS(r,o,c,f){r.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=r.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Rt(o,"link",c),vt(o),r.head.appendChild(o))}function Dr(r){return'[src="'+un(r)+'"]'}function ro(r){return"script[async]"+r}function Vb(r,o,c){if(o.count++,o.instance===null)switch(o.type){case"style":var f=r.querySelector('style[data-href~="'+un(c.href)+'"]');if(f)return o.instance=f,vt(f),f;var g=m({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return f=(r.ownerDocument||r).createElement("style"),vt(f),Rt(f,"style",g),oc(f,c.precedence,r),o.instance=f;case"stylesheet":g=Pr(c.href);var _=r.querySelector(so(g));if(_)return o.state.loading|=4,o.instance=_,vt(_),_;f=zb(c),(g=yn.get(g))&&nd(f,g),_=(r.ownerDocument||r).createElement("link"),vt(_);var b=_;return b._p=new Promise(function(T,R){b.onload=T,b.onerror=R}),Rt(_,"link",f),o.state.loading|=4,oc(_,c.precedence,r),o.instance=_;case"script":return _=Dr(c.src),(g=r.querySelector(ro(_)))?(o.instance=g,vt(g),g):(f=c,(g=yn.get(_))&&(f=m({},c),id(f,g)),r=r.ownerDocument||r,g=r.createElement("script"),vt(g),Rt(g,"link",f),r.head.appendChild(g),o.instance=g);case"void":return null;default:throw Error(i(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,oc(f,c.precedence,r));return o.instance}function oc(r,o,c){for(var f=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=f.length?f[f.length-1]:null,_=g,b=0;b<f.length;b++){var T=f[b];if(T.dataset.precedence===o)_=T;else if(_!==g)break}_?_.parentNode.insertBefore(r,_.nextSibling):(o=c.nodeType===9?c.head:c,o.insertBefore(r,o.firstChild))}function nd(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.title==null&&(r.title=o.title)}function id(r,o){r.crossOrigin==null&&(r.crossOrigin=o.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=o.referrerPolicy),r.integrity==null&&(r.integrity=o.integrity)}var lc=null;function Hb(r,o,c){if(lc===null){var f=new Map,g=lc=new Map;g.set(c,f)}else g=lc,f=g.get(c),f||(f=new Map,g.set(c,f));if(f.has(r))return f;for(f.set(r,null),c=c.getElementsByTagName(r),g=0;g<c.length;g++){var _=c[g];if(!(_[Ta]||_[wt]||r==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var b=_.getAttribute(o)||"";b=r+b;var T=f.get(b);T?T.push(_):f.set(b,[_])}}return f}function jb(r,o,c){r=r.ownerDocument||r,r.head.insertBefore(c,o==="title"?r.querySelector("head > title"):null)}function IS(r,o,c){if(c===1||o.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;switch(o.rel){case"stylesheet":return r=o.disabled,typeof o.precedence=="string"&&r==null;default:return!0}case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function $b(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function NS(r,o,c,f){if(c.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var g=Pr(f.href),_=o.querySelector(so(g));if(_){o=_._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(r.count++,r=cc.bind(r),o.then(r,r)),c.state.loading|=4,c.instance=_,vt(_);return}_=o.ownerDocument||o,f=zb(f),(g=yn.get(g))&&nd(f,g),_=_.createElement("link"),vt(_);var b=_;b._p=new Promise(function(T,R){b.onload=T,b.onerror=R}),Rt(_,"link",f),c.instance=_}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(c,o),(o=c.state.preload)&&(c.state.loading&3)===0&&(r.count++,c=cc.bind(r),o.addEventListener("load",c),o.addEventListener("error",c))}}var sd=0;function kS(r,o){return r.stylesheets&&r.count===0&&fc(r,r.stylesheets),0<r.count||0<r.imgCount?function(c){var f=setTimeout(function(){if(r.stylesheets&&fc(r,r.stylesheets),r.unsuspend){var _=r.unsuspend;r.unsuspend=null,_()}},6e4+o);0<r.imgBytes&&sd===0&&(sd=62500*dS());var g=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&fc(r,r.stylesheets),r.unsuspend)){var _=r.unsuspend;r.unsuspend=null,_()}},(r.imgBytes>sd?50:800)+o);return r.unsuspend=c,function(){r.unsuspend=null,clearTimeout(f),clearTimeout(g)}}:null}function cc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)fc(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var uc=null;function fc(r,o){r.stylesheets=null,r.unsuspend!==null&&(r.count++,uc=new Map,o.forEach(PS,r),uc=null,cc.call(r))}function PS(r,o){if(!(o.state.loading&4)){var c=uc.get(r);if(c)var f=c.get(null);else{c=new Map,uc.set(r,c);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<g.length;_++){var b=g[_];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(c.set(b.dataset.precedence,b),f=b)}f&&c.set(null,f)}g=o.instance,b=g.getAttribute("data-precedence"),_=c.get(b)||f,_===f&&c.set(null,g),c.set(b,g),this.count++,f=cc.bind(this),g.addEventListener("load",f),g.addEventListener("error",f),_?_.parentNode.insertBefore(g,_.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),o.state.loading|=4}}var ao={$$typeof:M,Provider:null,Consumer:null,_currentValue:de,_currentValue2:de,_threadCount:0};function DS(r,o,c,f,g,_,b,T,R){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Gu(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Gu(0),this.hiddenUpdates=Gu(null),this.identifierPrefix=f,this.onUncaughtError=g,this.onCaughtError=_,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=R,this.incompleteTransitions=new Map}function Wb(r,o,c,f,g,_,b,T,R,H,Y,Q){return r=new DS(r,o,c,b,R,H,Y,Q,T),o=1,_===!0&&(o|=24),_=Kt(3,null,null,o),r.current=_,_.stateNode=r,o=Uf(),o.refCount++,r.pooledCache=o,o.refCount++,_.memoizedState={element:f,isDehydrated:c,cache:o},Vf(_),r}function Xb(r){return r?(r=hr,r):hr}function Yb(r,o,c,f,g,_){g=Xb(g),f.context===null?f.context=g:f.pendingContext=g,f=Oi(o),f.payload={element:c},_=_===void 0?null:_,_!==null&&(f.callback=_),c=Ii(r,f,o),c!==null&&(jt(c,r,o),Fa(c,r,o))}function qb(r,o){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var c=r.retryLane;r.retryLane=c!==0&&c<o?c:o}}function rd(r,o){qb(r,o),(r=r.alternate)&&qb(r,o)}function Zb(r){if(r.tag===13||r.tag===31){var o=hs(r,67108864);o!==null&&jt(o,r,67108864),rd(r,67108864)}}function Kb(r){if(r.tag===13||r.tag===31){var o=tn();o=Ju(o);var c=hs(r,o);c!==null&&jt(c,r,o),rd(r,o)}}var hc=!0;function BS(r,o,c,f){var g=W.T;W.T=null;var _=se.p;try{se.p=2,ad(r,o,c,f)}finally{se.p=_,W.T=g}}function US(r,o,c,f){var g=W.T;W.T=null;var _=se.p;try{se.p=8,ad(r,o,c,f)}finally{se.p=_,W.T=g}}function ad(r,o,c,f){if(hc){var g=od(f);if(g===null)Xh(r,o,f,dc,c),Gb(r,f);else if(LS(g,r,o,c,f))f.stopPropagation();else if(Gb(r,f),o&4&&-1<FS.indexOf(r)){for(;g!==null;){var _=tr(g);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var b=os(_.pendingLanes);if(b!==0){var T=_;for(T.pendingLanes|=2,T.entangledLanes|=2;b;){var R=1<<31-qt(b);T.entanglements[1]|=R,b&=~R}Fn(_),(De&6)===0&&(Zl=Xt()+500,eo(0))}}break;case 31:case 13:T=hs(_,2),T!==null&&jt(T,_,2),Ql(),rd(_,2)}if(_=od(f),_===null&&Xh(r,o,f,dc,c),_===g)break;g=_}g!==null&&f.stopPropagation()}else Xh(r,o,f,null,c)}}function od(r){return r=cf(r),ld(r)}var dc=null;function ld(r){if(dc=null,r=er(r),r!==null){var o=a(r);if(o===null)r=null;else{var c=o.tag;if(c===13){if(r=l(o),r!==null)return r;r=null}else if(c===31){if(r=u(o),r!==null)return r;r=null}else if(c===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;r=null}else o!==r&&(r=null)}}return dc=r,null}function Qb(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(wx()){case r_:return 2;case a_:return 8;case nl:case Sx:return 32;case o_:return 268435456;default:return 32}default:return 32}}var cd=!1,Hi=null,ji=null,$i=null,oo=new Map,lo=new Map,Wi=[],FS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Gb(r,o){switch(r){case"focusin":case"focusout":Hi=null;break;case"dragenter":case"dragleave":ji=null;break;case"mouseover":case"mouseout":$i=null;break;case"pointerover":case"pointerout":oo.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":lo.delete(o.pointerId)}}function co(r,o,c,f,g,_){return r===null||r.nativeEvent!==_?(r={blockedOn:o,domEventName:c,eventSystemFlags:f,nativeEvent:_,targetContainers:[g]},o!==null&&(o=tr(o),o!==null&&Zb(o)),r):(r.eventSystemFlags|=f,o=r.targetContainers,g!==null&&o.indexOf(g)===-1&&o.push(g),r)}function LS(r,o,c,f,g){switch(o){case"focusin":return Hi=co(Hi,r,o,c,f,g),!0;case"dragenter":return ji=co(ji,r,o,c,f,g),!0;case"mouseover":return $i=co($i,r,o,c,f,g),!0;case"pointerover":var _=g.pointerId;return oo.set(_,co(oo.get(_)||null,r,o,c,f,g)),!0;case"gotpointercapture":return _=g.pointerId,lo.set(_,co(lo.get(_)||null,r,o,c,f,g)),!0}return!1}function Jb(r){var o=er(r.target);if(o!==null){var c=a(o);if(c!==null){if(o=c.tag,o===13){if(o=l(c),o!==null){r.blockedOn=o,d_(r.priority,function(){Kb(c)});return}}else if(o===31){if(o=u(c),o!==null){r.blockedOn=o,d_(r.priority,function(){Kb(c)});return}}else if(o===3&&c.stateNode.current.memoizedState.isDehydrated){r.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}r.blockedOn=null}function pc(r){if(r.blockedOn!==null)return!1;for(var o=r.targetContainers;0<o.length;){var c=od(r.nativeEvent);if(c===null){c=r.nativeEvent;var f=new c.constructor(c.type,c);lf=f,c.target.dispatchEvent(f),lf=null}else return o=tr(c),o!==null&&Zb(o),r.blockedOn=c,!1;o.shift()}return!0}function e0(r,o,c){pc(r)&&c.delete(o)}function zS(){cd=!1,Hi!==null&&pc(Hi)&&(Hi=null),ji!==null&&pc(ji)&&(ji=null),$i!==null&&pc($i)&&($i=null),oo.forEach(e0),lo.forEach(e0)}function gc(r,o){r.blockedOn===o&&(r.blockedOn=null,cd||(cd=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,zS)))}var _c=null;function t0(r){_c!==r&&(_c=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){_c===r&&(_c=null);for(var o=0;o<r.length;o+=3){var c=r[o],f=r[o+1],g=r[o+2];if(typeof f!="function"){if(ld(f||c)===null)continue;break}var _=tr(c);_!==null&&(r.splice(o,3),o-=3,oh(_,{pending:!0,data:g,method:c.method,action:f},f,g))}}))}function Br(r){function o(R){return gc(R,r)}Hi!==null&&gc(Hi,r),ji!==null&&gc(ji,r),$i!==null&&gc($i,r),oo.forEach(o),lo.forEach(o);for(var c=0;c<Wi.length;c++){var f=Wi[c];f.blockedOn===r&&(f.blockedOn=null)}for(;0<Wi.length&&(c=Wi[0],c.blockedOn===null);)Jb(c),c.blockedOn===null&&Wi.shift();if(c=(r.ownerDocument||r).$$reactFormReplay,c!=null)for(f=0;f<c.length;f+=3){var g=c[f],_=c[f+1],b=g[Ut]||null;if(typeof _=="function")b||t0(c);else if(b){var T=null;if(_&&_.hasAttribute("formAction")){if(g=_,b=_[Ut]||null)T=b.formAction;else if(ld(g)!==null)continue}else T=b.action;typeof T=="function"?c[f+1]=T:(c.splice(f,3),f-=3),t0(c)}}}function n0(){function r(_){_.canIntercept&&_.info==="react-transition"&&_.intercept({handler:function(){return new Promise(function(b){return g=b})},focusReset:"manual",scroll:"manual"})}function o(){g!==null&&(g(),g=null),f||setTimeout(c,20)}function c(){if(!f&&!navigation.transition){var _=navigation.currentEntry;_&&_.url!=null&&navigation.navigate(_.url,{state:_.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,g=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(c,100),function(){f=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),g!==null&&(g(),g=null)}}}function ud(r){this._internalRoot=r}mc.prototype.render=ud.prototype.render=function(r){var o=this._internalRoot;if(o===null)throw Error(i(409));var c=o.current,f=tn();Yb(c,f,r,o,null,null)},mc.prototype.unmount=ud.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var o=r.containerInfo;Yb(r.current,2,null,r,null,null),Ql(),o[Js]=null}};function mc(r){this._internalRoot=r}mc.prototype.unstable_scheduleHydration=function(r){if(r){var o=h_();r={blockedOn:null,target:r,priority:o};for(var c=0;c<Wi.length&&o!==0&&o<Wi[c].priority;c++);Wi.splice(c,0,r),c===0&&Jb(r)}};var i0=e.version;if(i0!=="19.2.0")throw Error(i(527,i0,"19.2.0"));se.findDOMNode=function(r){var o=r._reactInternals;if(o===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=d(o),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var VS={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:W,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var yc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!yc.isDisabled&&yc.supportsFiber)try{ya=yc.inject(VS),Yt=yc}catch{}}return fo.createRoot=function(r,o){if(!s(r))throw Error(i(299));var c=!1,f="",g=uy,_=fy,b=hy;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(g=o.onUncaughtError),o.onCaughtError!==void 0&&(_=o.onCaughtError),o.onRecoverableError!==void 0&&(b=o.onRecoverableError)),o=Wb(r,1,!1,null,null,c,f,null,g,_,b,n0),r[Js]=o.current,Wh(r),new ud(o)},fo.hydrateRoot=function(r,o,c){if(!s(r))throw Error(i(299));var f=!1,g="",_=uy,b=fy,T=hy,R=null;return c!=null&&(c.unstable_strictMode===!0&&(f=!0),c.identifierPrefix!==void 0&&(g=c.identifierPrefix),c.onUncaughtError!==void 0&&(_=c.onUncaughtError),c.onCaughtError!==void 0&&(b=c.onCaughtError),c.onRecoverableError!==void 0&&(T=c.onRecoverableError),c.formState!==void 0&&(R=c.formState)),o=Wb(r,1,!0,o,c??null,f,g,R,_,b,T,n0),o.context=Xb(null),c=o.current,f=tn(),f=Ju(f),g=Oi(f),g.callback=null,Ii(c,g,f),c=f,o.current.lanes=c,va(o,c),Fn(o),r[Js]=o.current,Wh(r),new mc(o)},fo.version="19.2.0",fo}var d0;function KS(){if(d0)return dd.exports;d0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),dd.exports=ZS(),dd.exports}var QS=KS(),md={exports:{}},yd={};/**
 * @license React
 * react-compiler-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p0;function GS(){if(p0)return yd;p0=1;var n=Mu().__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;return yd.c=function(e){return n.H.useMemoCache(e)},yd}var g0;function JS(){return g0||(g0=1,md.exports=GS()),md.exports}var a1=JS();const eA=Math.sqrt(50),tA=Math.sqrt(10),nA=Math.sqrt(2);function Jc(n,e,t){const i=(e-n)/Math.max(0,t),s=Math.floor(Math.log10(i)),a=i/Math.pow(10,s),l=a>=eA?10:a>=tA?5:a>=nA?2:1;let u,h,d;return s<0?(d=Math.pow(10,-s)/l,u=Math.round(n*d),h=Math.round(e*d),u/d<n&&++u,h/d>e&&--h,d=-d):(d=Math.pow(10,s)*l,u=Math.round(n/d),h=Math.round(e/d),u*d<n&&++u,h*d>e&&--h),h<u&&.5<=t&&t<2?Jc(n,e,t*2):[u,h,d]}function iA(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const i=e<n,[s,a,l]=i?Jc(e,n,t):Jc(n,e,t);if(!(a>=s))return[];const u=a-s+1,h=new Array(u);if(i)if(l<0)for(let d=0;d<u;++d)h[d]=(a-d)/-l;else for(let d=0;d<u;++d)h[d]=(a-d)*l;else if(l<0)for(let d=0;d<u;++d)h[d]=(s+d)/-l;else for(let d=0;d<u;++d)h[d]=(s+d)*l;return h}function sp(n,e,t){return e=+e,n=+n,t=+t,Jc(n,e,t)[2]}function sA(n,e,t){e=+e,n=+n,t=+t;const i=e<n,s=i?sp(e,n,t):sp(n,e,t);return(i?-1:1)*(s<0?1/-s:s)}var rA={value:()=>{}};function o1(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new zc(t)}function zc(n){this._=n}function aA(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",s=t.indexOf(".");if(s>=0&&(i=t.slice(s+1),t=t.slice(0,s)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}zc.prototype=o1.prototype={constructor:zc,on:function(n,e){var t=this._,i=aA(n+"",t),s,a=-1,l=i.length;if(arguments.length<2){for(;++a<l;)if((s=(n=i[a]).type)&&(s=oA(t[s],n.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<l;)if(s=(n=i[a]).type)t[s]=_0(t[s],n.name,e);else if(e==null)for(s in t)t[s]=_0(t[s],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new zc(n)},call:function(n,e){if((s=arguments.length-2)>0)for(var t=new Array(s),i=0,s,a;i<s;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(a=this._[n],i=0,s=a.length;i<s;++i)a[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],s=0,a=i.length;s<a;++s)i[s].value.apply(e,t)}};function oA(n,e){for(var t=0,i=n.length,s;t<i;++t)if((s=n[t]).name===e)return s.value}function _0(n,e,t){for(var i=0,s=n.length;i<s;++i)if(n[i].name===e){n[i]=rA,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var rp="http://www.w3.org/1999/xhtml";const m0={svg:"http://www.w3.org/2000/svg",xhtml:rp,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ou(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),m0.hasOwnProperty(e)?{space:m0[e],local:n}:n}function lA(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===rp&&e.documentElement.namespaceURI===rp?e.createElement(n):e.createElementNS(t,n)}}function cA(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function l1(n){var e=Ou(n);return(e.local?cA:lA)(e)}function uA(){}function Qp(n){return n==null?uA:function(){return this.querySelector(n)}}function fA(n){typeof n!="function"&&(n=Qp(n));for(var e=this._groups,t=e.length,i=new Array(t),s=0;s<t;++s)for(var a=e[s],l=a.length,u=i[s]=new Array(l),h,d,p=0;p<l;++p)(h=a[p])&&(d=n.call(h,h.__data__,p,a))&&("__data__"in h&&(d.__data__=h.__data__),u[p]=d);return new In(i,this._parents)}function hA(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function dA(){return[]}function c1(n){return n==null?dA:function(){return this.querySelectorAll(n)}}function pA(n){return function(){return hA(n.apply(this,arguments))}}function gA(n){typeof n=="function"?n=pA(n):n=c1(n);for(var e=this._groups,t=e.length,i=[],s=[],a=0;a<t;++a)for(var l=e[a],u=l.length,h,d=0;d<u;++d)(h=l[d])&&(i.push(n.call(h,h.__data__,d,l)),s.push(h));return new In(i,s)}function u1(n){return function(){return this.matches(n)}}function f1(n){return function(e){return e.matches(n)}}var _A=Array.prototype.find;function mA(n){return function(){return _A.call(this.children,n)}}function yA(){return this.firstElementChild}function bA(n){return this.select(n==null?yA:mA(typeof n=="function"?n:f1(n)))}var vA=Array.prototype.filter;function TA(){return Array.from(this.children)}function xA(n){return function(){return vA.call(this.children,n)}}function wA(n){return this.selectAll(n==null?TA:xA(typeof n=="function"?n:f1(n)))}function SA(n){typeof n!="function"&&(n=u1(n));for(var e=this._groups,t=e.length,i=new Array(t),s=0;s<t;++s)for(var a=e[s],l=a.length,u=i[s]=[],h,d=0;d<l;++d)(h=a[d])&&n.call(h,h.__data__,d,a)&&u.push(h);return new In(i,this._parents)}function h1(n){return new Array(n.length)}function AA(){return new In(this._enter||this._groups.map(h1),this._parents)}function eu(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}eu.prototype={constructor:eu,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function EA(n){return function(){return n}}function RA(n,e,t,i,s,a){for(var l=0,u,h=e.length,d=a.length;l<d;++l)(u=e[l])?(u.__data__=a[l],i[l]=u):t[l]=new eu(n,a[l]);for(;l<h;++l)(u=e[l])&&(s[l]=u)}function CA(n,e,t,i,s,a,l){var u,h,d=new Map,p=e.length,m=a.length,y=new Array(p),v;for(u=0;u<p;++u)(h=e[u])&&(y[u]=v=l.call(h,h.__data__,u,e)+"",d.has(v)?s[u]=h:d.set(v,h));for(u=0;u<m;++u)v=l.call(n,a[u],u,a)+"",(h=d.get(v))?(i[u]=h,h.__data__=a[u],d.delete(v)):t[u]=new eu(n,a[u]);for(u=0;u<p;++u)(h=e[u])&&d.get(y[u])===h&&(s[u]=h)}function MA(n){return n.__data__}function OA(n,e){if(!arguments.length)return Array.from(this,MA);var t=e?CA:RA,i=this._parents,s=this._groups;typeof n!="function"&&(n=EA(n));for(var a=s.length,l=new Array(a),u=new Array(a),h=new Array(a),d=0;d<a;++d){var p=i[d],m=s[d],y=m.length,v=IA(n.call(p,p&&p.__data__,d,i)),x=v.length,A=u[d]=new Array(x),E=l[d]=new Array(x),C=h[d]=new Array(y);t(p,m,A,E,C,v,e);for(var D=0,M=0,B,z;D<x;++D)if(B=A[D]){for(D>=M&&(M=D+1);!(z=E[M])&&++M<x;);B._next=z||null}}return l=new In(l,i),l._enter=u,l._exit=h,l}function IA(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function NA(){return new In(this._exit||this._groups.map(h1),this._parents)}function kA(n,e,t){var i=this.enter(),s=this,a=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(s=e(s),s&&(s=s.selection())),t==null?a.remove():t(a),i&&s?i.merge(s).order():s}function PA(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,s=t.length,a=i.length,l=Math.min(s,a),u=new Array(s),h=0;h<l;++h)for(var d=t[h],p=i[h],m=d.length,y=u[h]=new Array(m),v,x=0;x<m;++x)(v=d[x]||p[x])&&(y[x]=v);for(;h<s;++h)u[h]=t[h];return new In(u,this._parents)}function DA(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],s=i.length-1,a=i[s],l;--s>=0;)(l=i[s])&&(a&&l.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(l,a),a=l);return this}function BA(n){n||(n=UA);function e(m,y){return m&&y?n(m.__data__,y.__data__):!m-!y}for(var t=this._groups,i=t.length,s=new Array(i),a=0;a<i;++a){for(var l=t[a],u=l.length,h=s[a]=new Array(u),d,p=0;p<u;++p)(d=l[p])&&(h[p]=d);h.sort(e)}return new In(s,this._parents).order()}function UA(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function FA(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function LA(){return Array.from(this)}function zA(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],s=0,a=i.length;s<a;++s){var l=i[s];if(l)return l}return null}function VA(){let n=0;for(const e of this)++n;return n}function HA(){return!this.node()}function jA(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var s=e[t],a=0,l=s.length,u;a<l;++a)(u=s[a])&&n.call(u,u.__data__,a,s);return this}function $A(n){return function(){this.removeAttribute(n)}}function WA(n){return function(){this.removeAttributeNS(n.space,n.local)}}function XA(n,e){return function(){this.setAttribute(n,e)}}function YA(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function qA(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function ZA(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function KA(n,e){var t=Ou(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?WA:$A:typeof e=="function"?t.local?ZA:qA:t.local?YA:XA)(t,e))}function d1(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function QA(n){return function(){this.style.removeProperty(n)}}function GA(n,e,t){return function(){this.style.setProperty(n,e,t)}}function JA(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function eE(n,e,t){return arguments.length>1?this.each((e==null?QA:typeof e=="function"?JA:GA)(n,e,t??"")):ta(this.node(),n)}function ta(n,e){return n.style.getPropertyValue(e)||d1(n).getComputedStyle(n,null).getPropertyValue(e)}function tE(n){return function(){delete this[n]}}function nE(n,e){return function(){this[n]=e}}function iE(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function sE(n,e){return arguments.length>1?this.each((e==null?tE:typeof e=="function"?iE:nE)(n,e)):this.node()[n]}function p1(n){return n.trim().split(/^|\s+/)}function Gp(n){return n.classList||new g1(n)}function g1(n){this._node=n,this._names=p1(n.getAttribute("class")||"")}g1.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function _1(n,e){for(var t=Gp(n),i=-1,s=e.length;++i<s;)t.add(e[i])}function m1(n,e){for(var t=Gp(n),i=-1,s=e.length;++i<s;)t.remove(e[i])}function rE(n){return function(){_1(this,n)}}function aE(n){return function(){m1(this,n)}}function oE(n,e){return function(){(e.apply(this,arguments)?_1:m1)(this,n)}}function lE(n,e){var t=p1(n+"");if(arguments.length<2){for(var i=Gp(this.node()),s=-1,a=t.length;++s<a;)if(!i.contains(t[s]))return!1;return!0}return this.each((typeof e=="function"?oE:e?rE:aE)(t,e))}function cE(){this.textContent=""}function uE(n){return function(){this.textContent=n}}function fE(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function hE(n){return arguments.length?this.each(n==null?cE:(typeof n=="function"?fE:uE)(n)):this.node().textContent}function dE(){this.innerHTML=""}function pE(n){return function(){this.innerHTML=n}}function gE(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function _E(n){return arguments.length?this.each(n==null?dE:(typeof n=="function"?gE:pE)(n)):this.node().innerHTML}function mE(){this.nextSibling&&this.parentNode.appendChild(this)}function yE(){return this.each(mE)}function bE(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function vE(){return this.each(bE)}function TE(n){var e=typeof n=="function"?n:l1(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function xE(){return null}function wE(n,e){var t=typeof n=="function"?n:l1(n),i=e==null?xE:typeof e=="function"?e:Qp(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function SE(){var n=this.parentNode;n&&n.removeChild(this)}function AE(){return this.each(SE)}function EE(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function RE(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function CE(n){return this.select(n?RE:EE)}function ME(n){return arguments.length?this.property("__data__",n):this.node().__data__}function OE(n){return function(e){n.call(this,e,this.__data__)}}function IE(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function NE(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,s=e.length,a;t<s;++t)a=e[t],(!n.type||a.type===n.type)&&a.name===n.name?this.removeEventListener(a.type,a.listener,a.options):e[++i]=a;++i?e.length=i:delete this.__on}}}function kE(n,e,t){return function(){var i=this.__on,s,a=OE(e);if(i){for(var l=0,u=i.length;l<u;++l)if((s=i[l]).type===n.type&&s.name===n.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=a,s.options=t),s.value=e;return}}this.addEventListener(n.type,a,t),s={type:n.type,name:n.name,value:e,listener:a,options:t},i?i.push(s):this.__on=[s]}}function PE(n,e,t){var i=IE(n+""),s,a=i.length,l;if(arguments.length<2){var u=this.node().__on;if(u){for(var h=0,d=u.length,p;h<d;++h)for(s=0,p=u[h];s<a;++s)if((l=i[s]).type===p.type&&l.name===p.name)return p.value}return}for(u=e?kE:NE,s=0;s<a;++s)this.each(u(i[s],e,t));return this}function y1(n,e,t){var i=d1(n),s=i.CustomEvent;typeof s=="function"?s=new s(e,t):(s=i.document.createEvent("Event"),t?(s.initEvent(e,t.bubbles,t.cancelable),s.detail=t.detail):s.initEvent(e,!1,!1)),n.dispatchEvent(s)}function DE(n,e){return function(){return y1(this,n,e)}}function BE(n,e){return function(){return y1(this,n,e.apply(this,arguments))}}function UE(n,e){return this.each((typeof e=="function"?BE:DE)(n,e))}function*FE(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],s=0,a=i.length,l;s<a;++s)(l=i[s])&&(yield l)}var LE=[null];function In(n,e){this._groups=n,this._parents=e}function Xo(){return new In([[document.documentElement]],LE)}function zE(){return this}In.prototype=Xo.prototype={constructor:In,select:fA,selectAll:gA,selectChild:bA,selectChildren:wA,filter:SA,data:OA,enter:AA,exit:NA,join:kA,merge:PA,selection:zE,order:DA,sort:BA,call:FA,nodes:LA,node:zA,size:VA,empty:HA,each:jA,attr:KA,style:eE,property:sE,classed:lE,text:hE,html:_E,raise:yE,lower:vE,append:TE,insert:wE,remove:AE,clone:CE,datum:ME,on:PE,dispatch:UE,[Symbol.iterator]:FE};function Jp(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function b1(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function Yo(){}var Do=.7,tu=1/Do,Qr="\\s*([+-]?\\d+)\\s*",Bo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Wn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",VE=/^#([0-9a-f]{3,8})$/,HE=new RegExp(`^rgb\\(${Qr},${Qr},${Qr}\\)$`),jE=new RegExp(`^rgb\\(${Wn},${Wn},${Wn}\\)$`),$E=new RegExp(`^rgba\\(${Qr},${Qr},${Qr},${Bo}\\)$`),WE=new RegExp(`^rgba\\(${Wn},${Wn},${Wn},${Bo}\\)$`),XE=new RegExp(`^hsl\\(${Bo},${Wn},${Wn}\\)$`),YE=new RegExp(`^hsla\\(${Bo},${Wn},${Wn},${Bo}\\)$`),y0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Jp(Yo,zs,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:b0,formatHex:b0,formatHex8:qE,formatHsl:ZE,formatRgb:v0,toString:v0});function b0(){return this.rgb().formatHex()}function qE(){return this.rgb().formatHex8()}function ZE(){return v1(this).formatHsl()}function v0(){return this.rgb().formatRgb()}function zs(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=VE.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?T0(e):t===3?new $t(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?bc(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?bc(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=HE.exec(n))?new $t(e[1],e[2],e[3],1):(e=jE.exec(n))?new $t(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=$E.exec(n))?bc(e[1],e[2],e[3],e[4]):(e=WE.exec(n))?bc(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=XE.exec(n))?S0(e[1],e[2]/100,e[3]/100,1):(e=YE.exec(n))?S0(e[1],e[2]/100,e[3]/100,e[4]):y0.hasOwnProperty(n)?T0(y0[n]):n==="transparent"?new $t(NaN,NaN,NaN,0):null}function T0(n){return new $t(n>>16&255,n>>8&255,n&255,1)}function bc(n,e,t,i){return i<=0&&(n=e=t=NaN),new $t(n,e,t,i)}function KE(n){return n instanceof Yo||(n=zs(n)),n?(n=n.rgb(),new $t(n.r,n.g,n.b,n.opacity)):new $t}function Uo(n,e,t,i){return arguments.length===1?KE(n):new $t(n,e,t,i??1)}function $t(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}Jp($t,Uo,b1(Yo,{brighter(n){return n=n==null?tu:Math.pow(tu,n),new $t(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Do:Math.pow(Do,n),new $t(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new $t(ks(this.r),ks(this.g),ks(this.b),nu(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:x0,formatHex:x0,formatHex8:QE,formatRgb:w0,toString:w0}));function x0(){return`#${Ms(this.r)}${Ms(this.g)}${Ms(this.b)}`}function QE(){return`#${Ms(this.r)}${Ms(this.g)}${Ms(this.b)}${Ms((isNaN(this.opacity)?1:this.opacity)*255)}`}function w0(){const n=nu(this.opacity);return`${n===1?"rgb(":"rgba("}${ks(this.r)}, ${ks(this.g)}, ${ks(this.b)}${n===1?")":`, ${n})`}`}function nu(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function ks(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function Ms(n){return n=ks(n),(n<16?"0":"")+n.toString(16)}function S0(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Mn(n,e,t,i)}function v1(n){if(n instanceof Mn)return new Mn(n.h,n.s,n.l,n.opacity);if(n instanceof Yo||(n=zs(n)),!n)return new Mn;if(n instanceof Mn)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,s=Math.min(e,t,i),a=Math.max(e,t,i),l=NaN,u=a-s,h=(a+s)/2;return u?(e===a?l=(t-i)/u+(t<i)*6:t===a?l=(i-e)/u+2:l=(e-t)/u+4,u/=h<.5?a+s:2-a-s,l*=60):u=h>0&&h<1?0:l,new Mn(l,u,h,n.opacity)}function GE(n,e,t,i){return arguments.length===1?v1(n):new Mn(n,e,t,i??1)}function Mn(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}Jp(Mn,GE,b1(Yo,{brighter(n){return n=n==null?tu:Math.pow(tu,n),new Mn(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Do:Math.pow(Do,n),new Mn(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,s=2*t-i;return new $t(bd(n>=240?n-240:n+120,s,i),bd(n,s,i),bd(n<120?n+240:n-120,s,i),this.opacity)},clamp(){return new Mn(A0(this.h),vc(this.s),vc(this.l),nu(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=nu(this.opacity);return`${n===1?"hsl(":"hsla("}${A0(this.h)}, ${vc(this.s)*100}%, ${vc(this.l)*100}%${n===1?")":`, ${n})`}`}}));function A0(n){return n=(n||0)%360,n<0?n+360:n}function vc(n){return Math.max(0,Math.min(1,n||0))}function bd(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}function JE(n,e,t,i,s){var a=n*n,l=a*n;return((1-3*n+3*a-l)*e+(4-6*a+3*l)*t+(1+3*n+3*a-3*l)*i+l*s)/6}function eR(n){var e=n.length-1;return function(t){var i=t<=0?t=0:t>=1?(t=1,e-1):Math.floor(t*e),s=n[i],a=n[i+1],l=i>0?n[i-1]:2*s-a,u=i<e-1?n[i+2]:2*a-s;return JE((t-i/e)*e,l,s,a,u)}}const eg=n=>()=>n;function tR(n,e){return function(t){return n+t*e}}function nR(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function iR(n){return(n=+n)==1?T1:function(e,t){return t-e?nR(e,t,n):eg(isNaN(e)?t:e)}}function T1(n,e){var t=e-n;return t?tR(n,t):eg(isNaN(n)?e:n)}const iu=(function n(e){var t=iR(e);function i(s,a){var l=t((s=Uo(s)).r,(a=Uo(a)).r),u=t(s.g,a.g),h=t(s.b,a.b),d=T1(s.opacity,a.opacity);return function(p){return s.r=l(p),s.g=u(p),s.b=h(p),s.opacity=d(p),s+""}}return i.gamma=n,i})(1);function sR(n){return function(e){var t=e.length,i=new Array(t),s=new Array(t),a=new Array(t),l,u;for(l=0;l<t;++l)u=Uo(e[l]),i[l]=u.r||0,s[l]=u.g||0,a[l]=u.b||0;return i=n(i),s=n(s),a=n(a),u.opacity=1,function(h){return u.r=i(h),u.g=s(h),u.b=a(h),u+""}}}var rR=sR(eR);function aR(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,i=e.slice(),s;return function(a){for(s=0;s<t;++s)i[s]=n[s]*(1-a)+e[s]*a;return i}}function oR(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function lR(n,e){var t=e?e.length:0,i=n?Math.min(t,n.length):0,s=new Array(i),a=new Array(t),l;for(l=0;l<i;++l)s[l]=tg(n[l],e[l]);for(;l<t;++l)a[l]=e[l];return function(u){for(l=0;l<i;++l)a[l]=s[l](u);return a}}function cR(n,e){var t=new Date;return n=+n,e=+e,function(i){return t.setTime(n*(1-i)+e*i),t}}function Hn(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function uR(n,e){var t={},i={},s;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in n?t[s]=tg(n[s],e[s]):i[s]=e[s];return function(a){for(s in t)i[s]=t[s](a);return i}}var ap=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,vd=new RegExp(ap.source,"g");function fR(n){return function(){return n}}function hR(n){return function(e){return n(e)+""}}function x1(n,e){var t=ap.lastIndex=vd.lastIndex=0,i,s,a,l=-1,u=[],h=[];for(n=n+"",e=e+"";(i=ap.exec(n))&&(s=vd.exec(e));)(a=s.index)>t&&(a=e.slice(t,a),u[l]?u[l]+=a:u[++l]=a),(i=i[0])===(s=s[0])?u[l]?u[l]+=s:u[++l]=s:(u[++l]=null,h.push({i:l,x:Hn(i,s)})),t=vd.lastIndex;return t<e.length&&(a=e.slice(t),u[l]?u[l]+=a:u[++l]=a),u.length<2?h[0]?hR(h[0].x):fR(e):(e=h.length,function(d){for(var p=0,m;p<e;++p)u[(m=h[p]).i]=m.x(d);return u.join("")})}function tg(n,e){var t=typeof e,i;return e==null||t==="boolean"?eg(e):(t==="number"?Hn:t==="string"?(i=zs(e))?(e=i,iu):x1:e instanceof zs?iu:e instanceof Date?cR:oR(e)?aR:Array.isArray(e)?lR:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?uR:Hn)(n,e)}function dR(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}var E0=180/Math.PI,op={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function w1(n,e,t,i,s,a){var l,u,h;return(l=Math.sqrt(n*n+e*e))&&(n/=l,e/=l),(h=n*t+e*i)&&(t-=n*h,i-=e*h),(u=Math.sqrt(t*t+i*i))&&(t/=u,i/=u,h/=u),n*i<e*t&&(n=-n,e=-e,h=-h,l=-l),{translateX:s,translateY:a,rotate:Math.atan2(e,n)*E0,skewX:Math.atan(h)*E0,scaleX:l,scaleY:u}}var Tc;function pR(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?op:w1(e.a,e.b,e.c,e.d,e.e,e.f)}function gR(n){return n==null||(Tc||(Tc=document.createElementNS("http://www.w3.org/2000/svg","g")),Tc.setAttribute("transform",n),!(n=Tc.transform.baseVal.consolidate()))?op:(n=n.matrix,w1(n.a,n.b,n.c,n.d,n.e,n.f))}function S1(n,e,t,i){function s(d){return d.length?d.pop()+" ":""}function a(d,p,m,y,v,x){if(d!==m||p!==y){var A=v.push("translate(",null,e,null,t);x.push({i:A-4,x:Hn(d,m)},{i:A-2,x:Hn(p,y)})}else(m||y)&&v.push("translate("+m+e+y+t)}function l(d,p,m,y){d!==p?(d-p>180?p+=360:p-d>180&&(d+=360),y.push({i:m.push(s(m)+"rotate(",null,i)-2,x:Hn(d,p)})):p&&m.push(s(m)+"rotate("+p+i)}function u(d,p,m,y){d!==p?y.push({i:m.push(s(m)+"skewX(",null,i)-2,x:Hn(d,p)}):p&&m.push(s(m)+"skewX("+p+i)}function h(d,p,m,y,v,x){if(d!==m||p!==y){var A=v.push(s(v)+"scale(",null,",",null,")");x.push({i:A-4,x:Hn(d,m)},{i:A-2,x:Hn(p,y)})}else(m!==1||y!==1)&&v.push(s(v)+"scale("+m+","+y+")")}return function(d,p){var m=[],y=[];return d=n(d),p=n(p),a(d.translateX,d.translateY,p.translateX,p.translateY,m,y),l(d.rotate,p.rotate,m,y),u(d.skewX,p.skewX,m,y),h(d.scaleX,d.scaleY,p.scaleX,p.scaleY,m,y),d=p=null,function(v){for(var x=-1,A=y.length,E;++x<A;)m[(E=y[x]).i]=E.x(v);return m.join("")}}}var _R=S1(pR,"px, ","px)","deg)"),mR=S1(gR,", ",")",")"),na=0,yo=0,ho=0,A1=1e3,su,bo,ru=0,Vs=0,Iu=0,Fo=typeof performance=="object"&&performance.now?performance:Date,E1=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function ng(){return Vs||(E1(yR),Vs=Fo.now()+Iu)}function yR(){Vs=0}function au(){this._call=this._time=this._next=null}au.prototype=R1.prototype={constructor:au,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?ng():+t)+(e==null?0:+e),!this._next&&bo!==this&&(bo?bo._next=this:su=this,bo=this),this._call=n,this._time=t,lp()},stop:function(){this._call&&(this._call=null,this._time=1/0,lp())}};function R1(n,e,t){var i=new au;return i.restart(n,e,t),i}function bR(){ng(),++na;for(var n=su,e;n;)(e=Vs-n._time)>=0&&n._call.call(void 0,e),n=n._next;--na}function R0(){Vs=(ru=Fo.now())+Iu,na=yo=0;try{bR()}finally{na=0,TR(),Vs=0}}function vR(){var n=Fo.now(),e=n-ru;e>A1&&(Iu-=e,ru=n)}function TR(){for(var n,e=su,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:su=t);bo=n,lp(i)}function lp(n){if(!na){yo&&(yo=clearTimeout(yo));var e=n-Vs;e>24?(n<1/0&&(yo=setTimeout(R0,n-Fo.now()-Iu)),ho&&(ho=clearInterval(ho))):(ho||(ru=Fo.now(),ho=setInterval(vR,A1)),na=1,E1(R0))}}function C0(n,e,t){var i=new au;return e=e==null?0:+e,i.restart(s=>{i.stop(),n(s+e)},e,t),i}var xR=o1("start","end","cancel","interrupt"),wR=[],C1=0,M0=1,cp=2,Vc=3,O0=4,up=5,Hc=6;function Nu(n,e,t,i,s,a){var l=n.__transition;if(!l)n.__transition={};else if(t in l)return;SR(n,t,{name:e,index:i,group:s,on:xR,tween:wR,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:C1})}function ig(n,e){var t=kn(n,e);if(t.state>C1)throw new Error("too late; already scheduled");return t}function Yn(n,e){var t=kn(n,e);if(t.state>Vc)throw new Error("too late; already running");return t}function kn(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function SR(n,e,t){var i=n.__transition,s;i[e]=t,t.timer=R1(a,0,t.time);function a(d){t.state=M0,t.timer.restart(l,t.delay,t.time),t.delay<=d&&l(d-t.delay)}function l(d){var p,m,y,v;if(t.state!==M0)return h();for(p in i)if(v=i[p],v.name===t.name){if(v.state===Vc)return C0(l);v.state===O0?(v.state=Hc,v.timer.stop(),v.on.call("interrupt",n,n.__data__,v.index,v.group),delete i[p]):+p<e&&(v.state=Hc,v.timer.stop(),v.on.call("cancel",n,n.__data__,v.index,v.group),delete i[p])}if(C0(function(){t.state===Vc&&(t.state=O0,t.timer.restart(u,t.delay,t.time),u(d))}),t.state=cp,t.on.call("start",n,n.__data__,t.index,t.group),t.state===cp){for(t.state=Vc,s=new Array(y=t.tween.length),p=0,m=-1;p<y;++p)(v=t.tween[p].value.call(n,n.__data__,t.index,t.group))&&(s[++m]=v);s.length=m+1}}function u(d){for(var p=d<t.duration?t.ease.call(null,d/t.duration):(t.timer.restart(h),t.state=up,1),m=-1,y=s.length;++m<y;)s[m].call(n,p);t.state===up&&(t.on.call("end",n,n.__data__,t.index,t.group),h())}function h(){t.state=Hc,t.timer.stop(),delete i[e];for(var d in i)return;delete n.__transition}}function AR(n,e){var t=n.__transition,i,s,a=!0,l;if(t){e=e==null?null:e+"";for(l in t){if((i=t[l]).name!==e){a=!1;continue}s=i.state>cp&&i.state<up,i.state=Hc,i.timer.stop(),i.on.call(s?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete t[l]}a&&delete n.__transition}}function ER(n){return this.each(function(){AR(this,n)})}function RR(n,e){var t,i;return function(){var s=Yn(this,n),a=s.tween;if(a!==t){i=t=a;for(var l=0,u=i.length;l<u;++l)if(i[l].name===e){i=i.slice(),i.splice(l,1);break}}s.tween=i}}function CR(n,e,t){var i,s;if(typeof t!="function")throw new Error;return function(){var a=Yn(this,n),l=a.tween;if(l!==i){s=(i=l).slice();for(var u={name:e,value:t},h=0,d=s.length;h<d;++h)if(s[h].name===e){s[h]=u;break}h===d&&s.push(u)}a.tween=s}}function MR(n,e){var t=this._id;if(n+="",arguments.length<2){for(var i=kn(this.node(),t).tween,s=0,a=i.length,l;s<a;++s)if((l=i[s]).name===n)return l.value;return null}return this.each((e==null?RR:CR)(t,n,e))}function sg(n,e,t){var i=n._id;return n.each(function(){var s=Yn(this,i);(s.value||(s.value={}))[e]=t.apply(this,arguments)}),function(s){return kn(s,i).value[e]}}function M1(n,e){var t;return(typeof e=="number"?Hn:e instanceof zs?iu:(t=zs(e))?(e=t,iu):x1)(n,e)}function OR(n){return function(){this.removeAttribute(n)}}function IR(n){return function(){this.removeAttributeNS(n.space,n.local)}}function NR(n,e,t){var i,s=t+"",a;return function(){var l=this.getAttribute(n);return l===s?null:l===i?a:a=e(i=l,t)}}function kR(n,e,t){var i,s=t+"",a;return function(){var l=this.getAttributeNS(n.space,n.local);return l===s?null:l===i?a:a=e(i=l,t)}}function PR(n,e,t){var i,s,a;return function(){var l,u=t(this),h;return u==null?void this.removeAttribute(n):(l=this.getAttribute(n),h=u+"",l===h?null:l===i&&h===s?a:(s=h,a=e(i=l,u)))}}function DR(n,e,t){var i,s,a;return function(){var l,u=t(this),h;return u==null?void this.removeAttributeNS(n.space,n.local):(l=this.getAttributeNS(n.space,n.local),h=u+"",l===h?null:l===i&&h===s?a:(s=h,a=e(i=l,u)))}}function BR(n,e){var t=Ou(n),i=t==="transform"?mR:M1;return this.attrTween(n,typeof e=="function"?(t.local?DR:PR)(t,i,sg(this,"attr."+n,e)):e==null?(t.local?IR:OR)(t):(t.local?kR:NR)(t,i,e))}function UR(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function FR(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function LR(n,e){var t,i;function s(){var a=e.apply(this,arguments);return a!==i&&(t=(i=a)&&FR(n,a)),t}return s._value=e,s}function zR(n,e){var t,i;function s(){var a=e.apply(this,arguments);return a!==i&&(t=(i=a)&&UR(n,a)),t}return s._value=e,s}function VR(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=Ou(n);return this.tween(t,(i.local?LR:zR)(i,e))}function HR(n,e){return function(){ig(this,n).delay=+e.apply(this,arguments)}}function jR(n,e){return e=+e,function(){ig(this,n).delay=e}}function $R(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?HR:jR)(e,n)):kn(this.node(),e).delay}function WR(n,e){return function(){Yn(this,n).duration=+e.apply(this,arguments)}}function XR(n,e){return e=+e,function(){Yn(this,n).duration=e}}function YR(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?WR:XR)(e,n)):kn(this.node(),e).duration}function qR(n,e){if(typeof e!="function")throw new Error;return function(){Yn(this,n).ease=e}}function ZR(n){var e=this._id;return arguments.length?this.each(qR(e,n)):kn(this.node(),e).ease}function KR(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Yn(this,n).ease=t}}function QR(n){if(typeof n!="function")throw new Error;return this.each(KR(this._id,n))}function GR(n){typeof n!="function"&&(n=u1(n));for(var e=this._groups,t=e.length,i=new Array(t),s=0;s<t;++s)for(var a=e[s],l=a.length,u=i[s]=[],h,d=0;d<l;++d)(h=a[d])&&n.call(h,h.__data__,d,a)&&u.push(h);return new vi(i,this._parents,this._name,this._id)}function JR(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,i=e.length,s=t.length,a=Math.min(i,s),l=new Array(i),u=0;u<a;++u)for(var h=e[u],d=t[u],p=h.length,m=l[u]=new Array(p),y,v=0;v<p;++v)(y=h[v]||d[v])&&(m[v]=y);for(;u<i;++u)l[u]=e[u];return new vi(l,this._parents,this._name,this._id)}function eC(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function tC(n,e,t){var i,s,a=eC(e)?ig:Yn;return function(){var l=a(this,n),u=l.on;u!==i&&(s=(i=u).copy()).on(e,t),l.on=s}}function nC(n,e){var t=this._id;return arguments.length<2?kn(this.node(),t).on.on(n):this.each(tC(t,n,e))}function iC(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function sC(){return this.on("end.remove",iC(this._id))}function rC(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Qp(n));for(var i=this._groups,s=i.length,a=new Array(s),l=0;l<s;++l)for(var u=i[l],h=u.length,d=a[l]=new Array(h),p,m,y=0;y<h;++y)(p=u[y])&&(m=n.call(p,p.__data__,y,u))&&("__data__"in p&&(m.__data__=p.__data__),d[y]=m,Nu(d[y],e,t,y,d,kn(p,t)));return new vi(a,this._parents,e,t)}function aC(n){var e=this._name,t=this._id;typeof n!="function"&&(n=c1(n));for(var i=this._groups,s=i.length,a=[],l=[],u=0;u<s;++u)for(var h=i[u],d=h.length,p,m=0;m<d;++m)if(p=h[m]){for(var y=n.call(p,p.__data__,m,h),v,x=kn(p,t),A=0,E=y.length;A<E;++A)(v=y[A])&&Nu(v,e,t,A,y,x);a.push(y),l.push(p)}return new vi(a,l,e,t)}var oC=Xo.prototype.constructor;function lC(){return new oC(this._groups,this._parents)}function cC(n,e){var t,i,s;return function(){var a=ta(this,n),l=(this.style.removeProperty(n),ta(this,n));return a===l?null:a===t&&l===i?s:s=e(t=a,i=l)}}function O1(n){return function(){this.style.removeProperty(n)}}function uC(n,e,t){var i,s=t+"",a;return function(){var l=ta(this,n);return l===s?null:l===i?a:a=e(i=l,t)}}function fC(n,e,t){var i,s,a;return function(){var l=ta(this,n),u=t(this),h=u+"";return u==null&&(h=u=(this.style.removeProperty(n),ta(this,n))),l===h?null:l===i&&h===s?a:(s=h,a=e(i=l,u))}}function hC(n,e){var t,i,s,a="style."+e,l="end."+a,u;return function(){var h=Yn(this,n),d=h.on,p=h.value[a]==null?u||(u=O1(e)):void 0;(d!==t||s!==p)&&(i=(t=d).copy()).on(l,s=p),h.on=i}}function dC(n,e,t){var i=(n+="")=="transform"?_R:M1;return e==null?this.styleTween(n,cC(n,i)).on("end.style."+n,O1(n)):typeof e=="function"?this.styleTween(n,fC(n,i,sg(this,"style."+n,e))).each(hC(this._id,n)):this.styleTween(n,uC(n,i,e),t).on("end.style."+n,null)}function pC(n,e,t){return function(i){this.style.setProperty(n,e.call(this,i),t)}}function gC(n,e,t){var i,s;function a(){var l=e.apply(this,arguments);return l!==s&&(i=(s=l)&&pC(n,l,t)),i}return a._value=e,a}function _C(n,e,t){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,gC(n,e,t??""))}function mC(n){return function(){this.textContent=n}}function yC(n){return function(){var e=n(this);this.textContent=e??""}}function bC(n){return this.tween("text",typeof n=="function"?yC(sg(this,"text",n)):mC(n==null?"":n+""))}function vC(n){return function(e){this.textContent=n.call(this,e)}}function TC(n){var e,t;function i(){var s=n.apply(this,arguments);return s!==t&&(e=(t=s)&&vC(s)),e}return i._value=n,i}function xC(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,TC(n))}function wC(){for(var n=this._name,e=this._id,t=I1(),i=this._groups,s=i.length,a=0;a<s;++a)for(var l=i[a],u=l.length,h,d=0;d<u;++d)if(h=l[d]){var p=kn(h,e);Nu(h,n,t,d,l,{time:p.time+p.delay+p.duration,delay:0,duration:p.duration,ease:p.ease})}return new vi(i,this._parents,n,t)}function SC(){var n,e,t=this,i=t._id,s=t.size();return new Promise(function(a,l){var u={value:l},h={value:function(){--s===0&&a()}};t.each(function(){var d=Yn(this,i),p=d.on;p!==n&&(e=(n=p).copy(),e._.cancel.push(u),e._.interrupt.push(u),e._.end.push(h)),d.on=e}),s===0&&a()})}var AC=0;function vi(n,e,t,i){this._groups=n,this._parents=e,this._name=t,this._id=i}function I1(){return++AC}var pi=Xo.prototype;vi.prototype={constructor:vi,select:rC,selectAll:aC,selectChild:pi.selectChild,selectChildren:pi.selectChildren,filter:GR,merge:JR,selection:lC,transition:wC,call:pi.call,nodes:pi.nodes,node:pi.node,size:pi.size,empty:pi.empty,each:pi.each,on:nC,attr:BR,attrTween:VR,style:dC,styleTween:_C,text:bC,textTween:xC,remove:sC,tween:MR,delay:$R,duration:YR,ease:ZR,easeVarying:QR,end:SC,[Symbol.iterator]:pi[Symbol.iterator]};function EC(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var RC={time:null,delay:0,duration:250,ease:EC};function CC(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function MC(n){var e,t;n instanceof vi?(e=n._id,n=n._name):(e=I1(),(t=RC).time=ng(),n=n==null?null:n+"");for(var i=this._groups,s=i.length,a=0;a<s;++a)for(var l=i[a],u=l.length,h,d=0;d<u;++d)(h=l[d])&&Nu(h,n,e,d,l,t||CC(h,e));return new vi(i,this._parents,n,e)}Xo.prototype.interrupt=ER;Xo.prototype.transition=MC;function OC(n){if(!n.ok)throw new Error(n.status+" "+n.statusText);if(!(n.status===204||n.status===205))return n.json()}function IC(n,e){return fetch(n,e).then(OC)}function NC(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function ou(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,i=n.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+n.slice(t+1)]}function ia(n){return n=ou(Math.abs(n)),n?n[1]:NaN}function kC(n,e){return function(t,i){for(var s=t.length,a=[],l=0,u=n[0],h=0;s>0&&u>0&&(h+u+1>i&&(u=Math.max(1,i-h)),a.push(t.substring(s-=u,s+u)),!((h+=u+1)>i));)u=n[l=(l+1)%n.length];return a.reverse().join(e)}}function PC(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var DC=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function lu(n){if(!(e=DC.exec(n)))throw new Error("invalid format: "+n);var e;return new rg({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}lu.prototype=rg.prototype;function rg(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}rg.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function BC(n){e:for(var e=n.length,t=1,i=-1,s;t<e;++t)switch(n[t]){case".":i=s=t;break;case"0":i===0&&(i=t),s=t;break;default:if(!+n[t])break e;i>0&&(i=0);break}return i>0?n.slice(0,i)+n.slice(s+1):n}var N1;function UC(n,e){var t=ou(n,e);if(!t)return n+"";var i=t[0],s=t[1],a=s-(N1=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,l=i.length;return a===l?i:a>l?i+new Array(a-l+1).join("0"):a>0?i.slice(0,a)+"."+i.slice(a):"0."+new Array(1-a).join("0")+ou(n,Math.max(0,e+a-1))[0]}function I0(n,e){var t=ou(n,e);if(!t)return n+"";var i=t[0],s=t[1];return s<0?"0."+new Array(-s).join("0")+i:i.length>s+1?i.slice(0,s+1)+"."+i.slice(s+1):i+new Array(s-i.length+2).join("0")}const N0={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:NC,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>I0(n*100,e),r:I0,s:UC,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function k0(n){return n}var P0=Array.prototype.map,D0=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function FC(n){var e=n.grouping===void 0||n.thousands===void 0?k0:kC(P0.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",i=n.currency===void 0?"":n.currency[1]+"",s=n.decimal===void 0?".":n.decimal+"",a=n.numerals===void 0?k0:PC(P0.call(n.numerals,String)),l=n.percent===void 0?"%":n.percent+"",u=n.minus===void 0?"":n.minus+"",h=n.nan===void 0?"NaN":n.nan+"";function d(m){m=lu(m);var y=m.fill,v=m.align,x=m.sign,A=m.symbol,E=m.zero,C=m.width,D=m.comma,M=m.precision,B=m.trim,z=m.type;z==="n"?(D=!0,z="g"):N0[z]||(M===void 0&&(M=12),B=!0,z="g"),(E||y==="0"&&v==="=")&&(E=!0,y="0",v="=");var X=A==="$"?t:A==="#"&&/[boxX]/.test(z)?"0"+z.toLowerCase():"",ne=A==="$"?i:/[%p]/.test(z)?l:"",ae=N0[z],ie=/[defgprs%]/.test(z);M=M===void 0?6:/[gprs]/.test(z)?Math.max(1,Math.min(21,M)):Math.max(0,Math.min(20,M));function ge(ee){var fe=X,we=ne,me,He,W;if(z==="c")we=ae(ee)+we,ee="";else{ee=+ee;var se=ee<0||1/ee<0;if(ee=isNaN(ee)?h:ae(Math.abs(ee),M),B&&(ee=BC(ee)),se&&+ee==0&&x!=="+"&&(se=!1),fe=(se?x==="("?x:u:x==="-"||x==="("?"":x)+fe,we=(z==="s"?D0[8+N1/3]:"")+we+(se&&x==="("?")":""),ie){for(me=-1,He=ee.length;++me<He;)if(W=ee.charCodeAt(me),48>W||W>57){we=(W===46?s+ee.slice(me+1):ee.slice(me))+we,ee=ee.slice(0,me);break}}}D&&!E&&(ee=e(ee,1/0));var de=fe.length+ee.length+we.length,Ee=de<C?new Array(C-de+1).join(y):"";switch(D&&E&&(ee=e(Ee+ee,Ee.length?C-we.length:1/0),Ee=""),v){case"<":ee=fe+ee+we+Ee;break;case"=":ee=fe+Ee+ee+we;break;case"^":ee=Ee.slice(0,de=Ee.length>>1)+fe+ee+we+Ee.slice(de);break;default:ee=Ee+fe+ee+we;break}return a(ee)}return ge.toString=function(){return m+""},ge}function p(m,y){var v=d((m=lu(m),m.type="f",m)),x=Math.max(-8,Math.min(8,Math.floor(ia(y)/3)))*3,A=Math.pow(10,-x),E=D0[8+x/3];return function(C){return v(A*C)+E}}return{format:d,formatPrefix:p}}var xc,k1,P1;LC({thousands:",",grouping:[3],currency:["$",""]});function LC(n){return xc=FC(n),k1=xc.format,P1=xc.formatPrefix,xc}function zC(n){return Math.max(0,-ia(Math.abs(n)))}function VC(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ia(e)/3)))*3-ia(Math.abs(n)))}function HC(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,ia(e)-ia(n))+1}function jC(n,e){switch(arguments.length){case 0:break;case 1:{typeof n=="function"?this.interpolator(n):this.range(n);break}default:{this.domain(n),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function D1(n){return n}function $C(n,e,t,i){var s=sA(n,e,t),a;switch(i=lu(i??",f"),i.type){case"s":{var l=Math.max(Math.abs(n),Math.abs(e));return i.precision==null&&!isNaN(a=VC(s,l))&&(i.precision=a),P1(i,l)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(a=HC(s,Math.max(Math.abs(n),Math.abs(e))))&&(i.precision=a-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(a=zC(s))&&(i.precision=a-(i.type==="%")*2);break}}return k1(i)}function WC(n){var e=n.domain;return n.ticks=function(t){var i=e();return iA(i[0],i[i.length-1],t??10)},n.tickFormat=function(t,i){var s=e();return $C(s[0],s[s.length-1],t??10,i)},n.nice=function(t){t==null&&(t=10);var i=e(),s=0,a=i.length-1,l=i[s],u=i[a],h,d,p=10;for(u<l&&(d=l,l=u,u=d,d=s,s=a,a=d);p-- >0;){if(d=sp(l,u,t),d===h)return i[s]=l,i[a]=u,e(i);if(d>0)l=Math.floor(l/d)*d,u=Math.ceil(u/d)*d;else if(d<0)l=Math.ceil(l*d)/d,u=Math.floor(u*d)/d;else break;h=d}return n},n}function XC(){var n=0,e=1,t,i,s,a,l=D1,u=!1,h;function d(m){return m==null||isNaN(m=+m)?h:l(s===0?.5:(m=(a(m)-t)*s,u?Math.max(0,Math.min(1,m)):m))}d.domain=function(m){return arguments.length?([n,e]=m,t=a(n=+n),i=a(e=+e),s=t===i?0:1/(i-t),d):[n,e]},d.clamp=function(m){return arguments.length?(u=!!m,d):u},d.interpolator=function(m){return arguments.length?(l=m,d):l};function p(m){return function(y){var v,x;return arguments.length?([v,x]=y,l=m(v,x),d):[l(0),l(1)]}}return d.range=p(tg),d.rangeRound=p(dR),d.unknown=function(m){return arguments.length?(h=m,d):h},function(m){return a=m,t=m(n),i=m(e),s=t===i?0:1/(i-t),d}}function YC(n,e){return e.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function B1(){var n=WC(XC()(D1));return n.copy=function(){return YC(n,B1())},jC.apply(n,arguments)}function qC(n){for(var e=n.length/6|0,t=new Array(e),i=0;i<e;)t[i]="#"+n.slice(i*6,++i*6);return t}const ZC=n=>rR(n[n.length-1]);var KC=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(qC);const QC=ZC(KC);function vo(n,e,t){this.k=n,this.x=e,this.y=t}vo.prototype={constructor:vo,scale:function(n){return n===1?this:new vo(this.k*n,this.x,this.y)},translate:function(n,e){return n===0&e===0?this:new vo(this.k,this.x+this.k*n,this.y+this.k*e)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};vo.prototype;function cu(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const ag=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),B0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);B0&&parseFloat(B0[1]);const U0=globalThis,F0=globalThis.process||{},GC=globalThis.navigator||{};function U1(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Zs(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||U1()}function JC(n){return Zs()?U1()?"Electron":(GC.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const F1="4.1.0";function eM(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class tM{constructor(e,t,i="sessionStorage"){this.storage=eM(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function nM(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function iM(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var uu;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(uu||(uu={}));const sM=10;function L0(n){return typeof n!="string"?n:(n=n.toUpperCase(),uu[n]||uu.WHITE)}function rM(n,e,t){return!Zs&&typeof n=="string"&&(e&&(n=`\x1B[${L0(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${L0(t)+sM}m${n}\x1B[49m`)),n}function aM(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),s=n;for(const a of i){const l=s[a];typeof l=="function"&&(e.find(u=>a===u)||(s[a]=l.bind(n)))}}function og(n,e){if(!n)throw new Error("Assertion failed")}function Ur(){let n;if(Zs()&&U0.performance)n=U0?.performance?.now?.();else if("hrtime"in F0){const e=F0?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const Fr={debug:Zs()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},oM={enabled:!0,level:0};function Lr(){}const z0={},V0={once:!0};class qo{constructor({id:e}={id:""}){this.VERSION=F1,this._startTs=Ur(),this._deltaTs=Ur(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new tM(`__probe-${this.id}__`,oM),this.timeStamp(`${this.id} started`),aM(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ur()-this._startTs).toPrecision(10))}getDelta(){return Number((Ur()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Fr.warn,arguments,V0)}error(e){return this._getLogFunction(0,e,Fr.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Fr.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Fr.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Fr.debug||Fr.info,arguments,V0)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Lr,i&&[i],{tag:cM(t)}):Lr}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Lr)}group(e,t,i={collapsed:!1}){const s=H0({logLevel:e,message:t,opts:i}),{collapsed:a}=i;return s.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Lr)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=L1(e)}_getLogFunction(e,t,i,s,a){if(this._shouldLog(e)){a=H0({logLevel:e,message:t,args:s,opts:a}),i=i||a.method,og(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=Ur();const l=a.tag||a.message;if(a.once&&l)if(!z0[l])z0[l]=Ur();else return Lr;return t=lM(this.id,a.message,a),i.bind(console,t,...a.args)}return Lr}}qo.VERSION=F1;function L1(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return og(Number.isFinite(e)&&e>=0),e}function H0(n){const{logLevel:e,message:t}=n;n.logLevel=L1(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return og(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function lM(n,e,t){if(typeof e=="string"){const i=t.time?iM(nM(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=rM(e,t.color,t.background)}return e}function cM(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Td="4.3.3",uM=Td[0]>="0"&&Td[0]<="9"?`v${Td}`:"";function fM(){const n=new qo({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=uM,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const hM=fM();function dM(n,e){return z1(n||{},e)}function z1(n,e,t=0){if(t>3)return e;const i={...n};for(const[s,a]of Object.entries(e))a&&typeof a=="object"&&!Array.isArray(a)?i[s]=z1(i[s]||{},e[s],t+1):i[s]=e[s];return i}const pM="latest";function gM(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const _M=gM();function is(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Ps=typeof process!="object"||String(process)!=="[object process]"||process.browser,mM=typeof window<"u"&&typeof window.orientation<"u",j0=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);j0&&parseFloat(j0[1]);class yM{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){is(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){is(this.isRunning),this.isRunning=!1,this._reject(e)}}class xd{terminate(){}}const wd=new Map;function bM(n){is(n.source&&!n.url||!n.source&&n.url);let e=wd.get(n.source||n.url);return e||(n.url&&(e=vM(n.url),wd.set(n.url,e)),n.source&&(e=V1(n.source),wd.set(n.source,e))),is(e),e}function vM(n){if(!n.startsWith("http"))return n;const e=TM(n);return V1(e)}function V1(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function TM(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function H1(n,e=!0,t){const i=t||new Set;if(n){if($0(n))i.add(n);else if($0(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)H1(n[s],e,i)}}return t===void 0?Array.from(i):[]}function $0(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const Sd=()=>{};class fp{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Ps||typeof xd<"u"&&!Ps}constructor(e){const{name:t,source:i,url:s}=e;is(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=Sd,this.onError=a=>console.log(a),this.worker=Ps?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Sd,this.onError=Sd,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||H1(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=bM({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new xd(i,{eval:!1})}else if(this.source)e=new xd(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class xM{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return fp.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,a,l)=>s.done(l),i=(s,a)=>s.error(a)){const s=new Promise(a=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:a}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new yM(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Ps||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new fp({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return mM?this.maxMobileConcurrency:this.maxConcurrency}}const wM={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Qi{props;workerPools=new Map;static _workerFarm;static isSupported(){return fp.isSupported()}static getWorkerFarm(e={}){return Qi._workerFarm=Qi._workerFarm||new Qi({}),Qi._workerFarm.setProps(e),Qi._workerFarm}constructor(e){this.props={...wM},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let a=this.workerPools.get(t);return a||(a=new xM({name:t,source:i,url:s}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,a)),a}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function SM(n,e={}){const t=e[n.id]||{},i=Ps?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Ps?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let a=n.version;a==="latest"&&(a=pM);const l=a?`@${a}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${i}`}return is(s),s}function AM(n,e=_M){is(n,"no worker provided");const t=n.version;return!(!e||!t)}function EM(n,e){return!Qi.isSupported()||!Ps&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function RM(n,e,t,i,s){const a=n.id,l=SM(n,t),h=Qi.getWorkerFarm(t).getWorkerPool({name:a,url:l});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const d=await h.startJob("process-on-worker",CM.bind(null,s));return d.postMessage("process",{input:e,options:t,context:i}),await(await d.result).result}async function CM(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:a,options:l}=i;try{const u=await n(a,l);e.postMessage("done",{id:s,result:u})}catch(u){const h=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:s,error:h})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function MM(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let a=0;a<i.length;++a)if(i[a]!==s[a])return!1;return!0}function OM(...n){return IM(n)}function IM(n){const e=n.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),t=e.reduce((a,l)=>a+l.byteLength,0),i=new Uint8Array(t);let s=0;for(const a of e)i.set(a,s),s+=a.byteLength;return i.buffer}async function NM(n){const e=[];for await(const t of n)e.push(t);return OM(...e)}function W0(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class X0{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=W0(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(W0()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class ku{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let s=this.stats[t];return s||(e instanceof X0?s=e:s=new X0(t,i),this.stats[t]=s),s}}let kM="";const Y0={};function PM(n){for(const e in Y0)if(n.startsWith(e)){const t=Y0[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${kM}${n}`),n}function DM(n){return n&&typeof n=="object"&&n.isBuffer}function j1(n){if(DM(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function $1(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function BM(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const UM=n=>typeof n=="boolean",Eo=n=>typeof n=="function",Zo=n=>n!==null&&typeof n=="object",q0=n=>Zo(n)&&n.constructor==={}.constructor,FM=n=>!!n&&typeof n[Symbol.iterator]=="function",LM=n=>n&&typeof n[Symbol.asyncIterator]=="function",Ks=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Qs=n=>typeof Blob<"u"&&n instanceof Blob,zM=n=>n&&typeof n=="object"&&n.isBuffer,VM=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||Zo(n)&&Eo(n.tee)&&Eo(n.cancel)&&Eo(n.getReader),HM=n=>Zo(n)&&Eo(n.read)&&Eo(n.pipe)&&UM(n.readable),W1=n=>VM(n)||HM(n);class jM extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const $M=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,WM=/^([-\w.]+\/[-\w.+]+)/;function Z0(n,e){return n.toLowerCase()===e.toLowerCase()}function XM(n){const e=WM.exec(n);return e?e[1]:n}function K0(n){const e=$M.exec(n);return e?e[1]:""}const X1=/\?.*/;function YM(n){const e=n.match(X1);return e&&e[0]}function lg(n){return n.replace(X1,"")}function qM(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Pu(n){return Ks(n)?n.url:Qs(n)?n.name||"":typeof n=="string"?n:""}function cg(n){if(Ks(n)){const e=n,t=e.headers.get("content-type")||"",i=lg(e.url);return XM(t)||K0(i)}return Qs(n)?n.type||"":typeof n=="string"?K0(n):""}function ZM(n){return Ks(n)?n.headers["content-length"]||-1:Qs(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function Y1(n){if(Ks(n))return n;const e={},t=ZM(n);t>=0&&(e["content-length"]=String(t));const i=Pu(n),s=cg(n);s&&(e["content-type"]=s);const a=await GM(n);a&&(e["x-first-bytes"]=a),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:e});return Object.defineProperty(l,"url",{value:i}),l}async function KM(n){if(!n.ok)throw await QM(n)}async function QM(n){const e=qM(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&s?.includes("application/json")?await n.json():await n.text()}catch{}return new jM(t,i)}async function GM(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=a=>i(a?.target?.result),s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${JM(t)}`}return null}function JM(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function eO(n){return!tO(n)&&!nO(n)}function tO(n){return n.startsWith("http:")||n.startsWith("https:")}function nO(n){return n.startsWith("data:")}async function Q0(n,e){if(typeof n=="string"){const t=PM(n);return eO(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await Y1(n)}const G0=new qo({id:"loaders.gl"});class iO{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class sO{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const q1={fetch:null,mimeType:void 0,nothrow:!1,log:new sO,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:ag,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},rO={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Z1(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function K1(){const n=Z1();return n.globalOptions=n.globalOptions||{...q1},n.globalOptions}function aO(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],oO(n,t),cO(e,n,i)}function oO(n,e){J0(n,null,q1,rO,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},a=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};J0(i,t.id,s,a,e)}}function J0(n,e,t,i,s){const a=e||"Top level",l=e?`${e}.`:"";for(const u in n){const h=!e&&Zo(n[u]),d=u==="baseUri"&&!e,p=u==="workerUrl"&&e;if(!(u in t)&&!d&&!p){if(u in i)G0.warn(`${a} loader option '${l}${u}' no longer supported, use '${i[u]}'`)();else if(!h){const m=lO(u,s);G0.warn(`${a} loader option '${l}${u}' not recognized. ${m}`)()}}}}function lO(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const a in s.options){if(n===a)return`Did you mean '${s.id}.${a}'?`;const l=a.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(i=i||`Did you mean '${s.id}.${a}'?`)}return i}function cO(n,e,t){const s={...n.options||{}};return uO(s,t),s.log===null&&(s.log=new iO),ev(s,K1()),ev(s,e),s}function ev(n,e){for(const t in e)if(t in e){const i=e[t];q0(i)&&q0(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function uO(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function ug(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function fg(n){cu(n,"null loader"),cu(ug(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const Q1=()=>{const n=Z1();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function fO(n){const e=Q1();n=Array.isArray(n)?n:[n];for(const t of n){const i=fg(t);e.find(s=>i===s)||e.unshift(i)}}function hO(){return Q1()}const dO=/\.([^.]+)$/;async function pO(n,e=[],t,i){if(!G1(n))return null;let s=tv(n,e,{...t,nothrow:!0},i);if(s)return s;if(Qs(n)&&(n=await n.slice(0,10).arrayBuffer(),s=tv(n,e,t,i)),!s&&!t?.nothrow)throw new Error(J1(n));return s}function tv(n,e=[],t,i){if(!G1(n))return null;if(e&&!Array.isArray(e))return fg(e);let s=[];e&&(s=s.concat(e)),t?.ignoreRegisteredLoaders||s.push(...hO()),_O(s);const a=gO(n,s,t,i);if(!a&&!t?.nothrow)throw new Error(J1(n));return a}function gO(n,e,t,i){const s=Pu(n),a=cg(n),l=lg(s)||i?.url;let u=null,h="";return t?.mimeType&&(u=Ad(e,t?.mimeType),h=`match forced by supplied MIME type ${t?.mimeType}`),u=u||mO(e,l),h=h||(u?`matched url ${l}`:""),u=u||Ad(e,a),h=h||(u?`matched MIME type ${a}`:""),u=u||bO(e,n),h=h||(u?`matched initial data ${eT(n)}`:""),t?.fallbackMimeType&&(u=u||Ad(e,t?.fallbackMimeType),h=h||(u?`matched fallback MIME type ${a}`:"")),h&&hM.log(1,`selectLoader selected ${u?.name}: ${h}.`),u}function G1(n){return!(n instanceof Response&&n.status===204)}function J1(n){const e=Pu(n),t=cg(n);let i="No valid loader found (";i+=e?`${$1(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?eT(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function _O(n){for(const e of n)fg(e)}function mO(n,e){const t=e&&dO.exec(e),i=t&&t[1];return i?yO(n,i):null}function yO(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function Ad(n,e){for(const t of n)if(t.mimeTypes?.some(i=>Z0(e,i))||Z0(e,`application/x.${t.id}`))return t;return null}function bO(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(vO(e,t))return t}else if(ArrayBuffer.isView(e)){if(nv(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&nv(e,0,t))return t;return null}function vO(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function nv(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>TO(n,e,t,s))}function TO(n,e,t,i){if(i instanceof ArrayBuffer)return MM(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=hp(n,e,i.length);return i===s;default:return!1}}function eT(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?hp(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?hp(n,0,e):""}function hp(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let a=0;a<t;a++)s+=String.fromCharCode(i.getUint8(e+a));return s}const xO=256*1024;function*wO(n,e){const t=e?.chunkSize||xO;let i=0;const s=new TextEncoder;for(;i<n.length;){const a=Math.min(n.length-i,t),l=n.slice(i,i+a);i+=a,yield s.encode(l)}}const SO=256*1024;function*AO(n,e={}){const{chunkSize:t=SO}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),a=new ArrayBuffer(s),l=new Uint8Array(n,i,s);new Uint8Array(a).set(l),i+=s,yield a}}const EO=1024*1024;async function*RO(n,e){const t=e?.chunkSize||EO;let i=0;for(;i<n.size;){const s=i+t,a=await n.slice(i,s).arrayBuffer();i=s,yield a}}function iv(n,e){return ag?CO(n,e):MO(n)}async function*CO(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e?._streamReadAhead&&(i=t.read());const{done:a,value:l}=await s;if(a)return;yield j1(l)}}catch{t.releaseLock()}}async function*MO(n,e){for await(const t of n)yield j1(t)}function OO(n,e){if(typeof n=="string")return wO(n,e);if(n instanceof ArrayBuffer)return AO(n,e);if(Qs(n))return RO(n,e);if(W1(n))return iv(n,e);if(Ks(n))return iv(n.body,e);throw new Error("makeIterator")}const tT="Cannot convert supplied data type";function IO(n,e,t){if(e.text&&typeof n=="string")return n;if(zM(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(tT)}async function NO(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return IO(n,e);if(Qs(n)&&(n=await Y1(n)),Ks(n)){const s=n;return await KM(s),e.binary?await s.arrayBuffer():await s.text()}if(W1(n)&&(n=OO(n,t)),FM(n)||LM(n))return NM(n);throw new Error(tT)}function nT(n,e){const t=K1(),i=n||t;return typeof i.fetch=="function"?i.fetch:Zo(i.fetch)?s=>Q0(s,i.fetch):e?.fetch?e?.fetch:Q0}function kO(n,e,t){if(t)return t;const i={fetch:nT(e,n),...n};if(i.url){const s=lg(i.url);i.baseUrl=s,i.queryString=YM(i.url),i.filename=$1(s),i.baseUrl=BM(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function PO(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function fu(n,e,t,i){e&&!Array.isArray(e)&&!ug(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const s=Pu(n),l=PO(e,i),u=await pO(n,l,t);return u?(t=aO(t,u,l,s),i=kO({url:s,_parse:fu,loaders:l},t,i||null),await DO(u,n,t,i)):null}async function DO(n,e,t,i){if(AM(n),t=dM(n.options,t),Ks(e)){const a=e,{ok:l,redirected:u,status:h,statusText:d,type:p,url:m}=a,y=Object.fromEntries(a.headers.entries());i.response={headers:y,ok:l,redirected:u,status:h,statusText:d,type:p,url:m}}e=await NO(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,i);if(EM(n,t))return await RM(n,e,t,i,fu);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,i);if(s.parse)return await s.parse(e,t,i);throw is(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function dp(n,e,t,i){let s,a;!Array.isArray(e)&&!ug(e)?(s=[],a=e):(s=e,a=t);const l=nT(a);let u=n;return typeof n=="string"&&(u=await l(n)),Qs(n)&&(u=await l(n)),Array.isArray(s)?await fu(u,s,a):await fu(u,s,a)}const BO="4.3.3",UO=globalThis.loaders?.parseImageNode,pp=typeof Image<"u",gp=typeof ImageBitmap<"u",FO=!!UO,_p=ag?!0:FO;function LO(n){switch(n){case"auto":return gp||pp||_p;case"imagebitmap":return gp;case"image":return pp;case"data":return _p;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function zO(){if(gp)return"imagebitmap";if(pp)return"image";if(_p)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function VO(n){const e=jO(n);if(!e)throw new Error("Not an image");return e}function HO(n){switch(VO(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function jO(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const $O=/^data:image\/svg\+xml/,WO=/\.svg((\?|#).*)?$/;function hg(n){return n&&($O.test(n)||WO.test(n))}function XO(n,e){if(hg(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(a){throw new Error(a.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return iT(n,e)}function iT(n,e){if(hg(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function sT(n,e,t){const i=XO(n,t),s=self.URL||self.webkitURL,a=typeof i!="string"&&s.createObjectURL(i);try{return await YO(a||i,e)}finally{a&&s.revokeObjectURL(a)}}async function YO(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=a=>{const l=a instanceof Error?a.message:"error";s(new Error(l))}}catch(a){s(a)}})}const qO={};let sv=!0;async function ZO(n,e,t){let i;hg(t)?i=await sT(n,e,t):i=iT(n,t);const s=e&&e.imagebitmap;return await KO(i,s)}async function KO(n,e=null){if((QO(e)||!sv)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),sv=!1}return await createImageBitmap(n)}function QO(n){for(const e in n||qO)return!1;return!0}function GO(n){return!n4(n,"ftyp",4)||(n[8]&96)===0?null:JO(n)}function JO(n){switch(e4(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function e4(n,e,t){return String.fromCharCode(...n.slice(e,t))}function t4(n){return[...n].map(e=>e.charCodeAt(0))}function n4(n,e,t=0){const i=t4(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s+t])return!1;return!0}const jn=!1,Ro=!0;function rT(n){const e=Ko(n);return s4(e)||o4(e)||r4(e)||a4(e)||i4(e)}function i4(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=GO(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function s4(n){const e=Ko(n);return e.byteLength>=24&&e.getUint32(0,jn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,jn),height:e.getUint32(20,jn)}:null}function r4(n){const e=Ko(n);return e.byteLength>=10&&e.getUint32(0,jn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ro),height:e.getUint16(8,Ro)}:null}function a4(n){const e=Ko(n);return e.byteLength>=14&&e.getUint16(0,jn)===16973&&e.getUint32(2,Ro)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ro),height:e.getUint32(22,Ro)}:null}function o4(n){const e=Ko(n);if(!(e.byteLength>=3&&e.getUint16(0,jn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=l4();let a=2;for(;a+9<e.byteLength;){const l=e.getUint16(a,jn);if(s.has(l))return{mimeType:"image/jpeg",height:e.getUint16(a+5,jn),width:e.getUint16(a+7,jn)};if(!i.has(l))return null;a+=2,a+=e.getUint16(a,jn)}return null}function l4(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Ko(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function c4(n,e){const{mimeType:t}=rT(n)||{},i=globalThis.loaders?.parseImageNode;return cu(i),await i(n,t)}async function u4(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:a}=t||{},l=f4(s);let u;switch(l){case"imagebitmap":u=await ZO(n,e,a);break;case"image":u=await sT(n,e,a);break;case"data":u=await c4(n);break;default:cu(!1)}return s==="data"&&(u=HO(u)),u}function f4(n){switch(n){case"auto":case"data":return zO();default:return LO(n),n}}const h4=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],d4=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],p4={image:{type:"auto",decode:!0}},g4={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:BO,mimeTypes:d4,extensions:h4,parse:u4,tests:[n=>!!rT(new DataView(n))],options:p4},Ye=new qo({id:"deck"});let mp={};function _4(n){mp=n}function Bt(n,e,t,i){Ye.level>0&&mp[n]&&mp[n].call(null,e,t,i)}function m4(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const y4={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:m4,parseTextSync:JSON.parse};function b4(){const n="9.2.2",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(Ye.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Ye,_registerLoggers:_4},fO([y4,[g4,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const v4=b4();function dg(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const Ed={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function T4(n){const e={};for(const[t,i]of Object.entries(n))e[t]=x4(i);return e}function x4(n){let e=rv(n);if(e!=="object")return{value:n,...Ed[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...Ed[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=rv(n.value),{...n,...Ed[e],type:e}):{type:"object",value:null};throw new Error("props")}function rv(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const w4=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,S4=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,A4={vertex:w4,fragment:S4},av=/void\s+main\s*\([^)]*\)\s*\{\n?/,ov=/}\n?[^{}]*$/,Rd=[],jc="__LUMA_INJECT_DECLARATIONS__";function E4(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const s=R4(t);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function R4(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function hu(n,e,t,i=!1){const s=e==="vertex";for(const a in t){const l=t[a];l.sort((h,d)=>h.order-d.order),Rd.length=l.length;for(let h=0,d=l.length;h<d;++h)Rd[h]=l[h].injection;const u=`${Rd.join(`
`)}
`;switch(a){case"vs:#decl":s&&(n=n.replace(jc,u));break;case"vs:#main-start":s&&(n=n.replace(av,h=>h+u));break;case"vs:#main-end":s&&(n=n.replace(ov,h=>u+h));break;case"fs:#decl":s||(n=n.replace(jc,u));break;case"fs:#main-start":s||(n=n.replace(av,h=>h+u));break;case"fs:#main-end":s||(n=n.replace(ov,h=>u+h));break;default:n=n.replace(a,h=>h+u)}}return n=n.replace(jc,""),i&&(n=n.replace(/\}\s*$/,a=>a+A4[e])),n}function du(n){n.map(e=>C4(e))}function C4(n){if(n.instance)return;du(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,s={normalizedInjections:E4(i),parsedDeprecations:M4(t)};e&&(s.propValidators=T4(e)),n.instance=s;let a={};e&&(a=Object.entries(e).reduce((l,[u,h])=>{const d=h?.value;return d&&(l[u]=d),l},{})),n.defaultUniforms={...n.defaultUniforms,...a}}function aT(n,e,t){n.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function M4(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function pg(n){du(n);const e={},t={};oT({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((s,a)=>t[a]-t[s]).map(s=>e[s]);return du(i),i}function oT(n){const{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const a of e)i[a.name]=a,(s[a.name]===void 0||s[a.name]<t)&&(s[a.name]=t);for(const a of e)a.dependencies&&oT({modules:a.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function O4(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function I4(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=lv(n,N4),n;case"fragment":return n=lv(n,k4),n;default:throw new Error(e)}}const lT=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],N4=[...lT,[yp("attribute"),"in $1"],[yp("varying"),"out $1"]],k4=[...lT,[yp("varying"),"in $1"]];function lv(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function yp(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function cT(n,e){let t="";for(const i in n){const s=n[i];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[i]){const a=e[i];a.sort((l,u)=>l.order-u.order);for(const l of a)t+=`  ${l.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function uT(n){const e={vertex:{},fragment:{}};for(const t of n){let i,s;typeof t!="string"?(i=t,s=i.hook):(i={},s=t),s=s.trim();const[a,l]=s.split(":"),u=s.replace(/\(.+/,""),h=Object.assign(i,{signature:l});switch(a){case"vs":e.vertex[u]=h;break;case"fs":e.fragment[u]=h;break;default:throw new Error(a)}}return e}function P4(n,e){return{name:D4(n,e),language:"glsl",version:B4(n)}}function D4(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function B4(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const fT=`

${jc}
`,U4=`precision highp float;
`;function F4(n){const e=pg(n.modules||[]);return{source:z4(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:hT(e)}}function L4(n){const{vs:e,fs:t}=n,i=pg(n.modules||[]);return{vs:cv(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:cv(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:hT(i)}}function z4(n,e){const{source:t,stage:i,modules:s,hookFunctions:a=[],inject:l={},log:u}=e;dg(typeof t=="string","shader source must be a string");const h=t;let d="";const p=uT(a),m={},y={},v={};for(const A in l){const E=typeof l[A]=="string"?{injection:l[A],order:0}:l[A],C=/^(v|f)s:(#)?([\w-]+)$/.exec(A);if(C){const D=C[2],M=C[3];D?M==="decl"?y[A]=[E]:v[A]=[E]:m[A]=[E]}else v[A]=[E]}const x=s;for(const A of x){u&&aT(A,h,u);const E=dT(A,"wgsl");d+=E;const C=A.injections?.[i]||{};for(const D in C){const M=/^(v|f)s:#([\w-]+)$/.exec(D);if(M){const z=M[2]==="decl"?y:v;z[D]=z[D]||[],z[D].push(C[D])}else m[D]=m[D]||[],m[D].push(C[D])}}return d+=fT,d=hu(d,i,y),d+=cT(p[i],m),d+=h,d=hu(d,i,v),d}function cv(n,e){const{source:t,stage:i,language:s="glsl",modules:a,defines:l={},hookFunctions:u=[],inject:h={},prologue:d=!0,log:p}=e;dg(typeof t=="string","shader source must be a string");const m=s==="glsl"?P4(t).version:-1,y=n.shaderLanguageVersion,v=m===100?"#version 100":"#version 300 es",A=t.split(`
`).slice(1).join(`
`),E={};a.forEach(X=>{Object.assign(E,X.defines)}),Object.assign(E,l);let C="";switch(s){case"wgsl":break;case"glsl":C=d?`${v}

// ----- PROLOGUE -------------------------
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${O4(n)}
${i==="fragment"?U4:""}

// ----- APPLICATION DEFINES -------------------------

${V4(E)}

`:`${v}
`;break}const D=uT(u),M={},B={},z={};for(const X in h){const ne=typeof h[X]=="string"?{injection:h[X],order:0}:h[X],ae=/^(v|f)s:(#)?([\w-]+)$/.exec(X);if(ae){const ie=ae[2],ge=ae[3];ie?ge==="decl"?B[X]=[ne]:z[X]=[ne]:M[X]=[ne]}else z[X]=[ne]}for(const X of a){p&&aT(X,A,p);const ne=dT(X,i);C+=ne;const ae=X.instance?.normalizedInjections[i]||{};for(const ie in ae){const ge=/^(v|f)s:#([\w-]+)$/.exec(ie);if(ge){const fe=ge[2]==="decl"?B:z;fe[ie]=fe[ie]||[],fe[ie].push(ae[ie])}else M[ie]=M[ie]||[],M[ie].push(ae[ie])}}return C+="// ----- MAIN SHADER SOURCE -------------------------",C+=fT,C=hu(C,i,B),C+=cT(D[i],M),C+=A,C=hu(C,i,z),s==="glsl"&&m!==y&&(C=I4(C,i)),C.trim()}function hT(n){return function(t){const i={};for(const s of n){const a=s.getUniforms?.(t,i);Object.assign(i,a)}return i}}function V4(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function dT(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:dg(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${t}
`,s}const H4=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,j4=/^\s*\#\s*endif\s*$/;function $4(n,e){const t=n.split(`
`),i=[];let s=!0,a=null;for(const l of t){const u=l.match(H4),h=l.match(j4);u?(a=u[1],s=!!e?.defines?.[a]):h?s=!0:s&&i.push(l)}return i.join(`
`)}class Os{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Os.defaultShaderAssembler=Os.defaultShaderAssembler||new Os,Os.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:s,getUniforms:a}=F4({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?$4(s):s,getUniforms:a,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...L4({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let a=0,l=this._defaultModules.length;a<l;++a){const u=this._defaultModules[a],h=u.name;t[s++]=u,i[h]=!0}for(let a=0,l=e.length;a<l;++a){const u=e[a],h=u.name;i[h]||(t[s++]=u,i[h]=!0)}return t.length=s,du(t),t}}const W4=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,X4=`#version 300 es
${W4}`;function Y4(n){const{input:e,inputChannels:t,output:i}={};if(!e)return X4;if(!t)throw new Error("inputChannels");const s=q4(t),a=Z4(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${a};
}`}function q4(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function Z4(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class K4{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new ku({id:e})),this.stats.get(e)}}const pT=new K4,J=new qo({id:"luma.gl"}),Cd={};function Du(n="id"){Cd[n]=Cd[n]||1;const e=Cd[n]++;return`${n}-${e}`}let qe=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=Q4(t,i);const s=this.props.id!=="undefined"?this.props.id:Du(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function Q4(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}class Qe extends qe{static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const i={...t};(t.usage||0)&Qe.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,Qe.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,i){const s=ArrayBuffer.isView(e)?e.buffer:e,a=Math.min(e?e.byteLength:i,Qe.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(a):t===0&&i===s.byteLength?this.debugData=s.slice(0,a):this.debugData=s.slice(t,t+a)}static defaultProps={...qe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",onMapped:void 0}}function gT(n){const[e,t,i]=mg[n],s=n.includes("norm"),a=!s&&!n.startsWith("float"),l=n.startsWith("s");return{signedType:e,primitiveType:t,byteLength:i,normalized:s,integer:a,signed:l}}function G4(n){const e=n;switch(e){case"uint8":return"unorm8";case"sint8":return"snorm8";case"uint16":return"unorm16";case"sint16":return"snorm16";default:return e}}function J4(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}function gg(n){const e=ArrayBuffer.isView(n)?n.constructor:n;if(e===Uint8ClampedArray)return"uint8";const t=Object.values(mg).find(i=>e===i[4]);if(!t)throw new Error(e.name);return t[0]}function _g(n){const[,,,,e]=mg[n];return e}const mg={uint8:["uint8","u32",1,!1,Uint8Array],sint8:["sint8","i32",1,!1,Int8Array],unorm8:["uint8","f32",1,!0,Uint8Array],snorm8:["sint8","f32",1,!0,Int8Array],uint16:["uint16","u32",2,!1,Uint16Array],sint16:["sint16","i32",2,!1,Int16Array],unorm16:["uint16","u32",2,!0,Uint16Array],snorm16:["sint16","i32",2,!0,Int16Array],float16:["float16","f16",2,!1,Uint16Array],float32:["float32","f32",4,!1,Float32Array],uint32:["uint32","u32",4,!1,Uint32Array],sint32:["sint32","i32",4,!1,Int32Array]};function yg(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),s=t,a=i?parseInt(i):1,l=gT(s),u={type:s,components:a,byteLength:l.byteLength*a,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(u.webglOnly=!0),u}function eI(n,e,t){const i=t?G4(n):n;switch(i){case"unorm8":return e===1?"unorm8":e===3?"unorm8x3-webgl":`${i}x${e}`;case"snorm8":case"uint8":case"sint8":case"uint16":case"sint16":case"unorm16":case"snorm16":case"float16":if(e===1||e===3)throw new Error(`size: ${e}`);return`${i}x${e}`;default:return e===1?i:`${i}x${e}`}}function tI(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e,s=gg(n);return eI(s,i,t)}function nI(n){let e;switch(n.primitiveType){case"f32":e="float32";break;case"i32":e="sint32";break;case"u32":e="uint32";break;case"f16":return n.components<=2?"float16x2":"float16x4"}return n.components===1?e:`${e}x${n.components}`}const Mt="texture-compression-bc",Xe="texture-compression-astc",Ln="texture-compression-etc2",iI="texture-compression-etc1-webgl",wc="texture-compression-pvrtc-webgl",Md="texture-compression-atc-webgl",Sc="float32-renderable-webgl",Od="float16-renderable-webgl",sI="rgb9e5ufloat-renderable-webgl",Id="snorm8-renderable-webgl",po="norm16-renderable-webgl",Nd="snorm16-renderable-webgl",Ac="float32-filterable",uv="float16-filterable-webgl";function _T(n){const e=oI[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const rI={r8unorm:{},rg8unorm:{},"rgb8unorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},r8snorm:{render:Id},rg8snorm:{render:Id},"rgb8snorm-webgl":{},rgba8snorm:{render:Id},r8uint:{},rg8uint:{},rgba8uint:{},r8sint:{},rg8sint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},r16unorm:{f:po},rg16unorm:{render:po},"rgb16unorm-webgl":{f:po},rgba16unorm:{render:po},r16snorm:{f:Nd},rg16snorm:{render:Nd},"rgb16snorm-webgl":{f:po},rgba16snorm:{render:Nd},r16uint:{},rg16uint:{},rgba16uint:{},r16sint:{},rg16sint:{},rgba16sint:{},r16float:{render:Od,filter:"float16-filterable-webgl"},rg16float:{render:Od,filter:uv},rgba16float:{render:Od,filter:uv},r32uint:{},rg32uint:{},rgba32uint:{},r32sint:{},rg32sint:{},rgba32sint:{},r32float:{render:Sc,filter:Ac},rg32float:{render:!1,filter:Ac},"rgb32float-webgl":{render:Sc,filter:Ac},rgba32float:{render:Sc,filter:Ac},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},rgb9e5ufloat:{channels:"rgb",packed:!0,render:sI},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Sc},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},rgb10a2uint:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0}},aI={"bc1-rgb-unorm-webgl":{f:Mt},"bc1-rgb-unorm-srgb-webgl":{f:Mt},"bc1-rgba-unorm":{f:Mt},"bc1-rgba-unorm-srgb":{f:Mt},"bc2-rgba-unorm":{f:Mt},"bc2-rgba-unorm-srgb":{f:Mt},"bc3-rgba-unorm":{f:Mt},"bc3-rgba-unorm-srgb":{f:Mt},"bc4-r-unorm":{f:Mt},"bc4-r-snorm":{f:Mt},"bc5-rg-unorm":{f:Mt},"bc5-rg-snorm":{f:Mt},"bc6h-rgb-ufloat":{f:Mt},"bc6h-rgb-float":{f:Mt},"bc7-rgba-unorm":{f:Mt},"bc7-rgba-unorm-srgb":{f:Mt},"etc2-rgb8unorm":{f:Ln},"etc2-rgb8unorm-srgb":{f:Ln},"etc2-rgb8a1unorm":{f:Ln},"etc2-rgb8a1unorm-srgb":{f:Ln},"etc2-rgba8unorm":{f:Ln},"etc2-rgba8unorm-srgb":{f:Ln},"eac-r11unorm":{f:Ln},"eac-r11snorm":{f:Ln},"eac-rg11unorm":{f:Ln},"eac-rg11snorm":{f:Ln},"astc-4x4-unorm":{f:Xe},"astc-4x4-unorm-srgb":{f:Xe},"astc-5x4-unorm":{f:Xe},"astc-5x4-unorm-srgb":{f:Xe},"astc-5x5-unorm":{f:Xe},"astc-5x5-unorm-srgb":{f:Xe},"astc-6x5-unorm":{f:Xe},"astc-6x5-unorm-srgb":{f:Xe},"astc-6x6-unorm":{f:Xe},"astc-6x6-unorm-srgb":{f:Xe},"astc-8x5-unorm":{f:Xe},"astc-8x5-unorm-srgb":{f:Xe},"astc-8x6-unorm":{f:Xe},"astc-8x6-unorm-srgb":{f:Xe},"astc-8x8-unorm":{f:Xe},"astc-8x8-unorm-srgb":{f:Xe},"astc-10x5-unorm":{f:Xe},"astc-10x5-unorm-srgb":{f:Xe},"astc-10x6-unorm":{f:Xe},"astc-10x6-unorm-srgb":{f:Xe},"astc-10x8-unorm":{f:Xe},"astc-10x8-unorm-srgb":{f:Xe},"astc-10x10-unorm":{f:Xe},"astc-10x10-unorm-srgb":{f:Xe},"astc-12x10-unorm":{f:Xe},"astc-12x10-unorm-srgb":{f:Xe},"astc-12x12-unorm":{f:Xe},"astc-12x12-unorm-srgb":{f:Xe},"pvrtc-rgb4unorm-webgl":{f:wc},"pvrtc-rgba4unorm-webgl":{f:wc},"pvrtc-rbg2unorm-webgl":{f:wc},"pvrtc-rgba2unorm-webgl":{f:wc},"etc1-rbg-unorm-webgl":{f:iI},"atc-rgb-unorm-webgl":{f:Md},"atc-rgba-unorm-webgl":{f:Md},"atc-rgbai-unorm-webgl":{f:Md}},oI={...rI,...aI},lI=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],cI=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;class uI{getInfo(e){return fv(e)}isColor(e){return e.startsWith("rgba")||e.startsWith("bgra")||e.startsWith("rgb")}isDepthStencil(e){return e.startsWith("depth")||e.startsWith("stencil")}isCompressed(e){return lI.some(t=>e.startsWith(t))}getCapabilities(e){const t=_T(e),i={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},s=fv(e),a=e.startsWith("depth")||e.startsWith("stencil"),l=s?.signed,u=s?.integer,h=s?.webgl;return i.render&&=!l,i.filter&&=!a&&!l&&!u&&!h,i}}const Gr=new uI;function fv(n){let e=fI(n);if(Gr.isCompressed(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=hI(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=cI.exec(n);if(t){const[,i,s,a,l,u]=t,h=`${a}${s}`,d=gT(h),p=d.byteLength*8,m=i.length,y=[p,m>=2?p:0,m>=3?p:0,m>=4?p:0];e={format:n,attachment:e.attachment,dataType:d.signedType,components:m,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:e.packed,srgb:e.srgb},u==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function fI(n){const e=_T(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function hI(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,s]=t;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function dI(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}function pI(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}class gI{}class _I{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class Hs{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,webgl:{},onError:(e,t)=>{},onResize:(e,t)=>{const[i,s]=e.getDevicePixelSize();J.log(1,`${e} resized => ${i}x${s}px`)()},onPositionChange:(e,t)=>{const[i,s]=e.getPosition();J.log(1,`${e} repositioned => ${i},${s}`)()},onVisibilityChange:e=>J.log(1,`${e} Visibility changed ${e.isVisible}`)(),onDevicePixelRatioChange:(e,t)=>J.log(1,`${e} DPR changed ${t.oldRatio} => ${e.devicePixelRatio}`)(),debug:J.get("debug")||void 0,debugShaders:J.get("debug-shaders")||void 0,debugFramebuffers:!!J.get("debug-framebuffers"),debugFactories:!!J.get("debug-factories"),debugWebGL:!!J.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_reuseDevices:!1,_requestMaxLimits:!0,_cacheShaders:!1,_cachePipelines:!1,_cacheDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_handle:void 0};get[Symbol.toStringTag](){return"Device"}toString(){return`Device(${this.id})`}id;props;userData={};statsManager=pT;timestamp=0;_reused=!1;_lumaData={};_textureCaps={};constructor(e){this.props={...Hs.defaultProps,...e},this.id=this.props.id||Du(this[Symbol.toStringTag].toLowerCase())}getVertexFormatInfo(e){return yg(e)}isVertexFormatSupported(e){return!0}getTextureFormatInfo(e){return Gr.getInfo(e)}getTextureFormatCapabilities(e){let t=this._textureCaps[e];if(!t){const i=this._getDeviceTextureFormatCapabilities(e);t=this._getDeviceSpecificTextureFormatCapabilities(i),this._textureCaps[e]=t}return t}getMipLevelCount(e,t,i=1){const s=Math.max(e,t,i);return 1+Math.floor(Math.log2(s))}isExternalImage(e){return dI(e)}getExternalImageSize(e){return pI(e)}isTextureFormatSupported(e){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return Gr.isCompressed(e)}pushDebugGroup(e){this.commandEncoder.pushDebugGroup(e)}popDebugGroup(){this.commandEncoder?.popDebugGroup()}insertDebugMarker(e){this.commandEncoder?.insertDebugMarker(e)}loseDevice(){return!1}incrementTimestamp(){return this.timestamp++}reportError(e,t,...i){return this.props.onError(e,t)?()=>{}:J.error(e.message,t,...i)}debug(){if(this.props.debug)debugger;else J.once(0,`'Type luma.log.set({debug: true}) in console to enable debug breakpoints',
or create a device with the 'debug: true' prop.`)()}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}beginRenderPass(e){return this.commandEncoder.beginRenderPass(e)}beginComputePass(e){return this.commandEncoder.beginComputePass(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_getDeviceTextureFormatCapabilities(e){const t=Gr.getCapabilities(e),i=a=>(typeof a=="string"?this.features.has(a):a)??!0,s=i(t.create);return{format:e,create:s,render:s&&i(t.render),filter:s&&i(t.filter),blend:s&&i(t.blend),store:s&&i(t.store)}}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};if((e.usage||0)&Qe.INDEX&&(e.indexType||(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array&&(t.indexType="uint16")),!t.indexType))throw new Error("indices buffer content must be of type uint16 or uint32");return t}}const mI="set luma.log.level=1 (or higher) to trace rendering",hv="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class pu{static defaultProps={...Hs.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=pT;log=J;VERSION="9.2.2";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw J.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),J.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");J.error("This version of luma.gl has already been initialized")()}J.log(1,`${this.VERSION} - ${mI}`)(),globalThis.luma=this}async createDevice(e={}){const t={...pu.defaultProps,...e},i=this.selectAdapter(t.type,t.adapters);if(!i)throw new Error(hv);return t.waitForPageLoad&&await i.pageLoaded,await i.create(t)}async attachDevice(e,t){const i=this._getTypeFromHandle(e,t.adapters),s=i&&this.selectAdapter(i,t.adapters);if(!s)throw new Error(hv);return await s?.attach?.(e,t)}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this._getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapterType(e=[]){const t=["webgpu","webgl","null"],i=this._getAdapterMap(e);for(const s of t)if(i.get(s)?.isSupported?.())return s;return null}selectAdapter(e,t=[]){let i=e;e==="best-available"&&(i=this.getBestAvailableAdapterType(t));const s=this._getAdapterMap(t);return i&&s.get(i)||null}enforceWebGL2(e=!0,t=[]){const s=this._getAdapterMap(t).get("webgl");s||J.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(pu.defaultProps,e)}_getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":typeof GPUDevice<"u"&&e instanceof GPUDevice||e?.queue?"webgpu":e===null?"null":(e instanceof WebGLRenderingContext?J.warn("WebGL1 is not supported",e)():J.warn("Unknown handle type",e)(),null)}}const bp=new pu;class yI{get pageLoaded(){return TI()}}const bI=Zs()&&typeof document<"u",vI=()=>bI&&document.readyState==="complete";let Ec=null;function TI(){return Ec||(vI()||typeof window>"u"?Ec=Promise.resolve():Ec=new Promise(n=>window.addEventListener("load",()=>n()))),Ec}function xI(){let n,e;return{promise:new Promise((i,s)=>{n=i,e=s}),resolve:n,reject:e}}class Is{static isHTMLCanvas(e){return typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement}static isOffscreenCanvas(e){return typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static defaultProps={id:void 0,canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb",trackPosition:!1};id;props;canvas;htmlCanvas;offscreenCanvas;type;initialized;isInitialized=!1;isVisible=!0;cssWidth;cssHeight;devicePixelRatio;devicePixelWidth;devicePixelHeight;drawingBufferWidth;drawingBufferHeight;_initializedResolvers=xI();_resizeObserver;_intersectionObserver;_position;destroyed=!1;toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Is.defaultProps,...e},e=this.props,this.initialized=this._initializedResolvers.promise,Zs()?e.canvas?typeof e.canvas=="string"?this.canvas=SI(e.canvas):this.canvas=e.canvas:this.canvas=AI(e):this.canvas={width:e.width||1,height:e.height||1},Is.isHTMLCanvas(this.canvas)?(this.id=e.id||this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):Is.isOffscreenCanvas(this.canvas)?(this.id=e.id||"offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas):(this.id=e.id||"node-canvas-context",this.type="node"),this.cssWidth=this.htmlCanvas?.clientWidth||this.canvas.width,this.cssHeight=this.htmlCanvas?.clientHeight||this.canvas.height,this.devicePixelWidth=this.canvas.width,this.devicePixelHeight=this.canvas.height,this.drawingBufferWidth=this.canvas.width,this.drawingBufferHeight=this.canvas.height,this.devicePixelRatio=globalThis.devicePixelRatio||1,this._position=[0,0],Is.isHTMLCanvas(this.canvas)){this._intersectionObserver=new IntersectionObserver(t=>this._handleIntersection(t)),this._intersectionObserver.observe(this.canvas),this._resizeObserver=new ResizeObserver(t=>this._handleResize(t));try{this._resizeObserver.observe(this.canvas,{box:"device-pixel-content-box"})}catch{this._resizeObserver.observe(this.canvas,{box:"content-box"})}setTimeout(()=>this._observeDevicePixelRatio(),0),this.props.trackPosition&&this._trackPosition()}}destroy(){this.destroyed=!0}setProps(e){return"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1,this._updateDrawingBufferSize()),this}getCSSSize(){return[this.cssWidth,this.cssHeight]}getPosition(){return this._position}getDevicePixelSize(){return[this.devicePixelWidth,this.devicePixelHeight]}getDrawingBufferSize(){return[this.drawingBufferWidth,this.drawingBufferHeight]}getMaxDrawingBufferSize(){const e=this.device.limits.maxTextureDimension2D;return[e,e]}setDrawingBufferSize(e,t){this.canvas.width=e,this.canvas.height=t,this.drawingBufferWidth=e,this.drawingBufferHeight=t}getDevicePixelRatio(){return typeof window<"u"&&window.devicePixelRatio||1}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[s,a]=this.getDrawingBufferSize();return EI(e,i,s,a,t)}getPixelSize(){return this.getDevicePixelSize()}getAspect(){const[e,t]=this.getDevicePixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),[t]=this.getCSSSize();return t?e/t:1}catch{return 1}}resize(e){this.setDrawingBufferSize(e.width,e.height)}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}_handleIntersection(e){const t=e.find(s=>s.target===this.canvas);if(!t)return;const i=t.isIntersecting;this.isVisible!==i&&(this.isVisible=i,this.device.props.onVisibilityChange(this))}_handleResize(e){const t=e.find(h=>h.target===this.canvas);if(!t)return;this.cssWidth=t.contentBoxSize[0].inlineSize,this.cssHeight=t.contentBoxSize[0].blockSize;const i=this.getDevicePixelSize(),s=t.devicePixelContentBoxSize?.[0].inlineSize||t.contentBoxSize[0].inlineSize*devicePixelRatio,a=t.devicePixelContentBoxSize?.[0].blockSize||t.contentBoxSize[0].blockSize*devicePixelRatio,[l,u]=this.getMaxDrawingBufferSize();this.devicePixelWidth=Math.max(1,Math.min(s,l)),this.devicePixelHeight=Math.max(1,Math.min(a,u)),this._updateDrawingBufferSize(),this.device.props.onResize(this,{oldPixelSize:i})}_updateDrawingBufferSize(){if(this.props.autoResize){if(typeof this.props.useDevicePixels=="number"){const e=this.props.useDevicePixels;this.setDrawingBufferSize(this.cssWidth*e,this.cssHeight*e)}else this.props.useDevicePixels?this.setDrawingBufferSize(this.devicePixelWidth,this.devicePixelHeight):this.setDrawingBufferSize(this.cssWidth,this.cssHeight);this._updateDevice()}this._initializedResolvers.resolve(),this.isInitialized=!0,this.updatePosition()}_observeDevicePixelRatio(){const e=this.devicePixelRatio;this.devicePixelRatio=window.devicePixelRatio,this.updatePosition(),this.device.props.onDevicePixelRatioChange(this,{oldRatio:e}),matchMedia(`(resolution: ${this.devicePixelRatio}dppx)`).addEventListener("change",()=>this._observeDevicePixelRatio(),{once:!0})}_trackPosition(e=100){const t=setInterval(()=>{this.destroyed?clearInterval(t):this.updatePosition()},e)}updatePosition(){const e=this.htmlCanvas?.getBoundingClientRect();if(e){const t=[e.left,e.top];if(this._position??=t,t[0]!==this._position[0]||t[1]!==this._position[1]){const s=this._position;this._position=t,this.device.props.onPositionChange?.(this,{oldPosition:s})}}}}function wI(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}return n||document.body}function SI(n){const e=document.getElementById(n);if(!Is.isHTMLCanvas(e))throw new Error("Object is not a canvas element");return e}function AI(n){const{width:e,height:t}=n,i=document.createElement("canvas");i.id=Du("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",n?.visible||(i.style.visibility="hidden");const s=wI(n?.container||null);return s.insertBefore(i,s.firstChild),i}function EI(n,e,t,i,s){const a=n,l=dv(a[0],e,t);let u=pv(a[1],e,i,s),h=dv(a[0]+1,e,t);const d=h===t-1?h:h-1;h=pv(a[1]+1,e,i,s);let p;return s?(h=h===0?h:h+1,p=u,u=h):p=h===i-1?h:h-1,{x:l,y:u,width:Math.max(d-l+1,1),height:Math.max(p-u+1,1)}}function dv(n,e,t){return Math.min(Math.round(n*e),t-1)}function pv(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class js extends qe{static defaultProps={...qe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=js.normalizeProps(e,t),super(e,t,js.defaultProps)}static normalizeProps(e,t){return t}}const RI={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class bt extends qe{static SAMPLE=4;static STORAGE=8;static RENDER=16;static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static RENDER_ATTACHMENT=16;dimension;baseDimension;format;width;height;depth;mipLevels;updateTimestamp;get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}constructor(e,t){if(t=bt.normalizeProps(e,t),super(e,t,bt.defaultProps),this.dimension=this.props.dimension,this.baseDimension=RI[this.dimension],this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.mipLevels=this.props.mipLevels,this.props.width===void 0||this.props.height===void 0)if(e.isExternalImage(t.data)){const i=e.getExternalImageSize(t.data);this.width=i?.width||1,this.height=i?.height||1}else this.width=1,this.height=1,(this.props.width===void 0||this.props.height===void 0)&&J.warn(`${this} created with undefined width or height. This is deprecated. Use AsyncTexture instead.`)();this.updateTimestamp=e.incrementTimestamp()}setSampler(e){this.sampler=e instanceof js?e:this.device.createSampler(e)}clone(e){return this.device.createTexture({...this.props,...e})}static normalizeProps(e,t){const i={...t},{width:s,height:a}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof a=="number"&&(i.height=Math.max(1,Math.ceil(a))),i}_initializeData(e){this.device.isExternalImage(e)?this.copyExternalImage({image:e,width:this.width,height:this.height,depth:this.depth,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}):e&&this.copyImageData({data:e,mipLevel:0,x:0,y:0,z:0,aspect:"all"})}_normalizeCopyImageDataOptions(e){const{width:t,height:i,depth:s}=this,a={...bt.defaultCopyDataOptions,width:t,height:i,depth:s,...e},l=this.device.getTextureFormatInfo(this.format);if(!e.bytesPerRow&&!l.bytesPerPixel)throw new Error(`bytesPerRow must be provided for texture format ${this.format}`);return a.bytesPerRow=e.bytesPerRow||t*(l.bytesPerPixel||4),a.rowsPerImage=e.rowsPerImage||i,a}_normalizeCopyExternalImageOptions(e){const t=this.device.getExternalImageSize(e.image),i={...bt.defaultCopyExternalImageOptions,...t,...e};return i.width=Math.min(i.width,this.width-i.x),i.height=Math.min(i.height,this.height-i.y),i}static defaultProps={...qe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",usage:bt.TEXTURE|bt.RENDER_ATTACHMENT|bt.COPY_DST,width:void 0,height:void 0,depth:1,mipLevels:1,samples:void 0,sampler:{},view:void 0};static defaultCopyDataOptions={data:void 0,byteOffset:0,bytesPerRow:void 0,rowsPerImage:void 0,mipLevel:0,x:0,y:0,z:0,aspect:"all"};static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1}}class Bu extends qe{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Bu.defaultProps)}static defaultProps={...qe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0}}function CI(n,e,t){let i="";const s=e.split(/\r?\n/),a=n.slice().sort((l,u)=>l.lineNum-u.lineNum);switch(t?.showSourceCode||"no"){case"all":let l=0;for(let u=1;u<=s.length;u++)for(i+=mT(s[u-1],u,t);a.length>l&&a[l].lineNum===u;){const h=a[l++];i+=kd(h,s,h.lineNum,{...t,inlineSource:!1})}for(;a.length>l;){const u=a[l++];i+=kd(u,[],0,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const u of n)i+=kd(u,s,u.lineNum,{inlineSource:t?.showSourceCode!=="no"});return i}}function kd(n,e,t,i){if(i?.inlineSource){const a=MI(e,t),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${a}${l}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function MI(n,e,t){let i="";for(let s=e-2;s<=e;s++){const a=n[s-1];a!==void 0&&(i+=mT(a,e,t))}return i}function mT(n,e,t){const i=t?.html?II(n):n;return`${OI(String(e),4)}: ${i}${t?.html?"<br/>":`
`}`}function OI(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function II(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Uu extends qe{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:NI(t),...t},Uu.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t,this.id)}_displayShaderLog(e,t){if(typeof document>"u"||!document?.createElement)return;const i=t,s=`${this.stage} shader "${i}"`;let a=CI(e,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(a+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const u=document.createElement("Button");u.innerHTML=`
<h1>Compilation error in ${s}</h1><br /><br />
<code style="user-select:text;"><pre>
${a}
</pre></code>`,u.style.top="10px",u.style.left="10px",u.style.position="absolute",u.style.zIndex="9999",u.style.width="100%",u.style.textAlign="left",document.body.appendChild(u),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),u.onclick=()=>{const d=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(d)}}static defaultProps={...qe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0}}function NI(n){return kI(n.source)||n.id||Du(`unnamed ${n.stage}-shader`)}function kI(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}class Fu extends qe{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,Fu.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(s=>s.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:i})}resize(e){let t=!e;if(e){const[i,s]=Array.isArray(e)?e:[e.width,e.height];t=t||s!==this.height||i!==this.width,this.width=i,this.height=s}t&&(J.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,i)=>{if(typeof t=="string"){const s=this.createColorTexture(t,i);return this.attachResource(s),s.view}return t instanceof bt?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof bt?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:bt.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:bt.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}static defaultProps={...qe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}}class Ds extends qe{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,Ds.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}static defaultProps={...qe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",colorAttachmentFormats:void 0,depthStencilAttachmentFormat:void 0,parameters:{},bindings:{},uniforms:{}}}class Rs extends qe{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Rs.normalizeProps(e,t),super(e,t,Rs.defaultProps)}static normalizeProps(e,t){return t}static defaultProps={...qe.defaultProps,framebuffer:null,parameters:void 0,clearColor:Rs.defaultClearColor,clearColors:void 0,clearDepth:Rs.defaultClearDepth,clearStencil:Rs.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0}}class gu extends qe{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,gu.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...qe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class bg extends qe{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,bg.defaultProps)}static defaultProps={...qe.defaultProps,measureExecutionTime:void 0}}class vg extends qe{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,vg.defaultProps)}static defaultProps={...qe.defaultProps}}function yT(n){return UI[n]}function PI(n){const[e,t]=BI[n],i=e==="i32"||e==="u32",s=e!=="u32",a=DI[e]*t;return{primitiveType:e,components:t,byteLength:a,integer:i,signed:s}}const DI={f32:4,f16:2,i32:4,u32:4},BI={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},UI={f32:{type:"f32",components:1},f16:{type:"f16",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<f16>":{type:"f16",components:2},"vec3<f16>":{type:"f16",components:3},"vec4<f16>":{type:"f16",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16},"mat2x2<f16>":{type:"f16",components:4},"mat2x3<f16>":{type:"f16",components:6},"mat2x4<f16>":{type:"f16",components:8},"mat3x2<f16>":{type:"f16",components:6},"mat3x3<f16>":{type:"f16",components:9},"mat3x4<f16>":{type:"f16",components:12},"mat4x2<f16>":{type:"f16",components:8},"mat4x3<f16>":{type:"f16",components:12},"mat4x4<f16>":{type:"f16",components:16},"mat2x2<i32>":{type:"i32",components:4},"mat2x3<i32>":{type:"i32",components:6},"mat2x4<i32>":{type:"i32",components:8},"mat3x2<i32>":{type:"i32",components:6},"mat3x3<i32>":{type:"i32",components:9},"mat3x4<i32>":{type:"i32",components:12},"mat4x2<i32>":{type:"i32",components:8},"mat4x3<i32>":{type:"i32",components:12},"mat4x4<i32>":{type:"i32",components:16},"mat2x2<u32>":{type:"u32",components:4},"mat2x3<u32>":{type:"u32",components:6},"mat2x4<u32>":{type:"u32",components:8},"mat3x2<u32>":{type:"u32",components:6},"mat3x3<u32>":{type:"u32",components:9},"mat3x4<u32>":{type:"u32",components:12},"mat4x2<u32>":{type:"u32",components:8},"mat4x3<u32>":{type:"u32",components:12},"mat4x4<u32>":{type:"u32",components:16}};function bT(n,e){const t={};for(const i of n.attributes){const s=LI(n,e,i.name);s&&(t[i.name]=s)}return t}function FI(n,e,t=16){const i=bT(n,e),s=new Array(t).fill(null);for(const a of Object.values(i))s[a.location]=a;return s}function LI(n,e,t){const i=zI(n,t),s=VI(e,t);if(!i)return null;const a=PI(i.type),l=nI(a),u=s?.vertexFormat||l,h=yg(u);return{attributeName:s?.attributeName||i.name,bufferName:s?.bufferName||i.name,location:i.location,shaderType:i.type,primitiveType:a.primitiveType,shaderComponents:a.components,vertexFormat:u,bufferDataType:h.type,bufferComponents:h.components,normalized:h.normalized,integer:a.integer,stepMode:s?.stepMode||i.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function zI(n,e){const t=n.attributes.find(i=>i.name===e);return t||J.warn(`shader layout attribute "${e}" not present in shader`),t||null}function VI(n,e){HI(n);let t=jI(n,e);return t||(t=$I(n,e),t)?t:(J.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function HI(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&J.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function jI(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function $I(n,e){for(const t of n){let i=t.byteStride;if(typeof t.byteStride!="number")for(const a of t.attributes||[]){const l=yg(a.format);i+=l.byteLength}const s=t.attributes?.find(a=>a.attribute===e);if(s)return{attributeName:s.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}class Tg extends qe{static defaultProps={...qe.defaultProps,shaderLayout:void 0,bufferLayout:[]};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,Tg.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=FI(t.shaderLayout,t.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"),this)()}}class xg extends qe{static defaultProps={...qe.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,xg.defaultProps)}}class wg extends qe{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,wg.defaultProps)}static defaultProps={...qe.defaultProps,type:void 0,count:void 0}}let Rc;function vT(n){return(!Rc||Rc.byteLength<n)&&(Rc=new ArrayBuffer(n)),Rc}function WI(n,e){const t=vT(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function XI(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function _u(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":XI(n)}const YI=1024;class qI{layout={};byteLength;constructor(e,t={}){let i=0;for(const[a,l]of Object.entries(e)){const u=yT(l),{type:h,components:d}=u,p=d*(t?.[a]??1);i=J4(i,p);const m=i;i+=p,this.layout[a]={type:h,size:p,offset:m}}i+=(4-i%4)%4;const s=i*4;this.byteLength=Math.max(s,YI)}getData(e){const t=vT(this.byteLength),i={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(const[s,a]of Object.entries(e)){const l=this.layout[s];if(!l){J.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:h,offset:d}=l,p=i[u];if(h===1){if(typeof a!="number"&&typeof a!="boolean"){J.warn(`Supplied value for single component uniform ${s} is not a number: ${a}`)();continue}p[d]=Number(a)}else{if(!_u(a)){J.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${a}`)();continue}p.set(a,d)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function ZI(n,e,t=16){if(n!==e)return!1;const i=n,s=e;if(!_u(i))return!1;if(_u(s)&&i.length===s.length){for(let a=0;a<i.length;++a)if(s[a]!==i[a])return!1}return!0}function KI(n){return _u(n)?n.slice():n}class QI{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===e?.name);if(!t)throw new Error(e?.name);const i=t;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){ZI(this.uniforms[e],t)||(this.uniforms[e]=KI(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class GI{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,i]of Object.entries(e)){const s=t,a=new qI(i.uniformTypes??{},i.uniformSizes??{});this.uniformBufferLayouts.set(s,a);const l=new QI({name:t});l.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(t),a=e.createBuffer({usage:Qe.UNIFORM|Qe.COPY_DST,byteLength:s}),l=this.getUniformBufferData(t);return a.write(l),a}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:Qe.UNIFORM|Qe.COPY_DST,byteLength:i});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||=i}return e&&J.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),s=!1;if(i&&t?.needsRedraw){s||=t.needsRedraw;const a=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(a);const l=this.uniformBlocks.get(e)?.getAllUniforms();J.log(4,`Writing to uniform buffer ${String(e)}`,a,l)()}return s}}let vn=class{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}};class gv{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}let Ji=class extends vn{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},ns=class extends vn{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}},vp=class extends vn{constructor(e,t,i){super(e,i),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}},$s=class extends vn{constructor(e,t,i,s){super(e,i),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}};var Ki;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Ki||(Ki={}));let Cc=class{constructor(e,t,i,s,a,l,u){this.name=e,this.type=t,this.group=i,this.binding=s,this.attributes=a,this.resourceType=l,this.access=u}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},JI=class{constructor(e,t){this.name=e,this.type=t}},eN=class{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s,this.interpolation=null}},_v=class{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s}};class tN{constructor(e,t,i,s){this.name=e,this.type=t,this.attributes=i,this.id=s}}let nN=class{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}},iN=class{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}},sN=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}};function rN(n){var e=(32768&n)>>15,t=(31744&n)>>10,i=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}const TT=new Float32Array(1),aN=new Int32Array(TT.buffer),Ot=new Uint16Array(1);function oN(n){TT[0]=n;const e=aN[0],t=e>>31&1;let i=e>>23&255,s=8388607&e;if(i===255)return Ot[0]=t<<15|31744|(s!==0?512:0),Ot[0];if(i===0){if(s===0)return Ot[0]=t<<15,Ot[0];s|=8388608;let a=113;for(;!(8388608&s);)s<<=1,a--;return i=127-a,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),Ot[0]=t<<15|i<<10|s>>13,Ot[0]):(Ot[0]=t<<15,Ot[0])}return i=i-127+15,i>=31?(Ot[0]=t<<15|31744,Ot[0]):i<=0?i<-10?(Ot[0]=t<<15,Ot[0]):(s=(8388608|s)>>1-i,Ot[0]=t<<15|s>>13,Ot[0]):(s>>=13,Ot[0]=t<<15|i<<10|s,Ot[0])}const Sg=new Uint32Array(1),xT=new Float32Array(Sg.buffer,0,1);function mv(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return Sg[0]=e,xT[0]}function lN(n,e,t,i,s,a,l,u,h){const d=i*(l>>=s)*(a>>=s)+t*l+e*u;switch(h){case"r8unorm":return[Be(n,d,"8unorm",1)[0]];case"r8snorm":return[Be(n,d,"8snorm",1)[0]];case"r8uint":return[Be(n,d,"8uint",1)[0]];case"r8sint":return[Be(n,d,"8sint",1)[0]];case"rg8unorm":{const p=Be(n,d,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=Be(n,d,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=Be(n,d,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=Be(n,d,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=Be(n,d,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=Be(n,d,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=Be(n,d,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=Be(n,d,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=Be(n,d,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[Be(n,d,"16uint",1)[0]];case"r16sint":return[Be(n,d,"16sint",1)[0]];case"r16float":return[Be(n,d,"16float",1)[0]];case"rg16uint":{const p=Be(n,d,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=Be(n,d,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=Be(n,d,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=Be(n,d,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=Be(n,d,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=Be(n,d,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[Be(n,d,"32uint",1)[0]];case"r32sint":return[Be(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Be(n,d,"32float",1)[0]];case"rg32uint":{const p=Be(n,d,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=Be(n,d,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=Be(n,d,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=Be(n,d,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=Be(n,d,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=Be(n,d,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(n.buffer,d,1)[0],m=(4192256&p)>>11,y=(4290772992&p)>>22;return[mv(2047&p),mv(m),(function(v){const x=112+(v>>5&31)<<23|(31&v)<<18;return Sg[0]=x,xT[0]})(y),1]}}return null}function Be(n,e,t,i){const s=[0,0,0,0];for(let a=0;a<i;++a)switch(t){case"8unorm":s[a]=n[e]/255,e++;break;case"8snorm":s[a]=n[e]/255*2-1,e++;break;case"8uint":s[a]=n[e],e++;break;case"8sint":s[a]=n[e]-127,e++;break;case"16uint":s[a]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[a]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[a]=rN(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":s[a]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[a]=new Float32Array(n.buffer,e,1)[0],e+=4}return s}function Fe(n,e,t,i,s){for(let a=0;a<i;++a)switch(t){case"8unorm":n[e]=255*s[a],e++;break;case"8snorm":n[e]=.5*(s[a]+1)*255,e++;break;case"8uint":n[e]=s[a],e++;break;case"8sint":n[e]=s[a]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[a],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[a],e+=2;break;case"16float":{const l=oN(s[a]);new Uint16Array(n.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[a],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[a],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[a],e+=4}return s}const Pd={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};let qn=class wT{constructor(){this.id=wT._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(mu.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(yu.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}};qn._id=0;let mu=class extends qn{};mu.instance=new mu;let yu=class extends qn{};yu.instance=new yu;const ST=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);let nt=class extends qn{constructor(){super()}},Lo=class extends nt{constructor(e,t,i,s,a,l){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=s,this.startLine=a,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}},cN=class extends nt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},AT=class extends nt{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},Tp=class extends nt{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}},ET=class extends nt{constructor(e,t,i,s){super(),this.init=e,this.condition=t,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var t,i,s;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}},yi=class extends nt{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}},Ag=class extends nt{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}};class Co extends nt{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}let $c=class extends nt{constructor(e,t,i,s,a){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=a}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}};var $r,To,L,k;(n=>{n.increment="++",n.decrement="--"})($r||($r={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})($r||($r={}));class RT extends nt{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(To||(To={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(To||(To={}));let CT=class extends nt{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}};class Eg extends nt{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return ST.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}let MT=class extends nt{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}};class OT extends nt{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class IT extends nt{constructor(e,t,i,s){super(),this.condition=e,this.body=t,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class NT extends nt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class uN extends nt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class fN extends nt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class kT extends nt{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Rg extends nt{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class hN extends nt{constructor(){super()}get astNodeType(){return"discard"}}class PT extends nt{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class DT extends nt{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class K extends nt{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=K._priority.get(t.name);K._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?K.i32:t}getTypeName(){return this.name}}K.x32=new K("x32"),K.f32=new K("f32"),K.i32=new K("i32"),K.u32=new K("u32"),K.f16=new K("f16"),K.bool=new K("bool"),K.void=new K("void"),K._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class yv extends K{constructor(e){super(e)}}class _i extends K{constructor(e,t,i,s){super(e),this.members=t,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class F extends K{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}F.vec2f=new F("vec2",K.f32,null),F.vec3f=new F("vec3",K.f32,null),F.vec4f=new F("vec4",K.f32,null),F.vec2i=new F("vec2",K.i32,null),F.vec3i=new F("vec3",K.i32,null),F.vec4i=new F("vec4",K.i32,null),F.vec2u=new F("vec2",K.u32,null),F.vec3u=new F("vec3",K.u32,null),F.vec4u=new F("vec4",K.u32,null),F.vec2h=new F("vec2",K.f16,null),F.vec3h=new F("vec3",K.f16,null),F.vec4h=new F("vec4",K.f16,null),F.vec2b=new F("vec2",K.bool,null),F.vec3b=new F("vec3",K.bool,null),F.vec4b=new F("vec4",K.bool,null),F.mat2x2f=new F("mat2x2",K.f32,null),F.mat2x3f=new F("mat2x3",K.f32,null),F.mat2x4f=new F("mat2x4",K.f32,null),F.mat3x2f=new F("mat3x2",K.f32,null),F.mat3x3f=new F("mat3x3",K.f32,null),F.mat3x4f=new F("mat3x4",K.f32,null),F.mat4x2f=new F("mat4x2",K.f32,null),F.mat4x3f=new F("mat4x3",K.f32,null),F.mat4x4f=new F("mat4x4",K.f32,null),F.mat2x2h=new F("mat2x2",K.f16,null),F.mat2x3h=new F("mat2x3",K.f16,null),F.mat2x4h=new F("mat2x4",K.f16,null),F.mat3x2h=new F("mat3x2",K.f16,null),F.mat3x3h=new F("mat3x3",K.f16,null),F.mat3x4h=new F("mat3x4",K.f16,null),F.mat4x2h=new F("mat4x2",K.f16,null),F.mat4x3h=new F("mat4x3",K.f16,null),F.mat4x4h=new F("mat4x4",K.f16,null),F.mat2x2i=new F("mat2x2",K.i32,null),F.mat2x3i=new F("mat2x3",K.i32,null),F.mat2x4i=new F("mat2x4",K.i32,null),F.mat3x2i=new F("mat3x2",K.i32,null),F.mat3x3i=new F("mat3x3",K.i32,null),F.mat3x4i=new F("mat3x4",K.i32,null),F.mat4x2i=new F("mat4x2",K.i32,null),F.mat4x3i=new F("mat4x3",K.i32,null),F.mat4x4i=new F("mat4x4",K.i32,null),F.mat2x2u=new F("mat2x2",K.u32,null),F.mat2x3u=new F("mat2x3",K.u32,null),F.mat2x4u=new F("mat2x4",K.u32,null),F.mat3x2u=new F("mat3x2",K.u32,null),F.mat3x3u=new F("mat3x3",K.u32,null),F.mat3x4u=new F("mat3x4",K.u32,null),F.mat4x2u=new F("mat4x2",K.u32,null),F.mat4x3u=new F("mat4x3",K.u32,null),F.mat4x4u=new F("mat4x4",K.u32,null);class Wc extends K{constructor(e,t,i,s){super(e),this.storage=t,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class Mo extends K{constructor(e,t,i,s){super(e),this.attributes=t,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class xo extends K{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class Pn extends qn{constructor(){super(),this.postfix=null}}class Ws extends Pn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Vn extends Pn{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Cg extends Pn{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return ST.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class an extends Pn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class BT extends Pn{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class mt extends Pn{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof N}get isVector(){return this.value instanceof S||this.value instanceof ye}get scalarValue(){return this.value instanceof N?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof S||this.value instanceof ye?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class UT extends Pn{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class sa extends Pn{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class FT extends Pn{constructor(){super()}}class pt extends FT{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Cn extends FT{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?K.f32:e.name==="u32"||t.name==="u32"?K.u32:K.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class LT extends qn{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Xc extends Pn{constructor(){super()}get astNodeType(){return"default"}}class zT extends LT{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class VT extends LT{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class bv extends qn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class dN extends qn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class vv extends qn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class HT extends qn{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class wn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=wn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}wn._id=0;class xp extends wn{constructor(){super(new vn("void",null),null)}toString(){return"void"}}xp.void=new xp;class zr extends wn{constructor(e){super(new vp("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,s){this.reference.setDataValue(e,t,i,s)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}toString(){return`&${this.reference.toString()}`}}class N extends wn{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new N(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new N(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new N(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof N))return void console.error("SetDataValue: Invalid value",t);let a=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?a=Math.floor(a):this.typeInfo.name==="bool"&&(a=a?1:0),this.data[0]=a}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function pN(n,e,t){const i=e.length;return i===2?t==="f32"?new S(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new S(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new S(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new S(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new S(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new S(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new S(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new S(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new S(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new S(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new S(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new S(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class S extends wn{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new S(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new S(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new S(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,s){i instanceof Ws?console.error("TODO: Set vector postfix"):t instanceof S?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof $s)s=this.typeInfo.format||s;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?s=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?s=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?s=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?s=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let a=this;for(;t!==null&&a!==null;){if(t instanceof sa){const l=t.index;let u=-1;if(l instanceof mt){if(!(l.value instanceof N))return console.error(`GetSubData: Invalid array index ${l.value}`),null;u=l.value.value}else{const h=e.evalExpression(l,i);if(!(h instanceof N))return console.error("GetSubData: Unknown index type",l),null;u=h.value}if(u<0||u>=a.data.length)return console.error("GetSubData: Index out of range",u),null;if(a.data instanceof Float32Array){const h=new Float32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new N(h,s)}if(a.data instanceof Int32Array){const h=new Int32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new N(h,s)}if(a.data instanceof Uint32Array){const h=new Uint32Array(a.data.buffer,a.data.byteOffset+4*u,1);return new N(h,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof Ws))return console.error("GetSubData: Unknown postfix",t),null;{const l=t.value.toLowerCase();if(l.length===1){let h=0;if(l==="x"||l==="r")h=0;else if(l==="y"||l==="g")h=1;else if(l==="z"||l==="b")h=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;h=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new N(d,s,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new N(d,s,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new N(d,s,this)}}const u=[];for(const h of l)h==="x"||h==="r"?u.push(this.data[0]):h==="y"||h==="g"?u.push(this.data[1]):h==="z"||h==="b"?u.push(this.data[2]):h==="w"||h==="a"?u.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);a=pN(e,u,s.name)}t=t.postfix}return a}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class ye extends wn{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new ye(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,s){i instanceof Ws?console.error("TODO: Set matrix postfix"):t instanceof ye?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof $s)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof sa){const a=t.index;let l=-1;if(a instanceof mt){if(!(a.value instanceof N))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;l=a.value.value}else{const d=e.evalExpression(a,i);if(!(d instanceof N))return console.error("GetDataValue: Unknown index type",a),null;l=d.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const u=s.endsWith("h")?"h":"f";let h;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")h=new S(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${u}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")h=new S(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${u}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;h=new S(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${u}`))}return t.postfix?h.getSubData(e,t.postfix,i):h}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class at extends wn{constructor(e,t,i=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new at(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,s){if(t===null)return void console.log("setDataValue: NULL data.");let a=this.offset,l=this.typeInfo;for(;i;){if(i instanceof sa)if(l instanceof ns){const u=i.index;if(u instanceof mt){if(!(u.value instanceof N))return void console.error(`SetDataValue: Invalid index type ${u.value}`);a+=u.value.value*l.stride}else{const h=e.evalExpression(u,s);if(!(h instanceof N))return void console.error("SetDataValue: Unknown index type",u);a+=h.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(i instanceof Ws))return void console.error("SetDataValue: Unknown postfix type",i);{const u=i.value;if(l instanceof Ji){let h=!1;for(const d of l.members)if(d.name===u){a+=d.offset,l=d.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${u} not found`)}else if(l instanceof vn){const h=l.getTypeName();let d=0;if(u==="x"||u==="r")d=0;else if(u==="y"||u==="g")d=1;else if(u==="z"||u==="b")d=2;else{if(u!=="w"&&u!=="a")return void console.error(`SetDataValue: Unknown member ${u}`);d=3}if(!(t instanceof N))return void console.error("SetDataValue: Invalid value",t);const p=t.value;return h==="vec2f"?void(new Float32Array(this.buffer,a,2)[d]=p):h==="vec3f"?void(new Float32Array(this.buffer,a,3)[d]=p):h==="vec4f"?void(new Float32Array(this.buffer,a,4)[d]=p):h==="vec2i"?void(new Int32Array(this.buffer,a,2)[d]=p):h==="vec3i"?void(new Int32Array(this.buffer,a,3)[d]=p):h==="vec4i"?void(new Int32Array(this.buffer,a,4)[d]=p):h==="vec2u"?void(new Uint32Array(this.buffer,a,2)[d]=p):h==="vec3u"?void(new Uint32Array(this.buffer,a,3)[d]=p):h==="vec4u"?void(new Uint32Array(this.buffer,a,4)[d]=p):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}i=i.postfix}this.setData(e,t,l,a,s)}setData(e,t,i,s,a){const l=i.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool"){if(l==="vec2f"||l==="vec2h"){const u=new Float32Array(this.buffer,s,2);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3f"||l==="vec3h"){const u=new Float32Array(this.buffer,s,3);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4f"||l==="vec4h"){const u=new Float32Array(this.buffer,s,4);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2i"){const u=new Int32Array(this.buffer,s,2);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3i"){const u=new Int32Array(this.buffer,s,3);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4i"){const u=new Int32Array(this.buffer,s,4);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2u"){const u=new Uint32Array(this.buffer,s,2);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3u"){const u=new Uint32Array(this.buffer,s,3);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4u"){const u=new Uint32Array(this.buffer,s,4);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="vec2b"){const u=new Uint32Array(this.buffer,s,2);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(l==="vec3b"){const u=new Uint32Array(this.buffer,s,3);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(l==="vec4b"){const u=new Uint32Array(this.buffer,s,4);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="mat2x2f"||l==="mat2x2h"){const u=new Float32Array(this.buffer,s,4);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(l==="mat2x3f"||l==="mat2x3h"){const u=new Float32Array(this.buffer,s,6);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5]))}if(l==="mat2x4f"||l==="mat2x4h"){const u=new Float32Array(this.buffer,s,8);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7]))}if(l==="mat3x2f"||l==="mat3x2h"){const u=new Float32Array(this.buffer,s,6);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5]))}if(l==="mat3x3f"||l==="mat3x3h"){const u=new Float32Array(this.buffer,s,9);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8]))}if(l==="mat3x4f"||l==="mat3x4h"){const u=new Float32Array(this.buffer,s,12);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11]))}if(l==="mat4x2f"||l==="mat4x2h"){const u=new Float32Array(this.buffer,s,8);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7]))}if(l==="mat4x3f"||l==="mat4x3h"){const u=new Float32Array(this.buffer,s,12);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11]))}if(l==="mat4x4f"||l==="mat4x4h"){const u=new Float32Array(this.buffer,s,16);return void(t instanceof ye?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11],u[12]=t.data[12],u[13]=t.data[13],u[14]=t.data[14],u[15]=t.data[15]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11],u[12]=t[12],u[13]=t[13],u[14]=t[14],u[15]=t[15]))}if(t instanceof at){if(i===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",l,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`)}else t instanceof N&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof N&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof N&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof N&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,i){var s,a,l;if(t===null)return this;let u=this.offset,h=this.typeInfo;for(;t;){if(t instanceof sa){const p=t.index,m=p instanceof Pn?e.evalExpression(p,i):p;let y=0;if(m instanceof N?y=m.value:typeof m=="number"?y=m:console.error("GetDataValue: Invalid index type",p),h instanceof ns)u+=y*h.stride,h=h.format;else{const v=h.getTypeName();v==="mat4x4"||v==="mat4x4f"||v==="mat4x4h"?(u+=16*y,h=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(t instanceof Ws))return console.error("GetDataValue: Unknown postfix type",t),null;{const p=t.value;if(h instanceof Ji){let m=!1;for(const y of h.members)if(y.name===p){u+=y.offset,h=y.type,m=!0;break}if(!m)return console.error(`GetDataValue: Member ${p} not found`),null}else if(h instanceof vn){const m=h.getTypeName();if(m==="vec2f"||m==="vec3f"||m==="vec4f"||m==="vec2i"||m==="vec3i"||m==="vec4i"||m==="vec2u"||m==="vec3u"||m==="vec4u"||m==="vec2b"||m==="vec3b"||m==="vec4b"||m==="vec2h"||m==="vec3h"||m==="vec4h"||m==="vec2"||m==="vec3"||m==="vec4"){if(p.length>0&&p.length<5){let y="f";const v=[];for(let x=0;x<p.length;++x){const A=p[x].toLowerCase();let E=0;if(A==="x"||A==="r")E=0;else if(A==="y"||A==="g")E=1;else if(A==="z"||A==="b")E=2;else{if(A!=="w"&&A!=="a")return console.error(`Unknown member ${p}`),null;E=3}if(p.length===1){if(m.endsWith("f"))return this.buffer.byteLength<u+4*E+4?(console.log("Insufficient buffer data"),null):new N(new Float32Array(this.buffer,u+4*E,1),e.getTypeInfo("f32"),this);if(m.endsWith("h"))return new N(new Float32Array(this.buffer,u+4*E,1),e.getTypeInfo("f16"),this);if(m.endsWith("i"))return new N(new Int32Array(this.buffer,u+4*E,1),e.getTypeInfo("i32"),this);if(m.endsWith("b"))return new N(new Int32Array(this.buffer,u+4*E,1),e.getTypeInfo("bool"),this);if(m.endsWith("u"))return new N(new Uint32Array(this.buffer,u+4*E,1),e.getTypeInfo("i32"),this)}if(m==="vec2f")v.push(new Float32Array(this.buffer,u,2)[E]);else if(m==="vec3f"){if(u+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const C=new Float32Array(this.buffer,u,3);v.push(C[E])}else if(m==="vec4f")v.push(new Float32Array(this.buffer,u,4)[E]);else if(m==="vec2i")y="i",v.push(new Int32Array(this.buffer,u,2)[E]);else if(m==="vec3i")y="i",v.push(new Int32Array(this.buffer,u,3)[E]);else if(m==="vec4i")y="i",v.push(new Int32Array(this.buffer,u,4)[E]);else if(m==="vec2u"){y="u";const C=new Uint32Array(this.buffer,u,2);v.push(C[E])}else m==="vec3u"?(y="u",v.push(new Uint32Array(this.buffer,u,3)[E])):m==="vec4u"&&(y="u",v.push(new Uint32Array(this.buffer,u,4)[E]))}return v.length===2?h=e.getTypeInfo(`vec2${y}`):v.length===3?h=e.getTypeInfo(`vec3${y}`):v.length===4?h=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${v.length}`),new S(v,h,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${m} is not a struct`),null}}}t=t.postfix}const d=h.getTypeName();return d==="f32"?new N(new Float32Array(this.buffer,u,1),h,this):d==="i32"?new N(new Int32Array(this.buffer,u,1),h,this):d==="u32"?new N(new Uint32Array(this.buffer,u,1),h,this):d==="vec2f"?new S(new Float32Array(this.buffer,u,2),h,this):d==="vec3f"?new S(new Float32Array(this.buffer,u,3),h,this):d==="vec4f"?new S(new Float32Array(this.buffer,u,4),h,this):d==="vec2i"?new S(new Int32Array(this.buffer,u,2),h,this):d==="vec3i"?new S(new Int32Array(this.buffer,u,3),h,this):d==="vec4i"?new S(new Int32Array(this.buffer,u,4),h,this):d==="vec2u"?new S(new Uint32Array(this.buffer,u,2),h,this):d==="vec3u"?new S(new Uint32Array(this.buffer,u,3),h,this):d==="vec4u"?new S(new Uint32Array(this.buffer,u,4),h,this):h instanceof $s&&h.name==="atomic"?((s=h.format)===null||s===void 0?void 0:s.name)==="u32"?new N(new Uint32Array(this.buffer,u,1)[0],h.format,this):((a=h.format)===null||a===void 0?void 0:a.name)==="i32"?new N(new Int32Array(this.buffer,u,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=h.format)===null||l===void 0?void 0:l.name}`),null):new at(this.buffer,h,u,this)}toString(){let e="";if(this.typeInfo instanceof ns)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof Ji?e+="{...}":e="[...]";return e}}class mi extends wn{constructor(e,t,i,s){super(t,null),this.data=e,this.descriptor=i,this.view=s}clone(){return new mi(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=Pd[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=Pd[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=Pd[e],i=this.width;if(!e||i<=0||!t)return-1;const s=this.height,a=this.depthOrArrayLayers,l=this.dimension;return i/t.blockWidth*(l==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*a}getPixel(e,t,i=0,s=0){const a=this.texelByteSize,l=this.bytesPerRow,u=this.height,h=this.data[s];return lN(new Uint8Array(h),e,t,i,s,u,l,a,this.format)}setPixel(e,t,i,s,a){const l=this.texelByteSize,u=this.bytesPerRow,h=this.height,d=this.data[s];(function(p,m,y,v,x,A,E,C,D,M){const B=v*(E>>=x)*(A>>=x)+y*E+m*C;switch(D){case"r8unorm":return void Fe(p,B,"8unorm",1,M);case"r8snorm":return void Fe(p,B,"8snorm",1,M);case"r8uint":return void Fe(p,B,"8uint",1,M);case"r8sint":return void Fe(p,B,"8sint",1,M);case"rg8unorm":return void Fe(p,B,"8unorm",2,M);case"rg8snorm":return void Fe(p,B,"8snorm",2,M);case"rg8uint":return void Fe(p,B,"8uint",2,M);case"rg8sint":return void Fe(p,B,"8sint",2,M);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Fe(p,B,"8unorm",4,M);case"rgba8snorm":return void Fe(p,B,"8snorm",4,M);case"rgba8uint":return void Fe(p,B,"8uint",4,M);case"rgba8sint":return void Fe(p,B,"8sint",4,M);case"r16uint":return void Fe(p,B,"16uint",1,M);case"r16sint":return void Fe(p,B,"16sint",1,M);case"r16float":return void Fe(p,B,"16float",1,M);case"rg16uint":return void Fe(p,B,"16uint",2,M);case"rg16sint":return void Fe(p,B,"16sint",2,M);case"rg16float":return void Fe(p,B,"16float",2,M);case"rgba16uint":return void Fe(p,B,"16uint",4,M);case"rgba16sint":return void Fe(p,B,"16sint",4,M);case"rgba16float":return void Fe(p,B,"16float",4,M);case"r32uint":return void Fe(p,B,"32uint",1,M);case"r32sint":return void Fe(p,B,"32sint",1,M);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Fe(p,B,"32float",1,M);case"rg32uint":return void Fe(p,B,"32uint",2,M);case"rg32sint":return void Fe(p,B,"32sint",2,M);case"rg32float":return void Fe(p,B,"32float",2,M);case"rgba32uint":return void Fe(p,B,"32uint",4,M);case"rgba32sint":return void Fe(p,B,"32sint",4,M);case"rgba32float":return void Fe(p,B,"32float",4,M);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,i,s,h,u,l,this.format,a)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(k||(k={}));class P{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class w{}L=w,w.none=new P("",k.reserved,""),w.eof=new P("EOF",k.token,""),w.reserved={asm:new P("asm",k.reserved,"asm"),bf16:new P("bf16",k.reserved,"bf16"),do:new P("do",k.reserved,"do"),enum:new P("enum",k.reserved,"enum"),f16:new P("f16",k.reserved,"f16"),f64:new P("f64",k.reserved,"f64"),handle:new P("handle",k.reserved,"handle"),i8:new P("i8",k.reserved,"i8"),i16:new P("i16",k.reserved,"i16"),i64:new P("i64",k.reserved,"i64"),mat:new P("mat",k.reserved,"mat"),premerge:new P("premerge",k.reserved,"premerge"),regardless:new P("regardless",k.reserved,"regardless"),typedef:new P("typedef",k.reserved,"typedef"),u8:new P("u8",k.reserved,"u8"),u16:new P("u16",k.reserved,"u16"),u64:new P("u64",k.reserved,"u64"),unless:new P("unless",k.reserved,"unless"),using:new P("using",k.reserved,"using"),vec:new P("vec",k.reserved,"vec"),void:new P("void",k.reserved,"void")},w.keywords={array:new P("array",k.keyword,"array"),atomic:new P("atomic",k.keyword,"atomic"),bool:new P("bool",k.keyword,"bool"),f32:new P("f32",k.keyword,"f32"),i32:new P("i32",k.keyword,"i32"),mat2x2:new P("mat2x2",k.keyword,"mat2x2"),mat2x3:new P("mat2x3",k.keyword,"mat2x3"),mat2x4:new P("mat2x4",k.keyword,"mat2x4"),mat3x2:new P("mat3x2",k.keyword,"mat3x2"),mat3x3:new P("mat3x3",k.keyword,"mat3x3"),mat3x4:new P("mat3x4",k.keyword,"mat3x4"),mat4x2:new P("mat4x2",k.keyword,"mat4x2"),mat4x3:new P("mat4x3",k.keyword,"mat4x3"),mat4x4:new P("mat4x4",k.keyword,"mat4x4"),ptr:new P("ptr",k.keyword,"ptr"),sampler:new P("sampler",k.keyword,"sampler"),sampler_comparison:new P("sampler_comparison",k.keyword,"sampler_comparison"),struct:new P("struct",k.keyword,"struct"),texture_1d:new P("texture_1d",k.keyword,"texture_1d"),texture_2d:new P("texture_2d",k.keyword,"texture_2d"),texture_2d_array:new P("texture_2d_array",k.keyword,"texture_2d_array"),texture_3d:new P("texture_3d",k.keyword,"texture_3d"),texture_cube:new P("texture_cube",k.keyword,"texture_cube"),texture_cube_array:new P("texture_cube_array",k.keyword,"texture_cube_array"),texture_multisampled_2d:new P("texture_multisampled_2d",k.keyword,"texture_multisampled_2d"),texture_storage_1d:new P("texture_storage_1d",k.keyword,"texture_storage_1d"),texture_storage_2d:new P("texture_storage_2d",k.keyword,"texture_storage_2d"),texture_storage_2d_array:new P("texture_storage_2d_array",k.keyword,"texture_storage_2d_array"),texture_storage_3d:new P("texture_storage_3d",k.keyword,"texture_storage_3d"),texture_depth_2d:new P("texture_depth_2d",k.keyword,"texture_depth_2d"),texture_depth_2d_array:new P("texture_depth_2d_array",k.keyword,"texture_depth_2d_array"),texture_depth_cube:new P("texture_depth_cube",k.keyword,"texture_depth_cube"),texture_depth_cube_array:new P("texture_depth_cube_array",k.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new P("texture_depth_multisampled_2d",k.keyword,"texture_depth_multisampled_2d"),texture_external:new P("texture_external",k.keyword,"texture_external"),u32:new P("u32",k.keyword,"u32"),vec2:new P("vec2",k.keyword,"vec2"),vec3:new P("vec3",k.keyword,"vec3"),vec4:new P("vec4",k.keyword,"vec4"),bitcast:new P("bitcast",k.keyword,"bitcast"),block:new P("block",k.keyword,"block"),break:new P("break",k.keyword,"break"),case:new P("case",k.keyword,"case"),continue:new P("continue",k.keyword,"continue"),continuing:new P("continuing",k.keyword,"continuing"),default:new P("default",k.keyword,"default"),diagnostic:new P("diagnostic",k.keyword,"diagnostic"),discard:new P("discard",k.keyword,"discard"),else:new P("else",k.keyword,"else"),enable:new P("enable",k.keyword,"enable"),fallthrough:new P("fallthrough",k.keyword,"fallthrough"),false:new P("false",k.keyword,"false"),fn:new P("fn",k.keyword,"fn"),for:new P("for",k.keyword,"for"),function:new P("function",k.keyword,"function"),if:new P("if",k.keyword,"if"),let:new P("let",k.keyword,"let"),const:new P("const",k.keyword,"const"),loop:new P("loop",k.keyword,"loop"),while:new P("while",k.keyword,"while"),private:new P("private",k.keyword,"private"),read:new P("read",k.keyword,"read"),read_write:new P("read_write",k.keyword,"read_write"),return:new P("return",k.keyword,"return"),requires:new P("requires",k.keyword,"requires"),storage:new P("storage",k.keyword,"storage"),switch:new P("switch",k.keyword,"switch"),true:new P("true",k.keyword,"true"),alias:new P("alias",k.keyword,"alias"),type:new P("type",k.keyword,"type"),uniform:new P("uniform",k.keyword,"uniform"),var:new P("var",k.keyword,"var"),override:new P("override",k.keyword,"override"),workgroup:new P("workgroup",k.keyword,"workgroup"),write:new P("write",k.keyword,"write"),r8unorm:new P("r8unorm",k.keyword,"r8unorm"),r8snorm:new P("r8snorm",k.keyword,"r8snorm"),r8uint:new P("r8uint",k.keyword,"r8uint"),r8sint:new P("r8sint",k.keyword,"r8sint"),r16uint:new P("r16uint",k.keyword,"r16uint"),r16sint:new P("r16sint",k.keyword,"r16sint"),r16float:new P("r16float",k.keyword,"r16float"),rg8unorm:new P("rg8unorm",k.keyword,"rg8unorm"),rg8snorm:new P("rg8snorm",k.keyword,"rg8snorm"),rg8uint:new P("rg8uint",k.keyword,"rg8uint"),rg8sint:new P("rg8sint",k.keyword,"rg8sint"),r32uint:new P("r32uint",k.keyword,"r32uint"),r32sint:new P("r32sint",k.keyword,"r32sint"),r32float:new P("r32float",k.keyword,"r32float"),rg16uint:new P("rg16uint",k.keyword,"rg16uint"),rg16sint:new P("rg16sint",k.keyword,"rg16sint"),rg16float:new P("rg16float",k.keyword,"rg16float"),rgba8unorm:new P("rgba8unorm",k.keyword,"rgba8unorm"),rgba8unorm_srgb:new P("rgba8unorm_srgb",k.keyword,"rgba8unorm_srgb"),rgba8snorm:new P("rgba8snorm",k.keyword,"rgba8snorm"),rgba8uint:new P("rgba8uint",k.keyword,"rgba8uint"),rgba8sint:new P("rgba8sint",k.keyword,"rgba8sint"),bgra8unorm:new P("bgra8unorm",k.keyword,"bgra8unorm"),bgra8unorm_srgb:new P("bgra8unorm_srgb",k.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new P("rgb10a2unorm",k.keyword,"rgb10a2unorm"),rg11b10float:new P("rg11b10float",k.keyword,"rg11b10float"),rg32uint:new P("rg32uint",k.keyword,"rg32uint"),rg32sint:new P("rg32sint",k.keyword,"rg32sint"),rg32float:new P("rg32float",k.keyword,"rg32float"),rgba16uint:new P("rgba16uint",k.keyword,"rgba16uint"),rgba16sint:new P("rgba16sint",k.keyword,"rgba16sint"),rgba16float:new P("rgba16float",k.keyword,"rgba16float"),rgba32uint:new P("rgba32uint",k.keyword,"rgba32uint"),rgba32sint:new P("rgba32sint",k.keyword,"rgba32sint"),rgba32float:new P("rgba32float",k.keyword,"rgba32float"),static_assert:new P("static_assert",k.keyword,"static_assert")},w.tokens={decimal_float_literal:new P("decimal_float_literal",k.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new P("hex_float_literal",k.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new P("int_literal",k.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new P("uint_literal",k.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new P("name",k.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new P("ident",k.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new P("and",k.token,"&"),and_and:new P("and_and",k.token,"&&"),arrow:new P("arrow ",k.token,"->"),attr:new P("attr",k.token,"@"),forward_slash:new P("forward_slash",k.token,"/"),bang:new P("bang",k.token,"!"),bracket_left:new P("bracket_left",k.token,"["),bracket_right:new P("bracket_right",k.token,"]"),brace_left:new P("brace_left",k.token,"{"),brace_right:new P("brace_right",k.token,"}"),colon:new P("colon",k.token,":"),comma:new P("comma",k.token,","),equal:new P("equal",k.token,"="),equal_equal:new P("equal_equal",k.token,"=="),not_equal:new P("not_equal",k.token,"!="),greater_than:new P("greater_than",k.token,">"),greater_than_equal:new P("greater_than_equal",k.token,">="),shift_right:new P("shift_right",k.token,">>"),less_than:new P("less_than",k.token,"<"),less_than_equal:new P("less_than_equal",k.token,"<="),shift_left:new P("shift_left",k.token,"<<"),modulo:new P("modulo",k.token,"%"),minus:new P("minus",k.token,"-"),minus_minus:new P("minus_minus",k.token,"--"),period:new P("period",k.token,"."),plus:new P("plus",k.token,"+"),plus_plus:new P("plus_plus",k.token,"++"),or:new P("or",k.token,"|"),or_or:new P("or_or",k.token,"||"),paren_left:new P("paren_left",k.token,"("),paren_right:new P("paren_right",k.token,")"),semicolon:new P("semicolon",k.token,";"),star:new P("star",k.token,"*"),tilde:new P("tilde",k.token,"~"),underscore:new P("underscore",k.token,"_"),xor:new P("xor",k.token,"^"),plus_equal:new P("plus_equal",k.token,"+="),minus_equal:new P("minus_equal",k.token,"-="),times_equal:new P("times_equal",k.token,"*="),division_equal:new P("division_equal",k.token,"/="),modulo_equal:new P("modulo_equal",k.token,"%="),and_equal:new P("and_equal",k.token,"&="),or_equal:new P("or_equal",k.token,"|="),xor_equal:new P("xor_equal",k.token,"^="),shift_right_equal:new P("shift_right_equal",k.token,">>="),shift_left_equal:new P("shift_left_equal",k.token,"<<=")},w.simpleTokens={"@":L.tokens.attr,"{":L.tokens.brace_left,"}":L.tokens.brace_right,":":L.tokens.colon,",":L.tokens.comma,"(":L.tokens.paren_left,")":L.tokens.paren_right,";":L.tokens.semicolon},w.literalTokens={"&":L.tokens.and,"&&":L.tokens.and_and,"->":L.tokens.arrow,"/":L.tokens.forward_slash,"!":L.tokens.bang,"[":L.tokens.bracket_left,"]":L.tokens.bracket_right,"=":L.tokens.equal,"==":L.tokens.equal_equal,"!=":L.tokens.not_equal,">":L.tokens.greater_than,">=":L.tokens.greater_than_equal,">>":L.tokens.shift_right,"<":L.tokens.less_than,"<=":L.tokens.less_than_equal,"<<":L.tokens.shift_left,"%":L.tokens.modulo,"-":L.tokens.minus,"--":L.tokens.minus_minus,".":L.tokens.period,"+":L.tokens.plus,"++":L.tokens.plus_plus,"|":L.tokens.or,"||":L.tokens.or_or,"*":L.tokens.star,"~":L.tokens.tilde,_:L.tokens.underscore,"^":L.tokens.xor,"+=":L.tokens.plus_equal,"-=":L.tokens.minus_equal,"*=":L.tokens.times_equal,"/=":L.tokens.division_equal,"%=":L.tokens.modulo_equal,"&=":L.tokens.and_equal,"|=":L.tokens.or_equal,"^=":L.tokens.xor_equal,">>=":L.tokens.shift_right_equal,"<<=":L.tokens.shift_left_equal},w.regexTokens={decimal_float_literal:L.tokens.decimal_float_literal,hex_float_literal:L.tokens.hex_float_literal,int_literal:L.tokens.int_literal,uint_literal:L.tokens.uint_literal,ident:L.tokens.ident},w.storage_class=[L.keywords.function,L.keywords.private,L.keywords.workgroup,L.keywords.uniform,L.keywords.storage],w.access_mode=[L.keywords.read,L.keywords.write,L.keywords.read_write],w.sampler_type=[L.keywords.sampler,L.keywords.sampler_comparison],w.sampled_texture_type=[L.keywords.texture_1d,L.keywords.texture_2d,L.keywords.texture_2d_array,L.keywords.texture_3d,L.keywords.texture_cube,L.keywords.texture_cube_array],w.multisampled_texture_type=[L.keywords.texture_multisampled_2d],w.storage_texture_type=[L.keywords.texture_storage_1d,L.keywords.texture_storage_2d,L.keywords.texture_storage_2d_array,L.keywords.texture_storage_3d],w.depth_texture_type=[L.keywords.texture_depth_2d,L.keywords.texture_depth_2d_array,L.keywords.texture_depth_cube,L.keywords.texture_depth_cube_array,L.keywords.texture_depth_multisampled_2d],w.texture_external_type=[L.keywords.texture_external],w.any_texture_type=[...L.sampled_texture_type,...L.multisampled_texture_type,...L.storage_texture_type,...L.depth_texture_type,...L.texture_external_type],w.texel_format=[L.keywords.r8unorm,L.keywords.r8snorm,L.keywords.r8uint,L.keywords.r8sint,L.keywords.r16uint,L.keywords.r16sint,L.keywords.r16float,L.keywords.rg8unorm,L.keywords.rg8snorm,L.keywords.rg8uint,L.keywords.rg8sint,L.keywords.r32uint,L.keywords.r32sint,L.keywords.r32float,L.keywords.rg16uint,L.keywords.rg16sint,L.keywords.rg16float,L.keywords.rgba8unorm,L.keywords.rgba8unorm_srgb,L.keywords.rgba8snorm,L.keywords.rgba8uint,L.keywords.rgba8sint,L.keywords.bgra8unorm,L.keywords.bgra8unorm_srgb,L.keywords.rgb10a2unorm,L.keywords.rg11b10float,L.keywords.rg32uint,L.keywords.rg32sint,L.keywords.rg32float,L.keywords.rgba16uint,L.keywords.rgba16sint,L.keywords.rgba16float,L.keywords.rgba32uint,L.keywords.rgba32sint,L.keywords.rgba32float],w.const_literal=[L.tokens.int_literal,L.tokens.uint_literal,L.tokens.decimal_float_literal,L.tokens.hex_float_literal,L.keywords.true,L.keywords.false],w.literal_or_ident=[L.tokens.ident,L.tokens.int_literal,L.tokens.uint_literal,L.tokens.decimal_float_literal,L.tokens.hex_float_literal,L.tokens.name],w.element_count_expression=[L.tokens.int_literal,L.tokens.uint_literal,L.tokens.ident],w.template_types=[L.keywords.vec2,L.keywords.vec3,L.keywords.vec4,L.keywords.mat2x2,L.keywords.mat2x3,L.keywords.mat2x4,L.keywords.mat3x2,L.keywords.mat3x3,L.keywords.mat3x4,L.keywords.mat4x2,L.keywords.mat4x3,L.keywords.mat4x4,L.keywords.atomic,L.keywords.bitcast,...L.any_texture_type],w.attribute_name=[L.tokens.ident,L.keywords.block,L.keywords.diagnostic],w.assignment_operators=[L.tokens.equal,L.tokens.plus_equal,L.tokens.minus_equal,L.tokens.times_equal,L.tokens.division_equal,L.tokens.modulo_equal,L.tokens.and_equal,L.tokens.or_equal,L.tokens.xor_equal,L.tokens.shift_right_equal,L.tokens.shift_left_equal],w.increment_operators=[L.tokens.plus_plus,L.tokens.minus_minus];class Tv{constructor(e,t,i,s,a){this.type=e,this.lexeme=t,this.line=i,this.start=s,this.end=a}toString(){return this.lexeme}isTemplateType(){return w.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==w.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class gN{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Tv(w.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const t=w.simpleTokens[e];if(t)return this._addToken(t),!0;let i=w.none;const s=this._isAlpha(e),a=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(s){const l=w.keywords[e];if(l)return this._addToken(l),!0}if(s||a)return this._addToken(w.tokens.ident),!0;for(;;){let l=this._findType(e);const u=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(u=="=")return this._current++,e+=u,this._addToken(w.tokens.minus_equal),!0;if(u=="-")return this._current++,e+=u,this._addToken(w.tokens.minus_minus),!0;const h=this._tokens.length-1;if((w.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==w.tokens.paren_right)&&u!=">")return this._addToken(l),!0}if(e==">"&&(u==">"||u=="=")){let h=!1,d=this._tokens.length-1;for(let p=0;p<5&&d>=0&&w.assignment_operators.indexOf(this._tokens[d].type)===-1;++p,--d)if(this._tokens[d].type===w.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(l),!0}if(l===w.none){let h=e,d=0;const p=2;for(let m=0;m<p;++m)if(h+=this._peekAhead(m),l=this._findType(h),l!==w.none){d=m;break}if(l===w.none)return i!==w.none&&(this._current--,this._addToken(i),!0);e=h,this._current+=d+1}if(i=l,this._isAtEnd())break;e+=this._advance()}return i!==w.none&&(this._addToken(i),!0)}_findType(e){for(const i in w.regexTokens){const s=w.regexTokens[i];if(this._match(e,s.rule))return s}return w.literalTokens[e]||w.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new Tv(e,t,this._line,this._start,this._current))}}function re(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const bu=new Float32Array(1),_N=new Uint32Array(bu.buffer),mN=new Uint32Array(bu.buffer),vu=new Int32Array(1),yN=new Float32Array(vu.buffer),bN=new Uint32Array(vu.buffer),Tu=new Uint32Array(1),vN=new Float32Array(Tu.buffer),TN=new Int32Array(Tu.buffer);function xv(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return bu[0]=n,_N[0];if(t==="u32")return bu[0]=n,mN[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return vu[0]=n,yN[0];if(t==="u32")return vu[0]=n,bN[0]}else if(e==="u32"){if(t==="f32")return Tu[0]=n,vN[0];if(t==="i32"||t==="x32")return Tu[0]=n,TN[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class xN{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Mc{constructor(e,t){this.align=e,this.size=t}}class $n{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new sN,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof Lo&&this._functions.set(t.name,new xN(t));for(const t of e)if(t instanceof _i){const i=this.getTypeInfo(t,null);i instanceof Ji&&this.structs.push(i)}for(const t of e)if(t instanceof Rg)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Ag){const i=t,s=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new tN(i.name,a,i.attributes,s));continue}if(this._isUniformVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=new Cc(i.name,l,s,a,i.attributes,Ki.Uniform,i.access);u.access||(u.access="read"),this.uniforms.push(u);continue}if(this._isStorageVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(l),h=new Cc(i.name,l,s,a,i.attributes,u?Ki.StorageTexture:Ki.Storage,i.access);h.access||(h.access="read"),this.storage.push(h);continue}if(this._isTextureVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(l),h=new Cc(i.name,l,s,a,i.attributes,u?Ki.StorageTexture:Ki.Texture,i.access);h.access||(h.access="read"),u?this.storage.push(h):this.textures.push(h);continue}if(this._isSamplerVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),l=this.getTypeInfo(i.type,i.attributes),u=new Cc(i.name,l,s,a,i.attributes,Ki.Sampler,i.access);this.samplers.push(u);continue}}for(const t of e)if(t instanceof Lo){const i=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),a=this._getAttribute(t,"compute"),l=i||s||a,u=new iN(t.name,l?.name,t.attributes);u.attributes=t.attributes,u.startLine=t.startLine,u.endLine=t.endLine,this.functions.push(u),this._functions.get(t.name).info=u,l&&(this._functions.get(t.name).inUse=!0,u.inUse=!0,u.resources=this._findResources(t,!!l),u.inputs=this._getInputs(t.args),u.outputs=this._getOutputs(t.returnType),this.entry[l.name].push(u)),u.arguments=t.args.map(h=>new nN(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),u.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var s,a,l;if(i instanceof HT){if(i.value)if(re(i.value))for(const u of i.value)for(const h of this.overrides)u===h.name&&((s=t.info)===null||s===void 0||s.overrides.push(h));else for(const u of this.overrides)i.value===u.name&&((a=t.info)===null||a===void 0||a.overrides.push(u))}else if(i instanceof an)for(const u of this.overrides)i.name===u.name&&((l=t.info)===null||l===void 0||l.overrides.push(u))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const s of e.calls){const a=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;a&&t.add(a)}}findResource(e,t,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}for(const s of this.entry.vertex)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}for(const s of this.entry.fragment)if(s.name===i){for(const a of s.resources)if(a.group==e&&a.binding==t)return a}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],s=this,a=[];return e.search(l=>{if(l instanceof mu)a.push({});else if(l instanceof yu)a.pop();else if(l instanceof yi){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type),a.length>0&&(a[a.length-1][u.name]=u)}else if(l instanceof Vn){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type)}else if(l instanceof Co){const u=l;t&&u.type!==null&&this._markStructsFromAST(u.type),a.length>0&&(a[a.length-1][u.name]=u)}else if(l instanceof an){const u=l;if(a.length>0&&a[a.length-1][u.name])return;const h=s._findResource(u.name);h&&i.push(h)}else if(l instanceof Cg){const u=l,h=s._functions.get(u.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,t)),i.push(...h.resources))}else if(l instanceof Eg){const u=l,h=s._functions.get(u.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,t)),i.push(...h.resources))}}),[...new Map(i.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function t(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof _i)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof _i)this._getStructOutputs(i.type,t);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const a=this.getTypeInfo(i.type,i.type.attributes),l=this._parseInt(s.value),u=new _v(i.name,a,s.name,l);t.push(u)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new _v("",i,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof _i)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof _i)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),a=this._parseInt(t.value),l=new eN(e.name,s,t.name,a);return i!==null&&(l.interpolation=this._parseString(i.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new JI(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Wc){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,a=new vp(e.name,s,t);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Mo){const s=e,a=s.format?this.getTypeInfo(s.format,s.attributes):null,l=new ns(s.name,t);return l.format=a,l.count=s.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof _i){const s=e,a=new Ji(s.name,t);a.startLine=s.startLine,a.endLine=s.endLine;for(const l of s.members){const u=this.getTypeInfo(l.type,l.attributes);a.members.push(new gv(l.name,u,l.attributes))}return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof xo){const s=e,a=s.format instanceof K,l=s.format?a?this.getTypeInfo(s.format,null):new vn(s.format,null):null,u=new $s(s.name,l,t,s.access);return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof F){const s=e,a=s.format?this.getTypeInfo(s.format,null):null,l=new $s(s.name,a,t,s.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const i=new vn(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,s;const a=this._getTypeSize(e);if(e.size=(t=a?.size)!==null&&t!==void 0?t:0,e instanceof ns&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((i=l?.size)!==null&&i!==void 0?i:0,(s=l?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof vp&&this._updateTypeInfo(e.format),e instanceof Ji&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,s=0,a=0,l=0;for(let u=0,h=e.members.length;u<h;++u){const d=e.members[u],p=this._getTypeSize(d);if(!p)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const m=p.align,y=p.size;i=this._roundUp(m,i+s),s=y,a=i,l=Math.max(l,m),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(l,a+s),e.align=l}_getTypeSize(e){var t,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),a=this._getAttributeNum(e.attributes,"align",0);if(e instanceof gv&&(e=e.type),e instanceof vn){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=$n._typeInfo[e.name];if(l!==void 0){const u=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Mc(Math.max(a,l.align/u),Math.max(s,l.size/u))}}{const l=$n._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const u=e.name[e.name.length-1]==="h"?2:1;return new Mc(Math.max(a,l.align/u),Math.max(s,l.size/u))}}if(e instanceof ns){let l=e,u=8,h=8;const d=this._getTypeSize(l.format);return d!==null&&(h=d.size,u=d.align),h=l.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(u,h)),s&&(h=s),new Mc(Math.max(a,u),Math.max(s,h))}if(e instanceof Ji){let l=0,u=0,h=0,d=0,p=0;for(const m of e.members){const y=this._getTypeSize(m.type);y!==null&&(l=Math.max(y.align,l),h=this._roundUp(y.align,h+d),d=y.size,p=h)}return u=this._roundUp(l,p+d),new Mc(Math.max(a,l),Math.max(s,u))}return null}_isUniformVar(e){return e instanceof yi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof yi&&e.storage=="storage"}_isTextureVar(e){return e instanceof yi&&e.type!==null&&$n._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof yi&&e.type!==null&&$n._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let a of s)if(a.name==t)return a;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let s of e)if(s.name==t){let a=s!==null&&s.value!==null?s.value:i;return a instanceof Array&&(a=a[0]),typeof a=="number"?a:typeof a=="string"?parseInt(a):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}$n._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},$n._textureTypes=w.any_texture_type.map(n=>n.name),$n._samplerTypes=w.sampler_type.map(n=>n.name);let Mg=0;class Og{constructor(e,t,i){this.id=Mg++,this.name=e,this.value=t,this.node=i}clone(){return new Og(this.name,this.value,this.node)}}class Ig{constructor(e){this.id=Mg++,this.name=e.name,this.node=e}clone(){return new Ig(this.node)}}class Ng{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Mg++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new Og(e,t,i??null))}setVariable(e,t,i){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i?.value)!==null&&t!==void 0?t:null}clone(){return new Ng(this)}}class wN{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class SN{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let s=!0;if(i instanceof S)return i.data.forEach(a=>{a||(s=!1)}),new N(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S){const s=i.data.some(a=>a);return new N(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof N))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.evalExpression(i,t);if(s instanceof at&&s.typeInfo.size===0){const a=s.typeInfo,l=s.buffer.byteLength/a.stride;return new N(l,this.getTypeInfo("u32"))}return new N(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.abs(a)),i.typeInfo);const s=i;return new N(Math.abs(s.value),s.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.acos(a)),i.typeInfo);const s=i;return new N(Math.acos(s.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.acosh(a)),i.typeInfo);const s=i;return new N(Math.acosh(s.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.asin(a)),i.typeInfo);const s=i;return new N(Math.asin(s.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.asinh(a)),i.typeInfo);const s=i;return new N(Math.asinh(s.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.atan(a)),i.typeInfo);const s=i;return new N(Math.atan(s.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.atanh(a)),i.typeInfo);const s=i;return new N(Math.atanh(s.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((u,h)=>Math.atan2(u,s.data[h])),i.typeInfo);const a=i,l=s;return new N(Math.atan2(a.value,l.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.ceil(a)),i.typeInfo);const s=i;return new N(Math.ceil(s.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&a instanceof S)return new S(i.data.map((d,p)=>this._clamp(d,s.data[p],a.data[p])),i.typeInfo);const l=i,u=s,h=a;return new N(this._clamp(l.value,u.value,h.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.cos(a)),i.typeInfo);const s=i;return new N(Math.cos(s.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.cosh(a)),i.typeInfo);const s=i;return new N(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.clz32(a)),i.typeInfo);const s=i;return new N(Math.clz32(s.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>this._countOneBits(a)),i.typeInfo);const s=i;return new N(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>this._countTrailingZeros(a)),i.typeInfo);const s=i;return new N(this._countTrailingZeros(s.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const a=i.data,l=s.data;return new S([a[1]*l[2]-l[1]*a[2],a[2]*l[0]-l[2]*a[0],a[0]*l[1]-l[0]*a[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return i instanceof S?new S(i.data.map(a=>a*s),i.typeInfo):new N(i.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof ye){const s=i.data,a=i.typeInfo.getTypeName(),l=a.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(a==="mat2x2"||a==="mat2x2f"||a==="mat2x2h")return new N(s[0]*s[3]-s[1]*s[2],l);if(a==="mat2x3"||a==="mat2x3f"||a==="mat2x3h")return new N(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);if(a==="mat2x4"||a==="mat2x4f"||a==="mat2x4h")console.error(`TODO: Determinant for ${a}`);else if(a==="mat3x2"||a==="mat3x2f"||a==="mat3x2h")console.error(`TODO: Determinant for ${a}`);else{if(a==="mat3x3"||a==="mat3x3f"||a==="mat3x3h")return new N(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),l);a==="mat3x4"||a==="mat3x4f"||a==="mat3x4h"||a==="mat4x2"||a==="mat4x2f"||a==="mat4x2h"||a==="mat4x3"||a==="mat4x3f"||a==="mat4x3h"?console.error(`TODO: Determinant for ${a}`):a!=="mat4x4"&&a!=="mat4x4f"&&a!=="mat4x4h"||console.error(`TODO: Determinant for ${a}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S){let u=0;for(let h=0;h<i.data.length;++h)u+=(i.data[h]-s.data[h])*(i.data[h]-s.data[h]);return new N(Math.sqrt(u),this.getTypeInfo("f32"))}const a=i,l=s;return new N(Math.abs(a.value-l.value),i.typeInfo)}_dot(e,t){let i=0;for(let s=0;s<e.length;++s)i+=t[s]*e[s];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return i instanceof S&&s instanceof S?new N(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.exp(a)),i.typeInfo);const s=i;return new N(Math.exp(s.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.pow(2,a)),i.typeInfo);const s=i;return new N(Math.pow(2,s.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=s.value,u=a.value;if(i instanceof S)return new S(i.data.map(d=>d>>l&(1<<u)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const h=i.value;return new N(h>>l&(1<<u)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&a instanceof S){const l=this._dot(s.data,a.data);return new S(l<0?Array.from(i.data):i.data.map(u=>-u),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>this._firstLeadingBit(a)),i.typeInfo);const s=i;return new N(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>this._firstTrailingBit(a)),i.typeInfo);const s=i;return new N(this._firstTrailingBit(s.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.floor(a)),i.typeInfo);const s=i;return new N(Math.floor(s.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&a instanceof S)return i.data.length!==s.data.length||i.data.length!==a.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new S(i.data.map((d,p)=>d*s.data[p]+a.data[p]),i.typeInfo);const l=i,u=s,h=a;return new N(l.value*u.value+h.value,l.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>a-Math.floor(a)),i.typeInfo);const s=i;return new N(s.value-Math.floor(s.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t),l=this.exec.evalExpression(e.args[3],t);if(a.typeInfo.name!=="u32"&&a.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const u=a.value,h=(1<<l.value)-1<<u,d=~h;if(i instanceof S&&s instanceof S)return new S(i.data.map((y,v)=>y&d|s.data[v]<<u&h),i.typeInfo);const p=i.value,m=s.value;return new N(p&d|m<<u&h,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>1/Math.sqrt(a)),i.typeInfo);const s=i;return new N(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S){let a=0;return i.data.forEach(l=>{a+=l*l}),new N(Math.sqrt(a),this.getTypeInfo("f32"))}const s=i;return new N(Math.abs(s.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.log(a)),i.typeInfo);const s=i;return new N(Math.log(s.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.log2(a)),i.typeInfo);const s=i;return new N(Math.log2(s.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((u,h)=>Math.max(u,s.data[h])),i.typeInfo);const a=i,l=s;return new N(Math.max(a.value,l.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((u,h)=>Math.min(u,s.data[h])),i.typeInfo);const a=i,l=s;return new N(Math.min(a.value,l.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&a instanceof S)return new S(i.data.map((h,d)=>i.data[d]*(1-a.data[d])+s.data[d]*a.data[d]),i.typeInfo);const l=s,u=a;return new N(i.value*(1-u.value)+l.value*u.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((l,u)=>l%s.data[u]),i.typeInfo);const a=s;return new N(i.value%a.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S){const s=this.Length(e,t).value;return new S(i.data.map(a=>a/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((u,h)=>Math.pow(u,s.data[h])),i.typeInfo);const a=i,l=s;return new N(Math.pow(a.value,l.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof S?new S(i.data.map(s=>s),i.typeInfo):new N(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof S?new S(i.data.map(s=>s*Math.PI/180),i.typeInfo):new N(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S){const a=this._dot(i.data,s.data);return new S(i.data.map((l,u)=>l-2*a*s.data[u]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&a instanceof N){const l=this._dot(s.data,i.data);return new S(i.data.map((u,h)=>{const d=1-a.value*a.value*(1-l*l);if(d<0)return 0;const p=Math.sqrt(d);return a.value*u-(a.value*l+p)*s.data[h]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.round(a)),i.typeInfo);const s=i;return new N(Math.round(s.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.min(Math.max(a,0),1)),i.typeInfo);const s=i;return new N(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.sign(a)),i.typeInfo);const s=i;return new N(Math.sign(s.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.sin(a)),i.typeInfo);const s=i;return new N(Math.sin(s.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.sinh(a)),i.typeInfo);const s=i;return new N(Math.sinh(s.value),i.typeInfo)}_smoothstep(e,t,i){const s=Math.min(Math.max((i-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),a=this.exec.evalExpression(e.args[2],t);if(a instanceof S&&i instanceof S&&s instanceof S)return new S(a.data.map((d,p)=>this._smoothstep(i.data[p],s.data[p],d)),a.typeInfo);const l=i,u=s,h=a;return new N(this._smoothstep(l.value,u.value,h.value),a.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.sqrt(a)),i.typeInfo);const s=i;return new N(Math.sqrt(s.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof S&&i instanceof S)return new S(s.data.map((l,u)=>l<i.data[u]?0:1),s.typeInfo);const a=i;return new N(s.value<a.value?0:1,a.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.tan(a)),i.typeInfo);const s=i;return new N(Math.tan(s.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.tanh(a)),i.typeInfo);const s=i;return new N(Math.tanh(s.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof ye))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const a=i.data;return new ye([a[0],a[2],a[1],a[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const a=i.data;return new ye([a[0],a[3],a[6],a[1],a[4],a[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const a=i.data;return new ye([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const a=i.data;return new ye([a[0],a[3],a[1],a[4],a[2],a[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const a=i.data;return new ye([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const a=i.data;return new ye([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const a=i.data;return new ye([a[0],a[4],a[1],a[5],a[2],a[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const a=i.data;return new ye([a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const a=i.data;return new ye([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(a=>Math.trunc(a)),i.typeInfo);const s=i;return new N(Math.trunc(s.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof an){const a=i.name,l=t.getVariableValue(a);if(l instanceof mi){if(s<0||s>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const u=l.getMipLevelSize(s),h=l.dimension;return h==="1d"?new N(u[0],this.getTypeInfo("u32")):h==="3d"?new S(u,this.getTypeInfo("vec3u")):h==="2d"?new S(u.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${e.line}`),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),a=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof S)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof an){const l=i.name,u=t.getVariableValue(l);if(u instanceof mi){const h=Math.floor(s.data[0]),d=Math.floor(s.data[1]);if(h<0||h>=u.width||d<0||d>=u.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const p=u.getPixel(h,d,0,a);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new S(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof an){const s=i.name,a=t.getVariableValue(s);return a instanceof mi?new N(a.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof an){const s=i.name,a=t.getVariableValue(s);return a instanceof mi?new N(a.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof an){const s=i.name,a=t.getVariableValue(s);return a instanceof mi?new N(a.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),a=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof S)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof an){const u=i.name,h=t.getVariableValue(u);if(h instanceof mi){const d=h.getMipLevelSize(0),p=Math.floor(s.data[0]),m=Math.floor(s.data[1]);return p<0||p>=d[0]||m<0||m>=d[1]?(console.error(`Texture ${u} out of bounds. Line ${e.line}`),null):(h.setPixel(p,m,0,a,Array.from(l)),null)}return console.error(`Texture ${u} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t);return t.getVariable(s).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t);return h instanceof N&&u instanceof N&&(h.value=u.value),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value+=u.value),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicSub(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value-=u.value),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicMax(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=Math.max(h.value,u.value)),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicMin(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=Math.min(h.value,u.value)),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicAnd(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=h.value&u.value),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicOr(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=h.value|u.value),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicXor(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=h.value^u.value),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicExchange(e,t){let i=e.args[0];i instanceof pt&&(i=i.right);const s=this.exec.getVariableName(i,t),a=t.getVariable(s);let l=e.args[1];const u=this.exec.evalExpression(l,t),h=a.value.getSubData(this.exec,i.postfix,t),d=new N(h.value,h.typeInfo);return h instanceof N&&u instanceof N&&(h.value=u.value),a.value instanceof at&&a.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Dd={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Dt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class It extends wN{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new $n,this.reflection.updateAST(this.ast),this.context=(i=t?.clone())!==null&&i!==void 0?i:new Ng,this.builtins=new SN(this),this.typeInfo={bool:this.getTypeInfo(K.bool),i32:this.getTypeInfo(K.i32),u32:this.getTypeInfo(K.u32),f32:this.getTypeInfo(K.f32),f16:this.getTypeInfo(K.f16),vec2f:this.getTypeInfo(F.vec2f),vec2u:this.getTypeInfo(F.vec2u),vec2i:this.getTypeInfo(F.vec2i),vec2h:this.getTypeInfo(F.vec2h),vec3f:this.getTypeInfo(F.vec3f),vec3u:this.getTypeInfo(F.vec3u),vec3i:this.getTypeInfo(F.vec3i),vec3h:this.getTypeInfo(F.vec3h),vec4f:this.getTypeInfo(F.vec4f),vec4u:this.getTypeInfo(F.vec4u),vec4i:this.getTypeInfo(F.vec4i),vec4h:this.getTypeInfo(F.vec4h),mat2x2f:this.getTypeInfo(F.mat2x2f),mat2x3f:this.getTypeInfo(F.mat2x3f),mat2x4f:this.getTypeInfo(F.mat2x4f),mat3x2f:this.getTypeInfo(F.mat3x2f),mat3x3f:this.getTypeInfo(F.mat3x3f),mat3x4f:this.getTypeInfo(F.mat3x4f),mat4x2f:this.getTypeInfo(F.mat4x2f),mat4x3f:this.getTypeInfo(F.mat4x3f),mat4x4f:this.getTypeInfo(F.mat4x4f)}}getVariableValue(e){var t,i;const s=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof N)return s.value;if(s instanceof S||s instanceof ye)return Array.from(s.data);if(s instanceof at&&s.typeInfo instanceof ns){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,s){const a=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,a),this._execStatements(this.ast,a);const l=a.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const u=t[0],h=t[1],d=t[2],p=this.getTypeInfo("vec3u");a.setVariable("@num_workgroups",new S(t,p));const m=this.reflection.getFunctionInfo(e);m===null&&console.error(`Function ${e} not found in reflection data`);for(const y in i)for(const v in i[y]){const x=i[y][v];a.variables.forEach(A=>{var E;const C=A.node;if(C?.attributes){let D=null,M=null;for(const B of C.attributes)B.name==="binding"?D=B.value:B.name==="group"&&(M=B.value);if(v==D&&y==M){let B=!1;for(const z of m.resources)if(z.name===A.name&&z.group===parseInt(y)&&z.binding===parseInt(v)){B=!0;break}if(B)if(x.texture!==void 0&&x.descriptor!==void 0){const z=new mi(x.texture,this.getTypeInfo(C.type),x.descriptor,(E=x.texture.view)!==null&&E!==void 0?E:null);A.value=z}else x.uniform!==void 0?A.value=new at(x.uniform,this.getTypeInfo(C.type)):A.value=new at(x,this.getTypeInfo(C.type))}}})}for(let y=0;y<d;++y)for(let v=0;v<h;++v)for(let x=0;x<u;++x)a.setVariable("@workgroup_id",new S([x,v,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[x,v,y],a)}execStatement(e,t){if(e instanceof NT)return this.evalExpression(e.value,t);if(e instanceof PT){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof N))throw new Error("Invalid break-if condition");if(!i.value)return null}return It._breakObj}if(e instanceof DT)return It._continueObj;if(e instanceof Co)this._let(e,t);else if(e instanceof yi)this._var(e,t);else if(e instanceof $c)this._const(e,t);else if(e instanceof Lo)this._function(e,t);else{if(e instanceof IT)return this._if(e,t);if(e instanceof OT)return this._switch(e,t);if(e instanceof ET)return this._for(e,t);if(e instanceof AT)return this._while(e,t);if(e instanceof MT)return this._loop(e,t);if(e instanceof Tp){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof CT)this._assign(e,t);else if(e instanceof RT)this._increment(e,t);else{if(e instanceof _i)return null;if(e instanceof Ag){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new N(0,this.getTypeInfo("u32")))}else if(e instanceof Eg)this._call(e,t);else{if(e instanceof kT||e instanceof Rg)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Cn?this._evalBinaryOp(e,t):e instanceof mt?this._evalLiteral(e,t):e instanceof an?this._evalVariable(e,t):e instanceof Cg?this._evalCall(e,t):e instanceof Vn?this._evalCreate(e,t):e instanceof BT?this._evalConst(e,t):e instanceof UT?this._evalBitcast(e,t):e instanceof pt?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof K){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const s=e[i],a=this.reflection.getOverrideInfo(i);a!==null?(a.type===null&&(a.type=this.getTypeInfo("u32")),a.type.name==="u32"||a.type.name==="i32"||a.type.name==="f32"||a.type.name==="f16"?t.setVariable(i,new N(s,a.type)):a.type.name==="bool"?t.setVariable(i,new N(s?1:0,a.type)):a.type.name==="vec2"||a.type.name==="vec3"||a.type.name==="vec4"||a.type.name==="vec2f"||a.type.name==="vec3f"||a.type.name==="vec4f"||a.type.name==="vec2i"||a.type.name==="vec3i"||a.type.name==="vec4i"||a.type.name==="vec2u"||a.type.name==="vec3u"||a.type.name==="vec4u"||a.type.name==="vec2h"||a.type.name==="vec3h"||a.type.name==="vec4h"?t.setVariable(i,new S(s,a.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const s=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const m=i.getVariableValue(p.value[0]);s[0]=m instanceof N?m.value:parseInt(p.value[0])}if(p.value.length>1){const m=i.getVariableValue(p.value[1]);s[1]=m instanceof N?m.value:parseInt(p.value[1])}if(p.value.length>2){const m=i.getVariableValue(p.value[2]);s[2]=m instanceof N?m.value:parseInt(p.value[2])}}const a=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new S(s,a));const u=s[0],h=s[1],d=s[2];for(let p=0,m=0;p<d;++p)for(let y=0;y<h;++y)for(let v=0;v<u;++v,++m){const x=[v,y,p],A=[v+t[0]*s[0],y+t[1]*s[1],p+t[2]*s[2]];i.setVariable("@local_invocation_id",new S(x,a)),i.setVariable("@global_invocation_id",new S(A,a)),i.setVariable("@local_invocation_index",new N(m,l)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const s of i.attributes)if(s.name==="builtin"){const a=`@${s.value}`,l=t.getVariable(a);l!==void 0&&t.variables.set(i.name,l)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof pt;)e=e.right;return e instanceof an?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const a=t.clone(),l=this._execStatements(i,a);if(l)return l;continue}const s=this.execStatement(i,t);if(s)return s}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let a=0;a<s.node.args.length;++a){const l=s.node.args[a],u=this.evalExpression(e.args[a],i);i.setVariable(l.name,u,l)}this._execStatements(s.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);s?e.operator==="++"?s.value instanceof N?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof N?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof an){const i=this.getVariableName(e,t),s=t.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof pt){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof zr?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new zr(i)}}return null}_assign(e,t){let i=null,s="<var>",a=null;if(e.variable instanceof pt){const h=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),p=e.operator;if(p==="="){if(h instanceof N||h instanceof S||h instanceof ye){if(d instanceof N||d instanceof S||d instanceof ye&&h.data.length===d.data.length)return void h.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(h instanceof at&&d instanceof at&&h.buffer.byteLength-h.offset>=d.buffer.byteLength-d.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return h instanceof N||h instanceof S||h instanceof ye?d instanceof N||d instanceof S||d instanceof ye?void h.data.set(d.data.map((m,y)=>h.data[y]+m)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(h instanceof N||h instanceof S||h instanceof ye)&&(d instanceof N||d instanceof S||d instanceof ye)?void h.data.set(d.data.map((m,y)=>h.data[y]-m)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof pt){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const h=t.getVariable(s);if(!(h&&h.value instanceof zr))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);i=h.value.reference;let d=e.variable.postfix;if(!d){let p=e.variable.right;for(;p instanceof pt;){if(p.postfix){d=p.postfix;break}p=p.right}}d&&(i=i.getSubData(this,d,t))}}else{a=e.variable.postfix,s=this.getVariableName(e.variable,t);const h=t.getVariable(s);if(h===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);i=h.value}if(i instanceof zr&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const l=this.evalExpression(e.value,t),u=e.operator;if(u!=="="){const h=i.getSubData(this,a,t);if(h instanceof S&&l instanceof N){const d=h.data,p=l.value;if(u==="+=")for(let m=0;m<d.length;++m)d[m]+=p;else if(u==="-=")for(let m=0;m<d.length;++m)d[m]-=p;else if(u==="*=")for(let m=0;m<d.length;++m)d[m]*=p;else if(u==="/=")for(let m=0;m<d.length;++m)d[m]/=p;else if(u==="%=")for(let m=0;m<d.length;++m)d[m]%=p;else if(u==="&=")for(let m=0;m<d.length;++m)d[m]&=p;else if(u==="|=")for(let m=0;m<d.length;++m)d[m]|=p;else if(u==="^=")for(let m=0;m<d.length;++m)d[m]^=p;else if(u==="<<=")for(let m=0;m<d.length;++m)d[m]<<=p;else if(u===">>=")for(let m=0;m<d.length;++m)d[m]>>=p;else console.error(`Invalid operator ${u}. Line ${e.line}`)}else if(h instanceof S&&l instanceof S){const d=h.data,p=l.data;if(d.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(u==="+=")for(let m=0;m<d.length;++m)d[m]+=p[m];else if(u==="-=")for(let m=0;m<d.length;++m)d[m]-=p[m];else if(u==="*=")for(let m=0;m<d.length;++m)d[m]*=p[m];else if(u==="/=")for(let m=0;m<d.length;++m)d[m]/=p[m];else if(u==="%=")for(let m=0;m<d.length;++m)d[m]%=p[m];else if(u==="&=")for(let m=0;m<d.length;++m)d[m]&=p[m];else if(u==="|=")for(let m=0;m<d.length;++m)d[m]|=p[m];else if(u==="^=")for(let m=0;m<d.length;++m)d[m]^=p[m];else if(u==="<<=")for(let m=0;m<d.length;++m)d[m]<<=p[m];else if(u===">>=")for(let m=0;m<d.length;++m)d[m]>>=p[m];else console.error(`Invalid operator ${u}. Line ${e.line}`)}else{if(!(h instanceof N&&l instanceof N))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);u==="+="?h.value+=l.value:u==="-="?h.value-=l.value:u==="*="?h.value*=l.value:u==="/="?h.value/=l.value:u==="%="?h.value%=l.value:u==="&="?h.value&=l.value:u==="|="?h.value|=l.value:u==="^="?h.value^=l.value:u==="<<="?h.value<<=l.value:u===">>="?h.value>>=l.value:console.error(`Invalid operator ${u}. Line ${e.line}`)}return void(i instanceof at&&i.setDataValue(this,h,a,t))}if(i instanceof at)i.setDataValue(this,l,a,t);else if(a){if(!(i instanceof S||i instanceof ye))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(a instanceof sa){const h=this.evalExpression(a.index,t).value;if(i instanceof S){if(!(l instanceof N))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[h]=l.value}else{if(!(i instanceof ye))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const d=this.evalExpression(a.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(l instanceof S))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const p=i.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(d<2&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(d<2&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(d<2&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(d<3&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(d<3&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(d<3&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(d<4&&l.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=l.data[0],i.data[2*d+1]=l.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(d<4&&l.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=l.data[0],i.data[3*d+1]=l.data[1],i.data[3*d+2]=l.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(d<4&&l.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=l.data[0],i.data[4*d+1]=l.data[1],i.data[4*d+2]=l.data[2],i.data[4*d+3]=l.data[3]}}}}}else if(a instanceof Ws){const h=a.value;if(!(i instanceof S))return void console.error(`Invalid assignment to ${h}. Variable ${s} is not a vector. Line ${e.line}`);if(l instanceof N){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);if(h==="x")i.data[0]=l.value;else if(h==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[1]=l.value}else if(h==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[2]=l.value}else if(h==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[3]=l.value}}else{if(!(l instanceof S))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(h.length!==l.data.length)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);for(let d=0;d<h.length;++d){const p=h[d];if(p==="x"||p==="r")i.data[0]=l.data[d];else if(p==="y"||p==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[1]=l.data[d]}else if(p==="z"||p==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[2]=l.data[d]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${s}. Line ${e.line}`);i.data[3]=l.data[d]}}}}}else i instanceof N&&l instanceof N?i.value=l.value:i instanceof S&&l instanceof S||i instanceof ye&&l instanceof ye?i.data.set(l.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`)}_function(e,t){const i=new Ig(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof pt||(i=i.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const a=new Vn(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof pt||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof Mo||e.type instanceof _i||e.type instanceof F){const a=new Vn(e.type,[]);i=this._evalCreate(a,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof N))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const a of e.cases)if(a instanceof zT)for(const l of a.selectors){if(l instanceof Xc){s=a;continue}const u=this.evalExpression(l,t);if(!(u instanceof N))return console.error(`Invalid case selector. Line ${e.line}`),null;if(u.value===i.value)return this._execStatements(a.body,t)}else a instanceof VT&&(s=a);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof N))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const s of e.elseif){const a=this.evalExpression(s.condition,t);if(!(a instanceof N))return console.error(`Invalid if condition. Line ${e.line}`),null;if(a.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof N?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===It._breakObj)break;if(i!==null&&i!==It._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===It._breakObj)break;if(i===It._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===It._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===It._breakObj)break;if(i!==It._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),s=e.type;if(i instanceof N){const a=xv(i.value,i.typeInfo.name,s.name);return new N(a,this.getTypeInfo(s))}if(i instanceof S){const a=i.typeInfo.getTypeName();let l="";if(a.endsWith("f"))l="f32";else if(a.endsWith("i"))l="i32";else if(a.endsWith("u"))l="u32";else if(a.endsWith("b"))l="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${a}. Line ${e.line}`),null;l="f16"}const u=s.getTypeName();let h="";if(u.endsWith("f"))h="f32";else if(u.endsWith("i"))h="i32";else if(u.endsWith("u"))h="u32";else if(u.endsWith("b"))h="bool";else{if(!u.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}const d=(function(p,m,y){if(m===y)return p;const v=new Array(p.length);for(let x=0;x<p.length;x++)v[x]=xv(p[x],m,y);return v})(Array.from(i.data),l,h);return new S(d,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof Vn){if(e.type===null)return xp.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof Vn?e.type.name:e.name,a=e instanceof Vn?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(a===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(a.size===0)return null;const l=new at(new ArrayBuffer(a.size),a,0);if(a instanceof Ji){if(e.args)for(let u=0;u<e.args.length;++u){const h=a.members[u],d=e.args[u],p=this.evalExpression(d,t);l.setData(this,p,h.type,h.offset,t)}}else if(a instanceof ns){let u=0;if(e.args)for(let h=0;h<e.args.length;++h){const d=e.args[h],p=this.evalExpression(d,t);a.format===null&&(((i=p.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?a.format=this.getTypeInfo("i32"):a.format=p.typeInfo),l.setData(this,p,a.format,u,t),u+=a.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof Vn?l.getSubData(this,e.postfix,t):l}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new N(e.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=It._priority.get(t.name);It._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new zr(i);if(e.operator==="*")return i instanceof zr?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=i instanceof N?i.value:i instanceof S?Array.from(i.data):null;switch(e.operator){case"+":{if(re(s)){const u=s.map((h,d)=>+h);return new S(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(+a,l)}case"-":{if(re(s)){const u=s.map((h,d)=>-h);return new S(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(-a,l)}case"!":{if(re(s)){const u=s.map((h,d)=>h?0:1);return new S(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(a?0:1,l)}case"~":{if(re(s)){const u=s.map((h,d)=>~h);return new S(u,i.typeInfo)}const a=s,l=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new N(~a,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),a=i instanceof N?i.value:i instanceof S||i instanceof ye?Array.from(i.data):null,l=s instanceof N?s.value:s instanceof S||s instanceof ye?Array.from(s.data):null;switch(e.operator){case"+":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v+m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y+p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p+y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u+h,d)}case"-":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v-m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y-p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p-y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u-h,d)}case"*":{if(re(a)&&re(l)){const p=a,m=l;if(i instanceof ye&&s instanceof ye){const y=(function(E,C,D,M){if(Dt[C.name]===void 0||Dt[M.name]===void 0)return null;const B=Dt[C.name][0],z=Dt[C.name][1],X=Dt[M.name][0];if(B!==Dt[M.name][1])return null;const ne=new Array(X*z);for(let ae=0;ae<z;ae++)for(let ie=0;ie<X;ie++){let ge=0;for(let ee=0;ee<B;ee++)ge+=E[ee*z+ae]*D[ie*B+ee];ne[ae*X+ie]=ge}return ne})(p,i.typeInfo,m,s.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const v=Dt[s.typeInfo.name][0],x=Dt[i.typeInfo.name][1],A=this.getTypeInfo(`mat${v}x${x}f`);return new ye(y,A)}if(i instanceof ye&&s instanceof S){const y=(function(v,x,A,E){if(Dt[x.name]===void 0||Dd[E.name]===void 0)return null;const C=Dt[x.name][0],D=Dt[x.name][1];if(C!==A.length)return null;const M=new Array(D);for(let B=0;B<D;B++){let z=0;for(let X=0;X<C;X++)z+=v[X*D+B]*A[X];M[B]=z}return M})(p,i.typeInfo,m,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new S(y,s.typeInfo)}if(i instanceof S&&s instanceof ye){const y=(function(v,x,A,E){if(Dd[x.name]===void 0||Dt[E.name]===void 0)return null;const C=Dt[E.name][0],D=Dt[E.name][1];if(D!==v.length)return null;const M=[];for(let B=0;B<C;B++){let z=0;for(let X=0;X<D;X++)z+=v[X]*A[X*C+B];M[B]=z}return M})(p,i.typeInfo,m,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new S(y,i.typeInfo)}{if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v*m[x]);return new S(y,i.typeInfo)}}if(re(a)){const p=l,m=a.map((y,v)=>y*p);return i instanceof ye?new ye(m,i.typeInfo):new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p*y);return s instanceof ye?new ye(m,s.typeInfo):new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u*h,d)}case"%":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v%m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y%p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p%y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u%h,d)}case"/":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v/m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y/p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p/y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u/h,d)}case"&":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v&m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y&p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p&y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u&h,d)}case"|":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v|m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y|p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p|y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u|h,d)}case"^":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v^m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y^p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p^y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u^h,d)}case"<<":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v<<m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y<<p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p<<y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u<<h,d)}case">>":{if(re(a)&&re(l)){const p=a,m=l;if(p.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((v,x)=>v>>m[x]);return new S(y,i.typeInfo)}if(re(a)){const p=l,m=a.map((y,v)=>y>>p);return new S(m,i.typeInfo)}if(re(l)){const p=a,m=l.map((y,v)=>p>>y);return new S(m,s.typeInfo)}const u=a,h=l,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new N(u>>h,d)}case">":if(re(a)&&re(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,m)=>p>h[m]?1:0);return new S(d,i.typeInfo)}if(re(a)){const u=l,h=a.map((d,p)=>d>u?1:0);return new S(h,i.typeInfo)}if(re(l)){const u=a,h=l.map((d,p)=>u>d?1:0);return new S(h,s.typeInfo)}return new N(a>l?1:0,this.getTypeInfo("bool"));case"<":if(re(a)&&re(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,m)=>p<h[m]?1:0);return new S(d,i.typeInfo)}if(re(a)){const u=l,h=a.map((d,p)=>d<u?1:0);return new S(h,i.typeInfo)}if(re(l)){const u=a,h=l.map((d,p)=>u<d?1:0);return new S(h,s.typeInfo)}return new N(a<l?1:0,this.getTypeInfo("bool"));case"==":if(re(a)&&re(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,m)=>p===h[m]?1:0);return new S(d,i.typeInfo)}if(re(a)){const u=l,h=a.map((d,p)=>d==u?1:0);return new S(h,i.typeInfo)}if(re(l)){const u=a,h=l.map((d,p)=>u==d?1:0);return new S(h,s.typeInfo)}return new N(a===l?1:0,this.getTypeInfo("bool"));case"!=":if(re(a)&&re(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,m)=>p!==h[m]?1:0);return new S(d,i.typeInfo)}if(re(a)){const u=l,h=a.map((d,p)=>d!==u?1:0);return new S(h,i.typeInfo)}if(re(l)){const u=a,h=l.map((d,p)=>u!==d?1:0);return new S(h,s.typeInfo)}return new N(a!==l?1:0,this.getTypeInfo("bool"));case">=":if(re(a)&&re(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,m)=>p>=h[m]?1:0);return new S(d,i.typeInfo)}if(re(a)){const u=l,h=a.map((d,p)=>d>=u?1:0);return new S(h,i.typeInfo)}if(re(l)){const u=a,h=l.map((d,p)=>u>=d?1:0);return new S(h,s.typeInfo)}return new N(a>=l?1:0,this.getTypeInfo("bool"));case"<=":if(re(a)&&re(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,m)=>p<=h[m]?1:0);return new S(d,i.typeInfo)}if(re(a)){const u=l,h=a.map((d,p)=>d<=u?1:0);return new S(h,i.typeInfo)}if(re(l)){const u=a,h=l.map((d,p)=>u<=d?1:0);return new S(h,s.typeInfo)}return new N(a<=l?1:0,this.getTypeInfo("bool"));case"&&":if(re(a)&&re(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,m)=>p&&h[m]?1:0);return new S(d,i.typeInfo)}if(re(a)){const u=l,h=a.map((d,p)=>d&&u?1:0);return new S(h,i.typeInfo)}if(re(l)){const u=a,h=l.map((d,p)=>u&&d?1:0);return new S(h,s.typeInfo)}return new N(a&&l?1:0,this.getTypeInfo("bool"));case"||":if(re(a)&&re(l)){const u=a,h=l;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((p,m)=>p||h[m]?1:0);return new S(d,i.typeInfo)}if(re(a)){const u=l,h=a.map((d,p)=>d||u?1:0);return new S(h,i.typeInfo)}if(re(l)){const u=a,h=l.map((d,p)=>u||d?1:0);return new S(h,s.typeInfo)}return new N(a||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let a=0;a<s.node.args.length;++a){const l=s.node.args[a],u=this.evalExpression(e.args[a],i);i.createVariable(l.name,u,l)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const s=t.clone();for(let a=0;a<i.node.args.length;++a){const l=i.node.args[a],u=this.evalExpression(e.args[a],s);s.setVariable(l.name,u,l)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new N(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),a=Dd[s];if(a===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof mt)if(e.isVector){const u=e.vectorValue;for(const h of u)l.push(h)}else l.push(e.scalarValue);else if(e.args)for(const u of e.args){const h=this.evalExpression(u,t);if(h instanceof S){const d=h.data;for(let p=0;p<d.length;++p){let m=d[p];l.push(m)}}else if(h instanceof N){let d=h.value;l.push(d)}}if(e.type instanceof F&&e.type.format===null&&(e.type.format=F.f32),l.length===0){const u=new Array(a).fill(0);return new S(u,i).getSubData(this,e.postfix,t)}if(l.length===1)for(;l.length<a;)l.push(l[0]);return l.length<a?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new S(l.length>a?l.slice(0,a):l,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),a=Dt[s];if(a===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const l=[];if(e instanceof mt)if(e.isVector){const u=e.vectorValue;for(const h of u)l.push(h)}else l.push(e.scalarValue);else if(e.args)for(const u of e.args){const h=this.evalExpression(u,t);h instanceof S?l.push(...h.data):h instanceof N?l.push(h.value):h instanceof ye&&l.push(...h.data)}if(i instanceof $s&&i.format===null&&(i.format=this.getTypeInfo("f32")),l.length===0){const u=new Array(a[2]).fill(0);return new ye(u,i).getSubData(this,e.postfix,t)}return l.length!==a[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new ye(l,i).getSubData(this,e.postfix,t)}}It._breakObj=new wn(new vn("BREAK",null),null),It._continueObj=new wn(new vn("CONTINUE",null),null),It._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class AN{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class EN{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new AN,this._exec=new It,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,a=i.countNode;if(a instanceof an){const l=a.name,u=this._context.constants.get(l);if(u)try{const h=u.constEvaluate(this._exec);s.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(s=>{s instanceof vv||s instanceof Wc?s.type=this._forwardType(s.type):s instanceof Mo?s.format=this._forwardType(s.format):s instanceof yi||s instanceof Co||s instanceof $c?s.type=this._forwardType(s.type):s instanceof Lo?s.returnType=this._forwardType(s.returnType):s instanceof bv&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof yv){const t=this._getType(e.name);if(t)return t}else e instanceof Wc?e.type=this._forwardType(e.type):e instanceof Mo&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new gN(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==w.eof}_match(e){if(e instanceof P)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let s=!1;for(const a of e){if(i===a)return!0;a===w.tokens.name&&(s=!0)}if(s){const a=w.tokens.name.rule.exec(t.lexeme);if(a&&a.index==0&&a[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===w.tokens.name){const i=w.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._match(w.keywords.alias)){const t=this._type_alias();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.diagnostic)){const t=this._diagnostic();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.requires)){const t=this._requires_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(w.keywords.enable)){const t=this._enable_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(w.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(w.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(w.keywords.fn))return null;const e=this._currentLine,t=this._consume(w.tokens.ident,"Expected function name.").toString();this._consume(w.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(w.tokens.paren_right))do{if(this._check(w.tokens.paren_right))break;const u=this._attribute(),h=this._consume(w.tokens.name,"Expected argument name.").toString();this._consume(w.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=d,i.push(this._updateNode(new bv(h,p,u))))}while(this._match(w.tokens.comma));this._consume(w.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(w.tokens.arrow)){const u=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=u)}const a=this._compound_statement(),l=this._currentLine;return this._updateNode(new Lo(t,i,s,a,e,l),e)}_compound_statement(){const e=[];for(this._consume(w.tokens.brace_left,"Expected '{' for block.");!this._check(w.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(w.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._check(w.tokens.attr)&&this._attribute(),this._check(w.keywords.if))return this._if_statement();if(this._check(w.keywords.switch))return this._switch_statement();if(this._check(w.keywords.loop))return this._loop_statement();if(this._check(w.keywords.for))return this._for_statement();if(this._check(w.keywords.while))return this._while_statement();if(this._check(w.keywords.continuing))return this._continuing_statement();if(this._check(w.keywords.static_assert))return this._static_assert_statement();if(this._check(w.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(w.keywords.return))e=this._return_statement();else if(this._check([w.keywords.var,w.keywords.let,w.keywords.const]))e=this._variable_statement();else if(this._match(w.keywords.discard))e=this._updateNode(new hN);else if(this._match(w.keywords.break)){const t=this._updateNode(new PT);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(w.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(w.keywords.continue)){const t=this._updateNode(new DT);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(w.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(w.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new cN(t),e)}_while_statement(){if(!this._match(w.keywords.while))return null;const e=this._updateNode(new AT(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(w.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new Tp(i,e),t)}_for_statement(){if(!this._match(w.keywords.for))return null;this._consume(w.tokens.paren_left,"Expected '('.");const e=this._updateNode(new ET(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(w.tokens.semicolon)?null:this._for_init(),this._consume(w.tokens.semicolon,"Expected ';'."),e.condition=this._check(w.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(w.tokens.semicolon,"Expected ';'."),e.increment=this._check(w.tokens.paren_right)?null:this._for_increment(),this._consume(w.tokens.paren_right,"Expected ')'."),this._check(w.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(w.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(w.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new yi(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(w.keywords.let)){const e=this._currentLine,t=this._consume(w.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(w.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(w.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new Co(t,i,null,null,s),e)}if(this._match(w.keywords.const)){const e=this._currentLine,t=this._consume(w.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(w.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}this._consume(w.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof mt&&(i=s.type),this._updateNode(new $c(t,i,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(w.increment_operators))return this._current=e,null;const i=this._consume(w.increment_operators,"Expected increment operator");return this._updateNode(new RT(i.type===w.tokens.plus_plus?$r.increment:$r.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(w.tokens.brace_right))return null;let i=this._match(w.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const s=this._consume(w.assignment_operators,"Expected assignment operator."),a=this._short_circuit_or_expression();return this._updateNode(new CT(To.parse(s.lexeme),e,a),t)}_func_call_statement(){if(!this._check(w.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(w.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new Eg(i.lexeme,s),e)}_loop_statement(){if(!this._match(w.keywords.loop))return null;this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new MT([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof Tp){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(w.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(w.keywords.switch))return null;const e=this._updateNode(new OT(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(w.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([w.keywords.default,w.keywords.case]);){if(this._match(w.keywords.case)){const i=this._case_selectors();for(const a of i)if(a instanceof Xc){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new zT(i,s)))}if(this._match(w.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new VT(i)))}}return e}_case_selectors(){const e=[];for(this._match(w.keywords.default)?e.push(this._updateNode(new Xc)):e.push(this._shift_expression());this._match(w.tokens.comma);)this._match(w.keywords.default)?e.push(this._updateNode(new Xc)):e.push(this._shift_expression());return e}_case_body(){if(this._match(w.keywords.fallthrough))return this._consume(w.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(w.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(w.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let a=null;return this._match(w.keywords.else)&&(this._check(w.tokens.attr)&&this._attribute(),a=this._compound_statement()),this._updateNode(new IT(t,i,s,a),e)}_match_elseif(){return this._tokens[this._current].type===w.keywords.else&&this._tokens[this._current+1].type===w.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new dN(t,i))),this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(w.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new NT(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(w.tokens.or_or);)e=this._updateNode(new Cn(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(w.tokens.and_and);)e=this._updateNode(new Cn(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(w.tokens.or);)e=this._updateNode(new Cn(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(w.tokens.xor);)e=this._updateNode(new Cn(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(w.tokens.and);)e=this._updateNode(new Cn(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([w.tokens.equal_equal,w.tokens.not_equal])?this._updateNode(new Cn(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([w.tokens.less_than,w.tokens.greater_than,w.tokens.less_than_equal,w.tokens.greater_than_equal]);)e=this._updateNode(new Cn(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([w.tokens.shift_left,w.tokens.shift_right]);)e=this._updateNode(new Cn(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([w.tokens.plus,w.tokens.minus]);)e=this._updateNode(new Cn(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([w.tokens.star,w.tokens.forward_slash,w.tokens.modulo]);)e=this._updateNode(new Cn(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([w.tokens.minus,w.tokens.bang,w.tokens.tilde,w.tokens.star,w.tokens.and])?this._updateNode(new pt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(w.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(w.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new sa(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(w.tokens.period)){const e=this._consume(w.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new Ws(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return K.void;case"bool":return K.bool;case"i32":return K.i32;case"u32":return K.u32;case"f32":return K.f32;case"f16":return K.f16;case"vec2f":return F.vec2f;case"vec3f":return F.vec3f;case"vec4f":return F.vec4f;case"vec2i":return F.vec2i;case"vec3i":return F.vec3i;case"vec4i":return F.vec4i;case"vec2u":return F.vec2u;case"vec3u":return F.vec3u;case"vec4u":return F.vec4u;case"vec2h":return F.vec2h;case"vec3h":return F.vec3h;case"vec4h":return F.vec4h;case"mat2x2f":return F.mat2x2f;case"mat2x3f":return F.mat2x3f;case"mat2x4f":return F.mat2x4f;case"mat3x2f":return F.mat3x2f;case"mat3x3f":return F.mat3x3f;case"mat3x4f":return F.mat3x4f;case"mat4x2f":return F.mat4x2f;case"mat4x3f":return F.mat4x3f;case"mat4x4f":return F.mat4x4f;case"mat2x2h":return F.mat2x2h;case"mat2x3h":return F.mat2x3h;case"mat2x4h":return F.mat2x4h;case"mat3x2h":return F.mat3x2h;case"mat3x3h":return F.mat3x3h;case"mat3x4h":return F.mat3x4h;case"mat4x2h":return F.mat4x2h;case"mat4x3h":return F.mat4x3h;case"mat4x4h":return F.mat4x4h;case"mat2x2i":return F.mat2x2i;case"mat2x3i":return F.mat2x3i;case"mat2x4i":return F.mat2x4i;case"mat3x2i":return F.mat3x2i;case"mat3x3i":return F.mat3x3i;case"mat3x4i":return F.mat3x4i;case"mat4x2i":return F.mat4x2i;case"mat4x3i":return F.mat4x3i;case"mat4x4i":return F.mat4x4i;case"mat2x2u":return F.mat2x2u;case"mat2x3u":return F.mat2x3u;case"mat2x4u":return F.mat2x4u;case"mat3x2u":return F.mat3x2u;case"mat3x3u":return F.mat3x3u;case"mat3x4u":return F.mat3x4u;case"mat4x2u":return F.mat4x2u;case"mat4x3u":return F.mat4x3u;case"mat4x4u":return F.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(w.tokens.ident)){const i=this._previous().toString();if(this._check(w.tokens.paren_left)){const s=this._argument_expression_list(),a=this._getType(i);return a!==null?this._updateNode(new Vn(a,s)):this._updateNode(new Cg(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new BT(i,s.value))}return this._updateNode(new an(i))}if(this._match(w.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?K.i32:i.endsWith("u")||i.endsWith("U")?K.u32:K.x32;const a=parseInt(i);return this._validateTypeRange(a,s),this._updateNode(new mt(new N(a,this._exec.getTypeInfo(s)),s))}if(this._match(w.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,K.u32),this._updateNode(new mt(new N(i,this._exec.getTypeInfo(K.u32)),K.u32))}if(this._match([w.tokens.decimal_float_literal,w.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const a=parseFloat(i);this._validateTypeRange(a,s?K.f16:K.f32);const l=s?K.f16:K.f32;return this._updateNode(new mt(new N(a,this._exec.getTypeInfo(l)),l))}if(this._match([w.keywords.true,w.keywords.false])){let i=this._previous().toString()===w.keywords.true.rule;return this._updateNode(new mt(new N(i?1:0,this._exec.getTypeInfo(K.bool)),K.bool))}if(this._check(w.tokens.paren_left))return this._paren_expression();if(this._match(w.keywords.bitcast)){this._consume(w.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(w.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new UT(i,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Vn(e,t))}_argument_expression_list(){if(!this._match(w.tokens.paren_left))return null;const e=[];do{if(this._check(w.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(w.tokens.comma));return this._consume(w.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(w.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(w.tokens.paren_right),e}_paren_expression(){this._consume(w.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(w.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(w.keywords.struct))return null;const e=this._currentLine,t=this._consume(w.tokens.ident,"Expected name for struct.").toString();this._consume(w.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(w.tokens.brace_right);){const l=this._attribute(),u=this._consume(w.tokens.name,"Expected variable name.").toString();this._consume(w.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=h),this._check(w.tokens.brace_right)?this._match(w.tokens.comma):this._consume(w.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new vv(u,d,l)))}this._consume(w.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,a=this._updateNode(new _i(t,i,e,s),e);return this._context.structs.set(t,a),a}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(w.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof mt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof mt&&(e.type=e.value.type.name==="x32"?K.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(w.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(w.keywords.const))return null;const t=this._consume(w.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(w.tokens.colon)){const h=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=h)}let a=null;this._consume(w.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let h=[K.f32],d=l.constEvaluate(this._exec,h);d instanceof N&&this._validateTypeRange(d.value,h[0]),h[0]instanceof F&&h[0].format===null&&d.typeInfo instanceof $s&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?h[0].format=K.f16:d.typeInfo.format.name==="f32"?h[0].format=K.f32:d.typeInfo.format.name==="i32"?h[0].format=K.i32:d.typeInfo.format.name==="u32"?h[0].format=K.u32:d.typeInfo.format.name==="bool"?h[0].format=K.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),a=this._updateNode(new mt(d,h[0])),this._exec.context.setVariable(t.toString(),d)}catch{a=l}if(s!==null&&a instanceof mt){if(a.type.name!=="x32"&&s.getTypeName()!==a.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${a.type.name} to ${s.name}. Line:${this._currentLine}`);a.type=s,a.isScalar&&this._validateTypeRange(a.scalarValue,a.type)}else s===null&&a instanceof mt&&(s=(e=a?.type)!==null&&e!==void 0?e:K.f32,s===K.x32&&(s=K.i32));const u=this._updateNode(new $c(t.toString(),s,"","",a),i);return this._context.constants.set(u.name,u),u}_global_let_decl(){if(!this._match(w.keywords.let))return null;const e=this._currentLine,t=this._consume(w.tokens.name,"Expected variable name");let i=null;if(this._match(w.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}let s=null;if(this._match(w.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof mt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof mt&&(i=s.type.name==="x32"?K.i32:s.type);return s instanceof mt&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new Co(t.toString(),i,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(w.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(w.tokens.less_than)&&(t=this._consume(w.storage_class,"Expected storage_class.").toString(),this._match(w.tokens.comma)&&(i=this._consume(w.access_mode,"Expected access_mode.").toString()),this._consume(w.tokens.greater_than,"Expected '>'."));const s=this._consume(w.tokens.name,"Expected variable name");let a=null;if(this._match(w.tokens.colon)){const l=this._attribute();a=this._type_decl(),a!=null&&(a.attributes=l)}return this._updateNode(new yi(s.toString(),a,t,i,null),e)}_override_decl(){if(!this._match(w.keywords.override))return null;const e=this._consume(w.tokens.name,"Expected variable name");let t=null;if(this._match(w.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new Ag(e.toString(),t,null))}_diagnostic(){this._consume(w.tokens.paren_left,"Expected '('");const e=this._consume(w.tokens.ident,"Expected severity control name.");this._consume(w.tokens.comma,"Expected ','");let t=this._consume(w.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(w.tokens.period)&&(t+=`.${this._consume(w.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(w.tokens.paren_right,"Expected ')'"),this._updateNode(new kT(e.toString(),t))}_enable_directive(){const e=this._consume(w.tokens.ident,"identity expected.");return this._updateNode(new uN(e.toString()))}_requires_directive(){const e=[this._consume(w.tokens.ident,"identity expected.").toString()];for(;this._match(w.tokens.comma);){const t=this._consume(w.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new fN(e))}_type_alias(){const e=this._consume(w.tokens.ident,"identity expected.");this._consume(w.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new Rg(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([w.tokens.ident,...w.texel_format,w.keywords.bool,w.keywords.f32,w.keywords.i32,w.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new yv(i));return this._forwardTypeCount++,s}return this._updateNode(new K(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(w.template_types)){let i=this._advance().toString(),s=null,a=null;return this._match(w.tokens.less_than)&&(s=this._type_decl(),a=null,this._match(w.tokens.comma)&&(a=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new F(i,s,a))}if(this._match(w.keywords.ptr)){let i=this._previous().toString();this._consume(w.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(w.storage_class,"Expected storage_class for pointer");this._consume(w.tokens.comma,"Expected ',' for pointer.");const a=this._type_decl();let l=null;return this._match(w.tokens.comma)&&(l=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Wc(i,s.toString(),a,l))}const t=this._attribute();if(this._match(w.keywords.array)){let i=null,s=-1;const a=this._previous();let l=null;if(this._match(w.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let h="";if(this._match(w.tokens.comma)){l=this._shift_expression();try{h=l.constEvaluate(this._exec).toString(),l=null}catch{h="1"}}this._consume(w.tokens.greater_than,"Expected '>' for array."),s=h?parseInt(h):0}const u=this._updateNode(new Mo(a.toString(),t,i,s));return l&&this._deferArrayCountEval.push({arrayType:u,countNode:l}),u}return null}_texture_sampler_types(){if(this._match(w.sampler_type))return this._updateNode(new xo(this._previous().toString(),null,null));if(this._match(w.depth_texture_type))return this._updateNode(new xo(this._previous().toString(),null,null));if(this._match(w.sampled_texture_type)||this._match(w.multisampled_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new xo(e.toString(),t,null))}if(this._match(w.storage_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(w.texel_format,"Invalid texel format.").toString();this._consume(w.tokens.comma,"Expected ',' after texel format.");const i=this._consume(w.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new xo(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(w.tokens.attr);){const t=this._consume(w.attribute_name,"Expected attribute name"),i=this._updateNode(new HT(t.toString(),null));if(this._match(w.tokens.paren_left)){if(i.value=this._consume(w.literal_or_ident,"Expected attribute value").toString(),this._check(w.tokens.comma)){this._advance();do{const s=this._consume(w.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(w.tokens.comma))}this._consume(w.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class RN extends $n{constructor(e){super(),e&&this.update(e)}update(e){const t=new EN().parse(e);this.updateAST(t)}}function CN(n){const e={attributes:[],bindings:[]};let t;try{t=MN(n)}catch(a){return J.error(a.message)(),e}for(const a of t.uniforms){const l=[];for(const u of a.type?.members||[])l.push({name:u.name,type:wv(u.type)});e.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:l})}for(const a of t.textures)e.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(const a of t.samplers)e.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});const i=t.entry.vertex[0],s=i?.inputs.length||0;for(let a=0;a<s;a++){const l=i.inputs[a];if(l.locationType==="location"){const u=wv(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:u})}}return e}function wv(n){return n?.format?`${n.name}<${n.format.name}>`:n.name}function MN(n){try{return new RN(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const ON={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...ON}};const Tn=globalThis.mathgl.config;function IN(n,{precision:e=Tn.precision}={}){return n=NN(n),`${parseFloat(n.toPrecision(e))}`}function ra(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function es(n,e,t){return PN(n,i=>Math.max(e,Math.min(t,i)))}function zo(n,e,t){return ra(n)?n.map((i,s)=>zo(i,e[s],t)):t*e+(1-t)*n}function Vo(n,e,t){const i=Tn.EPSILON;try{if(n===e)return!0;if(ra(n)&&ra(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!Vo(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Tn.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Tn.EPSILON=i}}function NN(n){return Math.round(n/Tn.EPSILON)*Tn.EPSILON}function kN(n){return n.clone?n.clone():new Array(n.length)}function PN(n,e,t){if(ra(n)){const i=n;t=t||kN(i);for(let s=0;s<t.length&&s<i.length;++s){const a=typeof n=="number"?n:n[s];t[s]=e(a,s,t)}return t}return e(n)}class jT extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ra(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Tn)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+IN(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Vo(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const a=e[s],l=typeof t=="number"?t:t[s];this[s]=a+i*(l-a)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Tn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function DN(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function rn(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function Bd(n,e,t=""){if(Tn.debug&&!DN(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function Sv(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class BN extends jT{get x(){return this[0]}set x(e){this[0]=rn(e)}get y(){return this[1]}set y(e){this[1]=rn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];t+=s*s}return rn(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return rn(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Sv(e>=0&&e<this.ELEMENTS,"index is out of range"),rn(this[e])}setComponent(e,t){return Sv(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Yc=1e-6;let aa=typeof Float32Array<"u"?Float32Array:Array;function UN(){const n=new aa(2);return aa!=Float32Array&&(n[0]=0,n[1]=0),n}function wp(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function FN(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n}function LN(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n}function zN(n){const e=n[0],t=n[1];return Math.sqrt(e*e+t*t)}function VN(n,e){return n[0]=-e[0],n[1]=-e[1],n}function $T(n,e,t,i){const s=e[0],a=e[1];return n[0]=s+i*(t[0]-s),n[1]=a+i*(t[1]-a),n}function HN(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}const jN=FN;(function(){const n=UN();return function(e,t,i,s,a,l){let u,h;for(t||(t=2),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],a(n,n,l),e[u]=n[0],e[u+1]=n[1];return e}})();function $N(n,e,t){const i=e[0],s=e[1],a=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/a,n[1]=(t[1]*i+t[5]*s)/a,n}function WT(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[3]*i+t[7]*s+t[11]*a||1;return n[0]=(t[0]*i+t[4]*s+t[8]*a)/l,n[1]=(t[1]*i+t[5]*s+t[9]*a)/l,n[2]=(t[2]*i+t[6]*s+t[10]*a)/l,n}function WN(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function XN(){const n=new aa(3);return aa!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function YN(n){const e=n[0],t=n[1],i=n[2];return Math.sqrt(e*e+t*t+i*i)}function qN(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function ZN(n){const e=n[0],t=n[1],i=n[2];return e*e+t*t+i*i}function KN(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function QN(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function GN(n,e,t){const i=e[0],s=e[1],a=e[2],l=t[0],u=t[1],h=t[2];return n[0]=s*h-a*u,n[1]=a*l-i*h,n[2]=i*u-s*l,n}function JN(n,e,t,i){const s=e[0],a=e[1],l=e[2];return n[0]=s+i*(t[0]-s),n[1]=a+i*(t[1]-a),n[2]=l+i*(t[2]-l),n}function XT(n,e,t){const i=e[0],s=e[1],a=e[2];let l=t[3]*i+t[7]*s+t[11]*a+t[15];return l=l||1,n[0]=(t[0]*i+t[4]*s+t[8]*a+t[12])/l,n[1]=(t[1]*i+t[5]*s+t[9]*a+t[13])/l,n[2]=(t[2]*i+t[6]*s+t[10]*a+t[14])/l,n}function ek(n,e,t){const i=e[0],s=e[1],a=e[2];return n[0]=i*t[0]+s*t[3]+a*t[6],n[1]=i*t[1]+s*t[4]+a*t[7],n[2]=i*t[2]+s*t[5]+a*t[8],n}function tk(n,e,t){const i=t[0],s=t[1],a=t[2],l=t[3],u=e[0],h=e[1],d=e[2];let p=s*d-a*h,m=a*u-i*d,y=i*h-s*u,v=s*y-a*m,x=a*p-i*y,A=i*m-s*p;const E=l*2;return p*=E,m*=E,y*=E,v*=2,x*=2,A*=2,n[0]=u+p+v,n[1]=h+m+x,n[2]=d+y+A,n}function nk(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[0],a[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),a[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function ik(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),a[1]=s[1],a[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function sk(n,e,t,i){const s=[],a=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],a[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),a[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),a[2]=s[2],n[0]=a[0]+t[0],n[1]=a[1]+t[1],n[2]=a[2]+t[2],n}function rk(n,e){const t=n[0],i=n[1],s=n[2],a=e[0],l=e[1],u=e[2],h=Math.sqrt((t*t+i*i+s*s)*(a*a+l*l+u*u)),d=h&&QN(n,e)/h;return Math.acos(Math.min(Math.max(d,-1),1))}const YT=qN,ak=YN,Ud=ZN;(function(){const n=XN();return function(e,t,i,s,a,l){let u,h;for(t||(t=3),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],a(n,n,l),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2];return e}})();const Fd=[0,0,0];let Oc;class Xn extends BN{static get ZERO(){return Oc||(Oc=new Xn(0,0,0),Object.freeze(Oc)),Oc}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&ra(e)?this.copy(e):(Tn.debug&&(rn(e),rn(t),rn(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Tn.debug&&(rn(e.x),rn(e.y),rn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=rn(e)}angle(e){return rk(this,e)}cross(e){return GN(this,this,e),this.check()}rotateX({radians:e,origin:t=Fd}){return nk(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Fd}){return ik(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Fd}){return sk(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return XT(this,this,e),this.check()}transformAsVector(e){return WT(this,this,e),this.check()}transformByMatrix3(e){return ek(this,this,e),this.check()}transformByMatrix2(e){return WN(this,this,e),this.check()}transformByQuaternion(e){return tk(this,this,e),this.check()}}class ok extends jT{toString(){let e="[";if(Tn.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=rn(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}}function lk(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ck(n,e){if(n===e){const t=e[1],i=e[2],s=e[3],a=e[6],l=e[7],u=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=a,n[11]=e[14],n[12]=s,n[13]=l,n[14]=u}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function Sp(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=e[4],u=e[5],h=e[6],d=e[7],p=e[8],m=e[9],y=e[10],v=e[11],x=e[12],A=e[13],E=e[14],C=e[15],D=t*u-i*l,M=t*h-s*l,B=t*d-a*l,z=i*h-s*u,X=i*d-a*u,ne=s*d-a*h,ae=p*A-m*x,ie=p*E-y*x,ge=p*C-v*x,ee=m*E-y*A,fe=m*C-v*A,we=y*C-v*E;let me=D*we-M*fe+B*ee+z*ge-X*ie+ne*ae;return me?(me=1/me,n[0]=(u*we-h*fe+d*ee)*me,n[1]=(s*fe-i*we-a*ee)*me,n[2]=(A*ne-E*X+C*z)*me,n[3]=(y*X-m*ne-v*z)*me,n[4]=(h*ge-l*we-d*ie)*me,n[5]=(t*we-s*ge+a*ie)*me,n[6]=(E*B-x*ne-C*M)*me,n[7]=(p*ne-y*B+v*M)*me,n[8]=(l*fe-u*ge+d*ae)*me,n[9]=(i*ge-t*fe-a*ae)*me,n[10]=(x*X-A*B+C*D)*me,n[11]=(m*B-p*X-v*D)*me,n[12]=(u*ie-l*ee-h*ae)*me,n[13]=(t*ee-i*ie+s*ae)*me,n[14]=(A*M-x*z-E*D)*me,n[15]=(p*z-m*M+y*D)*me,n):null}function uk(n){const e=n[0],t=n[1],i=n[2],s=n[3],a=n[4],l=n[5],u=n[6],h=n[7],d=n[8],p=n[9],m=n[10],y=n[11],v=n[12],x=n[13],A=n[14],E=n[15],C=e*l-t*a,D=e*u-i*a,M=t*u-i*l,B=d*x-p*v,z=d*A-m*v,X=p*A-m*x,ne=e*X-t*z+i*B,ae=a*X-l*z+u*B,ie=d*M-p*D+m*C,ge=v*M-x*D+A*C;return h*ne-s*ae+E*ie-y*ge}function Bs(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3],u=e[4],h=e[5],d=e[6],p=e[7],m=e[8],y=e[9],v=e[10],x=e[11],A=e[12],E=e[13],C=e[14],D=e[15];let M=t[0],B=t[1],z=t[2],X=t[3];return n[0]=M*i+B*u+z*m+X*A,n[1]=M*s+B*h+z*y+X*E,n[2]=M*a+B*d+z*v+X*C,n[3]=M*l+B*p+z*x+X*D,M=t[4],B=t[5],z=t[6],X=t[7],n[4]=M*i+B*u+z*m+X*A,n[5]=M*s+B*h+z*y+X*E,n[6]=M*a+B*d+z*v+X*C,n[7]=M*l+B*p+z*x+X*D,M=t[8],B=t[9],z=t[10],X=t[11],n[8]=M*i+B*u+z*m+X*A,n[9]=M*s+B*h+z*y+X*E,n[10]=M*a+B*d+z*v+X*C,n[11]=M*l+B*p+z*x+X*D,M=t[12],B=t[13],z=t[14],X=t[15],n[12]=M*i+B*u+z*m+X*A,n[13]=M*s+B*h+z*y+X*E,n[14]=M*a+B*d+z*v+X*C,n[15]=M*l+B*p+z*x+X*D,n}function xu(n,e,t){const i=t[0],s=t[1],a=t[2];let l,u,h,d,p,m,y,v,x,A,E,C;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*a+e[12],n[13]=e[1]*i+e[5]*s+e[9]*a+e[13],n[14]=e[2]*i+e[6]*s+e[10]*a+e[14],n[15]=e[3]*i+e[7]*s+e[11]*a+e[15]):(l=e[0],u=e[1],h=e[2],d=e[3],p=e[4],m=e[5],y=e[6],v=e[7],x=e[8],A=e[9],E=e[10],C=e[11],n[0]=l,n[1]=u,n[2]=h,n[3]=d,n[4]=p,n[5]=m,n[6]=y,n[7]=v,n[8]=x,n[9]=A,n[10]=E,n[11]=C,n[12]=l*i+p*s+x*a+e[12],n[13]=u*i+m*s+A*a+e[13],n[14]=h*i+y*s+E*a+e[14],n[15]=d*i+v*s+C*a+e[15]),n}function kg(n,e,t){const i=t[0],s=t[1],a=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*a,n[9]=e[9]*a,n[10]=e[10]*a,n[11]=e[11]*a,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function fk(n,e,t,i){let s=i[0],a=i[1],l=i[2],u=Math.sqrt(s*s+a*a+l*l),h,d,p,m,y,v,x,A,E,C,D,M,B,z,X,ne,ae,ie,ge,ee,fe,we,me,He;return u<Yc?null:(u=1/u,s*=u,a*=u,l*=u,d=Math.sin(t),h=Math.cos(t),p=1-h,m=e[0],y=e[1],v=e[2],x=e[3],A=e[4],E=e[5],C=e[6],D=e[7],M=e[8],B=e[9],z=e[10],X=e[11],ne=s*s*p+h,ae=a*s*p+l*d,ie=l*s*p-a*d,ge=s*a*p-l*d,ee=a*a*p+h,fe=l*a*p+s*d,we=s*l*p+a*d,me=a*l*p-s*d,He=l*l*p+h,n[0]=m*ne+A*ae+M*ie,n[1]=y*ne+E*ae+B*ie,n[2]=v*ne+C*ae+z*ie,n[3]=x*ne+D*ae+X*ie,n[4]=m*ge+A*ee+M*fe,n[5]=y*ge+E*ee+B*fe,n[6]=v*ge+C*ee+z*fe,n[7]=x*ge+D*ee+X*fe,n[8]=m*we+A*me+M*He,n[9]=y*we+E*me+B*He,n[10]=v*we+C*me+z*He,n[11]=x*we+D*me+X*He,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function qT(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[4],l=e[5],u=e[6],h=e[7],d=e[8],p=e[9],m=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=a*s+d*i,n[5]=l*s+p*i,n[6]=u*s+m*i,n[7]=h*s+y*i,n[8]=d*s-a*i,n[9]=p*s-l*i,n[10]=m*s-u*i,n[11]=y*s-h*i,n}function hk(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[0],l=e[1],u=e[2],h=e[3],d=e[8],p=e[9],m=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=a*s-d*i,n[1]=l*s-p*i,n[2]=u*s-m*i,n[3]=h*s-y*i,n[8]=a*i+d*s,n[9]=l*i+p*s,n[10]=u*i+m*s,n[11]=h*i+y*s,n}function ZT(n,e,t){const i=Math.sin(t),s=Math.cos(t),a=e[0],l=e[1],u=e[2],h=e[3],d=e[4],p=e[5],m=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=a*s+d*i,n[1]=l*s+p*i,n[2]=u*s+m*i,n[3]=h*s+y*i,n[4]=d*s-a*i,n[5]=p*s-l*i,n[6]=m*s-u*i,n[7]=y*s-h*i,n}function dk(n,e){const t=e[0],i=e[1],s=e[2],a=e[3],l=t+t,u=i+i,h=s+s,d=t*l,p=i*l,m=i*u,y=s*l,v=s*u,x=s*h,A=a*l,E=a*u,C=a*h;return n[0]=1-m-x,n[1]=p+C,n[2]=y-E,n[3]=0,n[4]=p-C,n[5]=1-d-x,n[6]=v+A,n[7]=0,n[8]=y+E,n[9]=v-A,n[10]=1-d-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function pk(n,e,t,i,s,a,l){const u=1/(t-e),h=1/(s-i),d=1/(a-l);return n[0]=a*2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a*2*h,n[6]=0,n[7]=0,n[8]=(t+e)*u,n[9]=(s+i)*h,n[10]=(l+a)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*a*2*d,n[15]=0,n}function gk(n,e,t,i,s){const a=1/Math.tan(e/2);if(n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const l=1/(i-s);n[10]=(s+i)*l,n[14]=2*s*i*l}else n[10]=-1,n[14]=-2*i;return n}const _k=gk;function mk(n,e,t,i,s,a,l){const u=1/(e-t),h=1/(i-s),d=1/(a-l);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*u,n[13]=(s+i)*h,n[14]=(l+a)*d,n[15]=1,n}const yk=mk;function bk(n,e,t,i){let s,a,l,u,h,d,p,m,y,v;const x=e[0],A=e[1],E=e[2],C=i[0],D=i[1],M=i[2],B=t[0],z=t[1],X=t[2];return Math.abs(x-B)<Yc&&Math.abs(A-z)<Yc&&Math.abs(E-X)<Yc?lk(n):(m=x-B,y=A-z,v=E-X,s=1/Math.sqrt(m*m+y*y+v*v),m*=s,y*=s,v*=s,a=D*v-M*y,l=M*m-C*v,u=C*y-D*m,s=Math.sqrt(a*a+l*l+u*u),s?(s=1/s,a*=s,l*=s,u*=s):(a=0,l=0,u=0),h=y*u-v*l,d=v*a-m*u,p=m*l-y*a,s=Math.sqrt(h*h+d*d+p*p),s?(s=1/s,h*=s,d*=s,p*=s):(h=0,d=0,p=0),n[0]=a,n[1]=h,n[2]=m,n[3]=0,n[4]=l,n[5]=d,n[6]=y,n[7]=0,n[8]=u,n[9]=p,n[10]=v,n[11]=0,n[12]=-(a*x+l*A+u*E),n[13]=-(h*x+d*A+p*E),n[14]=-(m*x+y*A+v*E),n[15]=1,n)}function vk(){const n=new aa(4);return aa!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function KT(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function ga(n,e,t){const i=e[0],s=e[1],a=e[2],l=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*a+t[12]*l,n[1]=t[1]*i+t[5]*s+t[9]*a+t[13]*l,n[2]=t[2]*i+t[6]*s+t[10]*a+t[14]*l,n[3]=t[3]*i+t[7]*s+t[11]*a+t[15]*l,n}(function(){const n=vk();return function(e,t,i,s,a,l){let u,h;for(t||(t=4),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],n[3]=e[u+3],a(n,n,l),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2],e[u+3]=n[3];return e}})();var Ap;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(Ap||(Ap={}));const Tk=45*Math.PI/180,xk=1,Ld=.1,zd=500,wk=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Nn extends ok{static get IDENTITY(){return Ak()}static get ZERO(){return Sk()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ap}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,a,l,u,h,d,p,m,y,v,x,A,E){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=a,this[5]=l,this[6]=u,this[7]=h,this[8]=d,this[9]=p,this[10]=m,this[11]=y,this[12]=v,this[13]=x,this[14]=A,this[15]=E,this.check()}setRowMajor(e,t,i,s,a,l,u,h,d,p,m,y,v,x,A,E){return this[0]=e,this[1]=a,this[2]=d,this[3]=v,this[4]=t,this[5]=l,this[6]=p,this[7]=x,this[8]=i,this[9]=u,this[10]=m,this[11]=A,this[12]=s,this[13]=h,this[14]=y,this[15]=E,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(wk)}fromObject(e){return this.check()}fromQuaternion(e){return dk(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:s,top:a,near:l=Ld,far:u=zd}=e;return u===1/0?Ek(this,t,i,s,a,l):pk(this,t,i,s,a,l,u),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return bk(this,t,i,s),this.check()}ortho(e){const{left:t,right:i,bottom:s,top:a,near:l=Ld,far:u=zd}=e;return yk(this,t,i,s,a,l,u),this.check()}orthographic(e){const{fovy:t=Tk,aspect:i=xk,focalDistance:s=1,near:a=Ld,far:l=zd}=e;Av(t);const u=t/2,h=s*Math.tan(u),d=h*i;return this.ortho({left:-d,right:d,bottom:-h,top:h,near:a,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:a=500}=e;return Av(t),_k(this,t,i,s,a),this.check()}determinant(){return uk(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],a=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*a,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*a,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],a=1/i[1],l=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*a,e[2]=this[2]*l,e[3]=this[4]*s,e[4]=this[5]*a,e[5]=this[6]*l,e[6]=this[8]*s,e[7]=this[9]*a,e[8]=this[10]*l,e}transpose(){return ck(this,this),this.check()}invert(){return Sp(this,this),this.check()}multiplyLeft(e){return Bs(this,e,this),this.check()}multiplyRight(e){return Bs(this,this,e),this.check()}rotateX(e){return qT(this,this,e),this.check()}rotateY(e){return hk(this,this,e),this.check()}rotateZ(e){return ZT(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return fk(this,this,e,t),this.check()}scale(e){return kg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return xu(this,this,e),this.check()}transform(e,t){return e.length===4?(t=ga(t||[-0,-0,-0,-0],e,this),Bd(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let s;switch(i){case 2:s=HN(t||[-0,-0],e,this);break;case 3:s=XT(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Bd(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=$N(t||[-0,-0],e,this);break;case 3:i=WT(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Bd(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let Ic,Nc;function Sk(){return Ic||(Ic=new Nn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ic)),Ic}function Ak(){return Nc||(Nc=new Nn,Object.freeze(Nc)),Nc}function Av(n){if(n>Math.PI*2)throw Error("expected radians")}function Ek(n,e,t,i,s,a){const l=2*a/(t-e),u=2*a/(s-i),h=(t+e)/(t-e),d=(s+i)/(s-i),p=-1,m=-1,y=-2*a;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=h,n[9]=d,n[10]=p,n[11]=m,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function QT(n,e=[],t=0){const i=Math.fround(n),s=n-i;return e[t]=i,e[t+1]=s,e}function Rk(n){return n-Math.fround(n)}function Ck(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const s=t*4+i;QT(n[i*4+t],e,s*2)}return e}const Mk=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Ok={name:"fp32",vs:Mk},Ik=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,Nk={ONE:1},kk={name:"fp64arithmetic",vs:Ik,defaultUniforms:Nk,uniformTypes:{ONE:"f32"},fp64ify:QT,fp64LowPart:Rk,fp64ifyMatrix4:Ck},Pk=[0,1,1,1],Dk=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Bk=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Ev={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Pk},vs:Dk,fs:Bk,getUniforms:Uk};function Uk(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const Rv=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,Fk={name:"layer",vs:Rv,fs:Rv,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},Lk=`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,GT={name:"color",dependencies:[],source:Lk,getUniforms:n=>({}),uniformTypes:{opacity:"f32"}},zk=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,JT="#define SMOOTH_EDGE_RADIUS 0.5",Vk=`${JT}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Hk=`${JT}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,e2={name:"geometry",source:zk,vs:Vk,fs:Hk},jk=25;var gt;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(gt||(gt={}));var yt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(yt||(yt={}));var xe;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(xe||(xe={}));const $k="compute",Wk="auto",Ep="manipulation",qc="none",Rp="pan-x",Cp="pan-y";function Xk(n){if(n.includes(qc))return qc;const e=n.includes(Rp),t=n.includes(Cp);return e&&t?qc:e||t?e?Rp:Cp:n.includes(Ep)?Ep:Wk}class Yk{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===$k&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return Xk(e.join(" "))}}function wu(n){return n.trim().split(/\s+/g)}function Vd(n,e,t){if(n)for(const i of wu(e))n.addEventListener(i,t,!1)}function Hd(n,e,t){if(n)for(const i of wu(e))n.removeEventListener(i,t,!1)}function Cv(n){return(n.ownerDocument||n).defaultView}function qk(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function t2(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,s=0;for(;s<e;)t+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(i/e)}}function Mv(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:t2(e),deltaX:n.deltaX,deltaY:n.deltaY}}function n2(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function Ov(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function Zk(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function Iv(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function i2(n,e){return n===e?yt.None:Math.abs(n)>=Math.abs(e)?n<0?yt.Left:yt.Right:e<0?yt.Up:yt.Down}function Kk(n,e){const t=e.center;let i=n.offsetDelta,s=n.prevDelta;const a=n.prevInput;return(e.eventType===gt.Start||a?.eventType===gt.End)&&(s=n.prevDelta={x:a?.deltaX||0,y:a?.deltaY||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-i.x),deltaY:s.y+(t.y-i.y)}}function s2(n,e,t){return{x:e/n||0,y:t/n||0}}function Qk(n,e){return Ov(e[0],e[1])/Ov(n[0],n[1])}function Gk(n,e){return Iv(e[1],e[0])-Iv(n[1],n[0])}function Jk(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let s,a,l,u;if(e.eventType!==gt.Cancel&&(i>jk||t.velocity===void 0)){const h=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,p=s2(i,h,d);a=p.x,l=p.y,s=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,u=i2(h,d),n.lastInterval=e}else s=t.velocity,a=t.velocityX,l=t.velocityY,u=t.direction;e.velocity=s,e.velocityX=a,e.velocityY=l,e.direction=u}function eP(n,e){const{session:t}=n,{pointers:i}=e,{length:s}=i;t.firstInput||(t.firstInput=Mv(e)),s>1&&!t.firstMultiple?t.firstMultiple=Mv(e):s===1&&(t.firstMultiple=!1);const{firstInput:a,firstMultiple:l}=t,u=l?l.center:a.center,h=e.center=t2(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-a.timeStamp,e.angle=Zk(u,h),e.distance=n2(u,h);const{deltaX:d,deltaY:p}=Kk(t,e);e.deltaX=d,e.deltaY=p,e.offsetDirection=i2(e.deltaX,e.deltaY);const m=s2(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=m.x,e.overallVelocityY=m.y,e.overallVelocity=Math.abs(m.x)>Math.abs(m.y)?m.x:m.y,e.scale=l?Qk(l.pointers,i):1,e.rotation=l?Gk(l.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return qk(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,Jk(t,e),e}function tP(n,e,t){const i=t.pointers.length,s=t.changedPointers.length,a=e&gt.Start&&i-s===0,l=e&(gt.End|gt.Cancel)&&i-s===0;t.isFirst=!!a,t.isFinal=!!l,a&&(n.session={}),t.eventType=e;const u=eP(n,t);n.emit("hammer.input",u),n.recognize(u),n.session.prevInput=u}let nP=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){tP(this.manager,e,t)}init(){Vd(this.element,this.evEl,this.domHandler),Vd(this.target,this.evTarget,this.domHandler),Vd(Cv(this.element),this.evWin,this.domHandler)}destroy(){Hd(this.element,this.evEl,this.domHandler),Hd(this.target,this.evTarget,this.domHandler),Hd(Cv(this.element),this.evWin,this.domHandler)}};const iP={pointerdown:gt.Start,pointermove:gt.Move,pointerup:gt.End,pointercancel:gt.Cancel,pointerout:gt.Cancel},sP="pointerdown",rP="pointermove pointerup pointercancel";class aP extends nP{constructor(e){super(e),this.evEl=sP,this.evWin=rP,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const s=iP[e.type],a=e.pointerType,l=a==="touch";let u=t.findIndex(h=>h.pointerId===e.pointerId);s&gt.Start&&(e.buttons||l)?u<0&&(t.push(e),u=t.length-1):s&(gt.End|gt.Cancel)&&(i=!0),!(u<0)&&(t[u]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:a,srcEvent:e}),i&&t.splice(u,1))}}const oP=["","webkit","Moz","MS","ms","o"];function lP(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of oP){const s=i?i+t:e;if(s in n)return s}}const cP=1,Nv=2,kv={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class uP{constructor(e,t){this.options={...kv,...t,cssProps:{...kv.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new aP(this),this.touchAction=new Yk(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Nv:cP}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:a}=t;(!a||a&&a.state&xe.Recognized)&&(a=t.curRecognizer=null);let l=0;for(;l<s.length;)i=s[l],t.stopped!==Nv&&(!a||i===a||i.canRecognizeWith(a))?i.recognize(e):i.reset(),!a&&i.state&(xe.Began|xe.Changed|xe.Ended)&&(a=t.curRecognizer=i),l++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,s=i.indexOf(t);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const s of wu(e))i[s]=i[s]||[],i[s].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const s of wu(e))t?i[s]&&i[s].splice(i[s].indexOf(t),1):delete i[s]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let a=0;for(;a<i.length;)i[a](s),a++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,s]of Object.entries(this.options.cssProps)){const a=lP(t.style,i);e?(this.oldCssProps[a]=t.style[a],t.style[a]=s):t.style[a]=this.oldCssProps[a]||""}e||(this.oldCssProps={})}}}let fP=1;function hP(){return fP++}function Pv(n){return n&xe.Cancelled?"cancel":n&xe.Ended?"end":n&xe.Changed?"move":n&xe.Began?"start":""}class r2{constructor(e){this.options=e,this.id=hP(),this.state=xe.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<xe.Ended&&this.manager.emit(this.options.event+Pv(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=xe.Ended&&this.manager.emit(this.options.event+Pv(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=xe.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(xe.Failed|xe.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=xe.Failed;return}this.state&(xe.Recognized|xe.Cancelled|xe.Failed)&&(this.state=xe.Possible),this.state=this.process(t),this.state&(xe.Began|xe.Changed|xe.Ended|xe.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class a2 extends r2{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,s=t&(xe.Began|xe.Changed),a=this.attrTest(e);return s&&(i&gt.Cancel||!a)?t|xe.Cancelled:s||a?i&gt.End?t|xe.Ended:t&xe.Began?t|xe.Changed:xe.Began:xe.Failed}}class Dv extends r2{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[Ep]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,s=e.distance<t.threshold,a=e.deltaTime<t.time;if(this.reset(),e.eventType&gt.Start&&this.count===0)return this.failTimeout();if(s&&a&&i){if(e.eventType!==gt.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<t.interval:!0,u=!this.pCenter||n2(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!u||!l?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=xe.Recognized,this.tryEmit(this._input)},t.interval),xe.Began):xe.Recognized}return xe.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=xe.Failed},this.options.interval),xe.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===xe.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const dP=["","start","move","end","cancel","up","down","left","right"];class Bv extends a2{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:yt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&yt.Horizontal&&t.push(Cp),e&yt.Vertical&&t.push(Rp),t}getEventNames(){return dP.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:s}=e,{direction:a}=e;const l=e.deltaX,u=e.deltaY;return a&t.direction||(t.direction&yt.Horizontal?(a=l===0?yt.None:l<0?yt.Left:yt.Right,i=l!==this.pX,s=Math.abs(e.deltaX)):(a=u===0?yt.None:u<0?yt.Up:yt.Down,i=u!==this.pY,s=Math.abs(e.deltaY))),e.direction=a,i&&s>t.threshold&&!!(a&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&xe.Began)||!(this.state&xe.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=yt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const pP=["","start","move","end","cancel","in","out"];class gP extends a2{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[qc]}getEventNames(){return pP.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&xe.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Lu{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const _P=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",mP=_P.indexOf("firefox")!==-1,Uv=4.000244140625,yP=40,bP=.25;class vP extends Lu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let a=s.deltaY;globalThis.WheelEvent&&(mP&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(a/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(a*=yP)),a!==0&&a%Uv===0&&(a=Math.floor(a/Uv)),s.shiftKey&&a&&(a=a*bP),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-a,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const Fv=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class TP extends Lu{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,Fv.forEach(a=>e.addEventListener(a,this.handleEvent))}destroy(){Fv.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Lv=["keydown","keyup"];class xP extends Lu{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const a=s.target||s.srcElement;a.tagName==="INPUT"&&a.type==="text"||a.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Lv.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){Lv.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class wP extends Lu{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const zv=1,Mp=2,Vv=4,SP={pointerdown:zv,pointermove:Mp,pointerup:Vv,mousedown:zv,mousemove:Mp,mouseup:Vv},AP=0,EP=1,RP=2,CP=1,MP=2,OP=4;function IP(n){const e=SP[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let s=!1,a=!1,l=!1;return e===Mp?(s=!!(t&CP),a=!!(t&OP),l=!!(t&MP)):(s=i===AP,a=i===EP,l=i===RP),{leftButton:s,middleButton:a,rightButton:l}}function NP(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,a=i.height/e.offsetHeight||1,l={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/a};return{center:t,offsetCenter:l}}const kP={srcElement:"root",priority:0};class PP{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let a=i.srcEvent.target;for(;a&&a!==s.rootElement;){if(this._emit(s,a),s.handled)return;a=a.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,a=!1){const{handlers:l,handlersByElement:u}=this,h={...kP,...i};let d=u.get(h.srcElement);d||(d=[],u.set(h.srcElement,d));const p={type:e,handler:t,srcElement:h.srcElement,priority:h.priority};s&&(p.once=!0),a&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let m=d.length-1;for(;m>=0&&!(d[m].priority>=p.priority);)m--;d.splice(m+1,0,p)}remove(e,t){const{handlers:i,handlersByElement:s}=this;for(let a=i.length-1;a>=0;a--){const l=i[a];if(l.type===e&&l.handler===t){i.splice(a,1);const u=s.get(l.srcElement);u.splice(u.indexOf(l),1),u.length===0&&s.delete(l.srcElement)}}this._active=i.some(a=>!a.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let s=!1;const a=()=>{e.handled=!0},l=()=>{e.handled=!0,s=!0},u=[];for(let h=0;h<i.length;h++){const{type:d,handler:p,once:m}=i[h];if(p({...e,type:d,stopPropagation:a,stopImmediatePropagation:l}),m&&u.push(i[h]),s)break}for(let h=0;h<u.length;h++){const{type:d,handler:p}=u[h];this.remove(d,p)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...IP(e),...NP(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function DP(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),s=t.shift()||{};e=new i(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class BP{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new uP(e,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:a,requireFailure:l}=DP(i);this.manager.add(s),a&&s.recognizeWith(a),l&&s.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new vP(e,this._onOtherEvent,{enable:!1}),this.moveInput=new TP(e,this._onOtherEvent,{enable:!1}),this.keyInput=new xP(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new wP(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const s=i.get(e);s&&(s.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,s,a){if(typeof e!="string"){i=t;for(const[d,p]of Object.entries(e))this._addEventHandler(d,p,i,s,a);return}const{manager:l,events:u}=this;if(!l)return;let h=u.get(e);if(!h){const d=this._getRecognizerName(e)||e;h=new PP(this,d),u.set(e,h),l&&l.on(e,h.handleEvent)}h.add(e,t,i,s,a),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[a,l]of Object.entries(e))this._removeEventHandler(a,l);return}const{events:i}=this,s=i.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:a}=s;let l=!1;for(const u of i.values())if(u.recognizerName===a&&!u.isEmpty()){l=!0;break}l||this._toggleRecognizer(a,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Ue={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ue,"IDENTITY",{get:()=>(Ye.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const on={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Xs={common:0,meters:1,pixels:2},Op={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Hv={multipan:[Bv,{threshold:10,direction:yt.Vertical,pointers:2}],pinch:[gP,{},null,["multipan"]],pan:[Bv,{threshold:1},["pinch"],["multipan"]],dblclick:[Dv,{event:"dblclick",taps:2}],click:[Dv,{event:"click"},null,["dblclick"]]};function UP(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function Qo(n){let e={},t;return i=>{for(const s in i)if(!UP(i[s],e[s])){t=n(i),e=i;break}return t}}const jv=[0,0,0,0],FP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],o2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],LP=[0,0,0],l2=[0,0,0],zP=Qo(jP);function c2(n,e,t=l2){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,a=!0;switch(e===Ue.LNGLAT_OFFSETS||e===Ue.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case on.WEB_MERCATOR:(e===Ue.LNGLAT||e===Ue.CARTESIAN)&&(s=[0,0,0],a=!1);break;case on.WEB_MERCATOR_AUTO_OFFSET:e===Ue.LNGLAT?i=s:e===Ue.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case on.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case on.GLOBE:a=!1,s=null;break;default:a=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:a}}function VP(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:a,viewProjectionMatrix:l}=n,u=jv,h=jv,d=n.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:m,offsetMode:y}=c2(n,e,t);return y&&(h=n.projectPosition(p||m),d=[d[0]-h[0],d[1]-h[1],d[2]-h[2]],h[3]=1,u=ga([],h,l),a=i||a,l=Bs([],s,a),l=Bs([],l,FP)),{viewMatrix:a,viewProjectionMatrix:l,projectionCenter:u,originCommon:h,cameraPosCommon:d,shaderCoordinateOrigin:m,geospatialOrigin:p}}function HP({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Ue.DEFAULT,coordinateOrigin:s=l2,autoWrapLongitude:a=!1}){i===Ue.DEFAULT&&(i=n.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN);const l=zP({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return l.wrapLongitude=a,l.modelMatrix=t||o2,l}function jP({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:a,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:h,geospatialOrigin:d}=VP(n,t,i),p=n.getDistanceScales(),m=[n.width*e,n.height*e],y=ga([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,v={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:h,commonOrigin:l.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:m,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:LP,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:o2,cameraPosition:u};if(d){const x=n.getDistanceScales(d);switch(t){case Ue.METER_OFFSETS:v.commonUnitsPerWorldUnit=x.unitsPerMeter,v.commonUnitsPerWorldUnit2=x.unitsPerMeter2;break;case Ue.LNGLAT:case Ue.LNGLAT_OFFSETS:n._pseudoMeters||(v.commonUnitsPerMeter=x.unitsPerMeter),v.commonUnitsPerWorldUnit=x.unitsPerDegree,v.commonUnitsPerWorldUnit2=x.unitsPerDegree2;break;case Ue.CARTESIAN:v.commonUnitsPerWorldUnit=[1,1,x.unitsPerMeter[2]],v.commonUnitsPerWorldUnit2=[0,0,x.unitsPerMeter2[2]];break}}return v}const $P=Object.keys(Ue).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Ue[n]};`).join(""),WP=Object.keys(on).map(n=>`const PROJECTION_MODE_${n}: i32 = ${on[n]};`).join(""),XP=Object.keys(Xs).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Xs[n]};`).join(""),YP=`${$P}
${WP}
${XP}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,qP=`${YP}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,ZP=Object.keys(Ue).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Ue[n]};`).join(""),KP=Object.keys(on).map(n=>`const int PROJECTION_MODE_${n} = ${on[n]};`).join(""),QP=Object.keys(Xs).map(n=>`const int UNIT_${n.toUpperCase()} = ${Xs[n]};`).join(""),GP=`${ZP}
${KP}
${QP}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,JP={};function eD(n=JP){return"viewport"in n?HP(n):{}}const Pg={name:"project",dependencies:[Ok,e2],source:qP,vs:GP,getUniforms:eD,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},tD=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,nD=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,u2={name:"project32",dependencies:[Pg],source:tD,vs:nD};function iD(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Jr(n,e){const t=ga([],e,n);return KT(t,t,1/t[3]),t}function $v(n,e){const t=n%e;return t<0?e+t:t}function sD(n,e,t){return t*e+(1-t)*n}function Ip(n,e,t){return n<e?e:n>t?t:n}function rD(n){return Math.log(n)*Math.LOG2E}const Dg=Math.log2||rD;function Ti(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const On=Math.PI,f2=On/4,xn=On/180,Np=180/On,oa=512,Su=4003e4,Wr=85.051129,aD=1.5;function Wv(n){return Math.pow(2,n)}function h2(n){return Dg(n)}function la(n){const[e,t]=n;Ti(Number.isFinite(e)),Ti(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*xn,s=t*xn,a=oa*(i+On)/(2*On),l=oa*(On+Math.log(Math.tan(f2+s*.5)))/(2*On);return[a,l]}function Ys(n){const[e,t]=n,i=e/oa*(2*On)-On,s=2*(Math.atan(Math.exp(t/oa*(2*On)-On))-f2);return[i*Np,s*Np]}function oD(n){const{latitude:e}=n;Ti(Number.isFinite(e));const t=Math.cos(e*xn);return h2(Su*t)-9}function jd(n){const e=Math.cos(n*xn);return oa/Su/e}function kp(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;Ti(Number.isFinite(e)&&Number.isFinite(t));const s=oa,a=Math.cos(e*xn),l=s/360,u=l/a,h=s/Su/a,d={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[l,u,h],degreesPerUnit:[1/l,1/u,1/h]};if(i){const p=xn*Math.tan(e*xn)/a,m=l*p/2,y=s/Su*p,v=y/u*h;d.unitsPerDegree2=[0,m,y],d.unitsPerMeter2=[v,0,v]}return d}function d2(n,e){const[t,i,s]=n,[a,l,u]=e,{unitsPerMeter:h,unitsPerMeter2:d}=kp({longitude:t,latitude:i,highPrecision:!0}),p=la(n);p[0]+=a*(h[0]+d[0]*l),p[1]+=l*(h[1]+d[1]*l);const m=Ys(p),y=(s||0)+(u||0);return Number.isFinite(s)||Number.isFinite(u)?[m[0],m[1],y]:m}function lD(n){const{height:e,pitch:t,bearing:i,altitude:s,scale:a,center:l}=n,u=iD();xu(u,u,[0,0,-s]),qT(u,u,-t*xn),ZT(u,u,i*xn);const h=a/e;return kg(u,u,[h,h,h]),l&&xu(u,u,KN([],l)),u}function cD(n){const{width:e,height:t,altitude:i,pitch:s=0,offset:a,center:l,scale:u,nearZMultiplier:h=1,farZMultiplier:d=1}=n;let{fovy:p=Ho(aD)}=n;i!==void 0&&(p=Ho(i));const m=p*xn,y=s*xn,v=Bg(p);let x=v;l&&(x+=l[2]*u/Math.cos(y)/t);const A=m*(.5+(a?a[1]:0)/t),E=Math.sin(A)*x/Math.sin(Ip(Math.PI/2-y-A,.01,Math.PI-.01)),C=Math.sin(y)*E+x,D=x*10,M=Math.min(C*d,D);return{fov:m,aspect:e/t,focalDistance:v,near:h,far:M}}function Ho(n){return 2*Math.atan(.5/n)*Np}function Bg(n){return .5/Math.tan(.5*n*xn)}function p2(n,e){const[t,i,s=0]=n;return Ti(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),Jr(e,[t,i,s,1])}function Ug(n,e,t=0){const[i,s,a]=n;if(Ti(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(a))return Jr(e,[i,s,a,1]);const l=Jr(e,[i,s,0,1]),u=Jr(e,[i,s,1,1]),h=l[2],d=u[2],p=h===d?0:((t||0)-h)/(d-h);return $T([],l,u,p)}function uD(n){const{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:a=24,offset:l=[0,0]}=n,[[u,h],[d,p]]=i,m=fD(n.padding),y=la([u,Ip(p,-Wr,Wr)]),v=la([d,Ip(h,-Wr,Wr)]),x=[Math.max(Math.abs(v[0]-y[0]),s),Math.max(Math.abs(v[1]-y[1]),s)],A=[e-m.left-m.right-Math.abs(l[0])*2,t-m.top-m.bottom-Math.abs(l[1])*2];Ti(A[0]>0&&A[1]>0);const E=A[0]/x[0],C=A[1]/x[1],D=(m.right-m.left)/2/E,M=(m.top-m.bottom)/2/C,B=[(v[0]+y[0])/2+D,(v[1]+y[1])/2+M],z=Ys(B),X=Math.min(a,Dg(Math.abs(Math.min(E,C))));return Ti(Number.isFinite(X)),{longitude:z[0],latitude:z[1],zoom:X}}function fD(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(Ti(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Xv=Math.PI/180;function hD(n,e=0){const{width:t,height:i,unproject:s}=n,a={targetZ:e},l=s([0,i],a),u=s([t,i],a);let h,d;const p=n.fovy?.5*n.fovy*Xv:Math.atan(.5/n.altitude),m=(90-n.pitch)*Xv;return p>m-.01?(h=Yv(n,0,e),d=Yv(n,t,e)):(h=s([0,0],a),d=s([t,0],a)),[l,u,d,h]}function Yv(n,e,t){const{pixelUnprojectionMatrix:i}=n,s=Jr(i,[e,0,1,1]),a=Jr(i,[e,n.height,1,1]),u=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(a[2]-s[2]),h=$T([],s,a,u),d=Ys(h);return d.push(t),d}const qv=512;function dD(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:s,latitude:a,zoom:l,bearing:u=0}=n;(s<-180||s>180)&&(s=$v(s+180,360)-180),(u<-180||u>180)&&(u=$v(u+180,360)-180);const h=Dg(t/qv);if(l<=h)l=h,a=0;else{const d=t/2/Math.pow(2,l),p=Ys([0,d])[1];if(a<p)a=p;else{const m=Ys([0,qv-d])[1];a>m&&(a=m)}}return{width:e,height:t,longitude:s,latitude:a,zoom:l,pitch:i,bearing:u}}const g2=.01,pD=["longitude","latitude","zoom"],_2={curve:1.414,speed:1.2};function gD(n,e,t,i){const{startZoom:s,startCenterXY:a,uDelta:l,w0:u,u1:h,S:d,rho:p,rho2:m,r0:y}=m2(n,e,i);if(h<g2){const B={};for(const z of pD){const X=n[z],ne=e[z];B[z]=sD(X,ne,t)}return B}const v=t*d,x=Math.cosh(y)/Math.cosh(y+p*v),A=u*((Math.cosh(y)*Math.tanh(y+p*v)-Math.sinh(y))/m)/h,E=1/x,C=s+h2(E),D=LN([],l,A);wp(D,D,a);const M=Ys(D);return{longitude:M[0],latitude:M[1],zoom:C}}function _D(n,e,t){const i={..._2,...t},{screenSpeed:s,speed:a,maxDuration:l}=i,{S:u,rho:h}=m2(n,e,i),d=1e3*u;let p;return Number.isFinite(s)?p=d/(s/h):p=d/a,Number.isFinite(l)&&p>l?0:p}function m2(n,e,t){t=Object.assign({},_2,t);const i=t.curve,s=n.zoom,a=[n.longitude,n.latitude],l=Wv(s),u=e.zoom,h=[e.longitude,e.latitude],d=Wv(u-s),p=la(a),m=la(h),y=jN([],m,p),v=Math.max(n.width,n.height),x=v/d,A=zN(y)*l,E=Math.max(A,g2),C=i*i,D=(x*x-v*v+C*C*E*E)/(2*v*C*E),M=(x*x-v*v-C*C*E*E)/(2*x*C*E),B=Math.log(Math.sqrt(D*D+1)-D),z=Math.log(Math.sqrt(M*M+1)-M),X=(z-B)/i;return{startZoom:s,startCenterXY:p,uDelta:y,w0:v,u1:A,S:X,rho:i,rho2:C,r0:B,r1:z}}const y2=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,mD=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,yD=`
${y2}
${mD}
`,bD=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,vD=`
${y2}
${bD}
`,TD=Qo(ED),xD=Qo(RD),wD=[0,0,0,1],SD=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function AD(n,e){const[t,i,s]=n,a=Ug([t,i,s],e);return Number.isFinite(s)?a:[a[0],a[1],0]}function ED({viewport:n,center:e}){return new Nn(n.viewProjectionMatrix).invert().transform(e)}function RD({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,a=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>AD(l,i));for(const l of e){const u=l.clone().translate(new Xn(n.center).negate()),h=a.map(p=>u.transform(p)),d=new Nn().ortho({left:Math.min(...h.map(p=>p[0])),right:Math.max(...h.map(p=>p[0])),bottom:Math.min(...h.map(p=>p[1])),top:Math.max(...h.map(p=>p[1])),near:Math.min(...h.map(p=>-p[2])),far:Math.max(...h.map(p=>-p[2]))});t.push(d.multiplyRight(l))}return t}function CD(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=Pg.getUniforms(t),s=TD({viewport:t.viewport,center:i.center}),a=[],l=xD({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let h=0;h<n.shadowMatrices.length;h++){const d=l[h],p=d.clone().translate(new Xn(t.viewport.center).negate());i.coordinateSystem===Ue.LNGLAT&&i.projectionMode===on.WEB_MERCATOR?(l[h]=p,a[h]=s):(l[h]=d.clone().multiplyRight(SD),a[h]=p.transform(s))}const u={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||wD,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let h=0;h<l.length;h++)u[`viewProjectionMatrix${h}`]=l[h],u[`projectCenter${h}`]=a[h];for(let h=0;h<2;h++)u[`shadow_uShadowMap${h}`]=n.shadowMaps&&n.shadowMaps[h]||n.dummyShadowMap;return u}const Zv={name:"shadow",dependencies:[Pg],vs:yD,fs:vD,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:CD,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},b2={...Ev,defaultUniforms:{...Ev.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},MD=[e2],OD=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],ID=[];function ND(n){const e=Os.getDefaultShaderAssembler();for(const i of MD)e.addDefaultModule(i);e._hookFunctions.length=0;const t=n==="glsl"?OD:ID;for(const i of t)e.addShaderHook(i);return e}const kD=[255,255,255],PD=1;let DD=0;class BD{constructor(e={}){this.type="ambient";const{color:t=kD}=e,{intensity:i=PD}=e;this.id=e.id||`ambient-${DD++}`,this.color=t,this.intensity=i}}const UD=[255,255,255],FD=1,LD=[0,0,-1];let zD=0;class Kv{constructor(e={}){this.type="directional";const{color:t=UD}=e,{intensity:i=FD}=e,{direction:s=LD}=e,{_shadow:a=!1}=e;this.id=e.id||`directional-${zD++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new Xn(s).normalize().toArray(),this.shadow=a}getProjectedLight(e){return this}}class VD{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Fg extends VD{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,a=e.clearColor??(s?[0,0,0,0]:!1),l=s?1:!1,u=s?0:!1,h=e.colorMask??15,d={viewport:[0,0,t,i]};e.colorMask&&(d.colorMask=h),e.scissorRect&&(d.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:a,clearDepth:l,clearStencil:u});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:s,viewports:a,views:l,onViewportActive:u,clearStack:h=!0}=t;t.pass=t.pass||"unknown",h&&(this._lastRenderIndex=-1);const d=[];for(const p of a){const m=l&&l[p.id];u?.(p);const y=this._getDrawLayerParams(p,t),v=p.subViewports||[p];for(const x of v){const A=this._drawLayersInViewport(e,{target:i,shaderModuleProps:s,viewport:x,view:m,pass:t.pass,layers:t.layers},y);d.push(A)}}return d}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:s=!1,layerFilter:a,cullRect:l,effects:u,shaderModuleProps:h},d=!1){const p=[],m=v2(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:s,renderPass:i,cullRect:l},v={};for(let x=0;x<t.length;x++){const A=t[x],E=this._shouldDrawLayer(A,y,a,v),C={shouldDrawLayer:E};E&&!d&&(C.shouldDrawLayer=!0,C.layerRenderIndex=m(A,E),C.shaderModuleProps=this._getShaderModuleProps(A,u,i,h),C.layerParameters={...A.context.deck?.props.parameters,...this.getLayerParameters(A,x,e)}),p[x]=C}return p}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:s,target:a,viewport:l,view:u},h){const d=HD(this.device,{shaderModuleProps:i,target:a,viewport:l});if(u){const{clear:m,clearColor:y,clearDepth:v,clearStencil:x}=u.props;if(m){let A=[0,0,0,0],E=1,C=0;Array.isArray(y)?A=[...y.slice(0,3),y[3]||255].map(M=>M/255):y===!1&&(A=!1),v!==void 0&&(E=v),x!==void 0&&(C=x),this.device.beginRenderPass({framebuffer:a,parameters:{viewport:d,scissorRect:d},clearColor:A,clearDepth:E,clearStencil:C}).end()}}const p={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let m=0;m<t.length;m++){const y=t[m],v=h[m],{shouldDrawLayer:x}=v;if(x&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&v.shouldDrawLayer){const{layerRenderIndex:A,shaderModuleProps:E,layerParameters:C}=v;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,A),E.project&&(E.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:E,uniforms:{layerIndex:A},parameters:C})}catch(D){y.raiseError(D,`drawing ${y} to ${s}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(i){const u=t.layer.id;if(u in s||(s[u]=i(t)),!s[u])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,s){const a=this.device.canvasContext.cssToDeviceRatio(),l=e.internalState?.propsInTransition||e.props,u={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:a,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const h of t)Qv(u,h.getShaderModuleProps?.(e,u));return Qv(u,this.getShaderModuleProps(e,t,u),s)}}function v2(n=0,e={}){const t={},i=(s,a)=>{const l=s.props._offset,u=s.id,h=s.parent&&s.parent.id;let d;if(h&&!(h in e)&&i(s.parent,!1),h in t){const p=t[h]=t[h]||v2(e[h],e);d=p(s,a),t[u]=p}else Number.isFinite(l)?(d=l+(e[h]||0),t[u]=null):d=n;return a&&d>=n&&(n=d+1),e[u]=d,d};return i}function HD(n,{shaderModuleProps:e,target:t,viewport:i}){const s=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,a]=n.canvasContext.getDrawingBufferSize(),l=t?t.height:a,u=i;return[u.x*s,l-(u.y+u.height)*s,u.width*s,u.height*s]}function Qv(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class jD extends Fg{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),s=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],a=s.width*i,l=s.height*i,u=[1,1,1,1];(a!==t.width||l!==t.height)&&t.resize({width:a,height:l}),super.render({...e,clearColor:u,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const $D={color:[255,255,255],intensity:1},Gv=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],WD=[0,0,0,200/255];class T2{constructor(e={}){this.id="lighting-effect",this.shadowColor=WD,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(Zv),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:a}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:a,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},a=e.props.material;return{shadow:i,lighting:s,phongMaterial:a,gouraudMaterial:a}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Zv))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new Nn().lookAt({eye:new Xn(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new jD(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new BD($D),this.directionalLights.push(new Kv(Gv[0]),new Kv(Gv[1])))}}class XD{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:a=0,copy:l=!1,initialize:u=!1,maxCount:h}){const d=s||e&&e.constructor||Float32Array,p=t*i+a;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,p)}let m=1/0;h&&(m=h*i+a);const y=this._allocate(d,p,u,m);return e&&l?y.set(e):u||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,i,s){let a=Math.max(Math.ceil(t*this.opts.overAlloc),1);a>s&&(a=s);const l=this._pool,u=e.BYTES_PER_ELEMENT*a,h=l.findIndex(d=>d.byteLength>=u);if(h>=0){const d=new e(l.splice(h,1)[0],0,a);return i&&d.fill(0),d}return new e(a)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:s}=i,a=t.findIndex(l=>l.byteLength>=s);a<0?t.push(i):(a>0||t.length<this.opts.poolSize)&&t.splice(a,0,i),t.length>this.opts.poolSize&&t.shift()}}const jo=new XD;function wo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function YD(n){return[n[12],n[13],n[14]]}function qD(n){return{left:Vr(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Vr(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Vr(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Vr(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Vr(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Vr(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Jv=new Xn;function Vr(n,e,t,i){Jv.set(n,e,t);const s=Jv.len();return{distance:i/s,normal:new Xn(-n/s,-e/s,-t/s)}}function ZD(n){return n-Math.fround(n)}let go;function $d(n,e){const{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,a=(s-i)/t;go=jo.allocate(go,a,{type:Float32Array,size:t*2});let l=i,u=0;for(;l<s;){for(let h=0;h<t;h++){const d=n[l++];go[u+h]=d,go[u+h+t]=ZD(d)}u+=t*2}return go.subarray(0,a*t*2)}function KD(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const QD=Math.PI/180,GD=wo(),e3=[0,0,0],JD={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function e6({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:a,near:l,far:u}){const h=n/e,d=t?new Nn().orthographic({fovy:i,aspect:h,focalDistance:s,near:l,far:u}):new Nn().perspective({fovy:i,aspect:h,near:l,far:u});if(a){const{left:p=0,right:m=0,top:y=0,bottom:v=0}=a,x=es((p+n-m)/2,0,n)-n/2,A=es((y+e-v)/2,0,e)-e/2;d[8]-=x*2/n,d[9]+=A*2/e}return d}class _a{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||JD,this.focalDistance=e.focalDistance||1,this.position=e.position||e3,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?on.WEB_MERCATOR:on.WEB_MERCATOR_AUTO_OFFSET:on.IDENTITY}equals(e){return e instanceof _a?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Vo(e.projectionMatrix,this.projectionMatrix)&&Vo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),s=p2(i,this.pixelProjectionMatrix),[a,l]=s,u=t?l:this.height-l;return e.length===2?[a,u]:[a,u,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,a,l]=e,u=t?a:this.height-a,h=i&&i*this.distanceScales.unitsPerMeter[2],d=Ug([s,u,l],this.pixelUnprojectionMatrix,h),[p,m,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,m,y]:Number.isFinite(i)?[p,m,i]:[p,m]}projectPosition(e){const[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){const t=la(e);return t[1]=es(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Ys(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),a=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],a[0],l[0]),Math.min(i[1],s[1],a[1],l[1]),Math.max(i[0],s[0],a[0],l[0]),Math.max(i[1],s[1],a[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?kp({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,qD(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=oD({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||kp({latitude:i,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:a,modelMatrix:l}=e;let u=e3;if(a&&(u=l?new Nn(l).transformAsVector(a,[]):a),this.isGeospatial){const h=this.projectPosition([t,i,0]);this.center=new Xn(u).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(u)}_initMatrices(e){const{viewMatrix:t=GD,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:a,fovy:l=75,near:u=.1,far:h=1e3,padding:d=null,focalDistance:p=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Nn().multiplyRight(t).translate(new Xn(this.center).negate()),this.projectionMatrix=i||e6({width:this.width,height:this.height,orthographic:s,fovyRadians:a||l*QD,focalDistance:p,padding:d,near:u,far:h});const m=wo();Bs(m,m,this.projectionMatrix),Bs(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=Sp([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=YD(this.viewMatrixInverse);const y=wo(),v=wo();kg(y,y,[this.width/2,-this.height/2,1]),xu(y,y,[1,-1,0]),Bs(v,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=v,this.pixelUnprojectionMatrix=Sp(wo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Ye.warn("Pixel project matrix not invertible")()}}_a.displayName="Viewport";class ss extends _a{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:s=0,pitch:a=0,bearing:l=0,nearZMultiplier:u=.1,farZMultiplier:h=1.01,nearZ:d,farZ:p,orthographic:m=!1,projectionMatrix:y,repeat:v=!1,worldOffset:x=0,position:A,padding:E,legacyMeterSizes:C=!1}=e;let{width:D,height:M,altitude:B=1.5}=e;const z=Math.pow(2,s);D=D||1,M=M||1;let X,ne=null;if(y)B=y[5]/2,X=Ho(B);else{e.fovy?(X=e.fovy,B=Bg(X)):X=Ho(B);let ie;if(E){const{top:ge=0,bottom:ee=0}=E;ie=[0,es((ge+M-ee)/2,0,M)-M/2]}ne=cD({width:D,height:M,scale:z,center:A&&[0,0,A[2]*jd(t)],offset:ie,pitch:a,fovy:X,nearZMultiplier:u,farZMultiplier:h}),Number.isFinite(d)&&(ne.near=d),Number.isFinite(p)&&(ne.far=p)}let ae=lD({height:M,pitch:a,bearing:l,scale:z,altitude:B});x&&(ae=new Nn().translate([512*x,0,0]).multiplyLeft(ae)),super({...e,width:D,height:M,viewMatrix:ae,longitude:i,latitude:t,zoom:s,...ne,fovy:X,focalDistance:B}),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=a,this.bearing=l,this.altitude=B,this.fovy=X,this.orthographic=m,this._subViewports=v?[]:null,this._pseudoMeters=C,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){const a=s?new ss({...this,worldOffset:s}):this;this._subViewports.push(a)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),s=(e[2]||0)*jd(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),s=(e[2]||0)/jd(i);return[t,i,s]}addMetersToLngLat(e,t){return d2(e,t)}panByPosition(e,t){const i=Ug(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),a=wp([],s,VN([],i)),l=wp([],this.center,a),[u,h]=this.unprojectFlat(l);return{longitude:u,latitude:h}}getBounds(e={}){const t=hD(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:s}=this,{longitude:a,latitude:l,zoom:u}=uD({width:i,height:s,bounds:e,...t});return new ss({width:i,height:s,longitude:a,latitude:l,zoom:u})}}ss.displayName="WebMercatorViewport";const t3=[0,0,0];function Wd(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof ss){const[s,a,l=0]=n,u=e.getDistanceScales([s,a]);i[2]=l*u.unitsPerMeter[2]}return i}function t6(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:a,fromCoordinateOrigin:l}=n;return s===Ue.DEFAULT&&(s=e.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN),a===void 0&&(a=s),l===void 0&&(l=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:a,fromCoordinateOrigin:l}}function x2(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:a}){let[l,u,h=0]=n;switch(t&&([l,u,h]=ga([],[l,u,h,1],t)),i){case Ue.LNGLAT:return Wd([l,u,h],e,a);case Ue.LNGLAT_OFFSETS:return Wd([l+s[0],u+s[1],h+(s[2]||0)],e,a);case Ue.METER_OFFSETS:return Wd(d2(s,[l,u,h]),e,a);case Ue.CARTESIAN:default:return e.isGeospatial?[l+s[0],u+s[1],h+s[2]]:e.projectPosition([l,u,h])}}function n6(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:a,fromCoordinateSystem:l,fromCoordinateOrigin:u}=t6(e),{autoOffset:h=!0}=e,{geospatialOrigin:d=t3,shaderCoordinateOrigin:p=t3,offsetMode:m=!1}=h?c2(t,i,s):{},y=x2(n,{viewport:t,modelMatrix:a,coordinateSystem:l,coordinateOrigin:u,offsetMode:m});if(m){const v=t.projectPosition(d||p);YT(y,y,v)}return y}let i6=1,s6=1;class w2{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:a=1}=e,l=i6++,u={time:0,delay:t,duration:i,rate:s,repeat:a};return this._setChannelTime(u,this.time),this.channels.set(l,u),l}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:a,channel:l}=s;a.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=s6++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function r6(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function a6(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let o6=0;class Lg{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:bp.stats.get(`animation-loop-${o6++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...Lg.defaultAnimationLoopProps,...e},e=this.props,!e.device)throw new Error("No device provided");this.stats=e.stats||new ku({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=r6(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(a6(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw new Error("loop");const t=e?.canvas,i=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:i,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1];let i=1;const s=this.device?.getDefaultCanvasContext().canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Xd={};function Go(n="id"){Xd[n]=Xd[n]||1;const e=Xd[n]++;return`${n}-${e}`}class n3{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Go("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Qe.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function l6(n,e){if(e instanceof n3)return e;const t=c6(n,e),{attributes:i,bufferLayout:s}=u6(n,e);return new n3({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:i})}function c6(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:Qe.INDEX,data:t})}function u6(n,e){const t=[],i={};for(const[a,l]of Object.entries(e.attributes)){let u=a;switch(a){case"POSITION":u="positions";break;case"NORMAL":u="normals";break;case"TEXCOORD_0":u="texCoords";break;case"COLOR_0":u="colors";break}if(l){i[u]=n.createBuffer({data:l.value,id:`${a}-buffer`});const{value:h,size:d,normalized:p}=l;t.push({name:u,format:tI(h,d,p)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:s}}class zg{static defaultProps={...Ds.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new zg(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);const t={...Ds.defaultProps,...e},i=this._renderPipelineCache,s=this._hashRenderPipeline(t);let a=i[s]?.pipeline;return a?(i[s].useCount++,this.debug&&J.warn(`${this}: ${i[s].pipeline} reused, count=${i[s].useCount}, (id=${e.id})`)()):(a=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:Go("unnamed-cached")}),a.hash=s,i[s]={pipeline:a,useCount:1},this.debug&&J.warn(`${this}: ${a} created, count=${i[s].useCount}`)()),a}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);const t={...gu.defaultProps,...e},i=this._computePipelineCache,s=this._hashComputePipeline(t);let a=i[s]?.pipeline;return a?(i[s].useCount++,this.debug&&J.warn(`${this}: ${i[s].pipeline} reused, count=${i[s].useCount}, (id=${e.id})`)()):(a=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0}),a.hash=s,i[s]={pipeline:a,useCount:1},this.debug&&J.warn(`${this}: ${a} created, count=${i[s].useCount}`)()),a}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._getCache(e),i=e.hash;t[i].useCount--,t[i].useCount===0?(this._destroyPipeline(e),this.debug&&J.warn(`${this}: ${e} released and destroyed`)()):t[i].useCount<0?(J.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[i].useCount=0):this.debug&&J.warn(`${this}: ${e} released, count=${t[i].useCount}`)()}_destroyPipeline(e){const t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof gu&&(t=this._computePipelineCache),e instanceof Ds&&(t=this._renderPipelineCache),!t)throw new Error(`${this}`);if(!t[e.hash])throw new Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){const{type:t}=this.device,i=this._getHash(e.shader.source);return`${t}/C/${i}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,s="-",a=this._getHash(JSON.stringify(e.bufferLayout)),{type:l}=this.device;switch(l){case"webgl":return`${l}/R/${t}/${i}V${s}BL${a}`;case"webgpu":default:const u=this._getHash(JSON.stringify(e.parameters));return`${l}/R/${t}/${i}V${s}T${e.topology}P${u}BL${a}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class Vg{static defaultProps={...Uu.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new Vg(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);const t=this._hashShader(e);let i=this._cache[t];if(i)i.useCount++,this.debug&&J.warn(`${this}: Reusing shader ${i.shader.id} count=${i.useCount}`)();else{const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:s,useCount:1},this.debug&&J.warn(`${this}: Created new shader ${s.id}`)()}return i.shader}release(e){if(!this.cachingEnabled){e.destroy();return}const t=this._hashShader(e),i=this._cache[t];if(i)if(i.useCount--,i.useCount===0)this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy(),this.debug&&J.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else{if(i.useCount<0)throw new Error(`ShaderFactory: Shader ${e.id} released too many times`);this.debug&&J.warn(`${this}: Releasing shader ${e.id} count=${i.useCount}`)()}}_hashShader(e){return`${e.stage}:${e.source}`}}function f6(n,e){const t={},i="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const s of n.attributes)if(s){const a=`${s.location} ${s.name}: ${s.type}`;t[`in ${a}`]={[i]:s.stepMode||"vertex"}}for(const s of n.varyings||[]){const a=`${s.location} ${s.name}`;t[`out ${a}`]={[i]:JSON.stringify(s)}}return t}let xt=null,Yd=null;function h6(n,{id:e,minimap:t,opaque:i,top:s="0",left:a="0",rgbaScale:l=1}){xt||(xt=document.createElement("canvas"),xt.id=e,xt.title=e,xt.style.zIndex="100",xt.style.position="absolute",xt.style.top=s,xt.style.left=a,xt.style.border="blue 5px solid",xt.style.transform="scaleY(-1)",document.body.appendChild(xt),Yd=xt.getContext("2d")),(xt.width!==n.width||xt.height!==n.height)&&(xt.width=n.width/2,xt.height=n.height/2,xt.style.width="400px",xt.style.height="400px");const u=n.device.readPixelsToArrayWebGL(n),h=Yd?.createImageData(n.width,n.height);if(h){for(let p=0;p<u.length;p+=4)h.data[0+p+0]=u[p+0]*l,h.data[0+p+1]=u[p+1]*l,h.data[0+p+2]=u[p+2]*l,h.data[0+p+3]=i?255:u[p+3]*l;Yd?.putImageData(h,0,0)}}function Pp(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Pp(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!Pp(n[a],e[a],t-1))return!1;return!0}return!1}class qd{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const s of t){const a=i.findIndex(l=>l.name===s.name);a<0?i.push(s):i[a]=s}return i}getBufferIndex(e){const t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&J.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function d6(n,e){const t=Object.fromEntries(n.attributes.map(s=>[s.name,s.location])),i=e.slice();return i.sort((s,a)=>{const l=s.attributes?s.attributes.map(p=>p.attribute):[s.name],u=a.attributes?a.attributes.map(p=>p.attribute):[a.name],h=Math.min(...l.map(p=>t[p])),d=Math.min(...u.map(p=>t[p]));return h-d}),i}function p6(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function g6(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function _6(n){return p6(n)||g6(n)}function m6(n){return _6(n)||typeof n=="number"||typeof n=="boolean"}function y6(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];m6(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class b6{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const i=pg(Object.values(e).filter(s=>s.dependencies));for(const s of i)e[s.name]=s;J.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,a]of Object.entries(e))this._addModule(a),a.name&&s!==a.name&&!this.options.disableWarnings&&J.warn(`Module name: ${s} vs ${a.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const i=t,s=e[i]||{},a=this.modules[i];if(!a){this.options.disableWarnings||J.warn(`Module ${t} not found`)();continue}const l=this.moduleUniforms[i],u=this.moduleBindings[i],h=a.getUniforms?.(s,l)||s,{uniforms:d,bindings:p}=y6(h);this.moduleUniforms[i]={...l,...d},this.moduleBindings[i]={...u,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,i]of Object.entries(this.moduleUniforms))for(const[s,a]of Object.entries(i))e[`${t}.${s}`]={type:this.modules[t].uniformTypes?.[s],value:String(a)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let v6="";async function T6(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:v6+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}const x6=["+X","-X","+Y","-Y","+Z","-Z"],w6=["+X","-X","+Y","-Y","+Z","-Z"];class Oo{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const i=Go("async-texture");this.props={...Oo.defaultProps,id:i,...t},this.id=this.props.id,t={...t},typeof t?.data=="string"&&t.dimension==="2d"&&(t.data=T6(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((s,a)=>{this.resolveReady=()=>{this.isReady=!0,s()},this.rejectReady=a}),this.initAsync(t)}async initAsync(e){const t=e.data,i=await S2(t).then(void 0,this.rejectReady);if(this.destroyed)return;const s=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(i);if(!s)throw new Error("Texture size could not be determined");const a={...s,...e,data:void 0,mipLevels:1},l=this.device.getMipLevelCount(a.width,a.height);if(a.mipLevels=this.props.mipLevels==="auto"?l:Math.min(l,this.props.mipLevels),this.texture=this.device.createTexture(a),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,i);break;case"2d":this._setTexture2DData(i);break;case"3d":this._setTexture3DData(this.texture,i);break;case"2d-array":this._setTextureArrayData(this.texture,i);break;case"cube":this._setTextureCubeData(this.texture,i);break;case"cube-array":this._setTextureCubeArrayData(this.texture,i);break}this.props.mipmaps&&this.generateMipmaps(),J.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof js?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw new Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw new Error("Texture not initialized");const i=this._normalizeTextureData(e);i.length>1&&this.props.mipmaps!==!1&&J.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const a=i[s];this.device.isExternalImage(a)?this.texture.copyExternalImage({image:a,depth:t,mipLevel:s,flipY:!0}):this.texture.copyImageData({data:a.data,mipLevel:s})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw new Error(this.id);for(const[i,s]of Object.entries(t)){const a=w6.indexOf(i);this._setTexture2DData(s,a)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw new Error(this.id);for(let i=0;i<t.length;i++)this._setTexture2DData(t[i],i)}_setTextureCubeArrayData(e,t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,i,s=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&J.warn(`${this.id} has mipmap and multiple LODs.`)();const a=x6.indexOf(i);this._setTexture2DData(t,a)}_normalizeTextureData(e){const t=this.texture;let i;return ArrayBuffer.isView(e)?i=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?i=e:i=[e],i}static defaultProps={...bt.defaultProps,data:null,mipmaps:!1}}async function S2(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(S2));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),s={};for(let a=0;a<i.length;a++)s[i[a]]=t[a];return s}return n}const As=2,S6=1e4;class ca{static defaultProps={...Ds.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Os.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...ca.defaultProps,...t},t=this.props,this.id=t.id||Go("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(this.props.modules?.map(h=>[h.name,h])||[]),s=t.shaderInputs||new b6(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const a=E6(e),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:h,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:a,...this.props,modules:l});this.source=h,this._getModuleUniforms=d,this.props.shaderLayout||=CN(this.source)}else{const{vs:h,fs:d,getUniforms:p}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:a,...this.props,modules:l});this.vs=h,this.fs=d,this._getModuleUniforms=p}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||zg.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Vg.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return J.info(As,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings});const{indexBuffer:a}=this.vertexArray,l=a?a.byteLength/(a.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&l6(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new qd(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new qd(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Pp(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new GI(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(A6(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=t?.disableWarnings??this.props.disableWarnings;e.indices&&J.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=d6(this.pipeline.shaderLayout,this.bufferLayout);const s=new qd(this.bufferLayout);for(const[a,l]of Object.entries(e)){const u=s.getBufferLayout(a);if(!u){i||J.warn(`Model(${this.id}): Missing layout for buffer "${a}".`)();continue}const h=s.getAttributeNamesForBuffer(u);let d=!1;for(const p of h){const m=this._attributeInfos[p];if(m){const y=this.device.type==="webgpu"?s.getBufferIndex(m.bufferName):m.location;this.vertexArray.setBuffer(y,l),d=!0}}!d&&!i&&J.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${a}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,s]of Object.entries(e)){const a=this._attributeInfos[i];a?this.vertexArray.setConstantWebGL(a.location,s):(t?.disableWarnings??this.props.disableWarnings)||J.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Oo&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof Oo?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Bu?e=Math.max(e,t.texture.updateTimestamp):t instanceof Qe||t instanceof bt?e=Math.max(e,t.updateTimestamp):t instanceof Oo?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof js||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(J.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=bT(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=J.level>3?0:S6;J.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,J.group(As,`>>> DRAWING MODEL ${this.id}`,{collapsed:J.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=f6(this.pipeline.shaderLayout,this.id);J.table(As,e)();const t=this.shaderInputs.getDebugTable();J.table(As,t)();const i=this._getAttributeDebugTable();J.table(As,this._attributeInfos)(),J.table(As,i)(),J.groupEnd(As)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&h6(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=_g(t);return(e instanceof Qe?new i(e.debugData):e).toString()}}function A6(n){return!!(n.uniformTypes&&!R6(n.uniformTypes))}function E6(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function R6(n){for(const e in n)return!1;return!0}class ua{device;model;transformFeedback;static defaultProps={...ca.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=ua.defaultProps){if(!ua.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new ca(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||Y4(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof Qe)return t.readAsync();const{buffer:i,byteOffset:s=0,byteLength:a=i.byteLength}=t;return i.readAsync(s,a)}}class A2{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||Go("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[a,l]of Object.entries(t)){const u=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(u.value))throw new Error(`${this._print(a)}: must be typed array or object with value as typed array`);if((a==="POSITION"||a==="positions")&&!u.size&&(u.size=3),a==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=u}else this.attributes[a]=u}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const s of Object.values(e)){const{value:a,size:l,constant:u}=s;!u&&a&&l!==void 0&&l>=1&&(i=Math.min(i,a.length/l))}return i}}const C6={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class E2 extends Fg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:a,pickingFBO:l,deviceRect:{x:u,y:h,width:d,height:p},cullRect:m,effects:y,pass:v="picking",pickZ:x,shaderModuleProps:A}){this.pickZ=x;const E=this._resetColorEncoder(x),C=[u,h,d,p],D=super.render({target:l,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:a,cullRect:m,effects:y?.filter(B=>B.useInPicking),pass:v,isPicking:!0,shaderModuleProps:A,clearColor:[0,0,0,0],colorMask:15,scissorRect:C});return this._colorEncoderState=null,{decodePickingColor:E&&O6.bind(null,E),stats:D}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const s={...e.props.parameters},{pickable:a,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?s.blend=!1:a&&l.includes("draw")&&(Object.assign(s,C6),s.blend=!0,s.blendColor=M6(this._colorEncoderState,e,i)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function M6(n,e,t){const{byLayer:i,byAlpha:s}=n;let a,l=i.get(e);return l?(l.viewports.push(t),a=l.a):(a=i.size+1,a<=255?(l={a,layer:e,viewports:[t]},i.set(e,l),s[a]=l):(Ye.warn("Too many pickable layers, only picking the first 255")(),a=0)),[0,0,0,a/255]}function O6(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const jr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Au=Symbol.for("component"),Us=Symbol.for("propTypes"),Zd=Symbol.for("deprecatedProps"),ea=Symbol.for("asyncPropDefaults"),qs=Symbol.for("asyncPropOriginal"),ts=Symbol.for("asyncPropResolved");function R2(n,e=()=>!0){return Array.isArray(n)?C2(n,e,[]):e(n)?[n]:[]}function C2(n,e,t){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?C2(s,e,t):e(s)&&t.push(s)}return t}function I6({target:n,source:e,start:t=0,count:i=1}){const s=e.length,a=i*s;let l=0;for(let u=t;l<s;l++)n[u++]=e[l];for(;l<a;)l<a-l?(n.copyWithin(t+l,t,t+l),l*=2):(n.copyWithin(t+l,t,t+a-l),l=a);return n}class N6{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=dp(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===i&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const a of this._subscribers)a.onChange(this.getData())}}class k6{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let a=this._resources[e];a?a.setData(t,i):(a=new N6(e,t,this._context),this._resources[e]=a),a.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const s=t[i],a=this._resources[s.resourceId];a&&a.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){const{_resources:a,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),a[e]||this.add({resourceId:e,data:null,persistent:!1}));const u=a[e];if(this._track(i,s,u,t),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,s){const a=this._consumers,l=a[e]=a[e]||{};let u=l[t];const h=u&&u.resourceId&&this._resources[u.resourceId];h&&(h.unsubscribe(u),this.prune()),i&&(u?(u.onChange=s,u.resourceId=i.id):u={onChange:s,resourceId:i.id},l[t]=u,i.subscribe(u))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const P6="layerManager.setLayers",D6="layerManager.activateViewport";class B6{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{Bt(D6,this,u),u&&(this.context.viewport=u)};const{deck:i,stats:s,viewport:a,timeline:l}=t||{};this.layers=[],this.resourceManager=new k6({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:ND(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[Fk],renderPass:void 0,stats:s||new ku({id:"deck.gl"}),viewport:a||new _a({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new w2,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){Bt(P6,this,t,e),this._lastRenderedLayers=e;const i=R2(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(s=>s.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const l of e)i[l.id]?Ye.warn(`Multiple old layers with same id ${l.id}`)():i[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let a=!1;for(const l of s)if(l.hasUniformTransition()){a=`Uniform transition in ${l}`;break}this._needsUpdate=a,this.layers=s}_updateSublayersRecursively(e,t,i){for(const s of e){s.context=this.context;const a=t[s.id];a===null&&Ye.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let l=null;try{this._debug&&a!==s&&s.validateProps(),a?(this._transferLayerState(a,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),l=s.isComposite?s.getSubLayers():null}catch(u){this._handleError("matching",u,s)}l&&this._updateSublayersRecursively(l,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=jr.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=jr.MATCHED,t!==e&&(e.lifecycle=jr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=jr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=jr.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function bn(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!bn(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a of i)if(!e.hasOwnProperty(a)||!bn(n[a],e[a],t-1))return!1;return!0}return!1}class U6{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let a=i.length-1;a>=0;--a){const l=i[a];if(l.containsPixel(s)){const u=e.slice();return u[0]-=l.x,u[1]-=l.y,l.unproject(u,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=R2(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!bn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Ye.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:a=>this.getView(e.id)?.makeViewport({viewState:a,width:this.width,height:this.height})})}_updateController(e,t,i,s){const a=e.controller;if(a&&i){const l={...t,...a,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==a.type)&&(s=this._createController(e,l)),s&&s.setProps(l),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const a=e[s],l=this.getViewState(a),u=a.makeViewport({viewState:l,width:this.width,height:this.height});let h=t[a.id];const d=!!a.controller;d&&!h&&(i=!0),(i||!d)&&h&&(h.finalize(),h=null),this.controllers[a.id]=this._updateController(a,l,u,h),u&&this._viewports.unshift(u)}for(const s in t){const a=t[s];a&&!this.controllers[s]&&a.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}}const F6=/([0-9]+\.?[0-9]*)(%|px)/;function Yi(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=F6.exec(n);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function qi(n,e){return n.relative?Math.round(n.position*e):n.position}class fa{constructor(e){const{id:t,x:i=0,y:s=0,width:a="100%",height:l="100%",padding:u=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Yi(i),this._y=Yi(s),this._width=Yi(a),this._height=Yi(l),this._padding=u&&{left:Yi(u.left||0),right:Yi(u.right||0),top:Yi(u.top||0),bottom:Yi(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&bn(this.props,e.props,2)}clone(e){const t=this.constructor;return new t({...this.props,...e})}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const a=this.getViewportType(i);return new a({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:qi(this._x,e),y:qi(this._y,t),width:qi(this._width,e),height:qi(this._height,t)};return this._padding&&(i.padding={left:qi(this._padding.left,e),top:qi(this._padding.top,t),right:qi(this._padding.right,e),bottom:qi(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class zu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const i3=()=>{},Dp={BREAK:1,SNAP_TO_END:2,IGNORE:3},L6=n=>n,z6=Dp.BREAK;class V6{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:s,startProps:a,endProps:l,duration:u,easing:h}}=t,d=h(i/u),p=s.interpolateProps(a,l,d);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new zu(e.timeline),this.onViewStateChange=e.onViewStateChange||i3,this.onStateChange=e.onStateChange||i3}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:a,endProps:l}=this.transition.settings;s={...i,...a===Dp.SNAP_TO_END?l:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===Dp.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),a=t.transitionInterpolator,l=a.getDuration?a.getDuration(e,t):t.transitionDuration;if(l===0)return;const u=a.initializeProps(e,s);this.propsInTransition={};const h={duration:l,easing:t.transitionEasing||L6,interpolator:a,interruption:t.transitionInterruption||z6,startProps:u.start,endProps:u.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Nt(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class M2{constructor(e){const{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!Vo(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},s={};for(const a of this._propsToExtract)(a in e||a in t)&&(i[a]=e[a],s[a]=t[a]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];Nt(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const H6=["longitude","latitude","zoom","bearing","pitch"],j6=["longitude","latitude","zoom"];class Hg extends M2{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:H6,required:j6},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:s,around:a}=this.opts;if(s&&a){const l=s(e),u=s(t),h=l.unproject(a);i.start.around=a,Object.assign(i.end,{around:u.project(h),aroundPosition:h,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const s={};for(const a of this._propsToExtract)s[a]=zo(e[a]||0,t[a]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const a=this.opts.makeViewport({...t,...s});Object.assign(s,a.panByPosition(t.aroundPosition,zo(e.around,t.around,i)))}return s}}const gi={transitionDuration:0},$6=300,kc=n=>1-(1-n)*(1-n),Hr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Es={};class W6{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new V6({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){const{width:i,height:s}=this.props;if(t&&t.handled)return!1;const a=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return a&&t&&t.stopPropagation(),a}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?$6:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:a=!0,doubleClickZoom:l=!0,touchZoom:u=!0,touchRotate:h=!1,keyboard:d=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(Hr.WHEEL,p&&i),this.toggleEvents(Hr.PAN,p),this.toggleEvents(Hr.PINCH,p&&(u||h)),this.toggleEvents(Hr.MULTI_PAN,p&&h),this.toggleEvents(Hr.DOUBLE_CLICK,p&&l),this.toggleEvents(Hr.KEYBOARD,p&&d),this.scrollZoom=i,this.dragPan=s,this.dragRotate=a,this.doubleClickZoom=l,this.touchZoom=u,this.touchRotate=h,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const s={...e.getViewportProps(),...t},a=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),a){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,gi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,gi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kc},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,gi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],a=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kc},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:a}=e;let l=2/(1+Math.exp(-Math.abs(a*i)));a<0&&l!==0&&(l=1/l);const u=s?{...this._getTransitionProps({around:t}),transitionDuration:250}:gi,h=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(h,u,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,gi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,gi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],a=this.controllerState.rotate({pos:s});this.updateViewport(a,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:kc},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return Es._startPinchRotation=e.rotation,Es._lastPinchEvent=e,this.updateViewport(i,gi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:Es._startPinchRotation-i})}return this.updateViewport(t,gi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Es._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=Es;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const s=this.getCenter(e);let a=this.controllerState.rotateEnd();const l=Math.log2(e.scale),u=(l-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),h=Math.pow(2,l+u*t/2);a=a.zoom({pos:s,scale:h}).zoomEnd(),this.updateViewport(a,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:kc},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Es._startPinchRotation=null,Es._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:a,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:u}=this;let h;const d={};switch(e.srcEvent.code){case"Minus":h=t?u.zoomOut(i).zoomOut(i):u.zoomOut(i),d.isZooming=!0;break;case"Equal":h=t?u.zoomIn(i).zoomIn(i):u.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":t?(h=u.rotateLeft(a),d.isRotating=!0):(h=u.moveLeft(s),d.isPanning=!0);break;case"ArrowRight":t?(h=u.rotateRight(a),d.isRotating=!0):(h=u.moveRight(s),d.isPanning=!0);break;case"ArrowUp":t?(h=u.rotateUp(l),d.isRotating=!0):(h=u.moveUp(s),d.isPanning=!0);break;case"ArrowDown":t?(h=u.rotateDown(l),d.isRotating=!0):(h=u.moveDown(s),d.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?gi:e?{...t,transitionInterpolator:new Hg({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class X6{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const s3=5,Y6=1.2;class q6 extends X6{constructor(e){const{width:t,height:i,latitude:s,longitude:a,zoom:l,bearing:u=0,pitch:h=0,altitude:d=1.5,position:p=[0,0,0],maxZoom:m=20,minZoom:y=0,maxPitch:v=60,minPitch:x=0,startPanLngLat:A,startZoomLngLat:E,startRotatePos:C,startBearing:D,startPitch:M,startZoom:B,normalize:z=!0}=e;Nt(Number.isFinite(a)),Nt(Number.isFinite(s)),Nt(Number.isFinite(l)),super({width:t,height:i,latitude:s,longitude:a,zoom:l,bearing:u,pitch:h,altitude:d,maxZoom:m,minZoom:y,maxPitch:v,minPitch:x,normalize:z,position:p},{startPanLngLat:A,startZoomLngLat:E,startRotatePos:C,startBearing:D,startPitch:M,startZoom:B}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const a=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(a)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:a,startPitch:l}=this.getState();if(!s||a===void 0||l===void 0)return this;let u;return e?u=this._getNewRotation(e,s,l,a):u={bearing:a+t,pitch:l+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:a}=this.getState();if(a||(s=this.getViewportProps().zoom,a=this._unproject(t)||this._unproject(e)),!a)return this;const{maxZoom:l,minZoom:u}=this.getViewportProps();let h=s+Math.log2(i);h=es(h,u,l);const d=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...d.panByPosition(a,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:a}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(a-t.longitude)>180&&(i.longitude=a<0?a+360:a-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=es(s,i,t);const{maxPitch:a,minPitch:l,pitch:u}=e;e.pitch=es(u,l,a);const{normalize:h=!0}=e;return h&&Object.assign(e,dD(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){const a=e[0]-t[0],l=e[1]-t[1],u=e[1],h=t[1],{width:d,height:p}=this.getViewportProps(),m=a/d;let y=0;l>0?Math.abs(p-h)>s3&&(y=l/(h-p)*Y6):l<0&&h>s3&&(y=1-u/h),y=es(y,-1,1);const{minPitch:v,maxPitch:x}=this.getViewportProps(),A=s+180*m;let E=i;return y>0?E=i+y*(x-i):y<0&&(E=i-y*(v-i)),{pitch:E,bearing:A}}}class Z6 extends W6{constructor(){super(...arguments),this.ControllerState=q6,this.transition={transitionDuration:300,transitionInterpolator:new Hg({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class O2 extends fa{constructor(e={}){super(e)}getViewportType(){return ss}get ControllerType(){return Z6}}O2.displayName="MapView";const K6=new T2;function Q6(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class G6{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(s=>Q6(s,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(bn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const i=[];for(const s of e){const a=t[s.id];let l=s;a&&a!==s?a.setProps?(a.setProps(s.props),l=a):a.cleanup(this._context):a||s.setup(this._context),i.push(l),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof T2)||this._resolvedEffects.push(K6),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class J6 extends Fg{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const eB="deckRenderer.renderLayers";class tB{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new J6(e),this.pickLayersPass=new E2(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const a=t.render({...i,target:s});i.effects&&(this.lastPostProcessEffect&&(i.clearCanvas=e.clearCanvas===void 0?!0:e.clearCanvas),this._postRender(i.effects,i)),this.renderCount++,Bt(eB,this,a,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[i,s]=t;e.length===0&&[0,1].map(a=>{const l=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:i,height:s});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${a}`,colorAttachments:[l]}))});for(const a of e)a.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,s={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const a of e)if(a.postRender){s.target=a.id===this.lastPostProcessEffect?t.target:void 0;const l=a.postRender(s);s.inputBuffer=l,s.swapBuffer=l===i[0]?i[1]:i[0]}}}const nB={pickedColor:null,pickedObjectIndex:-1};function r3({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:a}){const{x:l,y:u,width:h,height:d}=a;let p=s*s,m=-1,y=0;for(let v=0;v<d;v++){const x=v+u-i,A=x*x;if(A>p)y+=4*h;else for(let E=0;E<h;E++){if(n[y+3]-1>=0){const D=E+l-t,M=D*D+A;M<=p&&(p=M,m=y)}y+=4}}if(m>=0){const v=n.slice(m,m+4),x=e(v);if(x){const A=Math.floor(m/4/h),E=m/4-A*h;return{...x,pickedColor:v,pickedX:l+E,pickedY:u+A}}Ye.error("Picked non-existent layer. Is picking buffer corrupt?")()}return nB}function a3({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const a=n.slice(i,i+4),l=a.join(",");if(!t.has(l)){const u=e(a);u?t.set(l,{...u,color:a}):Ye.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function Bp({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:a}){let l=e[0];e.length>1&&(l=iB(n?.pickedViewports||e,{x:i,y:s}));let u;if(l){const h=[i-l.x,s-l.y];a!==void 0&&(h[2]=a),u=l.unproject(h)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:u,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function o3(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:a,pickedLayer:l,pickedObjectIndex:u}=e,h=l?[l]:[];if(i==="hover"){const m=t.index,y=t.layerId,v=l?l.props.id:null;if(v!==y||u!==m){if(v!==y){const x=s.find(A=>A.props.id===y);x&&h.unshift(x)}t.layerId=v,t.index=u,t.info=null}}const d=Bp(n),p=new Map;return p.set(null,d),h.forEach(m=>{let y={...d};m===l&&(y.color=a,y.index=u,y.picked=!0),y=Up({layer:m,info:y,mode:i});const v=y.layer;m===l&&i==="hover"&&(t.info=y),p.set(v.id,y),i==="hover"&&v.updateAutoHighlight(y)}),p}function Up({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function iB(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class sB{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new E2(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},a=this.lastPickedInfo.info){const l=a&&a.layer&&a.layer.id,u=a&&a.viewport&&a.viewport.id,h=l?i.find(y=>y.id===l):null,d=u&&s.find(y=>y.id===u)||s[0],p=d&&d.unproject([e-d.x,t-d.y]);return{...a,...{x:e,y:t,viewport:d,coordinate:p,layer:h}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:i,x:s,y:a,radius:l=0,depth:u=1,mode:h="query",unproject3D:d,onViewportActive:p,effects:m}){const y=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||i.length===0)return{result:[],emptyInfo:Bp({viewports:i,x:s,y:a,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([s,a],!0),A=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],E=Math.round(l*y),{width:C,height:D}=this.pickingFBO,M=this._getPickingRect({deviceX:A[0],deviceY:A[1],deviceRadius:E,deviceWidth:C,deviceHeight:D}),B={x:s-l,y:a-l,width:l*2+1,height:l*2+1};let z;const X=[],ne=new Set;for(let ae=0;ae<u;ae++){let ie;if(M){const ee=this._drawAndSample({layers:v,views:t,viewports:i,onViewportActive:p,deviceRect:M,cullRect:B,effects:m,pass:`picking:${h}`});ie=r3({...ee,deviceX:A[0],deviceY:A[1],deviceRadius:E,deviceRect:M})}else ie={pickedColor:null,pickedObjectIndex:-1};let ge;if(ie.pickedLayer&&d&&this.depthFBO){const{pickedColors:ee}=this._drawAndSample({layers:[ie.pickedLayer],views:t,viewports:i,onViewportActive:p,deviceRect:{x:ie.pickedX,y:ie.pickedY,width:1,height:1},cullRect:B,effects:m,pass:`picking:${h}:z`},!0);ee[3]&&(ge=ee[0])}ie.pickedLayer&&ae+1<u&&(ne.add(ie.pickedLayer),ie.pickedLayer.disablePickingIndex(ie.pickedObjectIndex)),z=o3({pickInfo:ie,lastPickedInfo:this.lastPickedInfo,mode:h,layers:v,viewports:i,x:s,y:a,z:ge,pixelRatio:y});for(const ee of z.values())ee.layer&&X.push(ee);if(!ie.pickedColor)break}for(const ae of ne)ae.restorePickingColors();return{result:X,emptyInfo:z.get(null)}}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:a,radius:l=0,depth:u=1,mode:h="query",unproject3D:d,onViewportActive:p,effects:m}){const y=this.device.canvasContext.cssToDeviceRatio(),v=this._getPickable(e);if(!v||i.length===0)return{result:[],emptyInfo:Bp({viewports:i,x:s,y:a,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([s,a],!0),A=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],E=Math.round(l*y),{width:C,height:D}=this.pickingFBO,M=this._getPickingRect({deviceX:A[0],deviceY:A[1],deviceRadius:E,deviceWidth:C,deviceHeight:D}),B={x:s-l,y:a-l,width:l*2+1,height:l*2+1};let z;const X=[],ne=new Set;for(let ae=0;ae<u;ae++){let ie;if(M){const ee=this._drawAndSample({layers:v,views:t,viewports:i,onViewportActive:p,deviceRect:M,cullRect:B,effects:m,pass:`picking:${h}`});ie=r3({...ee,deviceX:A[0],deviceY:A[1],deviceRadius:E,deviceRect:M})}else ie={pickedColor:null,pickedObjectIndex:-1};let ge;if(ie.pickedLayer&&d&&this.depthFBO){const{pickedColors:ee}=this._drawAndSample({layers:[ie.pickedLayer],views:t,viewports:i,onViewportActive:p,deviceRect:{x:ie.pickedX,y:ie.pickedY,width:1,height:1},cullRect:B,effects:m,pass:`picking:${h}:z`},!0);ee[3]&&(ge=ee[0])}ie.pickedLayer&&ae+1<u&&(ne.add(ie.pickedLayer),ie.pickedLayer.disablePickingIndex(ie.pickedObjectIndex)),z=o3({pickInfo:ie,lastPickedInfo:this.lastPickedInfo,mode:h,layers:v,viewports:i,x:s,y:a,z:ge,pixelRatio:y});for(const ee of z.values())ee.layer&&X.push(ee);if(!ie.pickedColor)break}for(const ae of ne)ae.restorePickingColors();return{result:X,emptyInfo:z.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:i,x:s,y:a,width:l=1,height:u=1,mode:h="query",maxObjects:d=null,onViewportActive:p,effects:m}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([s,a],!0),A=x.x,E=x.y+x.height,C=this.device.canvasContext.cssToDevicePixels([s+l,a+u],!0),D=C.x+C.width,M=C.y,B={x:A,y:M,width:D-A,height:E-M},z=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:p,deviceRect:B,cullRect:{x:s,y:a,width:l,height:u},effects:m,pass:`picking:${h}`}),X=a3(z),ne=new Map,ae=[],ie=Number.isFinite(d);for(let ge=0;ge<X.length&&!(ie&&ae.length>=d);ge++){const ee=X[ge];let fe={color:ee.pickedColor,layer:null,index:ee.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:v};fe=Up({layer:ee.pickedLayer,info:fe,mode:h});const we=fe.layer.id;ne.has(we)||ne.set(we,new Set);const me=ne.get(we),He=fe.object??fe.index;me.has(He)||(me.add(He),ae.push(fe))}return ae}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:a,width:l=1,height:u=1,mode:h="query",maxObjects:d=null,onViewportActive:p,effects:m}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const v=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([s,a],!0),A=x.x,E=x.y+x.height,C=this.device.canvasContext.cssToDevicePixels([s+l,a+u],!0),D=C.x+C.width,M=C.y,B={x:A,y:M,width:D-A,height:E-M},z=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:p,deviceRect:B,cullRect:{x:s,y:a,width:l,height:u},effects:m,pass:`picking:${h}`}),X=a3(z),ne=new Map,ae=[],ie=Number.isFinite(d);for(let ge=0;ge<X.length&&!(ie&&ae.length>=d);ge++){const ee=X[ge];let fe={color:ee.pickedColor,layer:null,index:ee.pickedObjectIndex,picked:!0,x:s,y:a,pixelRatio:v};fe=Up({layer:ee.pickedLayer,info:fe,mode:h});const we=fe.layer.id;ne.has(we)||ne.set(we,new Set);const me=ne.get(we),He=fe.object??fe.index;me.has(He)||(me.add(He),ae.push(fe))}return ae}async _drawAndSampleAsync({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:a,cullRect:l,effects:u,pass:h},d=!1){const p=d?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:a,cullRect:l,effects:u,pass:h,pickZ:d,preRenderStats:{},isPicking:!0};for(const D of u)D.useInPicking&&(m.preRenderStats[D.id]=D.preRender(m));const{decodePickingColor:y}=this.pickLayersPass.render(m),{x:v,y:x,width:A,height:E}=a,C=new(d?Float32Array:Uint8Array)(A*E*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:v,sourceY:x,sourceWidth:A,sourceHeight:E,target:C}),{pickedColors:C,decodePickingColor:y}}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:a,cullRect:l,effects:u,pass:h},d=!1){const p=d?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:p,deviceRect:a,cullRect:l,effects:u,pass:h,pickZ:d,preRenderStats:{},isPicking:!0};for(const D of u)D.useInPicking&&(m.preRenderStats[D.id]=D.preRender(m));const{decodePickingColor:y}=this.pickLayersPass.render(m),{x:v,y:x,width:A,height:E}=a,C=new(d?Float32Array:Uint8Array)(A*E*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:v,sourceY:x,sourceWidth:A,sourceHeight:E,target:C}),{pickedColors:C,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:a}){const l=Math.max(0,e-i),u=Math.max(0,t-i),h=Math.min(s,e+i+1)-l,d=Math.min(a,t+i+1)-u;return h<=0||d<=0?null:{x:l,y:u,width:h,height:d}}}const rB={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},aB="top-left",l3="__root";class oB{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!bn(e.widgets,this.widgets,1)){const t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){const i=e.reduce((s,a)=>(s[a.id]=a,s),{});for(const s of this.getWidgets()){const{viewId:a}=s;if(a){const l=i[a];l&&(s.onViewportChange&&s.onViewportChange(l),s.onRedraw?.({viewports:[l],layers:t}))}else{if(s.onViewportChange)for(const l of e)s.onViewportChange(l);s.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){const i=Op[t.type];if(i)for(const s of this.getWidgets()){const{viewId:a}=s;(!a||a===e.viewport?.id)&&s[i]?.(e,t)}}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=t[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._removeWidget(s),this._addWidget(i)):i!==s&&(s.setProps(i.props),i=s):this._addWidget(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const s=t[i];s&&this._removeWidget(s)}this.widgets=e}_addWidget(e){const{viewId:t=null,placement:i=aB}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,i).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){const i=e||l3;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[i]=s);let a=s.querySelector(`.${t}`);return a||(a=globalThis.document.createElement("div"),a.className=t,a.style.position="absolute",a.style.zIndex="2",Object.assign(a.style,rB[t]),s.append(a)),a}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,a=i===l3||s,l=this.containers[i];a?(l.style.display="block",l.style.left=`${s?s.x:0}px`,l.style.top=`${s?s.y:0}px`,l.style.width=`${s?s.width:e}px`,l.style.height=`${s?s.height:t}px`):l.style.display="none"}}}function c3(n,e){e&&Object.entries(e).map(([t,i])=>{t.startsWith("--")?n.style.setProperty(t,i):n.style[t]=i})}function lB(n,e){e&&Object.keys(e).map(t=>{t.startsWith("--")?n.style.removeProperty(t):n.style[t]=""})}class ln{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){const t=this.props,i=this.rootElement;i&&t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),i&&!bn(t.style,e.style,1)&&(lB(i,t.style),c3(i,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(i=>typeof i=="string"&&i.length>0).forEach(i=>t.classList.add(i)),c3(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}ln.defaultProps={id:"widget",style:{},className:""};const cB={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class I2 extends ln{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,cB),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const s=i(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,i){const s=this.rootElement;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}I2.defaultProps={...ln.defaultProps};const uB="modulepreload",fB=function(n){return"/philippines-equake-locator-3d/"+n},u3={},Fp=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let d=function(p){return Promise.all(p.map(m=>Promise.resolve(m).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};var l=d;document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),h=u?.nonce||u?.getAttribute("nonce");s=d(t.map(p=>{if(p=fB(p),p in u3)return;u3[p]=!0;const m=p.endsWith(".css"),y=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${y}`))return;const v=document.createElement("link");if(v.rel=m?"stylesheet":uB,m||(v.as="script"),v.crossOrigin="",v.href=p,h&&v.setAttribute("nonce",h),document.head.appendChild(v),m)return new Promise((x,A)=>{v.addEventListener("load",x),v.addEventListener("error",()=>A(new Error(`Unable to preload CSS for ${p}`)))})}))}function a(u){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=u,window.dispatchEvent(h),!h.defaultPrevented)throw u}return s.then(u=>{for(const h of u||[])h.status==="rejected"&&a(h.reason);return e().catch(a)})};var Xr;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Xr||(Xr={}));const hB={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},dB=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),pB=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),gB=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function _B(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&mB(s),s}return this.originalGetContext(t,i)}}function mB(n){n.getExtension("EXT_color_buffer_float");const e={...hB,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:dB(n),OES_vertex_array_object:pB(n),ANGLE_instanced_arrays:gB(n)},t=n.getExtension;n.getExtension=function(s){const a=t.call(n,s);return a||(s in e?e[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(i.apply(n)||[])?.concat(Object.keys(e))}}async function N2(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,a)=>{i.onload=s,i.onerror=l=>a(new Error(`Unable to load script '${n}': ${l}`)),t.appendChild(i)})}const yB=1;let nn=null,f3=!1;const jg={debugSpectorJS:J.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function bB(n){if(!globalThis.SPECTOR)try{await N2(n.debugSpectorJSUrl||jg.debugSpectorJSUrl)}catch(e){J.warn(String(e))}}function vB(n){if(n={...jg,...n},!n.debugSpectorJS)return null;if(!nn&&globalThis.SPECTOR&&!globalThis.luma?.spector){J.probe(yB,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;nn=new e,globalThis.luma&&(globalThis.luma.spector=nn)}if(!nn)return null;if(f3||(f3=!0,nn.spyCanvases(),nn?.onCaptureStarted.add(e=>J.info("Spector capture started:",e)()),nn?.onCapture.add(e=>{J.info("Spector capture complete:",e)(),nn?.getResultUI(),nn?.resultView.display(),nn?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;nn?.startCapture(n.gl,500),e.device=t,new Promise(i=>setTimeout(i,2e3)).then(i=>{J.info("Spector capture stopped after 2 seconds")(),nn?.stopCapture()})}return nn}const TB="https://unpkg.com/webgl-debug@2.0.1/index.js";function k2(n){return n.luma=n.luma||{},n.luma}async function xB(){Zs()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await N2(TB))}function wB(n,e={}){return e.debugWebGL||e.traceWebGL?AB(n,e):SB(n)}function SB(n){const e=k2(n);return e.realContext?e.realContext:n}function AB(n,e){if(!globalThis.WebGLDebugUtils)return J.warn("webgl-debug not loaded")(),n;const t=k2(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Xr,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,EB.bind(null,e),RB.bind(null,e));for(const l in Xr)!(l in i)&&typeof Xr[l]=="number"&&(i[l]=Xr[l]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const a=Object.create(s);return t.realContext=n,t.debugContext=a,a.debug=!0,a}function h3(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function EB(n,e,t,i){i=Array.from(i).map(u=>u===void 0?"undefined":u);const s=globalThis.WebGLDebugUtils.glEnumToString(e),a=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),l=`${s} in gl.${t}(${a})`;J.error(l)();debugger}function RB(n,e,t){let i="";J.level>=1&&(i=h3(e,t),n.traceWebGL&&J.log(1,i)());for(const s of t)if(s===void 0){i=i||h3(e,t);debugger}}const Pc=1;class CB extends yI{type="webgl";constructor(){super(),Hs.defaultProps={...Hs.defaultProps,...jg}}enforceWebGL2(e){_B(e)}isSupported(){return typeof WebGL2RenderingContext<"u"}isDeviceHandle(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:(typeof WebGLRenderingContext<"u"&&e instanceof WebGLRenderingContext&&J.warn("WebGL1 is not supported",e)(),!1)}async attach(e,t={}){const{WebGLDevice:i}=await Fp(async()=>{const{WebGLDevice:a}=await Promise.resolve().then(()=>C3);return{WebGLDevice:a}},void 0);if(e instanceof i)return e;if(e?.device instanceof i)return e.device;if(!MB(e))throw new Error("Invalid WebGL2RenderingContext");const s=t.createCanvasContext===!0?{}:t.createCanvasContext;return new i({...t,_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1,...s}})}async create(e={}){const{WebGLDevice:t}=await Fp(async()=>{const{WebGLDevice:i}=await Promise.resolve().then(()=>C3);return{WebGLDevice:i}},void 0);J.groupCollapsed(Pc,"WebGLDevice created")();try{const i=[];(e.debugWebGL||e.debug)&&i.push(xB()),e.debugSpectorJS&&i.push(bB(e));const s=await Promise.allSettled(i);for(const u of s)u.status==="rejected"&&J.error(`Failed to initialize debug libraries ${u.reason}`)();const a=new t(e),l=`${a._reused?"Reusing":"Created"} device with WebGL2 ${a.props.debug?"debug ":""}context: ${a.info.vendor}, ${a.info.renderer} for canvas: ${a.canvasContext.id}`;return J.probe(Pc,l)(),J.table(Pc,a.info)(),a}finally{J.groupEnd(Pc)()}}}function MB(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const Kd=new CB,$g={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},dt=(n,e,t)=>e?n.enable(t):n.disable(t),d3=(n,e,t)=>n.hint(t,e),sn=(n,e,t)=>n.pixelStorei(t,e),p3=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},_o=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function Qd(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const OB={3042:dt,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:dt,2885:(n,e)=>n.cullFace(e),2929:dt,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:dt,35723:d3,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:p3,36010:p3,34964:_o,36662:_o,36663:_o,35053:_o,35055:_o,2886:(n,e)=>n.frontFace(e),33170:d3,2849:(n,e)=>n.lineWidth(e),32823:dt,32824:"polygonOffset",10752:"polygonOffset",35977:dt,32926:dt,32928:dt,32938:"sampleCoverage",32939:"sampleCoverage",3089:dt,3088:(n,e)=>n.scissor(...e),2960:dt,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:dt,10754:dt,12288:dt,12289:dt,12290:dt,12291:dt,12292:dt,12293:dt,12294:dt,12295:dt,3333:sn,3317:sn,37440:sn,37441:sn,37443:sn,3330:sn,3332:sn,3331:sn,3314:sn,32878:sn,3316:sn,3315:sn,32877:sn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Qd(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=Qd(e)&&e.length===3?[...e,...e]:e;const[t,i,s,a,l,u]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,a,l,u)},stencilOp:(n,e)=>{e=Qd(e)&&e.length===3?[...e,...e]:e;const[t,i,s,a,l,u]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,a,l,u)},viewport:(n,e)=>n.viewport(...e)};function rt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const IB={blendEquation:(n,e,t)=>n.blendEquationSeparate(rt(32777,e,t),rt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(rt(32969,e,t),rt(32968,e,t),rt(32971,e,t),rt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(rt(32824,e,t),rt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(rt(32938,e,t),rt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,rt(2962,e,t),rt(2967,e,t),rt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,rt(34816,e,t),rt(36003,e,t),rt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,rt(2964,e,t),rt(2965,e,t),rt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,rt(34817,e,t),rt(34818,e,t),rt(34819,e,t))},g3={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,s)=>n({32773:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,s)=>n({32969:e,32968:t,32971:i,32970:s}),clearColor:(n,e,t,i,s)=>n({3106:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,s)=>n({3107:[e,t,i,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,s)=>n({3088:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({2978:[e,t,i,s]})},zn=(n,e)=>n.isEnabled(e),_3={3042:zn,2884:zn,2929:zn,3024:zn,32823:zn,32926:zn,32928:zn,3089:zn,2960:zn,35977:zn},NB=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function ma(n,e){if(PB(e))return;const t={};for(const s in e){const a=Number(s),l=OB[s];l&&(typeof l=="string"?t[l]=!0:l(n,e[s],a))}const i=n.state&&n.state.cache;if(i)for(const s in t){const a=IB[s];a(n,e,i)}}function P2(n,e=$g){if(typeof e=="number"){const s=e,a=_3[s];return a?a(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const s of t){const a=_3[s];i[s]=a?a(n,Number(s)):n.getParameter(Number(s))}return i}function kB(n){ma(n,$g)}function PB(n){for(const e in n)return!1;return!0}function DB(n,e){if(n===e)return!0;if(m3(n)&&m3(e)&&n.length===e.length){for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}return!1}function m3(n){return Array.isArray(n)||ArrayBuffer.isView(n)}class Fs{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];ma(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t?.copyState?P2(e):Object.assign({},$g),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,UB(e);for(const i in g3){const s=g3[i];BB(e,i,s)}y3(e,"getParameter"),y3(e,"isEnabled")}_updateCache(e){let t=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const a in e){const l=e[a],u=this.cache[a];DB(l,u)||(t=!0,i=u,s&&!(a in s)&&(s[a]=u),this.cache[a]=l)}return{valueChanged:t,oldValue:i}}}function y3(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||NB.has(s))return t(s);const a=Fs.get(n);return s in a.cache||(a.cache[s]=t(s)),a.enable?a.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function BB(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...a){const l=Fs.get(n),{valueChanged:u,oldValue:h}=t(l._updateCache,...a);return u&&i(...a),h},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function UB(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const s=Fs.get(n);s.program!==i&&(e(i),s.program=i)}}function FB(n,e,t){let i="";const s={preserveDrawingBuffer:!0,...t};let a=null;if(a||=n.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!a&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,a=n.getContext("webgl2",s),a.luma||={},a.luma.softwareRenderer=!0),a||(a=n.getContext("webgl",{}),a&&(a=null,i||="Your browser only supports WebGL1")),!a)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:l,onContextRestored:u}=e;return n.addEventListener("webglcontextlost",h=>l(h),!1),n.addEventListener("webglcontextrestored",h=>u(h),!1),a.luma||={},a}function ha(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function LB(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);ha(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,a=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),u=a||t,h=l||i,d=n.getParameter(7938),p=D2(u,h),m=zB(u,h),y=VB(u,h);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:m,vendor:u,renderer:h,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function D2(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function zB(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function VB(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(D2(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function B2(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const So="WEBGL_compressed_texture_s3tc",Ao="WEBGL_compressed_texture_s3tc_srgb",Yr="EXT_texture_compression_rgtc",qr="EXT_texture_compression_bptc",HB="WEBGL_compressed_texture_etc",jB="WEBGL_compressed_texture_astc",$B="WEBGL_compressed_texture_etc1",WB="WEBGL_compressed_texture_pvrtc",XB="WEBGL_compressed_texture_atc",b3="EXT_texture_norm16",v3="EXT_render_snorm",YB="EXT_color_buffer_float",Wg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[v3],"norm16-renderable-webgl":[b3],"snorm16-renderable-webgl":[b3,v3],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[So,Ao,Yr,qr],"texture-compression-bc5-webgl":[Yr],"texture-compression-bc7-webgl":[qr],"texture-compression-etc2":[HB],"texture-compression-astc":[jB],"texture-compression-etc1-webgl":[$B],"texture-compression-pvrtc-webgl":[WB],"texture-compression-atc-webgl":[XB]};function qB(n){return n in Wg}function ZB(n,e,t){return(Wg[e]||[]).every(s=>ha(n,s,t))}const Xg={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},r16unorm:{gl:33322,rb:!0},r16snorm:{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},rg16unorm:{gl:33324},rg16snorm:{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},rgb10a2uint:{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},rgba16unorm:{gl:32859,rb:!0},rgba16snorm:{gl:36763},"rgb32float-webgl":{gl:34837,x:YB,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:So},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Ao},"bc1-rgba-unorm":{gl:33777,x:So},"bc1-rgba-unorm-srgb":{gl:35916,x:Ao},"bc2-rgba-unorm":{gl:33778,x:So},"bc2-rgba-unorm-srgb":{gl:35918,x:Ao},"bc3-rgba-unorm":{gl:33779,x:So},"bc3-rgba-unorm-srgb":{gl:35919,x:Ao},"bc4-r-unorm":{gl:36283,x:Yr},"bc4-r-snorm":{gl:36284,x:Yr},"bc5-rg-unorm":{gl:36285,x:Yr},"bc5-rg-snorm":{gl:36286,x:Yr},"bc6h-rgb-ufloat":{gl:36495,x:qr},"bc6h-rgb-float":{gl:36494,x:qr},"bc7-rgba-unorm":{gl:36492,x:qr},"bc7-rgba-unorm-srgb":{gl:36493,x:qr},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function KB(n,e,t){let i=e.create;const s=Xg[e.format];return s?.gl===void 0&&(i=!1),s?.x&&(i=i&&!!ha(n,s.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function U2(n){const e=Xg[n],t=JB(n),i=Gr.getInfo(n);return i.compressed&&(e.dataFormat=t),{internalFormat:t,format:e?.dataFormat||GB(i.channels,i.integer,i.normalized,t),type:i.dataType?B2(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function QB(n){switch(Gr.getInfo(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function GB(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function JB(n){const t=Xg[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const T3={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class eU extends _I{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,ha(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),qB(e)&&ZB(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(T3),...Object.keys(Wg)]}getWebGLFeature(e){const t=T3[e];return typeof t=="string"?!!ha(this.gl,t,this.extensions):!!t}}class tU extends gI{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderVariables(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class Io extends Fu{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const i=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const i=this.colorAttachments[t];if(i){const s=36064+t;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const t=QB(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${iU(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:i}=this.device,{texture:s}=t,a=t.props.baseMipLevel,l=t.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,s.handle,a,l);break;case 34067:const u=nU(l);i.framebufferTexture2D(36160,e,u,s.handle,a);break;case 3553:i.framebufferTexture2D(36160,e,3553,s.handle,a);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function nU(n){return n<34069?n+34069:n}function iU(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class sU extends Is{device;handle=null;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this._updateDevice()}getCurrentFramebuffer(){return this._framebuffer=this._framebuffer||new Io(this.device,{handle:null}),this._framebuffer}_updateDevice(){}}const Gd={};function rU(n="id"){Gd[n]=Gd[n]||1;const e=Gd[n]++;return`${n}-${e}`}class No extends Qe{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength=0;bytesUsed=0;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const i=typeof t=="object"?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e._setWebGLDebugMetadata(this.handle,this,{spector:{...this.props,data:typeof this.props.data}}),this.glTarget=aU(this.props.usage),this.glUsage=oU(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}_initWithData(e,t=0,i=e.byteLength+t){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,t,e),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}write(e,t=0){const i=ArrayBuffer.isView(e)?e:new Uint8Array(e),s=36663;this.gl.bindBuffer(s,this.handle),this.gl.bufferSubData(s,t,i),this.gl.bindBuffer(s,null),this._setDebugData(e,t,e.byteLength)}async mapAndWriteAsync(e,t=0,i=this.byteLength-t){const s=new ArrayBuffer(i);await e(s,"copied"),this.write(s,t)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}async mapAndReadAsync(e,t=0,i){const s=await this.readAsync(t,i);return await e(s.buffer,"copied")}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const i=new Uint8Array(t),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,s,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}}function aU(n){return n&Qe.INDEX?34963:n&Qe.VERTEX?34962:n&Qe.UNIFORM?35345:34962}function oU(n){return n&Qe.INDEX||n&Qe.VERTEX?35044:n&Qe.UNIFORM?35048:35044}function lU(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[m,y]=s;t.push({message:y.trim(),type:x3(m),lineNum:0,linePos:0});continue}const[a,l,u,...h]=s;let d=parseInt(u,10);isNaN(d)&&(d=0);let p=parseInt(l,10);isNaN(p)&&(p=0),t.push({message:h.join(":").trim(),type:x3(a),lineNum:d,linePos:p})}return t}function x3(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class cU extends Uu{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}e._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0,this.handle.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>(this._getCompilationStatus(),this.compilationStatus))}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?lU(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}J.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),J.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async s=>await new Promise(a=>setTimeout(a,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function uU(n,e,t,i){if(pU(e))return i(n);const s=n;s.pushState();try{return fU(n,e),ma(s.gl,t),i(n)}finally{s.popState()}}function fU(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Ls("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const a=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Ls("provokingVertex",e.provokingVertex,{first:36429,last:36430});a?.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const a=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Ls("polygonMode",e.polygonMode,{fill:6914,line:6913});a?.polygonModeWEBGL(1028,l),a?.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(dU("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(Lp("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&J.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,a=Lp("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,a,0,s),i.stencilFuncSeparate(1029,a,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Jd("stencilPassOperation",e.stencilPassOperation),a=Jd("stencilFailOperation",e.stencilFailOperation),l=Jd("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,a,l,s),i.stencilOpSeparate(1029,a,l,s)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=w3("blendColorOperation",e.blendColorOperation||"add"),a=w3("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,a);const l=Dc("blendColorSrcFactor",e.blendColorSrcFactor||"one"),u=Dc("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=Dc("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=Dc("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(l,u,h,d)}}function Lp(n,e){return Ls(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Jd(n,e){return Ls(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function w3(n,e){return Ls(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Dc(n,e,t="color"){return Ls(n,e,{one:1,zero:0,src:768,"one-minus-src":769,dst:774,"one-minus-dst":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,constant:t==="color"?32769:32771,"one-minus-constant":t==="color"?32770:32772,src1:768,"one-minus-src1":769,"src1-alpha":770,"one-minus-src1-alpha":771})}function hU(n,e){return`Illegal parameter ${e} for ${n}`}function Ls(n,e,t){if(!(e in t))throw new Error(hU(n,e));return t[e]}function dU(n,e){return e}function pU(n){let e=!0;for(const t in n){e=!1;break}return e}function F2(n){const e={};return n.addressModeU&&(e[10242]=ep(n.addressModeU)),n.addressModeV&&(e[10243]=ep(n.addressModeV)),n.addressModeW&&(e[32882]=ep(n.addressModeW)),n.magFilter&&(e[10240]=zp(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=gU(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=Lp("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function ep(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function zp(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function gU(n,e="none"){if(!e)return zp(n);switch(e){case"none":return zp(n);case"nearest":switch(n){case"nearest":return 9984;case"linear":return 9985}break;case"linear":switch(n){case"nearest":return 9986;case"linear":return 9987}}}class _U extends js{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=F2(t),this.handle=t.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,i]of Object.entries(e)){const s=Number(t);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}function $o(n,e,t){if(mU(e))return t(n);const{nocatch:i=!0}=e,s=Fs.get(n);s.push(),ma(n,e);let a;if(i)a=t(n),s.pop();else try{a=t(n)}finally{s.pop()}return a}function mU(n){for(const e in n)return!1;return!0}class Zr extends Bu{device;gl;handle;texture;constructor(e,t){super(e,{...bt.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}class ko extends bt{device;gl;handle;sampler=void 0;view;glTarget;glFormat;glType;glInternalFormat;compressed;_textureUnit=0;constructor(e,t){super(e,t),this.device=e,this.gl=this.device.gl;const i=U2(this.props.format);this.glTarget=yU(this.props.dimension),this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.handle=this.props.handle||this.gl.createTexture(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:this.props}),this.gl.bindTexture(this.glTarget,this.handle);const{dimension:s,width:a,height:l,depth:u,mipLevels:h,glTarget:d,glInternalFormat:p}=this;switch(s){case"2d":case"cube":this.gl.texStorage2D(d,h,p,a,l);break;case"2d-array":case"3d":this.gl.texStorage3D(d,h,p,a,l,u);break;default:throw new Error(s)}this.gl.bindTexture(this.glTarget,null),this._initializeData(t.data),this.setSampler(this.props.sampler),this.view=new Zr(this.device,{...this.props,texture:this}),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new Zr(this.device,{...e,texture:this})}setSampler(e={}){super.setSampler(e);const t=F2(this.sampler.props);this._setSamplerParameters(t)}copyImageData(e){const t=this._normalizeCopyImageDataOptions(e),i=t.data,{width:s,height:a,depth:l}=this,{mipLevel:u=0,byteOffset:h=0,x:d=0,y:p=0,z:m=0}=t,{glFormat:y,glType:v,compressed:x}=this,A=S3(this.glTarget,this.dimension,l),E=this.compressed?{}:{3314:t.bytesPerRow,32878:t.rowsPerImage};this.gl.bindTexture(A,this.handle),$o(this.gl,E,()=>{switch(this.dimension){case"2d":case"cube":x?this.gl.compressedTexSubImage2D(A,u,d,p,s,a,y,i,h):this.gl.texSubImage2D(A,u,d,p,s,a,y,v,i,h);break;case"2d-array":case"3d":x?this.gl.compressedTexSubImage3D(A,u,d,p,m,s,a,l,y,i,h):this.gl.texSubImage3D(A,u,d,p,m,s,a,l,y,v,i,h);break;default:}}),this.gl.bindTexture(A,null)}copyExternalImage(e){const t=this._normalizeCopyExternalImageOptions(e);if(t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");const{glFormat:i,glType:s}=this,{image:a,depth:l,mipLevel:u,x:h,y:d,z:p,width:m,height:y}=t,v=S3(this.glTarget,this.dimension,l),x=t.flipY?{37440:!0}:{};return this.gl.bindTexture(this.glTarget,this.handle),$o(this.gl,x,()=>{switch(this.dimension){case"2d":case"cube":this.gl.texSubImage2D(v,u,h,d,m,y,i,s,a);break;case"2d-array":case"3d":this.gl.texSubImage3D(v,u,h,d,p,m,y,l,i,s,a);break;default:}}),this.gl.bindTexture(this.glTarget,null),{width:t.width,height:t.height}}generateMipmapsWebGL(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(J.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){J.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}_setSamplerParameters(e){J.log(2,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,i]of Object.entries(e)){const s=Number(t),a=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,a);break;case 10240:case 10241:this.gl.texParameteri(this.glTarget,s,a);break;case 10242:case 10243:case 32882:this.gl.texParameteri(this.glTarget,s,a);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,a);break;case 34892:case 34893:this.gl.texParameteri(this.glTarget,s,a);break}}this.gl.bindTexture(this.glTarget,null)}_getActiveUnit(){return this.gl.getParameter(34016)-33984}_bind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}_unbind(e){const{gl:t}=this;return e!==void 0&&(this._textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}function yU(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function S3(n,e,t){return e==="cube"?34069+t:n}function bU(n){return wU[n]}function Yg(n){return xU[n]}function vU(n){return!!L2[n]}function TU(n){return L2[n]}const xU={5126:"f32",35664:"vec2<f32>",35665:"vec3<f32>",35666:"vec4<f32>",5124:"i32",35667:"vec2<i32>",35668:"vec3<i32>",35669:"vec4<i32>",5125:"u32",36294:"vec2<u32>",36295:"vec3<u32>",36296:"vec4<u32>",35670:"f32",35671:"vec2<f32>",35672:"vec3<f32>",35673:"vec4<f32>",35674:"mat2x2<f32>",35685:"mat2x3<f32>",35686:"mat2x4<f32>",35687:"mat3x2<f32>",35675:"mat3x3<f32>",35688:"mat3x4<f32>",35689:"mat4x2<f32>",35690:"mat4x3<f32>",35676:"mat4x4<f32>"},L2={35678:{viewDimension:"2d",sampleType:"float"},35680:{viewDimension:"cube",sampleType:"float"},35679:{viewDimension:"3d",sampleType:"float"},35682:{viewDimension:"3d",sampleType:"depth"},36289:{viewDimension:"2d-array",sampleType:"float"},36292:{viewDimension:"2d-array",sampleType:"depth"},36293:{viewDimension:"cube",sampleType:"float"},36298:{viewDimension:"2d",sampleType:"sint"},36299:{viewDimension:"3d",sampleType:"sint"},36300:{viewDimension:"cube",sampleType:"sint"},36303:{viewDimension:"2d-array",sampleType:"uint"},36306:{viewDimension:"2d",sampleType:"uint"},36307:{viewDimension:"3d",sampleType:"uint"},36308:{viewDimension:"cube",sampleType:"uint"},36311:{viewDimension:"2d-array",sampleType:"uint"}},wU={uint8:5121,sint8:5120,unorm8:5121,snorm8:5120,uint16:5123,sint16:5122,unorm16:5123,snorm16:5122,uint32:5125,sint32:5124,float16:5131,float32:5126};function SU(n,e){const t={attributes:[],bindings:[]};t.attributes=AU(n,e);const i=CU(n,e);for(const u of i){const h=u.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:u.name,group:0,location:u.location,visibility:(u.vertex?1:0)&(u.fragment?2:0),minBindingSize:u.byteLength,uniforms:h})}const s=RU(n,e);let a=0;for(const u of s)if(vU(u.type)){const{viewDimension:h,sampleType:d}=TU(u.type);t.bindings.push({type:"texture",name:u.name,group:0,location:a,viewDimension:h,sampleType:d}),u.textureUnit=a,a+=1}s.length&&(t.uniforms=s);const l=EU(n,e);return l?.length&&(t.varyings=l),t}function AU(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const a=n.getActiveAttrib(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:u}=a,h=n.getAttribLocation(e,l);if(h>=0){const d=Yg(u),p=/instance/i.test(l)?"instance":"vertex";t.push({name:l,location:h,stepMode:p,type:d})}}return t.sort((s,a)=>s.location-a.location),t}function EU(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let s=0;s<i;s++){const a=n.getTransformFeedbackVarying(e,s);if(!a)throw new Error("activeInfo");const{name:l,type:u,size:h}=a,d=Yg(u),{type:p,components:m}=yT(d);t.push({location:s,name:l,type:p,size:h*m})}return t.sort((s,a)=>s.location-a.location),t}function RU(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let s=0;s<i;s++){const a=n.getActiveUniform(e,s);if(!a)throw new Error("activeInfo");const{name:l,size:u,type:h}=a,{name:d,isArray:p}=MU(l);let m=n.getUniformLocation(e,d);const y={location:m,name:d,size:u,type:h,isArray:p};if(t.push(y),y.size>1)for(let v=0;v<y.size;v++){const x=`${d}[${v}]`;m=n.getUniformLocation(e,x);const A={...y,name:x,location:m};t.push(A)}}return t}function CU(n,e){const t=(a,l)=>n.getActiveUniformBlockParameter(e,a,l),i=[],s=n.getProgramParameter(e,35382);for(let a=0;a<s;a++){const l={name:n.getActiveUniformBlockName(e,a)||"",location:t(a,35391),byteLength:t(a,35392),vertex:t(a,35396),fragment:t(a,35398),uniformCount:t(a,35394),uniforms:[]},u=t(a,35395)||[],h=n.getActiveUniforms(e,u,35383),d=n.getActiveUniforms(e,u,35384),p=n.getActiveUniforms(e,u,35387),m=n.getActiveUniforms(e,u,35388);for(let y=0;y<l.uniformCount;++y){const v=n.getActiveUniform(e,u[y]);if(!v)throw new Error("activeInfo");const x=Yg(h[y]);l.uniforms.push({name:v.name,format:x,type:h[y],arrayLength:d[y],byteOffset:p[y],byteStride:m[y]})}i.push(l)}return i.sort((a,l)=>a.location-l.location),i}function MU(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function OU(n,e,t,i){const s=n;let a=i;a===!0&&(a=1),a===!1&&(a=0);const l=typeof a=="number"?[a]:a;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,l);case 35664:return n.uniform2fv(e,l);case 35665:return n.uniform3fv(e,l);case 35666:return n.uniform4fv(e,l);case 5124:return n.uniform1iv(e,l);case 35667:return n.uniform2iv(e,l);case 35668:return n.uniform3iv(e,l);case 35669:return n.uniform4iv(e,l);case 35670:return n.uniform1iv(e,l);case 35671:return n.uniform2iv(e,l);case 35672:return n.uniform3iv(e,l);case 35673:return n.uniform4iv(e,l);case 5125:return s.uniform1uiv(e,l,1);case 36294:return s.uniform2uiv(e,l,2);case 36295:return s.uniform3uiv(e,l,3);case 36296:return s.uniform4uiv(e,l,4);case 35674:return n.uniformMatrix2fv(e,!1,l);case 35675:return n.uniformMatrix3fv(e,!1,l);case 35676:return n.uniformMatrix4fv(e,!1,l);case 35685:return s.uniformMatrix2x3fv(e,!1,l);case 35686:return s.uniformMatrix2x4fv(e,!1,l);case 35687:return s.uniformMatrix3x2fv(e,!1,l);case 35688:return s.uniformMatrix3x4fv(e,!1,l);case 35689:return s.uniformMatrix4x2fv(e,!1,l);case 35690:return s.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function IU(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function NU(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const A3=4;class kU extends Ds{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};get[Symbol.toStringTag](){return"WEBGLRenderPipeline"}constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device._setWebGLDebugMetadata(this.handle,this,{spector:{id:this.props.id}}),this.vs=t.vs,this.fs=t.fs;const{varyings:i,bufferMode:s=35981}=t;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),J.time(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=SU(this.device.gl,this.handle),J.timeEnd(3,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=t.shaderLayout?PU(this.introspectedLayout,t.shaderLayout):this.introspectedLayout}destroy(){this.handle&&(this.device.gl.useProgram(null),this.device.gl.deleteProgram(this.handle),this.destroyed=!0,this.handle.destroyed=!0,this.handle=null)}setBindings(e,t){for(const[i,s]of Object.entries(e)){const a=this.shaderLayout.bindings.find(l=>l.name===i)||this.shaderLayout.bindings.find(l=>l.name===`${i}Uniforms`);if(!a){const l=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");t?.disableWarnings||J.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${l}`,s)();continue}switch(s||J.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),a.type){case"uniform":if(!(s instanceof No)&&!(s.buffer instanceof No))throw new Error("buffer value");break;case"texture":if(!(s instanceof Zr||s instanceof ko||s instanceof Io))throw new Error(`${this} Bad texture binding for ${i}`);break;case"sampler":J.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(a.type)}this.bindings[i]=s}}draw(e){const{renderPass:t,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:a,vertexCount:l,instanceCount:u,isInstanced:h=!1,firstVertex:d=0,transformFeedback:p}=e,m=IU(s),y=!!a.indexBuffer,v=a.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return J.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return J.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),a.bindBeforeRender(t),p&&p.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const x=t;return uU(this.device,i,x.glParameters,()=>{y&&h?this.device.gl.drawElementsInstanced(m,l||0,v,d,u||0):y?this.device.gl.drawElements(m,l||0,v,d):h?this.device.gl.drawArraysInstanced(m,d,l||0,u||0):this.device.gl.drawArrays(m,d,l||0),p&&p.end()}),a.unbindAfterRender(t),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),J.time(A3,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),J.timeEnd(A3,`linkProgram for ${this.id}`)(),J.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}J.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),J.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:const t=e==="link-error"?"Link error":"Validation error";switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`${this} ${t} during compilation of ${this.vs}`);case"pending":await this.vs.asyncCompilationStatus,this.vs.debugShader();break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`${this} ${t} during compilation of ${this.fs}`);case"pending":await this.fs.asyncCompilationStatus,this.fs.debugShader();break}const i=this.device.gl.getProgramInfoLog(this.handle);this.device.reportError(new Error(`${t} during ${e}: ${i}`),this)(),this.device.debug()}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation-error")):(this.linkStatus="error","link-error")}async _waitForLinkComplete(){const e=async s=>await new Promise(a=>setTimeout(a,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(J.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(const s of this.shaderLayout.bindings){const a=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!a)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:l}=s,u=e.getUniformBlockIndex(this.handle,l);if(u===4294967295)throw new Error(`Invalid uniform block name ${l}`);e.uniformBlockBinding(this.handle,i,u),a instanceof No?e.bindBufferBase(35345,i,a.handle):e.bindBufferRange(35345,i,a.buffer.handle,a.offset||0,a.size||a.buffer.byteLength-a.offset),i+=1;break;case"texture":if(!(a instanceof Zr||a instanceof ko||a instanceof Io))throw new Error("texture");let h;if(a instanceof Zr)h=a.texture;else if(a instanceof ko)h=a;else if(a instanceof Io&&a.colorAttachments[0]instanceof Zr)J.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=a.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(h.glTarget,h.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:i,type:s,textureUnit:a}=e,l=this.uniforms[t]??a;l!==void 0&&OU(this.device.gl,i,s,l)}}}function PU(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const s=t.attributes.find(a=>a.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):J.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class DU extends vg{device;handle=null;commands=[];constructor(e){super(e,{}),this.device=e}_executeCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":BU(this.device,t.options);break;case"copy-buffer-to-texture":UU(this.device,t.options);break;case"copy-texture-to-buffer":FU(this.device,t.options);break;case"copy-texture-to-texture":LU(this.device,t.options);break;default:throw new Error(t.name)}}}function BU(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function UU(n,e){throw new Error("Not implemented")}function FU(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:s="all",width:a=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:u=0,origin:h=[0,0],destinationBuffer:d,byteOffset:p=0,bytesPerRow:m,rowsPerImage:y}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||u!==0||m||y)throw new Error("not implemented");const{framebuffer:v,destroyFramebuffer:x}=z2(t);let A;try{const E=d,C=a||v.width,D=l||v.height,M=U2(v.colorAttachments[0].texture.props.format),B=M.format,z=M.type;n.gl.bindBuffer(35051,E.handle),A=n.gl.bindFramebuffer(36160,v.handle),n.gl.readPixels(h[0],h[1],C,D,B,z,p)}finally{n.gl.bindBuffer(35051,null),A!==void 0&&n.gl.bindFramebuffer(36160,A),x&&v.destroy()}}function LU(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:a=[0,0],destinationTexture:l}=e;let{width:u=e.destinationTexture.width,height:h=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:p}=z2(t),[m,y]=s,[v,x,A]=a,E=n.gl.bindFramebuffer(36160,d.handle);let C,D;if(l instanceof ko)C=l,u=Number.isFinite(u)?u:C.width,h=Number.isFinite(h)?h:C.height,C._bind(0),D=C.glTarget;else throw new Error("invalid destination");switch(D){case 3553:case 34067:n.gl.copyTexSubImage2D(D,i,v,x,m,y,u,h);break;case 35866:case 32879:n.gl.copyTexSubImage3D(D,i,v,x,A,m,y,u,h);break}C&&C._unbind(),n.gl.bindFramebuffer(36160,E),p&&d.destroy()}function z2(n){if(n instanceof bt){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}const zU=[1,2,4,8];class VU extends Rs{device;handle=null;glParameters={};constructor(e,t){super(e,t),this.device=e;let i;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:a,height:l}=t.framebuffer;i=[0,0,a,l]}else{const[a,l]=e.getDefaultCanvasContext().getDrawingBufferSize();i=[0,0,a,l]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(this.props.framebuffer&&s?.handle){const a=this.props.framebuffer.colorAttachments.map((l,u)=>36064+u);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=e.stencilReference),"colorMask"in e&&(t.colorMask=zU.map(i=>!!(i&e.colorMask))),this.glParameters=t,ma(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&$o(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){$o(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}class E3 extends bg{device;handle=null;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new DU(e)}destroy(){}finish(){return this.commandBuffer}beginRenderPass(e){return new VU(this.device,e)}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}}function HU(n){const{target:e,source:t,start:i=0,count:s=1}=n,a=t.length,l=s*a;let u=0;for(let h=i;u<a;u++)e[h++]=t[u];for(;u<l;)u<l-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+l-u),u=l);return n.target}class qg extends Tg{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return JC()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const i=t;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:a,stride:l,offset:u,normalized:h,integer:d,divisor:p}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),d?this.device.gl.vertexAttribIPointer(e,s,a,l,u):this.device.gl.vertexAttribPointer(e,s,a,h,l,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,p||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const i=B2(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const s=qg.isConstantAttributeZeroSupported(this.device)||e!==0;(t||s)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const i=jU(t),s=i.byteLength*e,a=i.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let l=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),l||=!$U(i,this.bufferValue),l){const u=WI(t.constructor,a);HU({target:u,source:i,start:0,count:a}),this.buffer.write(u),this.bufferValue=t}return this.buffer}}function jU(n){return Array.isArray(n)?new Float32Array(n):n}function $U(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class WU extends xg{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(NU(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:s,byteLength:a,byteOffset:l}=this._getBufferRange(t);if(i<0){this.unusedBuffers[e]=s,J.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:s,byteLength:a,byteOffset:l},this.bindOnUse||this._bindBuffer(i,s,l,a)}getBuffer(e){if(R3(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof No)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:i=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:s}}_getVaryingIndex(e){if(R3(e))return Number(e);for(const t of this.layout.varyings||[])if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,s,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,s){const a=t&&t.handle;!a||s===void 0?this.gl.bindBufferBase(35982,e,a):this.gl.bindBufferRange(35982,e,a,i,s)}}function R3(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class XU extends wg{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");const i=this.device.gl.createQuery();if(!i)throw new Error("WebGL query not supported");this.handle=i,Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,s)=>{const a=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(a)};requestAnimationFrame(a)}),this._pollingPromise}}function V2(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function YU(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function qU(n){return ZU[n]}const ZU={5124:"sint32",5125:"uint32",5122:"sint16",5123:"uint16",5120:"sint8",5121:"uint8",5126:"float32",5131:"float16",33635:"uint16",32819:"uint16",32820:"uint16",33640:"uint32",35899:"uint32",35902:"uint32",34042:"uint32",36269:"uint32"};function KU(n,e){const{sourceX:t=0,sourceY:i=0,sourceAttachment:s=0}=e||{};let{target:a=null,sourceWidth:l,sourceHeight:u,sourceDepth:h,sourceFormat:d,sourceType:p}=e||{};const{framebuffer:m,deleteFramebuffer:y}=H2(n),{gl:v,handle:x}=m;l||=m.width,u||=m.height;const A=m.colorAttachments[s]?.texture;if(!A)throw new Error(`Invalid framebuffer attachment ${s}`);h=A?.depth||1,d||=A?.glFormat||6408,p||=A?.glType||5121,a=JU(a,p,d,l,u);const E=gg(a);p=p||bU(E);const C=v.bindFramebuffer(36160,x);return v.readBuffer(36064+s),v.readPixels(t,i,l,u,d,p,a),v.readBuffer(36064),v.bindFramebuffer(36160,C||null),y&&m.destroy(),a}function QU(n,e){const{target:t,sourceX:i=0,sourceY:s=0,sourceFormat:a=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:u,sourceHeight:h,sourceType:d}=e||{};const{framebuffer:p,deleteFramebuffer:m}=H2(n);u=u||p.width,h=h||p.height;const y=p;d=d||5121;let v=t;if(!v){const A=V2(a),E=YU(d),C=l+u*h*A*E;v=y.device.createBuffer({byteLength:C})}const x=n.device.createCommandEncoder();return x.copyTextureToBuffer({sourceTexture:n,width:u,height:h,origin:[i,s],destinationBuffer:v,byteOffset:l}),x.destroy(),m&&p.destroy(),v}function H2(n){return n instanceof Fu?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:GU(n),deleteFramebuffer:!0}}function GU(n,e){const{device:t,width:i,height:s,id:a}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${a}`,width:i,height:s,colorAttachments:[n]})}function JU(n,e,t,i,s,a){if(n)return n;e||=5121;const l=qU(e),u=_g(l),h=V2(t);return new u(i*s*h)}class Vp extends Hs{type="webgl";handle;features;limits;info;canvasContext;preferredColorFormat="rgba8unorm";preferredDepthFormat="depth24plus";commandEncoder;lost;_resolveContextLost;gl;_constants;_extensions={};_polyfilled=!1;spectorJS;get[Symbol.toStringTag](){return"WebGLDevice"}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}isVertexFormatSupported(e){switch(e){case"unorm8x4-bgra":return!1;default:return!0}}constructor(e){super({...e,id:e.id||rU("webgl-device")});const t=Hs._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=t.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new sU(this,t),this.lost=new Promise(p=>{this._resolveContextLost=p});const s={...e.webgl};t.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),e.powerPreference!==void 0&&(s.powerPreference=e.powerPreference);const l=this.props._handle||FB(this.canvasContext.canvas,{onContextLost:p=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:p=>console.log("WebGL context restored")},s);if(!l)throw new Error("WebGL context creation failed");if(i=l.device,i){if(e._reuseDevices)return J.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=l,this.gl=l,this.spectorJS=vB({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=LB(this.gl,this._extensions),this.limits=new tU(this.gl),this.features=new eU(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),new Fs(this.gl,{log:(...p)=>J.log(1,...p)()}).trackState(this.gl,{copyState:!1});const h=e.debugWebGL||e.debug,d=e.debugWebGL;h&&(this.gl=wB(this.gl,{debugWebGL:h,traceWebGL:d}),J.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(J.level=Math.max(J.level,1))),this.commandEncoder=new E3(this,{id:`${this}-command-encoder`})}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}getTextureByteAlignment(){return 4}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new No(this,t)}createTexture(e){return new ko(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new _U(this,e)}createShader(e){return new cU(this,e)}createFramebuffer(e){return new Io(this,e)}createVertexArray(e){return new qg(this,e)}createTransformFeedback(e){return new WU(this,e)}createQuerySet(e){return new XU(this,e)}createRenderPipeline(e){return new kU(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}createCommandEncoder(e={}){return new E3(this,e)}submit(e){e||(e=this.commandEncoder.finish(),this.commandEncoder.destroy(),this.commandEncoder=this.createCommandEncoder({id:`${this.id}-default-encoder`})),e._executeCommands()}readPixelsToArrayWebGL(e,t){return KU(e,t)}readPixelsToBufferWebGL(e,t){return QU(e,t)}setParametersWebGL(e){ma(this.gl,e)}getParametersWebGL(e){return P2(this.gl,e)}withParametersWebGL(e,t){return $o(this.gl,e,t)}resetWebGL(){J.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),kB(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return KB(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Fs.get(this.gl).push()}popState(){Fs.get(this.gl).pop()}getGLKey(e,t){const i=Number(e);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[s,a])=>(i[`${s}:${this.getGLKey(s,t)}`]=`${a}:${this.getGLKey(a,t)}`,i),{})}setConstantAttributeWebGL(e,t){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[e];switch(s&&i8(s,t)&&J.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:e8(this,e,t);break;case Int32Array:t8(this,e,t);break;case Uint32Array:n8(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return ha(this.gl,e,this._extensions),this._extensions}_setWebGLDebugMetadata(e,t,i){e.luma=t;const s={props:i.spector,id:i.spector.id};e.__SPECTOR_Metadata=s}}function e8(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function t8(n,e,t){n.gl.vertexAttribI4iv(e,t)}function n8(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function i8(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const C3=Object.freeze(Object.defineProperty({__proto__:null,WebGLDevice:Vp},Symbol.toStringTag,{value:"Module"}));function Zi(){}const s8=({isDragging:n})=>n?"grabbing":"grab",j2={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Zi,onWebGLInitialized:Zi,onResize:Zi,onViewStateChange:Zi,onInteractionStateChange:Zi,onBeforeRender:Zi,onAfterRender:Zi,onLoad:Zi,onError:n=>Ye.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:s8,getTooltip:null,debug:!1,drawPickingColors:!1};class Zg{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ku({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const a=i.offsetCenter;if(!a)return;s.x=a.x,s.y=a.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=Op[i.type],a=i.offsetCenter;if(!s||!a||!this.layerManager)return;const l=this.layerManager.getLayers(),u=this.deckPicker.getLastPickedObject({x:a.x,y:a.y,layers:l,viewports:this.getViewports(a)},this._lastPointerDownInfo),{layer:h}=u,d=h&&(h[s]||h.props[s]),p=this.props[s];let m=!1;d&&(m=d.call(h,u,i)),m||(p?.(u,i),this.widgetManager.onEvent(u,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const s=i.offsetCenter,a=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=a.result[0]||a.emptyInfo},this.props={...j2,...e},e=this.props,e.viewState&&e.initialViewState&&Ye.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Ye.error("WebGL1 context not supported.")(),t=Kd.attach(e.gl,this.props.deviceProps)),t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&jo.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Ye.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Ye.removed("onLayerClick","onClick")(),e.initialViewState&&!bn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);if(Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),Ye.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),e.useDevicePixels!==void 0&&this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){this.device.canvasContext.props.useDevicePixels=e.useDevicePixels;const i=this.device.canvasContext.canvas,s={target:i,contentBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}],devicePixelContentBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}],borderBoxSize:[{inlineSize:i.clientWidth,blockSize:i.clientHeight}]};this.device.canvasContext._handleResize([s])}this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),a=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||i||s||a||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Nt(this.viewManager),this.viewManager.views}getViewports(e){return Nt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){Nt(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const a=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),a}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Nt(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",e.width&&typeof e.width=="number"&&(t.width=e.width),e.height&&typeof e.height=="number"&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:s}=t;return new Lg({device:e,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:s})}_createDevice(e){const t=this.props.deviceProps?.createCanvasContext,i=typeof t=="object"?t:void 0,s={adapters:[],...e.deviceProps};s.adapters.includes(Kd)||s.adapters.push(Kd);const a={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0};return bp.createDevice({_reuseDevices:!0,type:"webgl",...s,createCanvasContext:{...a,...i,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new O2({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let s=i,a=!1;for(const l of t)s=l,a=l.layer?.onHover(l,e.event)||a;a||(this.props.onHover?.(s,e.event),this.widgetManager.onHover(s,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new w2;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new BP(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Hv).map(s=>{const[a,l,u,h]=Hv[s],d=this.props.eventRecognizerOptions?.[s],p={...l,...d,event:s};return{recognizer:new a(p),recognizeWith:u,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in Op)this.eventManager.on(s,this._onEvent);this.viewManager=new U6({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new B6(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new G6({deck:this,device:this.device}),this.deckRenderer=new tB(this.device),this.deckPicker=new sB(this.device),this.widgetManager=new oB({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new I2),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const a={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(a),a.pass==="screen"&&this.widgetManager.onRedraw({viewports:a.viewports,layers:a.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Ye.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=bp.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}Zg.defaultProps=j2;Zg.VERSION=v4;function r8(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return _g(n)}}const a8=gg;function Bc(n,e,t){const i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function Ns(n){return n.stride||n.size*n.bytesPerElement}function o8(n,e){return n.type===e.type&&n.size===e.size&&Ns(n)===Ns(e)&&(n.offset||0)===(e.offset||0)}function Hp(n,e){e.offset&&Ye.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Ns(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,a=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:a,stride:t}}function l8(n,e){const t=Hp(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class c8{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,a=s==="float64";let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let u;a?u="float32":!s&&t.isIndexed?u="uint32":u=s||"float32";let h=r8(s||u);this.doublePrecision=a,a&&t.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...t,defaultType:h,defaultValue:l,logicalType:s,type:u,normalized:u.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Ns(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),jo.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const s=this.value;if(t){const a=Hp(this.getAccessor(),t),l=a.offset/s.BYTES_PER_ELEMENT,u=a.size||this.size;i[e]=s.subarray(l,l+u)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),s=[],a={name:this.id,byteStride:Ns(i),attributes:s};if(this.doublePrecision){const l=l8(i,t||{});s.push(Bc(e,{...i,...l.high},this.device.type),Bc(`${e}64Low`,{...i,...l.low},this.device.type))}else if(t){const l=Hp(i,t);s.push(Bc(e,{...i,...l},this.device.type))}else s.push(Bc(e,i,this.device.type));return a}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:s}=this,a=i*s;if(t&&a&&t.length>=a){const l=new Array(s).fill(1/0),u=new Array(s).fill(-1/0);for(let h=0;h<a;)for(let d=0;d<s;d++){const p=t[h++];p<l[d]&&(l[d]=p),p>u[d]&&(u[d]=p)}e=[l,u]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof Qe?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const l=a8(i.value);s.type=s.normalized?l.replace("int","norm"):l}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=Ns(s)}if(t.bounds=null,i.constant){let a=i.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!t.constant||!this._areValuesEqual(a,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(i.buffer){const a=i.buffer;t.externalBuffer=a,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let a=i.value;t.externalBuffer=null,t.constant=!1,this.value=a;let{buffer:l}=this;const u=Ns(s),h=(s.vertexOffset||0)*u;if(this.doublePrecision&&a instanceof Float64Array&&(a=$d(a,s)),this.settings.isIndexed){const p=this.settings.defaultType;a.constructor!==p&&(a=new p(a))}const d=a.byteLength+h+u*2;(!l||l.byteLength<d)&&(l=this._createBuffer(d)),l.write(a,h)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?$d(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,s=i.allocatedValue,a=jo.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=a;const{byteOffset:l}=this;let{buffer:u}=this;return(!u||u.byteLength<a.byteLength+l)&&(u=this._createBuffer(a.byteLength+l),t&&s&&u.write(s instanceof Float64Array?$d(s,this):s,l)),i.allocatedValue=a,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&Ye.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:s,size:a}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let l=a;for(;--l>=0;)t[i+l]=s[l];return t}switch(a){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let l=a;for(;--l>=0;)t[i+l]=Number.isFinite(e[l])?e[l]:s[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?Qe.INDEX:Qe.VERTEX)|Qe.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const M3=[],O3=[];function u8(n,e=0,t=1/0){let i=M3;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(O3.length=n.length,i=O3):i=M3,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function $2(n){return n&&n[Symbol.asyncIterator]}function f8(n,e){const{size:t,stride:i,offset:s,startIndices:a,nested:l}=e,u=n.BYTES_PER_ELEMENT,h=i?i/u:t,d=s?s/u:0,p=Math.floor((n.length-d)/h);return(m,{index:y,target:v})=>{if(!a){const C=y*h+d;for(let D=0;D<t;D++)v[D]=n[C+D];return v}const x=a[y],A=a[y+1]||p;let E;if(l){E=new Array(A-x);for(let C=x;C<A;C++){const D=C*h+d;v=new Array(t);for(let M=0;M<t;M++)v[M]=n[D+M];E[C-x]=v}}else if(h===t)E=n.subarray(x*t+d,A*t+d);else{E=new n.constructor((A-x)*t);let C=0;for(let D=x;D<A;D++){const M=D*h+d;for(let B=0;B<t;B++)E[C++]=n[M+B]}}return E}}const h8=[],Zc=[[0,1/0]];function d8(n,e){if(n===Zc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let s=0;for(let a=0;a<i;a++){const l=n[a];l[1]<e[0]?(t.push(l),s=a+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(s,0,e),t}const p8={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function W2(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...p8[t],...e,...n,type:t}}class X2 extends c8{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Zc}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!o8(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(a=>e[a])]:e[t];return W2(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=d8(this.state.updateRanges,[i,s])}else this.state.updateRanges=Zc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=h8}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==Zc),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:a},settings:{update:l,noAlloc:u}}=this;let h=!0;if(l){for(const[d,p]of a)l.call(s,this,{data:t,startRow:d,endRow:p,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,p]of a){const m=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(p)?this.getVertexOffset(p):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:y})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e,t){const i=this.device.type==="webgpu";if(i||t===void 0||typeof t=="function"){if(i&&typeof t!="function"){const l=this._normalizeValue(t,[],0);this._areValuesEqual(l,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}const s=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:s})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;Nt(ArrayBuffer.isView(l.value),`invalid ${s.accessor}`);const u=!!l.size&&l.size!==this.size;return i.binaryAccessor=f8(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!t)return i;for(const a in t){const l=super._getBufferLayout(a,t[a]);i.attributes.push(...l.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:a,numInstances:l}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:u,state:h,value:d,size:p,startIndices:m}=e,{accessor:y,transform:v}=u;let x=h.binaryAccessor||(typeof y=="function"?y:a[y]);typeof x!="function"&&typeof y=="string"&&(x=()=>a[y]),Nt(typeof x=="function",`accessor "${y}" is not a function`);let A=e.getVertexOffset(i);const{iterable:E,objectInfo:C}=u8(t,i,s);for(const D of E){C.index++;let M=x(D,C);if(v&&(M=v.call(this,M)),m){const B=(C.index<m.length-1?m[C.index+1]:l)-m[C.index];if(M&&Array.isArray(M[0])){let z=A;for(const X of M)e._normalizeValue(X,d,z),z+=p}else M&&M.length>p?d.set(M,A):(e._normalizeValue(M,C.target,0),I6({target:d,source:C.target,start:A,count:B}));A+=B*p}else e._normalizeValue(M,d,A),A+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function tp(n){const{source:e,target:t,start:i=0,size:s,getData:a}=n,l=n.end||t.length,u=e.length,h=l-i;if(u>h){t.set(e.subarray(0,h),i);return}if(t.set(e,i),!a)return;let d=u;for(;d<h;){const p=a(d,e);for(let m=0;m<s;m++)t[i+d]=p[m]||0,d++}}function g8({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:a}){if(!s||!a)return tp({source:n,target:e,size:t,getData:i}),e;let l=0,u=0;const h=i&&((p,m)=>i(p+u,m)),d=Math.min(s.length,a.length);for(let p=1;p<d;p++){const m=s[p]*t,y=a[p]*t;tp({source:n.subarray(l,m),target:e,start:u,end:y,size:t,getData:h}),l=m,u=y}return u<e.length&&tp({source:[],target:e,start:u,size:t,getData:h}),e}function _8(n){const{device:e,settings:t,value:i}=n,s=new X2(e,t);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function Y2(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function q2(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Z2(n){n.push(n.shift())}function m8(n,e){const{doublePrecision:t,settings:i,value:s,size:a}=n,l=t&&s instanceof Float64Array?2:1;let u=0;const{shaderAttributes:h}=n.settings;if(h)for(const d of Object.values(h))u=Math.max(u,d.vertexOffset??0);return(i.noAlloc?s.length:(e+u)*a)*l}function K2({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function Q2({device:n,buffer:e,attribute:t,fromLength:i,toLength:s,fromStartIndices:a,getData:l=u=>u}){const u=t.doublePrecision&&t.value instanceof Float64Array?2:1,h=t.size*u,d=t.byteOffset,p=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,m=t.startIndices,y=a&&m,v=t.isConstant;if(!y&&e&&i>=s)return e;const x=t.value instanceof Float64Array?Float32Array:t.value.constructor,A=v?t.value:new x(t.getBuffer().readSyncWebGL(d,s*x.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!v){const M=l;l=(B,z)=>t.normalizeConstant(M(B,z))}const E=v?(M,B)=>l(A,B):(M,B)=>l(A.subarray(M+d,M+d+h),B),C=e?new Float32Array(e.readSyncWebGL(p,i*4).buffer):new Float32Array(0),D=new Float32Array(s);return g8({source:C,target:D,sourceStartIndices:a,targetStartIndices:m,size:h,getData:E}),(!e||e.byteLength<D.byteLength+p)&&(e?.destroy(),e=n.createBuffer({byteLength:D.byteLength+p,usage:35050})),e.write(D,p),e}class G2{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new zu(i),this.attribute=t,this.attributeInTransition=_8(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=m8(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class y8 extends G2{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=x8(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:a,attribute:l}=this;Z2(a),a[0]=Q2({device:this.device,buffer:a[0],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),a[1]=K2({device:this.device,source:a[0],target:a[1]}),this.setBuffer(a[1]);const{transform:u}=this,h=u.model;let d=Math.floor(this.currentLength/l.size);J2(l)&&(d/=2),h.setVertexCount(d),l.isConstant?(h.setAttributes({aFrom:a[0]}),h.setConstantAttributes({aTo:l.value})):h.setAttributes({aFrom:a[0],aTo:l.getBuffer()}),u.transformFeedback.setBuffers({vCurrent:a[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let s=i/e;t&&(s=t(s));const{model:a}=this.transform,l={time:s};a.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const b8=`uniform interpolationUniforms {
  float time;
} interpolation;
`,I3={name:"interpolation",vs:b8,uniformTypes:{time:"f32"}},v8=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,T8=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function J2(n){return n.doublePrecision&&n.value instanceof Float64Array}function x8(n,e){const t=e.size,i=Y2(t),s=q2(t),a=e.getBufferLayout();return J2(e)?new ua(n,{vs:T8,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[kk,I3],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new ua(n,{vs:v8,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:a.attributes[0].format}],modules:[I3],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class w8 extends G2{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=M8(e),this.framebuffer=O8(e,this.texture),this.transform=C8(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:a,attribute:l}=this;for(let h=0;h<2;h++)a[h]=Q2({device:this.device,buffer:a[h],attribute:l,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});a[2]=K2({device:this.device,source:a[0],target:a[2]}),this.setBuffer(a[1]);const{model:u}=this.transform;u.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?u.setConstantAttributes({aTo:l.value}):u.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:s}=this,a=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:a.stiffness,damping:a.damping};t.model.shaderInputs.setProps({spring:l}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Z2(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const S8=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,A8={name:"spring",vs:S8,uniformTypes:{damping:"f32",stiffness:"f32"}},E8=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,R8=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function C8(n,e){const t=Y2(e.size),i=q2(e.size);return new ua(n,{vs:E8,fs:R8,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[A8],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function M8(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1})}function O8(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const I8={interpolation:y8,spring:w8};class N8{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const s in e){const a=e[s],l=a.getTransitionSetting(t);l&&this._updateAttribute(s,a,l)}for(const s in this.transitions){const a=e[s];(!a||!a.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const s=this.transitions[e];let a=!s||s.type!==i.type;if(a){s&&this._removeTransition(e);const l=I8[i.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,device:this.device}):(Ye.error(`unsupported transition type '${i.type}'`)(),a=!1)}(a||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const N3="attributeManager.invalidate",k8="attributeManager.updateStart",P8="attributeManager.updateEnd",D8="attribute.updateStart",B8="attribute.allocate",U8="attribute.updateEnd";class F8{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=Qo(KD),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new N8(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);Bt(N3,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);Bt(N3,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:a={},buffers:l={},context:u={}}){let h=!1;Bt(k8,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const p=this.attributes[d],m=p.settings.accessor;p.startIndices=i,p.numInstances=t,a[d]&&Ye.removed(`props.${d}`,`data.attributes.${d}`)(),p.setExternalBuffer(l[d])||p.setBinaryValue(typeof m=="string"?l[m]:void 0,e.startIndices)||typeof m=="string"&&!l[m]&&p.setConstantValue(u,a[m])||p.needsUpdate()&&(h=!0,this._updateAttribute({attribute:p,numInstances:t,data:e,props:a,context:u})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}h&&Bt(P8,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const a in t){const l=t[a];l.needsRedraw(e)&&!i.hasAttribute(a)&&(s[a]=l)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const s=e[i],a={...s,id:i,size:s.isIndexed&&1||s.size||1,...t};this.attributes[i]=new X2(this.device,a)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:s}=this,a=s[e];return a&&a.forEach(l=>{const u=i[l];u&&u.setNeedsUpdate(u.id,t)}),a}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if(Bt(D8,t),t.constant){t.setConstantValue(e.context,t.value);return}t.allocate(i)&&Bt(B8,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,Bt(U8,t,i))}}class L8 extends zu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:a}}=this,l=a(e/s);this._value=zo(t,i,l)}}const k3=1e-5;function P3(n,e,t,i,s){const a=e-n,u=(t-e)*s,h=-a*i;return u+h+a+e}function z8(n,e,t,i,s){if(Array.isArray(t)){const a=[];for(let l=0;l<t.length;l++)a[l]=P3(n[l],e[l],t[l],i,s);return a}return P3(n,e,t,i,s)}function D3(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class V8 extends zu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:a=e,_currValue:l=e}=this;let u=z8(a,l,t,i,s);const h=D3(u,t),d=D3(u,l);h<k3&&d<k3&&(u=t,this.end()),this._prevValue=l,this._currValue=u}}const H8={interpolation:L8,spring:V8};class j8{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){const{transitions:a}=this;if(a.has(e)){const h=a.get(e),{value:d=h.settings.fromValue}=h;t=d,this.remove(e)}if(s=W2(s),!s)return;const l=H8[s.type];if(!l){Ye.error(`unsupported transition type '${s.type}'`)();return}const u=new l(this.timeline);u.start({...s,fromValue:t,toValue:i}),a.set(e,u)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function $8(n){const e=n[Us];for(const t in e){const i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function W8(n,e){const t=ex({newProps:n,oldProps:e,propTypes:n[Us],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=Y8(n,e);let s=!1;return i||(s=q8(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:Z8(n,e),transitionsChanged:X8(n,e)}}function X8(n,e){if(!n.transitions)return!1;const t={},i=n[Us];let s=!1;for(const a in n.transitions){const l=i[a],u=l&&l.type;(u==="number"||u==="color"||u==="array")&&jp(n[a],e[a],l)&&(t[a]=!0,s=!0)}return s?t:!1}function ex({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const a of Object.keys(n))if(!(a in t)){if(!(a in e))return`${s}.${a} added`;const l=jp(n[a],e[a],i[a]);if(l)return`${s}.${a} ${l}`}for(const a of Object.keys(e))if(!(a in t)){if(!(a in n))return`${s}.${a} dropped`;if(!Object.hasOwnProperty.call(n,a)){const l=jp(n[a],e[a],i[a]);if(l)return`${s}.${a} ${l}`}}return!1}function jp(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function Y8(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function q8(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&B3(n,e,"all"))return{all:!0};const t={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&B3(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function Z8(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function B3(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},ex({oldProps:s,newProps:i,triggerName:t})}const K8="count(): argument not an object",Q8="count(): argument not a container";function G8(n){if(!eF(n))throw new Error(K8);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(J8(n))return Object.keys(n).length;throw new Error(Q8)}function J8(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function eF(n){return n!==null&&typeof n=="object"}function U3(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}const tF={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},$p={};function nF(n,e,t,i){if(t instanceof bt)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const{width:a,height:l}=t.data,u=e.createTexture({...t,sampler:{...tF,...s,...i},mipLevels:e.getMipLevelCount(a,l)});return u.generateMipmapsWebGL(),$p[u.id]=n,u}function iF(n,e){!e||!(e instanceof bt)||$p[e.id]===n&&(e.delete(),delete $p[e.id])}const sF={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||Wp(n)&&(n.length===3||n.length===4)},equal(n,e,t){return bn(n,e,1)}},accessor:{validate(n,e){const t=Eu(n);return t==="function"||t===Eu(e.value)},equal(n,e,t){return typeof e=="function"?!0:bn(n,e,1)}},array:{validate(n,e){return e.optional&&!n||Wp(n)},equal(n,e,t){const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?bn(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?bn(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:nF(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{iF(t.id,n)}}};function rF(n){const e={},t={},i={};for(const[s,a]of Object.entries(n)){const l=a?.deprecatedFor;if(l)i[s]=Array.isArray(l)?l:[l];else{const u=aF(s,a);e[s]=u,t[s]=u.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function aF(n,e){switch(Eu(e)){case"object":return mo(n,e);case"array":return mo(n,{type:"array",value:e,compare:!1});case"boolean":return mo(n,{type:"boolean",value:e});case"number":return mo(n,{type:"number",value:e});case"function":return mo(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function mo(n,e){return"type"in e?{name:n,...sF[e.type],...e}:"value"in e?{name:n,type:Eu(e.value),...e}:{name:n,type:"object",value:e}}function Wp(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Eu(n){return Wp(n)?"array":n===null?"null":typeof n}function oF(n,e){let t;for(let a=e.length-1;a>=0;a--){const l=e[a];"extensions"in l&&(t=l.extensions)}const i=Xp(n.constructor,t),s=Object.create(i);s[Au]=n,s[qs]={},s[ts]={};for(let a=0;a<e.length;++a){const l=e[a];for(const u in l)s[u]=l[u]}return Object.freeze(s),s}const lF="_mergedDefaultProps";function Xp(n,e){if(!(n instanceof Vu.constructor))return{};let t=lF;if(e)for(const s of e){const a=s.constructor;a&&(t+=`:${a.extensionName||a.name}`)}const i=tx(n,t);return i||(n[t]=cF(n,e||[]))}function cF(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=Xp(i),a=tx(n,"defaultProps")||{},l=rF(a),u=Object.assign(Object.create(null),s,l.defaultProps),h=Object.assign(Object.create(null),s?.[Us],l.propTypes),d=Object.assign(Object.create(null),s?.[Zd],l.deprecatedProps);for(const p of e){const m=Xp(p.constructor);m&&(Object.assign(u,m),Object.assign(h,m[Us]),Object.assign(d,m[Zd]))}return uF(u,n),hF(u,h),fF(u,d),u[Us]=h,u[Zd]=d,e.length===0&&!Kg(n,"_propTypes")&&(n._propTypes=h),u}function uF(n,e){const t=pF(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function fF(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const s=`${this.id}: ${t}`;for(const a of e[t])Kg(this,a)||(this[a]=i);Ye.deprecated(s,e[t].join("/"))()}})}function hF(n,e){const t={},i={};for(const s in e){const a=e[s],{name:l,value:u}=a;a.async&&(t[l]=u,i[l]=dF(l))}n[ea]=t,n[qs]={},Object.defineProperties(n,i)}function dF(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||$2(e)?this[qs][n]=e:this[ts][n]=e},get(){if(this[ts]){if(n in this[ts])return this[ts][n]||this[ea][n];if(n in this[qs]){const e=this[Au]&&this[Au].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[ea][n]}}return this[ea][n]}}}function Kg(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function tx(n,e){return Kg(n,e)&&n[e]}function pF(n){const e=n.componentName;return e||Ye.warn(`${n.name}.componentName not specified`)(),e||n.name}let gF=0;class Vu{constructor(...e){this.props=oF(this,e),this.id=this.props.id,this.count=gF++}clone(e){const{props:t}=this,i={};for(const s in t[ea])s in t[ts]?i[s]=t[ts][s]:s in t[qs]&&(i[s]=t[qs][s]);return new this.constructor({...t,...i,...e})}}Vu.componentName="Component";Vu.defaultProps={};const _F=Object.freeze({});class mF{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||_F}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Au]||this.component;const t=e[ts]||{},i=e[qs]||e,s=e[ea]||{};for(const a in t){const l=t[a];this._createAsyncPropData(a,s[a]),this._updateAsyncProp(a,l),t[a]=this.getAsyncProp(a)}for(const a in i){const l=i[a];this._createAsyncPropData(a,s[a]),this._updateAsyncProp(a,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if($2(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;t.then(a=>{this.component&&(a=this._postProcessValue(i,a),this._setAsyncPropValue(e,a,s),this._onResolve(e,a))}).catch(a=>{this._onError(e,a)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let a=[],l=0;for await(const u of t){if(!this.component)return;const{dataTransform:h}=this.component.props;h?a=h(u,a):a=a.concat(u),Object.defineProperty(a,"__diff",{enumerable:!1,value:[{startRow:l,endRow:a.length}]}),l=a.length,this._setAsyncPropValue(e,a,s)}this._onResolve(e,a)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[Us];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class yF extends mF{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,s=i?.props.fetch;return s?s(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const bF="layer.changeFlag",vF="layer.initialize",TF="layer.update",xF="layer.finalize",wF="layer.matched",F3=2**24-1,SF=Object.freeze([]),AF=Qo(({oldViewport:n,viewport:e})=>n.equals(e));let Rn=new Uint8ClampedArray(0);const EF={data:{type:"data",value:SF,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:a})=>{const{resourceManager:l}=t.context;s=s||t.getLoadOptions(),i=i||t.props.loaders,a&&(s={...s,fetch:{...s?.fetch,signal:a}});let u=l.contains(n);return!u&&!s&&(l.add({resourceId:n,data:dp(n,i),persistent:!1}),u=!0),u?l.subscribe({resourceId:n,onChange:h=>t.internalState?.reloadAsyncProp(e,h),consumerId:t.id,requestId:e}):dp(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ue.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Jo extends Vu{constructor(){super(...arguments),this.internalState=null,this.lifecycle=jr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Nt(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=x2(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,a,l]=p2(i,t.pixelProjectionMatrix);return e.length===2?[s,a]:[s,a,l]}unproject(e){return Nt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Nt(this.internalState);const i=this.internalState.viewport||this.context.viewport;return n6(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ue.DEFAULT||e===Ue.LNGLAT||e===Ue.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Nt(e instanceof Uint8Array);const[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:G8(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=U3(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=U3(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const s of i)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,a=this.internalState.hasPickingBuffer,l=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(u=>u.getNeedsPickingBuffer.call(this,u));if(a!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:u,instancePickingColors:h}=t.attributes,d=u||h;d&&(l&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!l&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!AF({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const a=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(a)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(Rn.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>F3&&Ye.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Rn=jo.allocate(Rn,t,{size:4,copy:!0,maxCount:Math.max(t,F3)});const s=Math.floor(Rn.length/4),a=[0,0,0];for(let l=i;l<s;l++)this.encodePickingColor(l,a),Rn[l*4+0]=a[0],Rn[l*4+1]=a[1],Rn[l*4+2]=a[2],Rn[l*4+3]=0}e.value=Rn.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),t=u.getAttributes()}const s=e.userData?.excludeAttributes||{},a={},l={};for(const u in t){if(s[u])continue;const h=t[u].getValue();for(const d in h){const p=h[d];p instanceof Qe?t[u].settings.isIndexed?e.setIndexBuffer(p):a[d]=p:p&&(l[d]=p)}}e.setAttributes(a),e.setConstantAttributes(l)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,a=i||s,l=a&&t.attributes&&t.attributes[a.id];if(l&&l.value){const u=l.value,h=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const p=a.getVertexOffset(d);u[p]===h[0]&&u[p+1]===h[1]&&u[p+2]===h[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;const a=s.getVertexOffset(e),l=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(l-a),a)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Rn.buffer&&(i.value=Rn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Nt(!this.internalState),Nt(Number.isFinite(this.props.coordinateSystem)),Bt(vF,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new yF({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Ye.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new j8(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Bt(wF,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Bt(TF,this,e),!e)return;const t=this.props,i=this.context,s=this.internalState,a=i.viewport,l=this._updateUniformTransition();s.propsInTransition=l,i.viewport=s.viewport||a,this.props=l;try{const u=this._getUpdateParams(),h=this.getModels();if(i.device)this.updateState(u);else try{this.updateState(u)}catch{}for(const p of this.props.extensions)p.updateState.call(this,u,p);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==h[0];this._postUpdate(u,d)}finally{i.viewport=a,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Bt(xF,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const a=this.props,l=this.context;this.props=this.internalState.propsInTransition||a;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:u}=this.props,h=u&&u(i)||[0,0];l.device instanceof Vp&&l.device.setParametersWebGL({polygonOffset:h});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...s}):d.setParameters(s);if(l.device instanceof Vp)l.device.withParametersWebGL(s,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:l};for(const p of this.props.extensions)p.draw.call(this,d,p);this.draw(d)}}finally{this.props=a}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let a=!1;switch(s){case"dataChanged":const l=e[s],u=t[s];l&&Array.isArray(u)&&(t.dataChanged=Array.isArray(l)?u.concat(l):l,a=!0);default:t[s]||(t[s]=e[s],a=!0)}a&&Bt(bF,this,s,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=W8(e,t);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],e.transitions?.[s]);return this.setChangeFlags(i)}validateProps(){$8(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new F8(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:s}=e,a=this.state.model;a?.isInstanced&&a.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:u,highlightColor:h}=i;if(t||s.autoHighlight!==l||s.highlightedObjectIndex!==u||s.highlightColor!==h){const d={};Array.isArray(h)&&(d.highlightColor=h),(t||s.autoHighlight!==l||u!==s.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(t=t||s,t)for(const a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Jo.defaultProps=EF;Jo.layerName="Layer";const Uc=Math.PI/180,L3=180/Math.PI,Kc=6370972,Kr=256;function RF(){const n=Kr/Kc,e=Math.PI/180*Kr;return{unitsPerMeter:[n,n,n],unitsPerMeter2:[0,0,0],metersPerUnit:[1/n,1/n,1/n],unitsPerDegree:[e,e,n],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/n]}}class CF extends _a{constructor(e={}){const{longitude:t=0,zoom:i=0,nearZMultiplier:s=.5,farZMultiplier:a=1,resolution:l=10}=e;let{latitude:u=0,height:h,altitude:d=1.5,fovy:p}=e;u=Math.max(Math.min(u,Wr),-Wr),h=h||1,p?d=Bg(p):p=Ho(d);const m=1/Math.PI/Math.cos(u*Math.PI/180),y=Math.pow(2,i)*m,v=e.nearZ??s,x=e.farZ??(d+Kr*2*y/h)*a,A=new Nn().lookAt({eye:[0,-d,0],up:[0,0,1]});A.rotateX(u*Uc),A.rotateZ(-t*Uc),A.scale(y/h),super({...e,height:h,viewMatrix:A,longitude:t,latitude:u,zoom:i,distanceScales:RF(),fovy:p,focalDistance:d,near:v,far:x}),this.scale=y,this.latitude=u,this.longitude=t,this.resolution=l}get projectionMode(){return on.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,this.height/2],t),s=this.unproject([this.width/2,0],t),a=this.unproject([this.width,this.height/2],t),l=this.unproject([this.width/2,this.height],t);return a[0]<this.longitude&&(a[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],a[0],s[0],l[0]),Math.min(i[1],a[1],s[1],l[1]),Math.max(i[0],a[0],s[0],l[0]),Math.max(i[1],a[1],s[1],l[1])]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,a,l]=e,u=t?a:this.height-a,{pixelUnprojectionMatrix:h}=this;let d;if(Number.isFinite(l))d=np(h,[s,u,l,1]);else{const v=np(h,[s,u,-1,1]),x=np(h,[s,u,1,1]),A=((i||0)/Kc+1)*Kr,E=Ud(YT([],v,x)),C=Ud(v),D=Ud(x),B=4*((4*C*D-(E-C-D)**2)/16)/E,z=Math.sqrt(C-B),X=Math.sqrt(Math.max(0,A*A-B)),ne=(z-X)/Math.sqrt(E);d=JN([],v,x,ne)}const[p,m,y]=this.unprojectPosition(d);return Number.isFinite(l)?[p,m,y]:Number.isFinite(i)?[p,m,i]:[p,m]}projectPosition(e){const[t,i,s=0]=e,a=t*Uc,l=i*Uc,u=Math.cos(l),h=(s/Kc+1)*Kr;return[Math.sin(a)*u*h,-Math.cos(a)*u*h,Math.sin(l)*h]}unprojectPosition(e){const[t,i,s]=e,a=ak(e),l=Math.asin(s/a),h=Math.atan2(t,-i)*L3,d=l*L3,p=(a/Kr-1)*Kc;return[h,d,p]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){const i=this.unproject(t);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}}function np(n,e){const t=ga([],e,n);return KT(t,t,1/t[3]),t}const ip={bearing:0,pitch:0,position:[0,0,0]},MF={speed:1.2,curve:1.414};class Qg extends M2{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...MF,...e}}interpolateProps(e,t,i){const s=gD(e,t,i,this.opts);for(const a in ip)s[a]=zo(e[a]||ip[a],t[a]||ip[a],i);return s}getDuration(e,t){let{transitionDuration:i}=t;return i==="auto"&&(i=_D(e,t,this.opts)),i}}const OF=typeof window<"u"?te.useLayoutEffect:te.useEffect;function Ru(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const IF={position:"absolute",zIndex:-1};function nx(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>nx(t,e));if(Hu(n)){if(NF(n))return e.style=IF,te.cloneElement(n,e);if(kF(n))return te.cloneElement(n,e)}return n}function Hu(n){return n&&typeof n=="object"&&"type"in n||!1}function NF(n){return n.props?.mapStyle}function kF(n){const e=n.type;return e&&e.deckGLViewProps}function Yp(n){if(typeof n=="function")return te.createElement(fa,{},n);if(Array.isArray(n))return n.map(Yp);if(Hu(n)){if(n.type===te.Fragment)return Yp(n.props.children);if(Ru(n.type,fa))return n}return n}function PF({children:n,layers:e=[],views:t=null}){const i=[],s=[],a={};return te.Children.forEach(Yp(n),l=>{if(Hu(l)){const u=l.type;if(Ru(u,Jo)){const h=DF(u,l.props);s.push(h)}else i.push(l);if(Ru(u,fa)&&u!==fa&&l.props.id){const h=new u(l.props);a[h.id]=h}}else l&&i.push(l)}),Object.keys(a).length>0&&(Array.isArray(t)?t.forEach(l=>{a[l.id]=l}):t&&(a[t.id]=t),t=Object.values(a)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:t}}function DF(n,e){const t={},i=n.defaultProps||{};for(const s in e)i[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const BF=te.createContext();function UF({children:n,deck:e,ContextProvider:t=BF.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},a=i.views[0].id;for(const l of n){let u=a,h=l;Hu(l)&&Ru(l.type,fa)&&(u=l.props.id||a,h=l.props.children);const d=i.getViewport(u),p=i.getViewState(u);if(d){p.padding=d.padding;const{x:m,y,width:v,height:x}=d;h=nx(h,{x:m,y,width:v,height:x,viewport:d,viewState:p}),s[u]||(s[u]={viewport:d,children:[]}),s[u].children.push(h)}}return Object.keys(s).map(l=>{const{viewport:u,children:h}=s[l],{x:d,y:p,width:m,height:y}=u,v={position:"absolute",left:d,top:p,width:m,height:y},x=`view-${l}`,A=te.createElement("div",{key:x,id:x,style:v},...h),E={deck:e,viewport:u,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:D=>{D.viewId=l,e._onViewStateChange(D)},widgets:[]},C=`view-${l}-context`;return te.createElement(t,{key:C,value:E},A)})}const FF={mixBlendMode:null};function LF({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const a in t)a in FF?s[a]=t[a]:i[a]=t[a];return{containerStyle:i,canvasStyle:s}}function zF(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function ix(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function VF(n,e,t){const i=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:s=>{n.redrawReason=s;const a=i.getViewports();n.lastRenderedViewports!==a?n.forceUpdate():ix(n)}});return i}function HF(n,e){const[t,i]=te.useState(0),a=te.useRef({control:null,version:t,forceUpdate:()=>i(z=>z+1)}).current,l=te.useRef(null),u=te.useRef(null),h=te.useMemo(()=>PF(n),[n.layers,n.views,n.children]);let d=!0;const p=z=>d&&n.viewState?(a.viewStateUpdateRequested=z,null):(a.viewStateUpdateRequested=null,n.onViewStateChange?.(z)),m=z=>{d?a.interactionStateUpdateRequested=z:(a.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(z))},y=te.useMemo(()=>{const z={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:u.current,layers:h.layers,views:h.views,onViewStateChange:p,onInteractionStateChange:m};return delete z._customRender,a.deck&&a.deck.setProps(z),z},[n]);te.useEffect(()=>{const z=n.Deck||Zg;return a.deck=VF(a,z,{...y,parent:l.current,canvas:u.current}),()=>a.deck?.finalize()},[]),OF(()=>{ix(a);const{viewStateUpdateRequested:z,interactionStateUpdateRequested:X}=a;z&&p(z),X&&m(X),a.deck?.isInitialized&&a.deck.redraw("Initial render")}),te.useImperativeHandle(e,()=>zF(a),[]);const v=a.deck&&a.deck.isInitialized?a.deck.getViewports():void 0,{ContextProvider:x,width:A="100%",height:E="100%",id:C,style:D}=n,{containerStyle:M,canvasStyle:B}=te.useMemo(()=>LF({width:A,height:E,style:D}),[A,E,D]);if(!a.viewStateUpdateRequested&&a.lastRenderedViewports===v||a.version!==t){a.lastRenderedViewports=v,a.version=t;const z=UF({children:h.children,deck:a.deck,ContextProvider:x}),X=te.createElement("canvas",{key:"canvas",id:C||"deckgl-overlay",ref:u,style:B});a.control=te.createElement("div",{id:`${C||"deckgl"}-wrapper`,ref:l,style:M},[X,z])}return d=!1,a.control}const jF=te.forwardRef(HF);var ju,Ge,sx,Cs,z3,rx,ax,ox,Gg,qp,Zp,Wo={},lx=[],$F=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,$u=Array.isArray;function bi(n,e){for(var t in e)n[t]=e[t];return n}function Jg(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function WF(n,e,t){var i,s,a,l={};for(a in e)a=="key"?i=e[a]:a=="ref"?s=e[a]:l[a]=e[a];if(arguments.length>2&&(l.children=arguments.length>3?ju.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(a in n.defaultProps)l[a]===void 0&&(l[a]=n.defaultProps[a]);return Qc(n,l,i,s,null)}function Qc(n,e,t,i,s){var a={type:n,props:e,key:t,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++sx,__i:-1,__u:0};return s==null&&Ge.vnode!=null&&Ge.vnode(a),a}function Wu(n){return n.children}function Gc(n,e){this.props=n,this.context=e}function da(n,e){if(e==null)return n.__?da(n.__,n.__i+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?da(n):null}function cx(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return cx(n)}}function V3(n){(!n.__d&&(n.__d=!0)&&Cs.push(n)&&!Cu.__r++||z3!=Ge.debounceRendering)&&((z3=Ge.debounceRendering)||rx)(Cu)}function Cu(){for(var n,e,t,i,s,a,l,u=1;Cs.length;)Cs.length>u&&Cs.sort(ax),n=Cs.shift(),u=Cs.length,n.__d&&(t=void 0,i=void 0,s=(i=(e=n).__v).__e,a=[],l=[],e.__P&&((t=bi({},i)).__v=i.__v+1,Ge.vnode&&Ge.vnode(t),e_(e.__P,t,i,e.__n,e.__P.namespaceURI,32&i.__u?[s]:null,a,s??da(i),!!(32&i.__u),l),t.__v=i.__v,t.__.__k[t.__i]=t,hx(a,t,l),i.__e=i.__=null,t.__e!=s&&cx(t)));Cu.__r=0}function ux(n,e,t,i,s,a,l,u,h,d,p){var m,y,v,x,A,E,C,D=i&&i.__k||lx,M=e.length;for(h=XF(t,e,D,h,M),m=0;m<M;m++)(v=t.__k[m])!=null&&(y=v.__i==-1?Wo:D[v.__i]||Wo,v.__i=m,E=e_(n,v,y,s,a,l,u,h,d,p),x=v.__e,v.ref&&y.ref!=v.ref&&(y.ref&&t_(y.ref,null,v),p.push(v.ref,v.__c||x,v)),A==null&&x!=null&&(A=x),(C=!!(4&v.__u))||y.__k===v.__k?h=fx(v,h,n,C):typeof v.type=="function"&&E!==void 0?h=E:x&&(h=x.nextSibling),v.__u&=-7);return t.__e=A,h}function XF(n,e,t,i,s){var a,l,u,h,d,p=t.length,m=p,y=0;for(n.__k=new Array(s),a=0;a<s;a++)(l=e[a])!=null&&typeof l!="boolean"&&typeof l!="function"?(h=a+y,(l=n.__k[a]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?Qc(null,l,null,null,null):$u(l)?Qc(Wu,{children:l},null,null,null):l.constructor==null&&l.__b>0?Qc(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=n,l.__b=n.__b+1,u=null,(d=l.__i=YF(l,t,h,m))!=-1&&(m--,(u=t[d])&&(u.__u|=2)),u==null||u.__v==null?(d==-1&&(s>p?y--:s<p&&y++),typeof l.type!="function"&&(l.__u|=4)):d!=h&&(d==h-1?y--:d==h+1?y++:(d>h?y--:y++,l.__u|=4))):n.__k[a]=null;if(m)for(a=0;a<p;a++)(u=t[a])!=null&&(2&u.__u)==0&&(u.__e==i&&(i=da(u)),px(u,u));return i}function fx(n,e,t,i){var s,a;if(typeof n.type=="function"){for(s=n.__k,a=0;s&&a<s.length;a++)s[a]&&(s[a].__=n,e=fx(s[a],e,t,i));return e}n.__e!=e&&(i&&(e&&n.type&&!e.parentNode&&(e=da(n)),t.insertBefore(n.__e,e||null)),e=n.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function YF(n,e,t,i){var s,a,l,u=n.key,h=n.type,d=e[t],p=d!=null&&(2&d.__u)==0;if(d===null&&n.key==null||p&&u==d.key&&h==d.type)return t;if(i>(p?1:0)){for(s=t-1,a=t+1;s>=0||a<e.length;)if((d=e[l=s>=0?s--:a++])!=null&&(2&d.__u)==0&&u==d.key&&h==d.type)return l}return-1}function H3(n,e,t){e[0]=="-"?n.setProperty(e,t??""):n[e]=t==null?"":typeof t!="number"||$F.test(e)?t:t+"px"}function Fc(n,e,t,i,s){var a,l;e:if(e=="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof i=="string"&&(n.style.cssText=i=""),i)for(e in i)t&&e in t||H3(n.style,e,"");if(t)for(e in t)i&&t[e]==i[e]||H3(n.style,e,t[e])}else if(e[0]=="o"&&e[1]=="n")a=e!=(e=e.replace(ox,"$1")),l=e.toLowerCase(),e=l in n||e=="onFocusOut"||e=="onFocusIn"?l.slice(2):e.slice(2),n.l||(n.l={}),n.l[e+a]=t,t?i?t.u=i.u:(t.u=Gg,n.addEventListener(e,a?Zp:qp,a)):n.removeEventListener(e,a?Zp:qp,a);else{if(s=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in n)try{n[e]=t??"";break e}catch{}typeof t=="function"||(t==null||t===!1&&e[4]!="-"?n.removeAttribute(e):n.setAttribute(e,e=="popover"&&t==1?"":t))}}function j3(n){return function(e){if(this.l){var t=this.l[e.type+n];if(e.t==null)e.t=Gg++;else if(e.t<t.u)return;return t(Ge.event?Ge.event(e):e)}}}function e_(n,e,t,i,s,a,l,u,h,d){var p,m,y,v,x,A,E,C,D,M,B,z,X,ne,ae,ie,ge,ee=e.type;if(e.constructor!=null)return null;128&t.__u&&(h=!!(32&t.__u),a=[u=e.__e=t.__e]),(p=Ge.__b)&&p(e);e:if(typeof ee=="function")try{if(C=e.props,D="prototype"in ee&&ee.prototype.render,M=(p=ee.contextType)&&i[p.__c],B=p?M?M.props.value:p.__:i,t.__c?E=(m=e.__c=t.__c).__=m.__E:(D?e.__c=m=new ee(C,B):(e.__c=m=new Gc(C,B),m.constructor=ee,m.render=ZF),M&&M.sub(m),m.props=C,m.state||(m.state={}),m.context=B,m.__n=i,y=m.__d=!0,m.__h=[],m._sb=[]),D&&m.__s==null&&(m.__s=m.state),D&&ee.getDerivedStateFromProps!=null&&(m.__s==m.state&&(m.__s=bi({},m.__s)),bi(m.__s,ee.getDerivedStateFromProps(C,m.__s))),v=m.props,x=m.state,m.__v=e,y)D&&ee.getDerivedStateFromProps==null&&m.componentWillMount!=null&&m.componentWillMount(),D&&m.componentDidMount!=null&&m.__h.push(m.componentDidMount);else{if(D&&ee.getDerivedStateFromProps==null&&C!==v&&m.componentWillReceiveProps!=null&&m.componentWillReceiveProps(C,B),!m.__e&&m.shouldComponentUpdate!=null&&m.shouldComponentUpdate(C,m.__s,B)===!1||e.__v==t.__v){for(e.__v!=t.__v&&(m.props=C,m.state=m.__s,m.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.some(function(fe){fe&&(fe.__=e)}),z=0;z<m._sb.length;z++)m.__h.push(m._sb[z]);m._sb=[],m.__h.length&&l.push(m);break e}m.componentWillUpdate!=null&&m.componentWillUpdate(C,m.__s,B),D&&m.componentDidUpdate!=null&&m.__h.push(function(){m.componentDidUpdate(v,x,A)})}if(m.context=B,m.props=C,m.__P=n,m.__e=!1,X=Ge.__r,ne=0,D){for(m.state=m.__s,m.__d=!1,X&&X(e),p=m.render(m.props,m.state,m.context),ae=0;ae<m._sb.length;ae++)m.__h.push(m._sb[ae]);m._sb=[]}else do m.__d=!1,X&&X(e),p=m.render(m.props,m.state,m.context),m.state=m.__s;while(m.__d&&++ne<25);m.state=m.__s,m.getChildContext!=null&&(i=bi(bi({},i),m.getChildContext())),D&&!y&&m.getSnapshotBeforeUpdate!=null&&(A=m.getSnapshotBeforeUpdate(v,x)),ie=p,p!=null&&p.type===Wu&&p.key==null&&(ie=dx(p.props.children)),u=ux(n,$u(ie)?ie:[ie],e,t,i,s,a,l,u,h,d),m.base=e.__e,e.__u&=-161,m.__h.length&&l.push(m),E&&(m.__E=m.__=null)}catch(fe){if(e.__v=null,h||a!=null)if(fe.then){for(e.__u|=h?160:128;u&&u.nodeType==8&&u.nextSibling;)u=u.nextSibling;a[a.indexOf(u)]=null,e.__e=u}else{for(ge=a.length;ge--;)Jg(a[ge]);Kp(e)}else e.__e=t.__e,e.__k=t.__k,fe.then||Kp(e);Ge.__e(fe,e,t)}else a==null&&e.__v==t.__v?(e.__k=t.__k,e.__e=t.__e):u=e.__e=qF(t.__e,e,t,i,s,a,l,h,d);return(p=Ge.diffed)&&p(e),128&e.__u?void 0:u}function Kp(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(Kp)}function hx(n,e,t){for(var i=0;i<t.length;i++)t_(t[i],t[++i],t[++i]);Ge.__c&&Ge.__c(e,n),n.some(function(s){try{n=s.__h,s.__h=[],n.some(function(a){a.call(s)})}catch(a){Ge.__e(a,s.__v)}})}function dx(n){return typeof n!="object"||n==null||n.__b&&n.__b>0?n:$u(n)?n.map(dx):bi({},n)}function qF(n,e,t,i,s,a,l,u,h){var d,p,m,y,v,x,A,E=t.props,C=e.props,D=e.type;if(D=="svg"?s="http://www.w3.org/2000/svg":D=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),a!=null){for(d=0;d<a.length;d++)if((v=a[d])&&"setAttribute"in v==!!D&&(D?v.localName==D:v.nodeType==3)){n=v,a[d]=null;break}}if(n==null){if(D==null)return document.createTextNode(C);n=document.createElementNS(s,D,C.is&&C),u&&(Ge.__m&&Ge.__m(e,a),u=!1),a=null}if(D==null)E===C||u&&n.data==C||(n.data=C);else{if(a=a&&ju.call(n.childNodes),E=t.props||Wo,!u&&a!=null)for(E={},d=0;d<n.attributes.length;d++)E[(v=n.attributes[d]).name]=v.value;for(d in E)if(v=E[d],d!="children"){if(d=="dangerouslySetInnerHTML")m=v;else if(!(d in C)){if(d=="value"&&"defaultValue"in C||d=="checked"&&"defaultChecked"in C)continue;Fc(n,d,null,v,s)}}for(d in C)v=C[d],d=="children"?y=v:d=="dangerouslySetInnerHTML"?p=v:d=="value"?x=v:d=="checked"?A=v:u&&typeof v!="function"||E[d]===v||Fc(n,d,v,E[d],s);if(p)u||m&&(p.__html==m.__html||p.__html==n.innerHTML)||(n.innerHTML=p.__html),e.__k=[];else if(m&&(n.innerHTML=""),ux(e.type=="template"?n.content:n,$u(y)?y:[y],e,t,i,D=="foreignObject"?"http://www.w3.org/1999/xhtml":s,a,l,a?a[0]:t.__k&&da(t,0),u,h),a!=null)for(d=a.length;d--;)Jg(a[d]);u||(d="value",D=="progress"&&x==null?n.removeAttribute("value"):x!=null&&(x!==n[d]||D=="progress"&&!x||D=="option"&&x!=E[d])&&Fc(n,d,x,E[d],s),d="checked",A!=null&&A!=n[d]&&Fc(n,d,A,E[d],s))}return n}function t_(n,e,t){try{if(typeof n=="function"){var i=typeof n.__u=="function";i&&n.__u(),i&&e==null||(n.__u=n(e))}else n.current=e}catch(s){Ge.__e(s,t)}}function px(n,e,t){var i,s;if(Ge.unmount&&Ge.unmount(n),(i=n.ref)&&(i.current&&i.current!=n.__e||t_(i,null,e)),(i=n.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(a){Ge.__e(a,e)}i.base=i.__P=null}if(i=n.__k)for(s=0;s<i.length;s++)i[s]&&px(i[s],e,t||typeof n.type!="function");t||Jg(n.__e),n.__c=n.__=n.__e=void 0}function ZF(n,e,t){return this.constructor(n,t)}function n_(n,e,t){var i,s,a,l;e==document&&(e=document.documentElement),Ge.__&&Ge.__(n,e),s=(i=!1)?null:e.__k,a=[],l=[],e_(e,n=e.__k=WF(Wu,null,[n]),s||Wo,Wo,e.namespaceURI,s?null:e.firstChild?ju.call(e.childNodes):null,a,s?s.__e:e.firstChild,i,l),hx(a,n,l)}ju=lx.slice,Ge={__e:function(n,e,t,i){for(var s,a,l;e=e.__;)if((s=e.__c)&&!s.__)try{if((a=s.constructor)&&a.getDerivedStateFromError!=null&&(s.setState(a.getDerivedStateFromError(n)),l=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,i||{}),l=s.__d),l)return s.__E=s}catch(u){n=u}throw n}},sx=0,Gc.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=bi({},this.state),typeof n=="function"&&(n=n(bi({},t),this.props)),n&&bi(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),V3(this))},Gc.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),V3(this))},Gc.prototype.render=Wu,Cs=[],rx=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ax=function(n,e){return n.__v.__b-e.__v.__b},Cu.__r=0,ox=/(PointerCapture)$|Capture$/i,Gg=0,qp=j3(!1),Zp=j3(!0);var KF=0;function kt(n,e,t,i,s,a){e||(e={});var l,u,h=e;if("ref"in h)for(u in h={},e)u=="ref"?l=e[u]:h[u]=e[u];var d={type:n,props:h,key:t,ref:l,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--KF,__i:-1,__u:0,__source:s,__self:a};if(typeof n=="function"&&(l=n.defaultProps))for(u in l)h[u]===void 0&&(h[u]=l[u]);return Ge.vnode&&Ge.vnode(d),d}const QF=n=>{const{children:e,orientation:t="horizontal"}=n;return kt("div",{className:`deck-widget-button-group ${t}`,children:e})},$3=n=>{const{className:e="",label:t,onClick:i,children:s}=n;return kt("button",{className:`deck-widget-icon-button ${e}`,type:"button",onClick:i,title:t,children:s||kt("div",{className:"deck-widget-icon"})})};class gx extends ln{constructor(e={}){super(e),this.className="deck-widget-zoom",this.placement="top-left",this.viewports={},this.setProps(this.props)}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId,super.setProps(e)}onRenderHTML(e){const t=kt(QF,{orientation:this.props.orientation,children:[kt($3,{onClick:()=>this.handleZoomIn(),label:this.props.zoomInLabel,className:"deck-widget-zoom-in"}),kt($3,{onClick:()=>this.handleZoomOut(),label:this.props.zoomOutLabel,className:"deck-widget-zoom-out"})]});n_(t,e)}onViewportChange(e){this.viewports[e.id]=e}handleZoom(e,t){const i=this.viewId||e?.id||"default-view",s={...e,zoom:t};this.props.transitionDuration>0&&(s.transitionDuration=this.props.transitionDuration,s.transitionInterpolator="latitude"in s?new Qg:new Hg({transitionProps:["zoom"]})),this.setViewState(i,s)}handleZoomIn(){for(const e of Object.values(this.viewports))this.handleZoom(e,e.zoom+1)}handleZoomOut(){for(const e of Object.values(this.viewports))this.handleZoom(e,e.zoom-1)}setViewState(e,t){this.deck._onViewStateChange({viewId:e,viewState:t,interactionState:{}})}}gx.defaultProps={...ln.defaultProps,id:"zoom",placement:"top-left",orientation:"vertical",transitionDuration:200,zoomInLabel:"Zoom In",zoomOutLabel:"Zoom Out",viewId:null};const GF=n=>{const{className:e="",label:t,onClick:i,children:s}=n;return kt("div",{className:"deck-widget-button",children:kt("button",{className:`deck-widget-icon-button ${e}`,type:"button",onClick:i,title:t,children:s||kt("div",{className:"deck-widget-icon"})})})};class _x extends ln{constructor(e={}){super(e),this.className="deck-widget-compass",this.placement="top-left",this.viewports={},this.setProps(this.props)}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId,super.setProps(e)}onRenderHTML(e){const t=this.viewId||Object.values(this.viewports)[0]?.id||"default-view",i=this.viewports[t],[s,a]=this.getRotation(i),l=kt("div",{className:"deck-widget-button",style:{perspective:100},children:kt("button",{type:"button",onClick:()=>{for(const u of Object.values(this.viewports))this.handleCompassReset(u)},title:this.props.label,style:{transform:`rotateX(${a}deg)`},children:kt("svg",{fill:"none",width:"100%",height:"100%",viewBox:"0 0 26 26",children:kt("g",{transform:`rotate(${s},13,13)`,children:[kt("path",{d:"M10 13.0001L12.9999 5L15.9997 13.0001H10Z",fill:"var(--icon-compass-north-color, rgb(240, 92, 68))"}),kt("path",{d:"M16.0002 12.9999L13.0004 21L10.0005 12.9999H16.0002Z",fill:"var(--icon-compass-south-color, rgb(204, 204, 204))"})]})})})});n_(l,e)}onViewportChange(e){e.equals(this.viewports[e.id])||(this.viewports[e.id]=e,this.updateHTML())}getRotation(e){return e instanceof ss?[-e.bearing,e.pitch]:e instanceof CF?[0,Math.max(-80,Math.min(80,e.latitude))]:[0,0]}handleCompassReset(e){const t=this.viewId||e.id||"default-view";if(e instanceof ss){const i={...e,bearing:0,...this.getRotation(e)[0]===0?{pitch:0}:{},transitionDuration:this.props.transitionDuration,transitionInterpolator:new Qg};this.deck._onViewStateChange({viewId:t,viewState:i,interactionState:{}})}}}_x.defaultProps={...ln.defaultProps,id:"compass",placement:"top-left",viewId:null,label:"Reset Compass",transitionDuration:200};class mx extends ln{constructor(e={}){super(e),this.className="deck-widget-fullscreen",this.placement="top-left",this.fullscreen=!1,this.setProps(this.props)}onAdd(){document.addEventListener("fullscreenchange",this.onFullscreenChange.bind(this))}onRemove(){document.removeEventListener("fullscreenchange",this.onFullscreenChange.bind(this))}onRenderHTML(e){n_(kt(GF,{onClick:()=>{this.handleClick().catch(t=>Ye.error(t)())},label:this.fullscreen?this.props.exitLabel:this.props.enterLabel,className:this.fullscreen?"deck-widget-fullscreen-exit":"deck-widget-fullscreen-enter"}),e)}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId,super.setProps(e)}getContainer(){return this.props.container||this.deck?.getCanvas()?.parentElement}onFullscreenChange(){const e=this.fullscreen,t=document.fullscreenElement===this.getContainer();e!==t&&(this.fullscreen=!this.fullscreen),this.updateHTML()}async handleClick(){this.fullscreen?await this.exitFullscreen():await this.requestFullscreen(),this.updateHTML()}async requestFullscreen(){const e=this.getContainer();e?.requestFullscreen?await e.requestFullscreen({navigationUI:"hide"}):this.togglePseudoFullscreen()}async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():this.togglePseudoFullscreen()}togglePseudoFullscreen(){this.getContainer()?.classList.toggle("deck-pseudo-fullscreen")}}mx.defaultProps={...ln.defaultProps,id:"fullscreen",placement:"top-left",viewId:null,enterLabel:"Enter Fullscreen",exitLabel:"Exit Fullscreen",container:void 0};const JF=te.createContext(null);function eL(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n._seaLevelZoom??n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding,elevation:n._centerAltitude}}function tL(n){return Number.isFinite(n.longitude)||Number.isFinite(n.latitude)||Number.isFinite(n.zoom)||Number.isFinite(n.pitch)||Number.isFinite(n.bearing)}function nL(n,e){return!!(Number.isFinite(e.longitude)&&n.center.lng!==e.longitude||Number.isFinite(e.latitude)&&n.center.lat!==e.latitude||Number.isFinite(e.bearing)&&n.bearing!==e.bearing||Number.isFinite(e.pitch)&&n.pitch!==e.pitch||Number.isFinite(e.zoom)&&(n._seaLevelZoom??n.zoom)!==e.zoom||e.padding&&!n.isPaddingEqual(e.padding))}function W3(){}function iL(n,e){const t=n._constrain,i=n._calcMatrices;if(n._constrain=W3,n._calcMatrices=W3,Number.isFinite(e.bearing)&&(n.bearing=e.bearing),Number.isFinite(e.pitch)&&(n.pitch=e.pitch),e.padding&&!n.isPaddingEqual(e.padding)&&(n.padding=e.padding),Number.isFinite(e.longitude)||Number.isFinite(e.latitude)){const s=n.center;n._center=new s.constructor(e.longitude??s.lng,e.latitude??s.lat)}if(Number.isFinite(e.zoom))if(n._centerAltitude=e.elevation??0,n.elevation){n._seaLevelZoom=e.zoom;const s=n.pixelsPerMeter/n.worldSize*n._centerAltitude,a=n._mercatorZfromZoom(e.zoom),l=n._mercatorZfromZoom(n._maxZoom),u=Math.max(a-s,l);n._setZoom(n._zoomFromMercatorZ(u))}else n._seaLevelZoom=null,n.zoom=e.zoom;n._constrain=t,n._calcMatrices=i,n._unmodified||(n._constrain(),n._calcMatrices())}const sL=new Set(["_calcMatrices","_calcFogMatrices","_updateCameraState","_updateSeaLevelZoom"]);function rL(n){let e=!1,t={};const i=n;let s=null;const a={get(l,u){return u==="$reactViewState"?t:u==="$proposedTransform"?s:u==="$internalUpdate"?e:u==="_setZoom"?h=>{e&&s?.[u](h),Number.isFinite(t.zoom)||i[u](h)}:(e&&u==="_translateCameraConstrained"&&tL(t)&&(s=s||i.clone()),sL.has(u)?function(...h){s?.[u](...h),i[u](...h)}:e&&s?s[u]:i[u])},set(l,u,h){if(u==="$reactViewState")return t=h,iL(i,t),!0;if(u==="$proposedTransform")return s=h,!0;if(u==="$internalUpdate")return e=h,!0;let d=h;return u==="center"||u==="_center"?(Number.isFinite(t.longitude)||Number.isFinite(t.latitude))&&(d=new h.constructor(t.longitude??h.lng,t.latitude??h.lat)):u==="zoom"||u==="_zoom"||u==="_seaLevelZoom"?Number.isFinite(t.zoom)&&(d=i[u]):u==="_centerAltitude"?Number.isFinite(t.elevation)&&(d=i[u]):u==="pitch"||u==="_pitch"?Number.isFinite(t.pitch)&&(d=i[u]):(u==="bearing"||u==="rotation"||u==="angle")&&Number.isFinite(t.bearing)&&(d=i[u]),e&&d!==h&&(s=s||i.clone()),e&&s&&(s[u]=h),i[u]=d,!0}};return new Proxy(n,a)}const aL=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function X3(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const e={};for(const i of n.layers)e[i.id]=i;const t=n.layers.map(i=>{let s=null;"interactive"in i&&(s=Object.assign({},i),delete s.interactive);const a=e[i.ref];if(a){s=s||Object.assign({},i),delete s.ref;for(const l of aL)l in a&&(s[l]=a[l])}return s||i});return{...n,layers:t}}function oL(n,e){const t=Array.isArray(n)?n[0]:n?n.x:0,i=Array.isArray(n)?n[1]:n?n.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,a=Array.isArray(e)?e[1]:e?e.y:0;return t===s&&i===a}function Gi(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Gi(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(const s of t)if(!e.hasOwnProperty(s)||!Gi(n[s],e[s]))return!1;return!0}return!1}var Y3={};const q3={version:8,sources:{},layers:[]},Z3={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},K3={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Q3={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},lL=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],cL=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class pa{constructor(e,t,i){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=s=>{const a=this.props[Q3[s.type]];a?a(s):s.type==="error"&&console.error(s.error)},this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const a=this.props[Z3[s.type]];a&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),a(s),delete s.features)},this._onCameraEvent=s=>{if(!this._internalUpdate){const a=this.props[K3[s.type]],l=this._proxyTransform;a&&(s.viewState=eL(l.$proposedTransform??l),a(s)),s.type==="moveend"&&(l.$proposedTransform=null)}s.type in this._deferredEvents&&(this._deferredEvents[s.type]=!1)},this._MapClass=e,this.props=t,this._initialize(i)}get map(){return this._map}get transform(){return this._map.transform}setProps(e){const t=this.props;this.props=e;const i=this._updateSettings(e,t);i&&this._createProxyTransform(this._map);const s=this._updateSize(e),a=this._updateViewState(e,!0);this._updateStyle(e,t),this._updateStyleComponents(e,t),this._updateHandlers(e,t),(i||s||a&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const i=pa.savedMaps.pop();if(!i)return null;const s=i.map,a=s.getContainer();for(t.className=a.className;a.childNodes.length>0;)t.appendChild(a.childNodes[0]);s._container=t,i.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:l}=e;return l&&(l.bounds?s.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):i._updateViewState(l,!1)),s.isStyleLoaded()?s.fire("load"):s.once("styledata",()=>s.fire("load")),s._update(),i}_initialize(e){const{props:t}=this,{mapStyle:i=q3}=t,s={...t,...t.initialViewState,accessToken:t.mapboxAccessToken||uL()||null,container:e,style:X3(i)},a=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[a.longitude||0,a.latitude||0],zoom:a.zoom||0,pitch:a.pitch||0,bearing:a.bearing||0}),t.gl){const m=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=m,t.gl)}const l=new this._MapClass(s);a.padding&&l.setPadding(a.padding),t.cursor&&(l.getCanvas().style.cursor=t.cursor),this._createProxyTransform(l);const u=l._render;l._render=m=>{this._inRender=!0,u.call(l,m),this._inRender=!1};const h=l._renderTaskQueue.run;l._renderTaskQueue.run=m=>{this._proxyTransform.$internalUpdate=!0,h.call(l._renderTaskQueue,m),this._proxyTransform.$internalUpdate=!1,this._fireDefferedEvents()};const d=l.jumpTo;l.jumpTo=(...m)=>(this._proxyTransform.$internalUpdate=!0,d.apply(l,m),this._proxyTransform.$internalUpdate=!1,l);const p=l.fire;l.fire=this._fireEvent.bind(this,p),l.on("styledata",()=>{this._updateStyleComponents(this.props,{})}),l.on("sourcedata",()=>{this._updateStyleComponents(this.props,{})});for(const m in Z3)l.on(m,this._onPointerEvent);for(const m in K3)l.on(m,this._onCameraEvent);for(const m in Q3)l.on(m,this._onEvent);this._map=l}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),pa.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createProxyTransform(e){const t=rL(e.transform);e.transform=t,e.painter.transform=t,this._proxyTransform=t}_updateSize(e){const{viewState:t}=e;if(t){const i=this._map;if(t.width!==i.transform.width||t.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e,t){const i=e.viewState||e,s=this._proxyTransform,{zoom:a,pitch:l,bearing:u}=s,h=nL(this._proxyTransform,i);if(s.$reactViewState=i,h&&t){const d=this._deferredEvents;d.move=!0,d.zoom||(d.zoom=a!==s.zoom),d.rotate||(d.rotate=u!==s.bearing),d.pitch||(d.pitch=l!==s.pitch)}return h}_updateSettings(e,t){const i=this._map;let s=!1;for(const a of lL)a in e&&!Gi(e[a],t[a])&&(s=!0,i[`set${a[0].toUpperCase()}${a.slice(1)}`]?.call(i,e[a]));return s}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:i=q3,styleDiffing:s=!0}=e,a={diff:s};return"localIdeographFontFamily"in e&&(a.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(X3(i),a),!0}return!1}_updateStyleComponents(e,t){const i=this._map;let s=!1;return i.isStyleLoaded()&&("light"in e&&i.setLight&&!Gi(e.light,t.light)&&(s=!0,i.setLight(e.light)),"fog"in e&&i.setFog&&!Gi(e.fog,t.fog)&&(s=!0,i.setFog(e.fog)),"terrain"in e&&i.setTerrain&&!Gi(e.terrain,t.terrain)&&(!e.terrain||i.getSource(e.terrain.source))&&(s=!0,i.setTerrain(e.terrain))),s}_updateHandlers(e,t){const i=this._map;let s=!1;for(const a of cL){const l=e[a]??!0,u=t[a]??!0;Gi(l,u)||(s=!0,l?i[a].enable(l):i[a].disable())}return s}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:i=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:i.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const s=e.type,a=this._hoveredFeatures?.length>0,l=this._queryRenderedFeatures(e.point),u=l.length>0;!u&&a&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,u&&!a&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,t,i){const s=this._map,a=this._proxyTransform,l=a.$internalUpdate;try{a.$internalUpdate=!1,e.call(s,t,i)}finally{a.$internalUpdate=l}return s}_fireDefferedEvents(){const e=this._map;this._internalUpdate=!0;for(const t in this._deferredEvents)this._deferredEvents[t]&&e.fire(t);this._internalUpdate=!1}}pa.savedMaps=[];function uL(){let n=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);n=e&&e[1]}try{n=n||Y3.MapboxAccessToken}catch{}try{n=n||Y3.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return n}const fL=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function hL(n){if(!n)return null;const e=n.map,t={getMap:()=>e,getCenter:()=>n.transform.center,getZoom:()=>n.transform.zoom,getBearing:()=>n.transform.bearing,getPitch:()=>n.transform.pitch,getPadding:()=>n.transform.padding,getBounds:()=>n.transform.getBounds(),project:i=>{const s=e.transform;e.transform=n.transform;const a=e.project(i);return e.transform=s,a},unproject:i=>{const s=e.transform;e.transform=n.transform;const a=e.unproject(i);return e.transform=s,a},queryTerrainElevation:(i,s)=>{const a=e.transform;e.transform=n.transform;const l=e.queryTerrainElevation(i,s);return e.transform=a,l},queryRenderedFeatures:(i,s)=>{const a=e.transform;e.transform=n.transform;const l=e.queryRenderedFeatures(i,s);return e.transform=a,l}};for(const i of dL(e))!(i in t)&&!fL.includes(i)&&(t[i]=e[i].bind(e));return t}function dL(n){const e=new Set;let t=n;for(;t;){for(const i of Object.getOwnPropertyNames(t))i[0]!=="_"&&typeof n[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);t=Object.getPrototypeOf(t)}return Array.from(e)}const pL=typeof document<"u"?te.useLayoutEffect:te.useEffect,gL=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function _L(n,e){for(const i of gL)i in e&&(n[i]=e[i]);const{RTLTextPlugin:t="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;t&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"&&n.setRTLTextPlugin(t,i=>{i&&console.error(i)},!0)}const Xu=te.createContext(null);function mL(n,e){const t=te.useContext(JF),[i,s]=te.useState(null),a=te.useRef(),{current:l}=te.useRef({mapLib:null,map:null});te.useEffect(()=>{const d=n.mapLib;let p=!0,m;return Promise.resolve(d||Fp(()=>import("./mapbox-gl-C8n3o6aj.js").then(y=>y.m),[])).then(y=>{if(!p)return;if(!y)throw new Error("Invalid mapLib");const v="Map"in y?y:y.default;if(!v.Map)throw new Error("Invalid mapLib");_L(v,n),n.reuseMaps&&(m=pa.reuse(n,a.current)),m||(m=new pa(v.Map,n,a.current)),l.map=hL(m),l.mapLib=v,s(m),t?.onMapMount(l.map,n.id)}).catch(y=>{const{onError:v}=n;v?v({type:"error",target:null,error:y}):console.error(y)}),()=>{p=!1,m&&(t?.onMapUnmount(n.id),n.reuseMaps?m.recycle():m.destroy())}},[]),pL(()=>{i&&i.setProps(n)}),te.useImperativeHandle(e,()=>l.map,[i]);const u=te.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),h={height:"100%"};return te.createElement("div",{id:n.id,ref:a,style:u},i&&te.createElement(Xu.Provider,{value:l},te.createElement("div",{"mapboxgl-children":"",style:h},n.children)))}const yL=te.forwardRef(mL);var yx=r1();const bL=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Gs(n,e){if(!n||!e)return;const t=n.style;for(const i in e){const s=e[i];Number.isFinite(s)&&!bL.test(i)?t[i]=`${s}px`:t[i]=s}}function bx(n,e){if(n===e)return null;const t=G3(n),i=G3(e),s=[];for(const a of i)t.has(a)||s.push(a);for(const a of t)i.has(a)||s.push(a);return s.length===0?null:s}function G3(n){return new Set(n?n.trim().split(/\s+/):[])}te.memo(te.forwardRef((n,e)=>{const{map:t,mapLib:i}=te.useContext(Xu),s=te.useRef({props:n}),a=te.useMemo(()=>{let C=!1;te.Children.forEach(n.children,B=>{B&&(C=!0)});const D={...n,element:C?document.createElement("div"):null},M=new i.Marker(D);return M.setLngLat([n.longitude,n.latitude]),M.getElement().addEventListener("click",B=>{s.current.props.onClick?.({type:"click",target:M,originalEvent:B})}),M.on("dragstart",B=>{const z=B;z.lngLat=a.getLngLat(),s.current.props.onDragStart?.(z)}),M.on("drag",B=>{const z=B;z.lngLat=a.getLngLat(),s.current.props.onDrag?.(z)}),M.on("dragend",B=>{const z=B;z.lngLat=a.getLngLat(),s.current.props.onDragEnd?.(z)}),M},[]);te.useEffect(()=>(a.addTo(t.getMap()),()=>{a.remove()}),[]);const{longitude:l,latitude:u,offset:h,style:d,draggable:p=!1,popup:m=null,rotation:y=0,rotationAlignment:v="auto",pitchAlignment:x="auto"}=n;te.useEffect(()=>{Gs(a.getElement(),d)},[d]),te.useImperativeHandle(e,()=>a,[]);const A=s.current.props;(a.getLngLat().lng!==l||a.getLngLat().lat!==u)&&a.setLngLat([l,u]),h&&!oL(a.getOffset(),h)&&a.setOffset(h),a.isDraggable()!==p&&a.setDraggable(p),a.getRotation()!==y&&a.setRotation(y),a.getRotationAlignment()!==v&&a.setRotationAlignment(v),a.getPitchAlignment()!==x&&a.setPitchAlignment(x),a.getPopup()!==m&&a.setPopup(m);const E=bx(A.className,n.className);if(E)for(const C of E)a.toggleClassName(C);return s.current.props=n,yx.createPortal(n.children,a.getElement())}));te.memo(te.forwardRef((n,e)=>{const{map:t,mapLib:i}=te.useContext(Xu),s=te.useMemo(()=>document.createElement("div"),[]),a=te.useRef({props:n}),l=te.useMemo(()=>{const u={...n},h=new i.Popup(u);return h.setLngLat([n.longitude,n.latitude]),h.once("open",d=>{a.current.props.onOpen?.(d)}),h},[]);if(te.useEffect(()=>{const u=h=>{a.current.props.onClose?.(h)};return l.on("close",u),l.setDOMContent(s).addTo(t.getMap()),()=>{l.off("close",u),l.isOpen()&&l.remove()}},[]),te.useEffect(()=>{Gs(l.getElement(),n.style)},[n.style]),te.useImperativeHandle(e,()=>l,[]),l.isOpen()){const u=a.current.props;(l.getLngLat().lng!==n.longitude||l.getLngLat().lat!==n.latitude)&&l.setLngLat([n.longitude,n.latitude]),n.offset&&!Gi(u.offset,n.offset)&&(l.options.anchor=n.anchor,l.setOffset(n.offset)),(u.anchor!==n.anchor||u.maxWidth!==n.maxWidth)&&l.setMaxWidth(n.maxWidth);const h=bx(u.className,n.className);if(h)for(const d of h)l.toggleClassName(d);a.current.props=n}return yx.createPortal(n.children,s)}));function el(n,e,t,i){const s=te.useContext(Xu),a=te.useMemo(()=>n(s),[]);return te.useEffect(()=>{const l=e,u=null,h=typeof e=="function"?e:null,{map:d}=s;return d.hasControl(a)||(d.addControl(a,l?.position),u&&u(s)),()=>{h&&h(s),d.hasControl(a)&&d.removeControl(a)}},[]),a}function vL(n){const e=el(({mapLib:t})=>new t.AttributionControl(n),{position:n.position});return te.useEffect(()=>{Gs(e._container,n.style)},[n.style]),null}te.memo(vL);function TL(n){const e=el(({mapLib:t})=>new t.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return te.useEffect(()=>{Gs(e._controlContainer,n.style)},[n.style]),null}te.memo(TL);function xL(n,e){const t=te.useRef({props:n}),i=el(({mapLib:s})=>{const a=new s.GeolocateControl(n),l=a._setupUI.bind(a);return a._setupUI=u=>{a._container.hasChildNodes()||l(u)},a.on("geolocate",u=>{t.current.props.onGeolocate?.(u)}),a.on("error",u=>{t.current.props.onError?.(u)}),a.on("outofmaxbounds",u=>{t.current.props.onOutOfMaxBounds?.(u)}),a.on("trackuserlocationstart",u=>{t.current.props.onTrackUserLocationStart?.(u)}),a.on("trackuserlocationend",u=>{t.current.props.onTrackUserLocationEnd?.(u)}),a},{position:n.position});return t.current.props=n,te.useImperativeHandle(e,()=>i,[]),te.useEffect(()=>{Gs(i._container,n.style)},[n.style]),null}te.memo(te.forwardRef(xL));function wL(n){const e=el(({mapLib:t})=>new t.NavigationControl(n),{position:n.position});return te.useEffect(()=>{Gs(e._container,n.style)},[n.style]),null}te.memo(wL);function SL(n){const e=el(({mapLib:a})=>new a.ScaleControl(n),{position:n.position}),t=te.useRef(n),i=t.current;t.current=n;const{style:s}=n;return n.maxWidth!==void 0&&n.maxWidth!==i.maxWidth&&(e.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==i.unit&&e.setUnit(n.unit),te.useEffect(()=>{Gs(e._container,s)},[s]),null}te.memo(SL);const AL=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,J3=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,EL={name:"line",source:AL,vs:J3,fs:J3,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},RL=`// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, color, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct ColorUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> color: ColorUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * color.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
}
`,CL=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,ML=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,OL=[0,0,0,255],IL={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getColor:{type:"accessor",value:OL},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class i_ extends Jo{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:CL,fs:ML,source:RL,modules:[u2,GT,b2,EL]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:i,widthMinPixels:s,widthMaxPixels:a,wrapLongitude:l}=this.props,u=this.state.model,h={widthUnits:Xs[t],widthScale:i,widthMinPixels:s,widthMaxPixels:a,useShortestPath:l?1:0};u.shaderInputs.setProps({line:h}),u.draw(this.context.renderPass),l&&(u.shaderInputs.setProps({line:{...h,useShortestPath:-1}}),u.draw(this.context.renderPass))}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new ca(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new A2({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),parameters:e,isInstanced:!0})}}i_.layerName="LineLayer";i_.defaultProps=IL;const e1=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,NL={name:"scatterplot",vs:e1,fs:e1,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},kL=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,PL=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,DL=`// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,t1=[0,0,0,255],BL={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:t1},getLineColor:{type:"accessor",value:t1},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Po extends Jo{getShaders(){return super.getShaders({vs:kL,fs:PL,source:DL,modules:[u2,GT,b2,NL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:a,stroked:l,filled:u,billboard:h,antialiasing:d,lineWidthUnits:p,lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:v}=this.props,x={stroked:l,filled:u,billboard:h,antialiasing:d,radiusUnits:Xs[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:a,lineWidthUnits:Xs[p],lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:v},A=this.state.model;A.shaderInputs.setProps({scatterplot:x}),this.context.device.type==="webgpu"&&(A.instanceCount=this.props.data.length),A.draw(this.context.renderPass)}_getModel(){const e=this.context.device.type==="webgpu"?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0,t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new ca(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new A2({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0,parameters:e})}}Po.defaultProps=BL;Po.layerName="ScatterplotLayer";class n1 extends ln{static defaultProps={...ln.defaultProps,id:"custom-icon-widget",placement:"top-left",viewId:null,title:"Custom Action",onClick:()=>{},iconClassName:"my-custom-widget-button",iconName:"info",className:"my-custom-widget"};placement;className;buttonElement=null;constructor(e){super(e),this.placement=this.props.placement,this.className=this.props.className}onAdd(){const e=document.createElement("div");e.className=`deck-widget ${this.props.className}`;const t=document.createElement("div");t.className="deck-widget-button",this.buttonElement=document.createElement("button"),this.buttonElement.type="button";const i=document.createElement("div");return i.className="deck-widget-icon material-symbols-outlined",i.textContent=this.props.iconName,this.buttonElement.appendChild(i),t.appendChild(this.buttonElement),e.appendChild(t),this.updateHTML(),e}onRenderHTML(){if(!this.buttonElement)return;this.buttonElement.className=this.props.iconClassName,this.buttonElement.title=this.props.title,this.buttonElement.setAttribute("aria-label",this.props.title),this.buttonElement.onclick=this.props.onClick;const e=this.buttonElement.querySelector(".deck-widget-icon");e&&e.textContent!==this.props.iconName&&(e.textContent=this.props.iconName)}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId,super.setProps(e),this.rootElement&&e.className&&(this.rootElement.className=`deck-widget ${e.className}`)}}class UL extends ln{static defaultProps={...ln.defaultProps,id:"custom-icon-group-widget",placement:"top-left",viewId:null,buttons:[],orientation:"vertical",className:"my-custom-group"};placement;className;buttonGroupContainer=null;constructor(e){super(e),this.placement=this.props.placement,this.className=this.props.className}onAdd(){const e=document.createElement("div");return e.className=`deck-widget ${this.className}`,this.buttonGroupContainer=document.createElement("div"),this.buttonGroupContainer.className=`deck-widget-button-group ${this.props.orientation}`,e.appendChild(this.buttonGroupContainer),this.updateHTML(),e}onRenderHTML(){if(!this.buttonGroupContainer)return;const{buttons:e}=this.props,t=Array.from(this.buttonGroupContainer.querySelectorAll(".deck-widget-button"));if(e.forEach((i,s)=>{const a=t[s];if(a){const l=a.querySelector("button"),u=a.querySelector(".deck-widget-icon");l&&u&&(l.title=i.title,l.setAttribute("aria-label",i.title),l.onclick=i.onClick,u.textContent!==i.iconName&&(u.textContent=i.iconName))}else{const l=document.createElement("div");l.className="deck-widget-button";const u=document.createElement("button");u.type="button",u.title=i.title,u.setAttribute("aria-label",i.title),u.onclick=i.onClick;const h=document.createElement("div");h.className="deck-widget-icon material-symbols-outlined",h.textContent=i.iconName,u.appendChild(h),l.appendChild(u),this.buttonGroupContainer.appendChild(l)}}),t.length>e.length)for(let i=e.length;i<t.length;i++)t[i].remove()}setProps(e){this.placement=e.placement??this.placement,this.viewId=e.viewId??this.viewId,super.setProps(e),this.rootElement&&e.className&&(this.className=e.className,this.rootElement.className=`deck-widget ${this.className}`),this.buttonGroupContainer&&e.orientation&&(this.buttonGroupContainer.className=`deck-widget-button-group ${e.orientation}`)}}const FL={position:"absolute",top:10,right:80,minWidth:"250px",maxWidth:"400px",maxHeight:"60vh",backgroundColor:"rgba(0, 0, 0, 0.8)",borderRadius:"5px",zIndex:1e3,color:"white",fontFamily:"Arial, sans-serif",boxSizing:"border-box",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",display:"flex",flexDirection:"column"},LL={display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #ccc",padding:"0.75rem 1rem",flexShrink:0},zL={background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",padding:"0 0.5rem",color:"white",lineHeight:1},VL={padding:"1rem",overflowY:"auto"},i1=n=>{const e=a1.c(19),{title:t,onClose:i,children:s,style:a}=n,l=te.useRef(null);let u,h;e[0]!==i?(u=()=>{const E=C=>{l.current&&!l.current.contains(C.target)&&i()};return document.addEventListener("mousedown",E),()=>{document.removeEventListener("mousedown",E)}},h=[i],e[0]=i,e[1]=u,e[2]=h):(u=e[1],h=e[2]),te.useEffect(u,h);let d;e[3]!==a?(d={...FL,...a},e[3]=a,e[4]=d):d=e[4];let p;e[5]===Symbol.for("react.memo_cache_sentinel")?(p={margin:0},e[5]=p):p=e[5];let m;e[6]!==t?(m=ve.jsx("h4",{style:p,children:t}),e[6]=t,e[7]=m):m=e[7];let y;e[8]!==i?(y=ve.jsx("button",{style:zL,onClick:i,"aria-label":"Close panel",children:" "}),e[8]=i,e[9]=y):y=e[9];let v;e[10]!==m||e[11]!==y?(v=ve.jsxs("div",{style:LL,children:[m,y]}),e[10]=m,e[11]=y,e[12]=v):v=e[12];let x;e[13]!==s?(x=ve.jsx("div",{style:VL,children:s}),e[13]=s,e[14]=x):x=e[14];let A;return e[15]!==d||e[16]!==v||e[17]!==x?(A=ve.jsxs("div",{ref:l,style:d,children:[v,x]}),e[15]=d,e[16]=v,e[17]=x,e[18]=A):A=e[18],A},HL="pk.eyJ1IjoibGluZHJldyIsImEiOiJjbTdsdm92aWswZDBhMndxNDdmNGl6ZHN6In0.HsNTemohqwAAb9ZCfFOm6A",jL="data/earthquakes.json",$L=B1([0,-5e5],QC),s1=4.3,WL={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11},Lc=n=>{try{const[e,t]=n.split(" - "),[i,s,a]=e.split(" "),l=parseInt(i),u=WL[s],h=parseInt(a),[d,p]=t.split(" "),[m,y]=d.split(":");let v=parseInt(m);const x=parseInt(y);return p==="PM"&&v!==12&&(v+=12),p==="AM"&&v===12&&(v=0),new Date(h,u,l,v,x)}catch(e){return console.error("Failed to parse date string:",n,e),new Date(0)}},XL={longitude:122,latitude:12.5,zoom:5.5,pitch:50,bearing:0},YL={position:"absolute",top:10,left:10,width:"400px",height:"90%",padding:"1rem",backgroundColor:"rgba(0, 0, 0, 0.8)",boxShadow:"-2px 0 8px rgba(0, 0, 0, 0.3)",boxSizing:"border-box",borderRadius:"5px",fontFamily:"Arial, sans-serif",fontSize:"18px",zIndex:1e3,transition:"transform 0.3s ease-in-out",overflowY:"auto",color:"#ffffff"},qL={display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid #ccc",paddingBottom:"0.5rem",color:"#ffffff"},ZL={background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",padding:"0 0.5rem",color:"#ffffff"},KL={padding:"8px 4px",borderBottom:"1px solid #444",cursor:"pointer",fontSize:"14px",transition:"background-color 0.2s"},QL={display:"block",fontSize:"12px",color:"#ccc"},GL={display:"block",fontSize:"12px",color:"#aaa"};function JL(){const[n,e]=te.useState(null),[t,i]=te.useState(null),[s,a]=te.useState(XL),[l,u]=te.useState(null),[h,d]=te.useState({scale:0,opacity:0}),p=te.useRef(0),m=te.useRef(null),[y,v]=te.useState([]),[x,A]=te.useState([]),[E,C]=te.useState([0,10]),[D,M]=te.useState([s1,10]),[B,z]=te.useState([]);te.useEffect(()=>{IC(jL).then(Z=>{if(Z){v(Z);const ue=Z.map(Wt=>Wt.magnitude),be=Math.floor(Math.min(...ue)*10)/10,Ne=Math.floor(Math.max(...ue)*10)/10;C([be,Ne]),M([Math.min(s1,Ne),Ne]);const Zn=[...Z].sort((Wt,rs)=>Lc(rs.datetime).getTime()-Lc(Wt.datetime).getTime()).slice(0,20);z(Zn)}})},[]),te.useEffect(()=>{const[Z,ue]=D,be=y.filter(Ne=>Ne.magnitude>=Z&&Ne.magnitude<=ue);A(be),t&&!be.find(Ne=>Ne.id===t.id)&&(i(null),e(null))},[y,D,t]),te.useEffect(()=>{if(!n){p.current&&cancelAnimationFrame(p.current),d({scale:0,opacity:0});return}let Z=null;const ue=2e3,be=5e4,Ne=Ke=>{Z||(Z=Ke);const Wt=(Ke-Z)%ue/ue;d({scale:Wt*be,opacity:Math.max(0,.7-Wt*.7)}),p.current=requestAnimationFrame(Ne)};return p.current=requestAnimationFrame(Ne),()=>{p.current&&cancelAnimationFrame(p.current)}},[n]);const X=Z=>{const be=60*Math.PI/180,Wt=Z.depth_km*1e3*Math.tan(be)/111321,rs=Z.latitude-Wt;a(tl=>({...tl,longitude:Z.longitude,latitude:rs,zoom:8,pitch:60,bearing:0,transitionInterpolator:new Qg({speed:1.5}),transitionDuration:2e3}))},ne=({object:Z})=>{Z?(i(Z),e(Z),u(null),X(Z)):(i(null),e(null))},ae=Z=>{let[ue,be]=D,Ne=!1;Z.magnitude<ue&&(ue=Z.magnitude,Ne=!0),Z.magnitude>be&&(be=Z.magnitude,Ne=!0),Ne&&M([ue,be]),X(Z),i(Z),e(Z),u(null)},ie=new Po({id:"earthquakes",data:x,radiusUnits:"meters",getPosition:Z=>[Z.longitude,Z.latitude,-Z.depth_km*1e3],getRadius:Z=>Math.pow(2,Z.magnitude)*100,getFillColor:Z=>{const ue=$L(-Z.depth_km*1e3),be=Uo(ue);return[be.r,be.g,be.b]},radiusMinPixels:2,pickable:!0,autoHighlight:!0,billboard:!0}),ge=new i_({id:"depth-lines",data:n?[n]:[],getSourcePosition:Z=>[Z.longitude,Z.latitude,-Z.depth_km*1e3],getTargetPosition:Z=>[Z.longitude,Z.latitude,0],getColor:[255,255,255],getWidth:2,pickable:!1}),ee=new Po({id:"epicenter-ripple",data:n?[n]:[],radiusUnits:"meters",getPosition:Z=>[Z.longitude,Z.latitude,-Z.depth_km*1e3],getRadius:()=>h.scale,getFillColor:[255,255,255,Math.floor(h.opacity*128)],radiusMinPixels:0,radiusMaxPixels:5e4,pickable:!1,billboard:!0,updateTriggers:{getRadius:[h.scale],getFillColor:[h.opacity]}}),fe=new Po({id:"epicenter-circle",data:n?[n]:[],radiusUnits:"meters",lineWidthUnits:"pixels",getPosition:Z=>[Z.longitude,Z.latitude,1],getRadius:500,getFillColor:[255,255,255,128],getLineColor:[0,0,0,255],getLineWidth:2,radiusMinPixels:4,pickable:!1,billboard:!0}),we=[ie,ge,ee,fe],me=()=>{u(Z=>Z==="history"?null:"history")},He=()=>{u(Z=>Z==="filter"?null:"filter")},W=Z=>{console.log("Button widget was clicked!",Z),alert("Check historical earthquake from 2018 to October 2025")},se=()=>{open("https://github.com/GReturn/philippines-equake-locator-3d")},de=new n1({id:"source-code-widget",placement:"bottom-right",title:"Source Code",onClick:se,iconName:"code",iconClassName:"deck-widget-icon-button my-custom-widget-button"}),Ee=new n1({id:"about-widget",placement:"bottom-right",title:"About",onClick:W,iconName:"info",iconClassName:"deck-widget-icon-button my-custom-widget-button"}),Le=[{id:"filter-widget",title:"Add Filters",iconName:"filter_list",onClick:He},{id:"history-widget",title:"Recent Earthquakes",iconName:"list",onClick:me}],I=new UL({id:"my-tools-widget",placement:"top-right",orientation:"vertical",buttons:Le,className:"my-custom-group"}),G=[new gx({placement:"top-right"}),new _x({placement:"top-right"}),new mx({placement:"top-right",container:m.current||void 0}),I,Ee,de],oe=Z=>{const ue=+Z.target.value;M([ue,Math.max(ue,D[1])])},ce=Z=>{const ue=+Z.target.value;M([Math.min(D[0],ue),ue])};return ve.jsx(ve.Fragment,{children:ve.jsxs("div",{ref:m,style:{position:"relative",width:"100vw",height:"100vh"},children:[ve.jsx("div",{style:{position:"relative",width:"100vw",height:"100vh"},children:ve.jsx(jF,{viewState:s,onViewStateChange:Z=>a(Z.viewState),controller:!0,layers:we,widgets:G,onHover:Z=>{t||e(Z.object)},onClick:ne,getTooltip:({object:Z})=>Z&&`Mag ${Z.magnitude} Earthquake
- Depth: ${Z.depth_km} km`,children:ve.jsx(yL,{mapboxAccessToken:HL,mapStyle:"style.json",projection:"mercator",attributionControl:!1})})}),ve.jsxs("div",{style:{...YL,transform:t?"translateX(0)":"translateX(-450px)"},children:[ve.jsxs("div",{style:qL,children:[ve.jsx("h3",{style:{margin:0},children:"Earthquake Details"}),ve.jsx("button",{style:ZL,onClick:()=>{i(null),e(null)},children:""})]}),ve.jsxs("div",{style:{marginTop:"1rem"},children:[ve.jsxs("p",{children:[ve.jsx("strong",{children:"Magnitude:"})," ",t?.magnitude]}),ve.jsxs("p",{children:[ve.jsx("strong",{children:"Location:"})," ",t?.location]}),ve.jsxs("p",{children:[ve.jsx("strong",{children:"Date:"})," ",t?Lc(t.datetime).toLocaleString():""]}),ve.jsxs("p",{children:[ve.jsx("strong",{children:"Depth:"})," ",t?.depth_km," km"]}),ve.jsxs("p",{children:[ve.jsx("strong",{children:"Latitude:"})," ",t?.latitude]}),ve.jsxs("p",{children:[ve.jsx("strong",{children:"Longitude:"})," ",t?.longitude]}),ve.jsxs("p",{children:[ve.jsx("strong",{children:"ID:"})," ",t?.id]})]})]}),l==="filter"&&ve.jsxs(i1,{title:"Filter by Magnitude",onClose:()=>u(null),children:[ve.jsxs("div",{style:{marginBottom:"10px"},children:[ve.jsxs("label",{htmlFor:"minMag",style:{display:"block",marginBottom:"5px"},children:["Min: ",D[0].toFixed(1)]}),ve.jsx("input",{type:"range",id:"minMag",min:E[0],max:E[1],step:"0.1",value:D[0],onChange:oe,style:{width:"100%"}})]}),ve.jsxs("div",{children:[ve.jsxs("label",{htmlFor:"maxMag",style:{display:"block",marginBottom:"5px"},children:["Max: ",D[1].toFixed(1)]}),ve.jsx("input",{type:"range",id:"maxMag",min:E[0],max:E[1],step:"0.1",value:D[1],onChange:ce,style:{width:"100%"}})]})]}),l==="history"&&ve.jsx(i1,{title:"Recent Earthquakes",onClose:()=>u(null),children:ve.jsx("ul",{style:{listStyle:"none",padding:0,margin:0},children:B.map(Z=>ve.jsxs("li",{onClick:()=>ae(Z),style:KL,onMouseEnter:ue=>ue.currentTarget.style.backgroundColor="#333",onMouseLeave:ue=>ue.currentTarget.style.backgroundColor="transparent",children:[ve.jsxs("strong",{children:["Mag ",Z.magnitude]}),ve.jsx("span",{style:QL,children:Z.location}),ve.jsx("span",{style:GL,children:Lc(Z.datetime).toLocaleString()})]},Z.id))})})]})})}function e5(){const n=a1.c(1);let e;return n[0]===Symbol.for("react.memo_cache_sentinel")?(e=ve.jsx("div",{style:{width:"100vw",height:"100vh"},children:ve.jsx(JL,{})}),n[0]=e):e=n[0],e}QS.createRoot(document.getElementById("root")).render(ve.jsx(te.StrictMode,{children:ve.jsx(e5,{})}));
